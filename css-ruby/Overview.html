<!DOCTYPE html>
<!--

Issues:
	bidi
	box layout/sizing
	clean up inter-character vs. parallel layout requirements

Redo all examples with consistent font. (M+ 2p?)

-->

<html lang=en>
 <head>
  <meta content="text/html; charset=utf-8" http-equiv=Content-Type>
  <title>CSS Ruby Module Level 1</title>
  <!--
  <link href="http://purl.org/dc/terms/" rel="schema.dcterms">
  <link href="http://www.w3.org/Consortium/Legal/ipr-notice#Copyright" rel="dcterms.rights">
  -->

  <meta content="CSS Ruby Module Level 1" name=dcterms.title>
  <meta content=text name=dcterms.type>
  <meta content=2014-05-29 name=dcterms.date>
  <meta content="Elika J. Etemad" name=dcterms.creator>
  <meta content="Koji Ishii" name=dcterms.creator>
  <meta content="Richard Ishida" name=dcterms.creator>
  <meta content=W3C name=dcterms.publisher>
  <meta content="http://dev.w3.org/csswg/css3-ruby/" name=dcterms.identifier>
  <link href="#contents" rel=contents>
  <link href="#index" rel=index>
  <link href="../default.css" rel=stylesheet type="text/css">
  <link href="../csslogo.ico" rel="shortcut icon" type="image/x-icon">
  <link href="http://www.w3.org/StyleSheets/TR/W3C-ED.css" rel=stylesheet
   type="text/css">

 <body class=h-entry>
  <div class=head> <!--begin-logo-->
   <p><a href="http://www.w3.org/"><img alt=W3C height=48
    src="http://www.w3.org/Icons/w3c_home" width=72></a> <!--end-logo-->

   <h1 class=p-name>CSS Ruby Module Level 1</h1>

   <h2 class="no-num no-toc">Editor's Draft <time class=dt-updated
    datetime=20140529>29 May 2014</time>
    <!-- for HTML4 doctype: <span class="value-title" title="20140529">29 May 2014</span></span> --></h2>

   <dl>
    <dt>This version:

    <dd><a class=u-url
     href="http://dev.w3.org/csswg/css3-ruby/">http://dev.w3.org/csswg/css3-ruby/</a>

    <dt>Latest version:

    <dd><a
     href="http://www.w3.org/TR/css3-ruby/">http://www.w3.org/TR/css3-ruby/</a>

    <dt>Editor's draft:

    <dd><a
     href="http://dev.w3.org/csswg/css3-ruby/">http://dev.w3.org/csswg/css3-ruby/</a>
     (<a
     href="https://dvcs.w3.org/hg/csswg/log/tip/css3-ruby/Overview.src.html">change
     log</a>)

    <dt>Previous version:

    <dd><a href="http://www.w3.org/TR/2011/WD-css3-ruby-20110630/">
     http://www.w3.org/TR/2011/WD-css3-ruby-20110630/</a>

    <dt>Issue Tracking:

    <dd><a href="http://www.w3.org/Style/CSS/Tracker/products/FIXME"
     rel=issues>http://www.w3.org/Style/CSS/Tracker/products/FIXME</a>

    <dt>Feedback:

    <dd><a
     href="mailto:www-style@w3.org?subject=%5BSHORTNAME%5D%20feedback">www-style@w3.org</a>
     with subject line “<kbd>[css3-ruby] <var>… message topic
     …</var></kbd>” (<a
     href="http://lists.w3.org/Archives/Public/www-style/"
     rel=discussion>archives</a>)

    <dt>Editors:

    <dd class="p-author h-card vcard"> <a class="p-name fn u-url url"
     href="http://fantasai.inkedblade.net/contact" rel=author>Elika J.
     Etemad</a>, <a class="p-org org h-org"
     href="http://www.mozilla.org/">Mozilla</a>

    <dd class="p-author h-card vcard"> <a class="p-name fn u-url url"
     href="mailto:koji.a.ishii@mail.rakuten.com" rel=author>Koji Ishii</a>,
     <span class="p-org org">Rakuten, Inc.</span>

    <dd class="p-author h-card vcard"> <a class="p-name fn u-url url"
     href="mailto:ishida@w3.org" rel=author>Richard Ishida</a>, <span
     class="p-org org">W3C</span>

    <dt>Former editors:

    <dd>Michel Suignard, Microsoft

    <dd>Marcin Sawicki, Microsoft
   </dl>
   <!--begin-copyright-->
   <p class=copyright><a
    href="http://www.w3.org/Consortium/Legal/ipr-notice#Copyright"
    rel=license>Copyright</a> © 2014 <a href="http://www.w3.org/"><abbr
    title="World Wide Web Consortium">W3C</abbr></a><sup>®</sup> (<a
    href="http://www.csail.mit.edu/"><abbr
    title="Massachusetts Institute of Technology">MIT</abbr></a>, <a
    href="http://www.ercim.eu/"><abbr
    title="European Research Consortium for Informatics and Mathematics">ERCIM</abbr></a>,
    <a href="http://www.keio.ac.jp/">Keio</a>, <a
    href="http://ev.buaa.edu.cn/">Beihang</a>), All Rights Reserved. W3C <a
    href="http://www.w3.org/Consortium/Legal/ipr-notice#Legal_Disclaimer">liability</a>,
    <a
    href="http://www.w3.org/Consortium/Legal/ipr-notice#W3C_Trademarks">trademark</a>
    and <a
    href="http://www.w3.org/Consortium/Legal/copyright-documents">document
    use</a> rules apply.</p>
   <!--end-copyright-->
   <hr title="Separator for header">
  </div>

  <h2 class="no-num no-toc" id=abstract>Abstract</h2>

  <p> <span class=p-summary> “Ruby” are short runs of text alongside the
   base text, typically used in East Asian documents to indicate
   pronunciation or to provide a short annotation. This module describes the
   rendering model and formatting controls related to displaying ruby
   annotations in CSS. </span> <a href="http://www.w3.org/TR/CSS/">CSS</a> is
   a language for describing the rendering of structured documents (such as
   HTML and XML) on screen, on paper, in speech, etc.

  <h2 class="no-num no-toc" id=status>Status of this document</h2>
  <!--begin-status-->

  <p>This is a public copy of the editors' draft. It is provided for
   discussion only and may change at any moment. Its publication here does
   not imply endorsement of its contents by W3C. Don't cite this document
   other than as work in progress.

  <p>The (<a
   href="http://lists.w3.org/Archives/Public/www-style/">archived</a>) public
   mailing list <a
   href="mailto:www-style@w3.org?Subject=%5Bcss3-ruby%5D%20PUT%20SUBJECT%20HERE">
   www-style@w3.org</a> (see <a
   href="http://www.w3.org/Mail/Request">instructions</a>) is preferred for
   discussion of this specification. When sending e-mail, please put the text
   “css3-ruby” in the subject, preferably like this:
   “[<!---->css3-ruby<!---->] <em>…summary of comment…</em>”

  <p>This document was produced by the <a
   href="http://www.w3.org/Style/CSS/members">CSS Working Group</a> (part of
   the <a href="http://www.w3.org/Style/">Style Activity</a>).

  <p>This document was produced by a group operating under the <a
   href="http://www.w3.org/Consortium/Patent-Policy-20040205/">5 February
   2004 W3C Patent Policy</a>. W3C maintains a <a
   href="http://www.w3.org/2004/01/pp-impl/32061/status"
   rel=disclosure>public list of any patent disclosures</a> made in
   connection with the deliverables of the group; that page also includes
   instructions for disclosing a patent. An individual who has actual
   knowledge of a patent which the individual believes contains <a
   href="http://www.w3.org/Consortium/Patent-Policy-20040205/#def-essential">Essential
   Claim(s)</a> must disclose the information in accordance with <a
   href="http://www.w3.org/Consortium/Patent-Policy-20040205/#sec-Disclosure">section
   6 of the W3C Patent Policy</a>.</p>
  <!--end-status-->

  <p>The following features are at risk: …

  <h2 class="no-num no-toc" id=contents> Table of Contents</h2>
  <!--begin-toc-->

  <ul class=toc>
   <li><a href="#intro"><span class=secno>1. </span> Introduction</a>
    <ul class=toc>
     <li><a href="#placement"><span class=secno>1.1. </span> Module
      interactions</a>

     <li><a href="#values"><span class=secno>1.2. </span> Values</a>

     <li><a href="#diagram-conventions"><span class=secno>1.3. </span>
      Diagram conventions</a>

     <li><a href="#ruby-def"><span class=secno>1.4. </span> What is ruby?</a>
    </ul>

   <li><a href="#ruby-model"><span class=secno>2. </span> Ruby Formatting
    Model</a>
    <ul class=toc>
     <li><a href="#ruby-display"><span class=secno>2.1. </span> Ruby-specific
      ‘<code class=property>display</code>’ property values</a>

     <li><a href="#box-fixup"><span class=secno>2.2. </span> Anonymous Ruby
      Box Generation</a>
      <ul class=toc>
       <li><a href="#block-ruby"><span class=secno>2.2.1. </span> Block-level
        Ruby</a>
      </ul>

     <li><a href="#pairing"><span class=secno>2.3. </span> Ruby Pairing and
      Annotation Levels</a>
      <ul class=toc>
       <li><a href="#nested-pairing"><span class=secno>2.3.1. </span> Nested
        Ruby</a>
      </ul>

     <li><a href="#autohide"><span class=secno>2.4. </span> Autohiding
      Annotations</a>

     <li><a href="#white-space"><span class=secno>2.5. </span> White
      Space</a>

     <li><a href="#ruby-layout"><span class=secno>2.6. </span> Ruby
      layout</a>
      <ul class=toc>
       <li><a href="#inter-character-layout"><span class=secno>2.6.1. </span>
        Inter-character ruby layout</a>
      </ul>

     <li><a href="#box-style"><span class=secno>2.7. </span> Styling Ruby
      Boxes</a>

     <li><a href="#line-breaks"><span class=secno>2.8. </span> Ruby box and
      line breaking</a>
      <ul class=toc>
       <li><a href="#break-between"><span class=secno>2.8.1. </span> Breaking
        between bases</a>

       <li><a href="#break-within"><span class=secno>2.8.2. </span> Breaking
        within bases</a>
      </ul>

     <li><a href="#ruby-bidi"><span class=secno>2.9. </span> Bidi
      Reordering</a>

     <li><a href="#line-height"><span class=secno>2.10. </span> Ruby box and
      line stacking</a>
    </ul>

   <li><a href="#ruby-props"><span class=secno>3. </span> Ruby Properties</a>

    <ul class=toc>
     <li><a href="#rubypos"><span class=secno>3.1. </span> Ruby positioning:
      the ‘<code class=property>ruby-position</code>’ property</a>

     <li><a href="#collapsed-ruby"><span class=secno>3.2. </span> Collapsed
      Ruby Annotations: the ‘<code class=property>ruby-merge</code>’
      property</a>

     <li><a href="#ruby-align-property"><span class=secno>3.3. </span> Ruby
      Text Distribution: the ‘<code class=property>ruby-align</code>’
      property</a>
    </ul>

   <li><a href="#edge-effects"><span class=secno>4. </span> Edge Effects</a>
    <ul class=toc>
     <li><a href="#ruby-overhang"><span class=secno>4.1. </span> Overhanging
      Ruby</a>

     <li><a href="#line-edge"><span class=secno>4.2. </span> Line-edge
      Alignment</a>
    </ul>

   <li class=no-num><a href="#default-stylesheet"> Appendix A: Default Style
    Sheet</a>
    <ul class=toc>
     <li class=no-num><a href="#default-ua-ruby"> Supporting Ruby Layout</a>

     <li class=no-num><a href="#default-inline"> Inlining Ruby
      Annotations</a>

     <li class=no-num><a href="#default-parens"> Generating Parentheses</a>
    </ul>

   <li><a href="#glossary"><span class=secno>5. </span> Glossary</a>

   <li><a href="#conformance"><span class=secno>6. </span> Conformance</a>
    <ul class=toc>
     <li><a href="#conventions"><span class=secno>6.1. </span> Document
      conventions</a>

     <li><a href="#conformance-classes"><span class=secno>6.2. </span>
      Conformance classes</a>

     <li><a href="#partial"><span class=secno>6.3. </span> Partial
      implementations</a>

     <li><a href="#experimental"><span class=secno>6.4. </span> Experimental
      implementations</a>

     <li><a href="#testing"><span class=secno>6.5. </span> Non-experimental
      implementations</a>
    </ul>

   <li class=no-num><a href="#acknowledgments"> Acknowledgments</a>

   <li class=no-num><a href="#changes"> Changes</a>

   <li class=no-num><a href="#references"> References</a>
    <ul class=toc>
     <li class=no-num><a href="#normative-references"> Normative
      references</a>

     <li class=no-num><a href="#other-references"> Other references</a>
    </ul>

   <li class=no-num><a href="#index"> Index</a>

   <li class=no-num><a href="#property-index"> Property index</a>
  </ul>
  <!--end-toc-->

  <h2 id=intro><span class=secno>1. </span> Introduction</h2>

  <p><em>This section is not normative.</em>

  <h3 id=placement><span class=secno>1.1. </span> Module interactions</h3>

  <p>This module extends the inline box model of CSS Level 2 <a
   href="#ref-CSS21">[CSS21]<!--{{!CSS21}}--></a> to support ruby.

  <p>None of the properties in this module apply to the
   <code>::first-line</code> or <code>::first-letter</code> pseudo-elements.

  <h3 id=values><span class=secno>1.2. </span> Values</h3>

  <p>This specification follows the <a
   href="http://www.w3.org/TR/CSS21/about.html#property-defs">CSS property
   definition conventions</a> from <a
   href="#ref-CSS21">[CSS21]<!--{{!CSS21}}--></a>. Value types not defined in
   this specification are defined in CSS Level 2 Revision 1 <a
   href="#ref-CSS21">[CSS21]<!--{{!CSS21}}--></a>. Other CSS modules may
   expand the definitions of these value types: for example <a
   href="#ref-CSS3VAL">[CSS3VAL]<!--{{CSS3VAL}}--></a>, when combined with
   this module, expands the definition of the <var>&lt;length&gt;</var> value
   type as used in this specification.

  <p>In addition to the property-specific values listed in their definitions,
   all properties defined in this specification also accept the <a
   href="http://www.w3.org/TR/CSS21/cascade.html#value-def-inherit">inherit</a>
   keyword as their property value. For readability it has not been repeated
   explicitly.

  <h3 id=diagram-conventions><span class=secno>1.3. </span> Diagram
   conventions</h3>

  <p>Many typographical conventions in East Asian typography depend on
   whether the character rendered is wide (CJK) or narrow (non-CJK). There
   are a number of illustrations in this document for which the following
   legend is used:

  <dl>
   <dt><img alt="Symbolic wide-cell glyph representation" height=39
    src="images/fullwidth.gif" width=39>

   <dd>Wide-cell glyph (e.g. Han) that is the <var>n</var>th character in the
    text run. They are typically sized to 50% when used as annotations.

   <dt><img alt="Symbolic narrow-cell glyph representation" height=39
    src="images/halfwidth.gif" width=19>

   <dd>Narrow-cell glyph (e.g. Roman) which is the <var>n</var>th glyph in
    the text run.
  </dl>

  <p>The orientation which the above symbols assume in the diagrams
   corresponds to the orientation that the glyphs they represent are intended
   to assume when rendered by the user agent. Spacing between these
   characters in the diagrams is incidental, unless intentionally changed to
   make a point.

  <h3 id=ruby-def><span class=secno>1.4. </span> What is ruby?</h3>

  <p><dfn id=ruby>Ruby</dfn> is the commonly-used name for a run of text that
   appears alongside another run of text (referred to as the “base”) and
   serves as an annotation or a pronunciation guide associated with that run
   of text.

  <p>The following figures show two examples of Ruby, a simple case and one
   with more complicated structure.

  <div class=example>
   <p>In this first example, a single annotation is used to annotate the base
    text.

   <div class=figure>
    <p><img alt="Example of ruby applied on top of a Japanese expression"
     src="images/licence.png">

    <p class=caption>Example of ruby used in Japanese (simple case)
   </div>

   <p>In Japanese typography, this case is sometimes called <i
    lang=ja>taigo</i> ruby or group-ruby (per-word ruby), because the
    annotation as a whole is associated with multi-character word (as a
    whole).
  </div>

  <div class=example>
   <p>In this second example, two levels of annotations are attached to a
    base sequence: the hiragana characters on top refer to the pronunciation
    of each of the base kanji characters, while the words “Keio” and
    “University” on the bottom are annotations describing the English
    translation.

   <div class=figure>
    <p><img
     alt="Example showing complex ruby with annotation text over and under the base characters"
     src="images/ruby-univ.gif">

    <p class=caption>Complex ruby with annotation text over and under the
     base characters
   </div>

   <p>

   <p>Notice that to allow correct association between the hiragana
    characters and their corresponding Kanji base characters, the spacing
    between these Kanji characters is adjusted. (This happens around the
    fourth Kanji character in the figure above.) To avoid variable spacing
    between the Kanji characters in the example above the hiragana
    annotations can be styled as a <i>collapsed annotation</i>, which will
    look more like the group-ruby example earlier. However because the
    base-annotation pairings are recorded in the ruby structure, if the text
    breaks across lines, the annotation characters will stay correctly paired
    with their respective base characters.
  </div>

  <p><a href="#ruby"><i>Ruby</i></a> formatting as used in Japanese is
   described in JIS X-4051 <a
   href="#ref-JIS4051">[JIS4051]<!--{{JIS4051}}--></a> (in Japanese) and in
   Requirements for Japanese Text Layout <a
   href="#ref-JLREQ">[JLREQ]<!--{{JLREQ}}--></a> (in English and Japanese)].
   In HTML, ruby structure and markup to represent it is described in the
   Ruby Markup Extension specification. This module describes the CSS
   rendering model and formatting controls relevant to ruby layout of such
   markup.

  <h2 id=ruby-model><span class=secno>2. </span> Ruby Formatting Model</h2>

  <p>The CSS ruby model is based on the <a
   href="http://darobin.github.io/html-ruby/">HTML Ruby Markup Extension</a>
   and <a href="http://www.w3.org/TR/ruby/">XHTML Ruby Annotation
   Recommendation</a> <a href="#ref-RUBY">[RUBY]<!--{{RUBY}}--></a>. In this
   model, a ruby structure consists of one or more <dfn id=ruby-base>ruby
   base</dfn> elements representing the base (annotated) text, associated
   with one or more levels of <dfn id=ruby-annotation>ruby annotation</dfn>
   elements representing the annotations. The structure of ruby is similar to
   that of a table: there are “rows” (the base text level, each
   annotation level) and “columns” (each <a href="#ruby-base-box"><i>ruby
   base</i></a> and its corresponding <a href="#ruby-annotation-box"><i>ruby
   annotations</i></a>).

  <p>Consecutive bases and annotations are grouped together into <dfn
   id=ruby-segments>ruby segments</dfn>. Within a <i>ruby segment</i>, a <a
   href="#ruby-annotation-box"><i>ruby annotation</i></a> may span multiple
   <a href="#ruby-base-box"><i>ruby bases</i></a>.

  <p class=note>In HTML, a single <code>&lt;ruby&gt;</code> element may
   contain multiple <a href="#ruby-segments"><i>ruby segments</i></a>. (In
   the XHTML Ruby model, a single <code>&lt;ruby&gt;</code> element can only
   contain one <i>ruby segment</i>.)

  <h3 id=ruby-display><span class=secno>2.1. </span> Ruby-specific ‘<code
   class=property>display</code>’ property values</h3>

  <p>For document languages (such as XML applications) that do not have
   pre-defined ruby elements, authors must map document language elements to
   ruby elements; this is done with the ‘<code
   class=property>display</code>’ property.

  <table class=propdef>
   <tbody>
    <tr>
     <th>Name:

     <td>display

    <tr>
     <th><a href="#values">New Values</a>:

     <td>ruby | ruby-base | ruby-text | ruby-base-container |
      ruby-text-container
  </table>

  <p>The following new ‘<code class=property>display</code>’ values
   assign ruby layout roles to an arbitrary element:

  <dl>
   <dt>‘<a href="#ruby"><code class=css>ruby</code></a>’

   <dd>Specifies that an element generates a <dfn id=ruby-container-box
    title="ruby container | ruby container box">ruby container box</dfn>.
    (Corresponds to HTML/XHTML <code>&lt;ruby&gt;</code> elements.)

   <dt>‘<code class=css>ruby-base</code>’

   <dd>Specifies that an element generates a <dfn id=ruby-base-box
    title="ruby base box | ruby base">ruby base box</dfn>. (Corresponds to
    HTML/XHTML <code>&lt;rb&gt;</code> elements.)

   <dt>‘<code class=css>ruby-text</code>’

   <dd>Specifies that an element generates a <dfn id=ruby-annotation-box
    title="ruby annotation box | ruby annotation">ruby annotation box</dfn>.
    (Corresponds to HTML/XHTML <code>&lt;rt&gt;</code> elements.)

   <dt>‘<code class=css>ruby-base-container</code>’

   <dd>Specifies that an element generates a <dfn id=ruby-base-container-box
    title="ruby base container box | ruby base container">ruby base container
    box</dfn>. (Corresponds to XHTML <code>&lt;rbc&gt;</code> elements;
    generated as an anonymous box in HTML.)

   <dt>‘<code class=css>ruby-text-container</code>’

   <dd>Specifies that an element generates a <dfn
    id=ruby-annotation-container-box
    title="ruby annotation container box | ruby annotation container">ruby
    annotation container box</dfn>. (Corresponds to HTML/XHTML
    <code>&lt;rtc&gt;</code> elements.)
  </dl>

  <h3 id=box-fixup><span class=secno>2.2. </span> Anonymous Ruby Box
   Generation</h3>

  <p>The CSS model does not require that the document language include
   elements that correspond to each of these components. Missing parts of the
   structure are implied through the anonymous box generation rules <a
   href="http://www.w3.org/TR/CSS21/tables.html#anonymous-boxes">similar to
   those used to normalize tables</a>. <a
   href="#ref-CSS21">[CSS21]<!--{{!CSS21}}--></a>

  <ol>
   <li>Any in-flow block-level boxes directly contained by a <a
    href="#ruby-container-box"><i>ruby container</i></a>, <a
    href="#ruby-base-container-box"><i>ruby base container</i></a>, <a
    href="#ruby-annotation-container-box"><i>ruby annotation
    container</i></a>, <a href="#ruby-base-box"><i>ruby base box</i></a>, or
    <a href="#ruby-annotation-box"><i>ruby annotation box</i></a> are forced
    to be inline-level boxes, and their ‘<code
    class=property>display</code>’ value computed accordingly. For example,
    the ‘<code class=property>display</code>’ property of an in-flow
    element with ‘<code class=css>display: block</code>’ parented by an
    element with ‘<code class=css>display: ruby-text</code>’ computes to
    ‘<code class=css>inline-block</code>’. This computation occurs after
    any intermediary anonymous-box fixup (such as that required by internal
    table elements).

   <li>Any consecutive sequence of <a href="#ruby-base-box"><i>ruby
    bases</i></a> not parented by a <a
    href="#ruby-base-container-box"><i>ruby base container</i></a> is wrapped
    in an anonymous <a href="#ruby-base-container-box"><i>ruby base
    container</i></a>. Similarly, any consecutive sequence of <a
    href="#ruby-annotation-box"><i>ruby annotations</i></a> not parented by a
    <a href="#ruby-annotation-container-box"><i>ruby annotation
    container</i></a> is wrapped in an anonymous <a
    href="#ruby-annotation-container-box"><i>ruby annotation
    container</i></a>.

   <li>Within each <a href="#ruby-base-container-box"><i>ruby base
    container</i></a>, each sequence of inline-level boxes is wrapped in an
    anonymous <a href="#ruby-base-box"><i>ruby base box</i></a>. Similarly,
    within each <a href="#ruby-annotation-container-box"><i>ruby annotation
    container</i></a>, each sequence of inline-level boxes is wrapped in an
    anonymous <a href="#ruby-annotation-box"><i>ruby annotation box</i></a>.

   <li>A sequence of <a href="#ruby-base-container-box"><i>ruby base
    containers</i></a> and/or <a
    href="#ruby-annotation-container-box"><i>ruby annotation
    containers</i></a> not parented by a <a
    href="#ruby-container-box"><i>ruby container</i></a> is wrapped in an
    anonymous <a href="#ruby-container-box"><i>ruby container</i></a>.
  </ol>

  <p>At this point, all ruby layout structures are properly parented, and the
   UA can start to associate bases with their annotations.

  <p class=note> Note that the UA is not required to create any of these
   anonymous boxes in its internal structures, as long as pairing and layout
   behaves as if they existed.

  <h4 id=block-ruby><span class=secno>2.2.1. </span> Block-level Ruby</h4>

  <p>If an element has a computed ‘<code
   class=property>display-inside</code>’ of ‘<a href="#ruby"><code
   class=css>ruby</code></a>’ and a computed ‘<code
   class=property>display-outside</code>’ other than ‘<code
   class=css>inline-level</code>’, then it generates two boxes: a principal
   block container box of the required ‘<code
   class=property>display-outside</code>’ type, and an inline-level <a
   href="#ruby-container-box"><i>ruby container</i></a>. All properties
   specified on the element apply to the principal box (and if inheritable,
   inherit to the <a href="#ruby-container-box"><i>ruby container
   box</i></a>). This allows styling the element as a block, while correctly
   maintaining the internal ruby structure.

  <p>See the <a href="http://www.w3.org/TR/css-display/">CSS Display
   Module</a> for more information on ‘<code
   class=property>display-inside</code>’ and ‘<code
   class=property>display-outside</code>’.

  <h3 id=pairing><span class=secno>2.3. </span> Ruby Pairing and Annotation
   Levels</h3>

  <p>Within a ruby structure, each <a href="#ruby-base-box"><i>ruby
   base</i></a> is associated with <a href="#ruby-annotation-box"><i>ruby
   annotations</i></a> and vice versa. A <a href="#ruby-base-box"><i>ruby
   base</i></a> can be associated with at most one <a
   href="#ruby-annotation-box"><i>ruby annotation</i></a> per annotation
   level. If there are multiple annotation levels, it can therefore be
   associated with multiple <a href="#ruby-annotation-box"><i>ruby
   annotations</i></a>. A <a href="#ruby-annotation-box"><i>ruby
   annotation</i></a> is associated with one or more <a
   href="#ruby-base-box"><i>ruby bases</i></a>; annotations can span multiple
   bases.

  <p><dfn id=annotation-pairing>Annotation pairing</dfn> is the process of
   associating <a href="#ruby-annotation-box"><i>ruby annotations</i></a>
   with <a href="#ruby-base-box"><i>ruby bases</i></a>.

  <ol>
   <li>
    <p>First, the ruby structure is divided into <a
     href="#ruby-segments"><i>ruby segments</i></a>, each consisting of a
     single <a href="#ruby-base-container-box"><i>ruby base container</i></a>
     followed by one or more <a href="#ruby-annotation-container-box"><i>ruby
     annotation containers</i></a>. If the first child of a <a
     href="#ruby-container-box"><i>ruby container</i></a> is a <a
     href="#ruby-annotation-container-box"><i>ruby annotation
     container</i></a>, an anonymous, empty <a
     href="#ruby-base-container-box"><i>ruby base container</i></a> is
     assumed to exist before it. Similarly, if the <a
     href="#ruby-container-box"><i>ruby container</i></a> contains
     consecutive <a href="#ruby-base-container-box"><i>ruby base
     containers</i></a>, anonymous, empty <a
     href="#ruby-annotation-container-box"><i>ruby annotation
     containers</i></a> are assumed to exist between them. The <a
     href="#ruby-base-container-box"><i>ruby base container</i></a> in each
     segment is thus associated with each of the <a
     href="#ruby-annotation-container-box"><i>ruby annotation
     containers</i></a> in that segment.

    <p>Each <a href="#ruby-annotation-container-box"><i>ruby annotation
     containers</i></a> in a <i>ruby segment</i> represents one <dfn id=level
     title="annotation level | level">level</dfn> of annotation: the first
     one represents the first level of annotation, the second one represents
     the second level of annotation, and so on.

   <li>Within each <i>ruby segment</i>, each <a href="#ruby-base-box"><i>ruby
    base box</i></a> in the <a href="#ruby-base-container-box"><i>ruby base
    container</i></a> is paired with one <a
    href="#ruby-annotation-box"><i>ruby annotation box</i></a> from each <a
    href="#ruby-annotation-container-box"><i>ruby annotation
    container</i></a> in its <i>ruby segment</i>. If there are not enough <a
    href="#ruby-annotation-box"><i>ruby annotations</i></a> in a <a
    href="#ruby-annotation-container-box"><i>ruby annotation
    container</i></a>, the last one is associated with any excess <a
    href="#ruby-base-box"><i>ruby bases</i></a>. (If there are not any in the
    <a href="#ruby-annotation-container-box"><i>ruby annotation
    container</i></a>, an anonymous empty one is assumed to exist.) If there
    are not enough <a href="#ruby-base-box"><i>ruby bases</i></a>, any
    remaining <a href="#ruby-annotation-box"><i>ruby annotations</i></a> are
    assumed to be associated with empty, anonymous bases inserted at the end
    of the <a href="#ruby-base-container-box"><i>ruby base container</i></a>.

    <p>If an implementation supports ruby markup with explicit spanning (e.g.
     XHTML Complex Ruby Annotations), it must adjust the pairing rules to
     pair spanning annotations to multiple bases appropriately.
  </ol>

  <p>A this point, ruby “columns” are defined, each represented by a
   single <a href="#ruby-base-box"><i>ruby base</i></a> and associated with
   one <a href="#ruby-annotation-box"><i>ruby annotation</i></a> (possibly an
   empty, anonymous one) from each <a href="#level"><i>annotation
   level</i></a>.

  <h4 id=nested-pairing><span class=secno>2.3.1. </span> Nested Ruby</h4>

  <p>When <a href="#ruby-container-box"><i>ruby containers</i></a> are
   nested, pairing begins with the deepest <a
   href="#ruby-container-box"><i>ruby container</i></a>, then expands out,
   treating each <a href="#ruby-container-box"><i>ruby container</i></a>
   nested within another <a href="#ruby-container-box"><i>ruby
   container</i></a> essentially as a single <a href="#ruby-base-box"><i>ruby
   base</i></a> in the outer <a href="#ruby-container-box"><i>ruby
   container</i></a>, and associating each <a
   href="#ruby-annotation-box"><i>ruby annotation</i></a> paired with the
   nested <a href="#ruby-container-box"><i>ruby container</i></a> as being
   associated with (spanning) all of its <a href="#ruby-base-box"><i>ruby
   bases</i></a>.

  <p>Using nested <a href="#ruby-container-box"><i>ruby containers</i></a>
   thus allows the representation of complex spanning relationships.

  <p class=issue>This has to be Level 1 because HTML5 allows it, so we have
   to handle it. Yay HTML5.

  <h3 id=autohide><span class=secno>2.4. </span> Autohiding Annotations</h3>

  <p>If a <a href="#ruby-annotation-box"><i>ruby annotation</i></a> has the
   exact same text content as its base, it is <dfn id=hidden
   title="hidden ruby annotation | hidden annotation">hidden</dfn>. Hiding a
   <a href="#ruby-annotation-box"><i>ruby annotation</i></a> does not affect
   annotation pairing or the block-axis positioning of boxes in other <a
   href="#level"><i>levels</i></a>. However the <a href="#hidden"><i>hidden
   annotation</i></a> is not visible, and it has no impact on layout other
   than to separate adjacent sequences of <a
   href="#ruby-annotation-box"><i>ruby annotation boxes</i></a> within its
   level, as if they belonged to separate segments and the <a
   href="#hidden"><i>hidden annotation</i></a>’s base were not a <a
   href="#ruby-base-box"><i>ruby base</i></a> but an intervening inline.

  <div class=example>
   <p>This is to allow correct inlined display of annotations for Japanese
    words that are a mix of kanji and hirangana. For example, the word
    <i>振り仮名</i> should be inlined as

   <p class=figure>振り仮名(ふりがな)

   <p>and therefore marked up as

   <pre>
<!--		-->&lt;ruby>
<!--		-->  &lt;rb>振&lt;/rb>&lt;rb>り&lt;/rb>&lt;rb>仮&lt;/rb>&lt;rb>名&lt;/rb>
<!--		-->  &lt;rp>(&lt;/rp>&lt;rt>ふ&lt;/rt>&lt;rt>り&lt;/rt>&lt;rt>が&lt;/rt>&lt;rt>な&lt;/rt>&lt;rp>)&lt;/rp>
<!--		-->&lt;ruby></pre>

   <p>However, when displayed as ruby, the “り” should be hidden

   <div class=figure>
    <p><img
     alt="Hiragana annotations for 振り仮名 appear, each above its base character."
     src="images/furigana-separate.png">

    <p class=caption>Hiragana ruby for 振り仮名
   </div>
  </div>

  <p class=note> Future levels of CSS Ruby may add controls for this, but in
   this level it is always forced.

  <p>The content comparison for this auto-hiding behavior takes place prior
   to white space collapsing and ignores elements (considers only the
   <code>textContent</code> of the boxes).

  <p class=issue>Is before or after white space collapsing easier? We should
   do whatever is easier, as it really doesn't matter much which way to go.

  <h3 id=white-space><span class=secno>2.5. </span> White Space</h3>

  <p><i>Collapsible</i> white space within a ruby structure is discarded

  <ul>
   <li>at the beginning and end of a <a href="#ruby-container-box"><i>ruby
    container</i></a>, <a href="#ruby-annotation-container-box"><i>ruby
    annotation container</i></a>, or <a
    href="#ruby-base-container-box"><i>ruby base container</i></a>,

   <li>at the beginning/end of a <a href="#ruby-annotation-box"><i>ruby
    annotation box</i></a> or <a href="#ruby-base-box"><i>ruby base
    box</i></a> if white space is not its only contents,

   <li>between a <a href="#ruby-base-container-box"><i>ruby base
    container</i></a> and its following <a
    href="#ruby-annotation-container-box"><i>ruby annotation
    container</i></a>,

   <li>between <a href="#ruby-annotation-container-box"><i>ruby annotation
    containers</i></a>.
  </ul>

  <p>Between <a href="#ruby-segments"><i>ruby segments</i></a>, between <a
   href="#ruby-base-box"><i>ruby bases</i></a>, and between <a
   href="#ruby-annotation-box"><i>ruby annotations</i></a>, however, white
   space is not discarded.

  <p>Where undiscarded white space is <i>collapsible</i>, it will collapse
   following the standard <a
   href="http://www.w3.org/TR/css3-text/#white-space-rules">white space
   processing rules</a>. <a
   href="#ref-CSS-TEXT-3">[CSS-TEXT-3]<!--{{!CSS-TEXT-3}}--></a> For
   <i>collapsible</i> white space between <a href="#ruby-segments"><i>ruby
   segments</i></a>, however, the contextual text for determining collapsing
   behavior is given by the <a href="#ruby-base-box"><i>ruby bases</i></a> on
   either side, not the text on either side of the white space in the source
   document.

  <div class=note>
   <p>Note that the white space processing rules cause a white space sequence
    containing a <i>segment break</i> (such as a line feed) to <a
    href="http://www.w3.org/TR/css3-text/#line-break-transform">collapse to
    nothing</a> between CJK characters. This means that CJK ruby can safely
    use white space for indentation of the ruby markup. For example, the
    following markup will display without any spaces:

   <pre>
<!--		-->&lt;ruby>
<!--		-->  &lt;rb>東&lt;/rb>&lt;rb>京&lt;/rb>
<!--		-->  &lt;rt>とう&lt;/rt>&lt;rt>きょう&lt;/rt>
<!--		-->&lt;/ruby></pre>

   <p>However, white space that does not contain a <i>segment break</i> does
    not collapse completely away, so this markup will display with a space
    between the first and second ruby pairs:

   <pre>
<!--		-->&lt;ruby>
<!--		-->  &lt;rb>東&lt;/rb>	&lt;rb>京&lt;/rb>
<!--		-->  &lt;rt>とう&lt;/rt>	&lt;rt>きょう&lt;/rt>
<!--		-->&lt;/ruby></pre>
  </div>

  <p>Any preserved white space is then wrapped in an anonymous box belonging
   to the <a href="#ruby-base-container-box"><i>ruby base container</i></a>
   (if between <a href="#ruby-base-box"><i>ruby bases</i></a>), <a
   href="#ruby-annotation-container-box"><i>ruby annotation container</i></a>
   (if between <a href="#ruby-annotation-box"><i>ruby annotations</i></a>),
   or <a href="#ruby-container-box"><i>ruby container</i></a> (if between <a
   href="#ruby-segments"><i>ruby segments</i></a>). In the latter case, the
   text is considered part of the <i>base level</i>. Such anonynmous boxes do
   not take part in pairing. They merely ensure separation between adjacent
   bases/annotations.

  <p class=issue>Specify how these anonymous white space boxes impact layout.

  <div class=example>
   <p>These rules allow ruby to be used with space-separated scripts such as
    Latin. For example,

   <pre>
<!--		-->&lt;ruby>
<!--		-->  &lt;rb>W&lt;/rb>&lt;rb>W&lt;/rb>&lt;rb>W&lt;/rb>
<!--		-->  &lt;rt>World&lt;/rt> &lt;rt>Wide&lt;/rt> &lt;rt>Web&lt;/rt>
<!--		-->&lt;/ruby></pre>

   <p>They also ensure that annotated white space is preserved. For example,

   <pre>
<!--		-->&lt;ruby>
<!--		-->  &lt;rb>Aerith&lt;/rb>&lt;rb> &lt;/rb>&lt;rb>Gainsboro&lt;/rb>
<!--		-->  &lt;rt>エアリス&lt;/rt>&lt;rt>・&lt;/rt>&lt;rt>ゲインズブール&lt;/rt>
<!--		-->&lt;/ruby></pre>
  </div>

  <h3 id=ruby-layout><span class=secno>2.6. </span> Ruby layout</h3>

  <p>When a ruby structure is laid out, its base level is laid out on the
   line, aligned according to its ‘<code
   class=property>vertical-align</code>’ property exactly as if its
   <i>bases</i> were a regular sequence of <i>inline</i> boxes. Each <a
   href="#ruby-base-container-box"><i>ruby base container</i></a> is sized
   and positioned to contain exactly the full height of its <a
   href="#ruby-base-box"><i>ruby bases</i></a>.

  <p><a href="#ruby-annotation-box"><i>Ruby annotations</i></a> associated
   with the base level are then positioned with respect to their <a
   href="#ruby-base-box"><i>ruby base boxes</i></a> according to the
   applicable ‘<a href="#ruby-position"><code
   class=property>ruby-position</code></a>’ values. <a
   href="#ruby-annotation-box"><i>Ruby annotations</i></a> within a level
   (within a single <a href="#ruby-container-box"><i>ruby container</i></a>)
   are aligned to each other as if they were inline boxes participating in
   the same inline formatting context. Each <a
   href="#ruby-annotation-container-box"><i>ruby annotation container</i></a>
   is sized and positioned to contain exactly the full height of its <a
   href="#ruby-annotation-box"><i>ruby annotations</i></a>.

  <p>A ruby container (or fragment thereof) measures as wide as the content
   of its widest level. Similarly, <a href="#ruby-base-box"><i>ruby base
   boxes</i></a> and <a href="#ruby-annotation-box"><i>ruby annotation
   boxes</i></a> within a ruby “column” have the measure of the widest
   content in that “column”. In the case of spanning <i>annotations</i>
   (whether actually spanning or pretending to span per ‘<code
   class=property>ruby-collapse</code>’), the measures of the <a
   href="#ruby-annotation-box"><i>ruby annotation box</i></a> and the sum of
   its associated <a href="#ruby-base-box"><i>ruby base boxes</i></a> must
   match.

  <p>How the extra space is distributed when ruby content is narrower than
   the measure of its box is specified by the ‘<a href="#ruby-align"><code
   class=property>ruby-align</code></a>’ property.

  <h4 id=inter-character-layout><span class=secno>2.6.1. </span>
   Inter-character ruby layout</h4>

  <p>Inter-character annotations have special layout. When ‘<a
   href="#ruby-position"><code class=property>ruby-position</code></a>’
   indicates ‘<code class=css>inter-character</code>’ annotations, the
   affected <i>annotation boxes</i> are spliced into and measured as part of
   the layout of the base level. The <a
   href="#ruby-base-container-box"><i>ruby base container</i></a> must be
   sized to include both the <i>base boxes</i> as well as the ‘<code
   class=css>inter-character</code>’ <i>annotation boxes</i>. The affected
   <a href="#ruby-annotation-container-box"><i>ruby annotation
   container</i></a> is similarly sized so that its content box coincides
   with that of the <a href="#ruby-base-container-box"><i>ruby base
   container</i></a>.

  <p>For the purpose of laying out other levels of annotations, an ‘<code
   class=css>inter-character</code>’ annotation effectively becomes part of
   its base. <span class=issue>Or should it become a quasi-base between two
   bases?</span> A spanning ‘<code class=css>inter-character</code>’
   annotation is placed after all the bases that it spans.

  <h3 id=box-style><span class=secno>2.7. </span> Styling Ruby Boxes</h3>

  <p>In most respects, ruby boxes can be styled similar to inline boxes.
   However, the UA is not required to support any of the box properties
   (borders, margins, padding), any of the background properties or outline
   properties, or any other property that illustrates the bounds of the box
   on <a href="#ruby-base-container-box"><i>ruby base container
   boxes</i></a>, <a href="#ruby-annotation-container-box"><i>ruby annotation
   container boxes</i></a>, or <a href="#nested-pairing">ruby-internal
   <i>ruby container boxes</i></a>. The UA may implement these boxes simply
   as abstractions for inheritance and control over the layout of their
   contents.

  <h3 id=line-breaks><span class=secno>2.8. </span> Ruby box and line
   breaking</h3>

  <p>When there is not enough space for an entire <a
   href="#ruby-container-box"><i>ruby container</i></a> to fit on the line,
   the ruby may be broken wherever all levels simultaneously allow a break.
   Ruby most often breaks between base-annotation sets, but if the
   line-breaking rules allow it, can also break within a <a
   href="#ruby-base-box"><i>ruby base</i></a> (and, in parallel, its
   associated <i>annotation boxes</i>).

  <p>Whenever ruby breaks across lines, <a
   href="#ruby-annotation-box"><i>ruby annotations</i></a> must stay with
   their respective <i>bases</i>. The line <em>must not</em> break between a
   <a href="#ruby-base-box"><i>ruby base</i></a> and its <i>annotations</i>,
   even in the case of ‘<code class=css>inter-character</code>’
   <i>annotations</i>.

  <div class=figure> <img
   alt="Diagram showing the line breaking opportunity in a &#34;Bopomofo&#34; ruby"
   src="images/r-break-b.gif">
   <p class=caption>‘<code class=css>inter-character</code>’ ruby line
    breaking opportunity
  </div>

  <h4 id=break-between><span class=secno>2.8.1. </span> Breaking between
   bases</h4>

  <p>In typical cases, <a href="#ruby-base-box"><i>ruby base boxes</i></a>
   and <a href="#ruby-annotation-box"><i>ruby annotation boxes</i></a> are
   styled to forbid internal line wrapping and do not contain forced breaks.
   (See <a href="#default-stylesheet">Appendix A</a>.) In such cases the <a
   href="#ruby-container-box"><i>ruby container</i></a> can only break
   between adjacent <a href="#ruby-base-box"><i>ruby bases</i></a>, and only
   if no <a href="#ruby-annotation-box"><i>ruby annotations</i></a> span
   those <a href="#ruby-base-box"><i>ruby bases</i></a>.

  <div class=figure>
   <p><img
    alt="Diagram showing the line breaking opportunity in a complex ruby"
    src="images/r-break-a.gif">

   <p class=caption>Ruby line breaking opportunity
  </div>

  <p>Whether ruby can break between two adjacent <a
   href="#ruby-base-box"><i>ruby bases</i></a> is controlled by normal
   line-breaking rules for the base text, exactly as if the <a
   href="#ruby-base-box"><i>ruby bases</i></a> were adjacent <i>inline</i>
   boxes. (The annotations are ignored when determining soft wrap
   opportunities for the base level.)

  <div class=example>
   <p>For example, if two adjacent ruby bases are “蝴” and “蝶”,
    the line may break between them, because lines are normally allowed to
    break between two Han characters. However, if ‘<code
    class=property>word-break</code>’ is ‘<code
    class=css>keep-all</code>’, that line break is forbidden.

   <pre>&lt;ruby>蝴&lt;rt>hú&lt;/rt>蝶&lt;rt>dié&lt;/rt></pre>
  </div>

  <p>Inter-base white space is significant for evaluating line break
   opportunities between <a href="#ruby-base-box"><i>ruby bases</i></a>. As
   with white space between inlines, it collapses when the line breaks there.
   Similarly, annotation white space is also trimmed at a line break.

  <div class=example>
   <p>For example, given the following markup:

   <pre>&lt;ruby>&lt;rb>one&lt;/rb> &lt;rb>two&lt;/rb> &lt;rt>1&lt;/rt> &lt;rt>2&lt;/rt>&lt;/ruby></pre>

   <p>Due to the space, the line may break between “one” and “two“.
    If the line breaks there, that space—and the space between “1” and
    “2”—disappears, in accordance with standard CSS white space
    processing rules. <a
    href="#ref-CSS-TEXT-3">[CSS-TEXT-3]<!--{{CSS-TEXT-3}}--></a>
  </div>

  <h4 id=break-within><span class=secno>2.8.2. </span> Breaking within bases</h4>

  <p>For longer base texts, it is sometimes appropriate to allow breaking
   within a base-annotation pair. For example, if an English sentence is
   annotated with its Japanese translation, allowing the text to wrap allows
   for reasonable line breaking behavior in the paragraph.

  <p class=issue> Insert scanned example so people don't think this is just
   the ramblings of an insane spec-writer.

  <p>Line-breaking within a <a href="#ruby-base-box"><i>ruby base</i></a> is
   only allowed if the ‘<code class=property>white-space</code>’ property
   of the <a href="#ruby-base-box"><i>ruby base</i></a> and all its parallel
   <i>annotations</i> allow it, and there exists a <i>soft wrap
   opportunity</i> <em>within</em> (i.e. not at the start or end) the content
   of each base/annotation box. Since there is no structural correspondance
   between fragments of content within <a href="#ruby-base-box"><i>ruby
   bases</i></a> and <i>annotations</i>, the UA may break at any set of
   opportunities; but it is recommended that the UA attempt to proportionally
   balance the amount of content inside each fragment.

  <p>There are no line breaking opportunities within ‘<code
   class=css>inter-character</code>’ <i>annotations</i>.

  <p>Ruby alignment takes place within each fragment, after line-breaking.

  <h3 id=ruby-bidi><span class=secno>2.9. </span> Bidi Reordering</h3>

  <p class=issue> Constraints: Text within a ruby base must remain
   contiguous, and bases belonging to a single annotation must remain
   contiguous. Still figuring out exactly to enforce these limitations in a
   sensible manner. <!--

	<p>The Unicode bidirectional algorithm orders logically-stored text for visual presentation
	when characters from scripts of opposing directionalities are mixed
	within a single paragraph.
	(See [[CSS3-WRITING-MODES]] for a more in-depth discussion of bidirectional text in CSS.)
	Bidi reordering of ruby-annotation pairs is controlled by the ordering of the base text, as follows:

<h4 id="bidi-B">Proposal A</h4>

	<p class="note">This proposal is simpler, but will require more frequent tagging of mixed-directionality content.

	<p>To avoid the interference of the <i>annotations</i> in the ordering of base text,
	all annotations are ignored for the purpose of resolving neutral characters in the base level.

	<p>To preserve the correspondance of <i>ruby annotations</i>
	to their respective <i>ruby bases</i>,
	a few restrictions are imposed:
	<ul>
		<li>The contents of a <i>ruby base</i> or <i>ruby annotation</i> must remain contiguous.
			To this end, the contents of each <i>ruby base</i> and <i>ruby annotation</i> are treated as if within a <i>bidi isolation</i>.
		<li>For the purpose of ordering <i>ruby bases</i> within a <i>ruby container</i>,
			each <i>ruby base</i> is treated as a strong character of its specified 'direction'.
			(<i>Ruby annotations</i> are positioned with respect to their <i>bases</i>,
			so are affected by reordering, but do not themselves participate in reordering.)
		<li>All <i>bases</i> spanned by a single <i>annotation</i> must remain contiguous.
			To this end, the embedding level of all bases spanned by a spanning <i>annotation</i>
			is increased by two prior to reordering.
	</ul>

<h4 id="bidi-B">Proposal B</h4>

	<p class="note">This preserves some aspects of implicit bidi.
	For example, annotating each half of "first-second" would not cause the word to reverse itself to "second-first" within an opposite-order paragraph.

	<p>To avoid the interference of the <i>annotations</i> in the ordering of the base text,
	all annotations are ignored for the purpose of resolving neutral characters in the base text;
	and the base text is resolved exactly as if each <i>ruby base</i> were
	just a normal <i>inline box</i> embedded in the <i>ruby container</i>'s inline formatting context.

	<p>Furthermore, to preserve the correspondance of <i>ruby annotations</i>
	to their respective <i>ruby bases</i>,
	a few restrictions are imposed:
	<ul>
		<li>The contents of a <i>ruby base</i> must remain contiguous.
		<li>All <i>bases</i> spanned by a single <i>annotation</i> must remain contiguous.
	</ul>
	<p>To this end, the text of <i>ruby base</i> boxes that are not <i>bidi-isolated</i>
	must have its embedding level increased by two;
	and if an <i>annotation</i> spans more than one <i>ruby base</i>,
	the spanned text's embedding level
	(or the embedding level assigned to the isolation, if the <i>ruby base</i> is <i>bidi-isolated</i>)
	is further increased by two.

-->

  <h3 id=line-height><span class=secno>2.10. </span> Ruby box and line
   stacking</h3>

  <p>The ‘<code class=property>line-height</code>’ property controls
   spacing between lines in CSS. When inline content on line is shorter than
   the ‘<code class=property>line-height</code>’, half-leading is added
   on either side of the content, as specificed in <a
   href="http://www.w3.org/TR/CSS21/visudet.html#line-height">CSS2.1§10.8</a>.
   <a href="#ref-CSS21">[CSS21]<!--{{!CSS21}}--></a>

  <p>In order to ensure consistent spacing of lines, documents with ruby
   typically ensure that the ‘<code class=property>line-height</code>’ is
   large enough to accommodate ruby between lines of text. Therefore,
   ordinarily, <a href="#ruby-annotation-container-box"><i>ruby annotation
   containers</i></a> and <a href="#ruby-annotation-box"><i>ruby annotation
   boxes</i></a> do not contribute to the measured height of a line's inline
   contents; any alignment (see ‘<code
   class=property>vertical-align</code>’) and line-height calculations are
   performed using only the <a href="#ruby-base-container-box"><i>ruby base
   container</i></a>, exactly as if it were a normal inline.

  <p>However, if the ‘<code class=property>line-height</code>’ specified
   on the <a href="#ruby-container-box"><i>ruby container</i></a> is less
   than the distance between the top of the top <a
   href="#ruby-annotation-container-box"><i>ruby annotation container</i></a>
   and the bottom of the bottom <a
   href="#ruby-annotation-container-box"><i>ruby annotation
   container</i></a>, then additional leading is added on the appropriate
   side of the <a href="#ruby-base-container-box"><i>ruby base
   container</i></a> such that if a block consisted of three lines each
   containing ruby identical to this, none of the <a
   href="#ruby-container-box"><i>ruby containers</i></a> would overlap.

  <p class=note>Note that this does not ensure that the <a
   href="#ruby-annotation-box"><i>ruby annotations</i></a> remain within the
   line box. It merely ensures that <em>if all lines had equal spacing</em>
   and equivalent amounts and positioning of <a
   href="#ruby-annotation-box"><i>ruby annotations</i></a>, there would be
   enough room to avoid overlap.

  <p>Authors should ensure appropriate ‘<code
   class=property>line-height</code>’ and ‘<code
   class=property>padding</code>’ to accommodate ruby, and be particularly
   careful at the beginning or end of a block and when a line contains
   inline-level content (such as images, inline blocks, or elements shifted
   with ‘<code class=property>vertical-align</code>’) taller than the
   paragraph's default font size.

  <div class=figure>
   <p><img
    alt="The content of each line sits in the middle of its line height; 		             the additional space on each side is called half-leading. 		             Ruby fits between lines if it is smaller than twice the half-leading, 		             but this means that it occupies space belonging to the half-leading of the previous line."
    src="images/rlh-a.gif">

   <p class=caption>Ruby annotations will often overflow the line; authors
    should ensure content over/under a ruby-annotated line is adequately
    spaced to leave room for the ruby.
  </div>

  <p class=note>More control over how ruby affects alignment and line layout
   will be part of the CSS Line Layout Module Level 3. Note, it is currently
   in the process of being rewritten; the current drafts should not be relied
   upon.

  <h2 id=ruby-props><span class=secno>3. </span> Ruby Properties</h2>

  <p>The following properties are introduced to control ruby positioning and
   alignment.

  <h3 id=rubypos><span class=secno>3.1. </span> Ruby positioning: the ‘<a
   href="#ruby-position"><code class=property>ruby-position</code></a>’
   property</h3>

  <table class=propdef>
   <tbody>
    <tr>
     <th>Name:

     <td><dfn id=ruby-position>ruby-position</dfn>

    <tr>
     <th><a href="#values">Value</a>:

     <td>[ over | under | inter-character ] && [ right | left ]

    <tr>
     <th>Initial:

     <td>over right

    <tr>
     <th>Applies to:

     <td>ruby annotation containers

    <tr>
     <th>Inherited:

     <td>yes

    <tr>
     <th>Percentages:

     <td>N/A

    <tr>
     <th>Media:

     <td>visual

    <tr>
     <th>Computed value:

     <td>specified value

    <tr>
     <th>Animatable:

     <td>no

    <tr>
     <th>Canonical order:

     <td><abbr title="follows order of property value definition">per
      grammar</abbr>
  </table>

  <p>This property controls position of the ruby text with respect to its
   base. Values have the following meanings:

  <p class=issue><span class=issuehead>Issue-107: </span> Roland Steiner has
   requested the addition of an auto value as default. See <a
   href="http://www.w3.org/Search/Mail/Public/advanced_search?keywords=&amp;hdr-1-name=subject&amp;hdr-1-query=ruby-position%3A+undesirable+default+value+%27before%27+for+complex+ruby&amp;hdr-2-name=from&amp;hdr-2-query=&amp;hdr-3-name=message-id&amp;hdr-3-query=&amp;period_month=&amp;period_year=&amp;index-grp=Public__FULL&amp;index-type=t&amp;type-index=www-style&amp;resultsperpage=20&amp;sortby=date">this
   thread</a> and <a
   href="http://www.w3.org/Search/Mail/Public/advanced_search?keywords=&amp;hdr-1-name=subject&amp;hdr-1-query=Styling+of+complex+Ruby&amp;hdr-2-name=from&amp;hdr-2-query=&amp;hdr-3-name=message-id&amp;hdr-3-query=&amp;period_month=&amp;period_year=&amp;index-grp=Public__FULL&amp;index-type=t&amp;type-index=public-i18n-core&amp;resultsperpage=20&amp;sortby=date">this
   one</a>.

  <dl>
   <dt><dfn id=over title="ruby-position:over">‘<code
    class=css>over</code>’</dfn>

   <dd>The ruby text appears <i>over</i> the base in horizontal text.
    <div class=figure>
     <p><img
      alt="Diagram of ruby glyph layout in horizontal mode with ruby text appearing above the base"
      src="images/shinkansen-top.gif">

     <p class=caption>Ruby over Japanese base text in horizontal layout
    </div>

   <dt><dfn id=right title="ruby-position:right">‘<code
    class=css>right</code>’</dfn>

   <dd>The ruby text appears on the right side of the base in vertical text.
    <div class=figure>
     <p><img
      alt="Diagram of ruby glyph layout in vertical mode with ruby text apearing vertically on the right of the base"
      src="images/shinkansen-right.gif" width=33>

     <p class=caption>Ruby to the right of Japanese base text in vertical
      layout
    </div>

   <dt><dfn id=under title="ruby-position:under">‘<code
    class=css>under</code>’</dfn>

   <dd>The ruby text appears under the base in horizontal text. This is a
    relatively rare setting used in ideographic East Asian writing systems,
    most easily found in educational text.
    <div class=figure>
     <p><img
      alt="Diagram of ruby glyph layout in horizontal mode with ruby text appearing below the base"
      src="images/shinkansen-bottom.gif">

     <p class=caption>Ruby under Japanese base text in horizontal layout
    </div>

   <dt><dfn id=left title="ruby-position:left">‘<code
    class=css>left</code>’</dfn>

   <dd>The ruby text appears on the left side of the base in vertical text.
    <div class=figure>
     <p><img
      alt="Diagram of ruby glyph layout in vertical mode with ruby text apearing vertically on the left of the base"
      src="images/shinkansen-left.gif">

     <p class=caption>Ruby to the left of Japanese base text in vertical
      layout
    </div>

   <dt><dfn id=inter-character title="ruby-position:inter-character">‘<code
    class=css>inter-character</code>’</dfn>

   <dd>
    <p>The ruby text appears on the right of the base in horizontal text.
     This value forces the ‘<code class=property>writing-mode</code>’ of
     the <a href="#ruby-annotation-box"><i>ruby annotation</i></a> to be
     vertical.

    <p>This value is provided for the special case of traditional Chinese as
     used especially in Taiwan: ruby (made of <a
     href="#g-bopomofo">bopomofo</a> glyphs) in that context appears
     vertically along the right side of the base glyph, even when the layout
     of the base characters is horizontal:

    <div class=figure>
     <p><img alt="Example of Taiwanese-style ruby" src="images/bopomofo.gif">

     <p class=caption>“Bopomofo” ruby in traditional Chinese (ruby text
      shown in blue for clarity) in horizontal layout
    </div>

    <p class=note> Note that the user agent is responsible for ensuring the
     correct relative alignment and positioning of the glyphs, including
     those corresponding to the tone marks, when displaying. Tone marks are
     spacing characters that occur (in memory) at the end of the ruby text
     for each base character. They are usually displayed in a separate column
     to the right of the bopomofo characters, and the height of the tone mark
     depends on the number of characters in the syllable. One tone mark,
     however, is placed above the bopomofo, not to the right of it.
     <!-- See Taiwanese requirements doc for EPUB at http://epub-revision.googlecode.com/files/EGLS_TW_eng.ppt -->
  </dl>

  <p>If multiple <a href="#ruby-annotation-container-box"><i>ruby annotation
   containers</i></a> have the same ‘<a href="#ruby-position"><code
   class=property>ruby-position</code></a>’, they stack along the block
   axis, with lower levels of annotation closer to the base text.

  <h3 id=collapsed-ruby><span class=secno>3.2. </span> Collapsed Ruby
   Annotations: the ‘<a href="#ruby-merge"><code
   class=property>ruby-merge</code></a>’ property</h3>

  <table class=propdef>
   <tbody>
    <tr>
     <th>Name:

     <td><dfn id=ruby-merge>ruby-merge</dfn>

    <tr>
     <th><a href="#values">Value</a>:

     <td>separate | collapse | auto

    <tr>
     <th>Initial:

     <td>separate

    <tr>
     <th>Applies to:

     <td>ruby annotation containers

    <tr>
     <th>Inherited:

     <td>yes

    <tr>
     <th>Percentages:

     <td>N/A

    <tr>
     <th>Media:

     <td>visual

    <tr>
     <th>Computed value:

     <td>specified value

    <tr>
     <th>Animatable:

     <td>no

    <tr>
     <th>Canonical order:

     <td><abbr title="follows order of property value definition">per
      grammar</abbr>
  </table>

  <p> This property controls how ruby annotation boxes should be rendered
   when there are more than one in a ruby container box.

  <p>Possible values:

  <dl>
   <dt><dfn id=separate title="ruby-merge:separate">‘<code
    class=css>separate</code>’</dfn>

   <dd>
    <p> Each ruby annotation box is rendered in the same column(s) as its
     corresponding base box(es). This style is called “mono ruby” in <a
     href="#ref-JLREQ">[JLREQ]<!--{{JLREQ}}--></a>.

    <div class=example>
     <p>For example, the following two markups render the same:

     <pre>&lt;ruby&gt;無&lt;rt&gt;む&lt;/ruby&gt;&lt;ruby&gt;常&lt;rt&gt;じょう&lt;/ruby&gt;</pre>

     <p>and:

     <pre>&lt;ruby style="ruby-merge:separate"&gt;&lt;rb&gt;無&lt;rb&gt;常&lt;rt&gt;む&lt;rt&gt;じょう&lt;/ruby&gt;</pre>
    </div>

   <dt><dfn id=collapse title="ruby-merge:collapse">‘<code
    class=css>collapse</code>’</dfn>

   <dd>
    <p> All <a href="#ruby-annotation-box"><i>ruby annotation boxes</i></a>
     within the same <i>ruby segment</i> on the same line are concatenated,
     and laid out as if their contents belonged to a single <a
     href="#ruby-annotation-box"><i>ruby annotation box</i></a> spanning all
     their associated <a href="#ruby-base-box"><i>ruby base boxes</i></a>.
     This style renders similar to “group ruby” in <a
     href="#ref-JLREQ">[JLREQ]<!--{{JLREQ}}--></a>, except that <a
     href="#ruby-annotation-box"><i>ruby annotations</i></a> are kept
     together with their respective <a href="#ruby-base-box"><i>ruby
     bases</i></a> when breaking lines.

    <div class=example>
     <p>The following two markups render the same both characters fit on one
      line:

     <pre>&lt;ruby&gt;無常&lt;rt&gt;むじょう&lt;/ruby&gt;</pre>

     <p>and:

     <pre>&lt;ruby style="ruby-merge:collapse"&gt;&lt;rb&gt;無&lt;rb&gt;常&lt;rt&gt;む&lt;rt&gt;じょう&lt;/ruby&gt;</pre>

     <p>However, the second one renders the same as ‘<code
      class=css>ruby-position: separate</code>’ when the two bases are
      split across lines.
    </div>

   <dt><dfn id=auto title="ruby-merge:auto">‘<code
    class=css>auto</code>’</dfn>

   <dd>
    <p> The user agent may use any algorithm to determine how each ruby
     annotation box is rendered to its corresponding base box, with the
     intention that if all annotations fit over their respective bases, the
     result is identical to “mono ruby”, but if some annotations are
     wider than their bases the space is shared in some way to avoid forcing
     space between bases.

    <div class=example>
     <p> One possible algorithm is described as “jukugo ruby” in <a
      href="#ref-JLREQ">[JLREQ]<!--{{JLREQ}}--></a>.

     <p> Another, more simplified algorithm of “jukugo ruby” is to render
      as ‘<code class=css>separate</code>’ if all ruby annotation boxes
      fit within the advances of their corresponding base boxes, and render
      as ‘<code class=css>collapse</code>’ otherwise.
    </div>
  </dl>

  <h3 id=ruby-align-property><span class=secno>3.3. </span><a
   id=rubyalign></a> Ruby Text Distribution: the ‘<a
   href="#ruby-align"><code class=property>ruby-align</code></a>’ property</h3>

  <table class=propdef>
   <tbody>
    <tr>
     <th>Name:

     <td><dfn id=ruby-align>ruby-align</dfn>

    <tr>
     <th><a href="#values">Value</a>:

     <td>start | center | space-between | space-around

    <tr>
     <th>Initial:

     <td>space-around

    <tr>
     <th>Applies to:

     <td>ruby bases, ruby annotations, ruby base containers, ruby annotation
      containers

    <tr>
     <th>Inherited:

     <td>yes

    <tr>
     <th>Percentages:

     <td>N/A

    <tr>
     <th>Media:

     <td>visual

    <tr>
     <th>Computed value:

     <td>specified value (except for initial and inherit)
  </table>

  <p>This property specifies how text is distributed within the various ruby
   boxes when their contents do not exactly fill their respective boxes. Note
   that space distributed by ‘<a href="#ruby-align"><code
   class=property>ruby-align</code></a>’ is unrelated to, and independent
   of, any space distributed due to justification.

  <p>Values have the following meanings:

  <dl>
   <dt><dfn id=start title="ruby-align:start">‘<code
    class=css>start</code>’</dfn>

   <dd>The ruby content is aligned with the start edge of its box.
    <div class=figure>
     <p><img
      alt="Diagram of glyph layout in left aligned ruby when ruby text is shorter than base"
      height=91 src="images/ra-l.gif" width=145><img
      alt="Diagram of glyph layout in left aligned ruby when ruby text is longer than base"
      height=91 src="images/ra-l-rb.gif" width=145>

     <p class=caption>‘<code class=css>start</code>’ ruby distribution
    </div>

   <dt><dfn id=center title="ruby-align:center">‘<code
    class=css>center</code>’</dfn>

   <dd>The ruby content is centered within its box.
    <div class=figure>
     <p><img
      alt="Diagram of glyph layout in center aligned ruby when ruby text is shorter than base"
      height=91 src="images/ra-c.gif" width=145><img
      alt="Diagram of glyph layout in center aligned ruby when ruby text is longer than base"
      height=91 src="images/ra-c-rb.gif" width=145>

     <p class=caption>‘<code class=css>center</code>’ ruby distribution
    </div>

   <dt><dfn id=space-between title="ruby-align:space-between">‘<code
    class=css>space-between</code>’</dfn>

   <dd>
    <p>The ruby content expands as defined for normal text justification (as
     defined by ‘<code class=property>text-justify</code>’), except that
     if there are no <a
     href="http://www.w3.org/TR/css3-text/#expansion-opportunity"><i>expansion
     opportunities</i></a> the content is centered.

    <div class=figure>
     <p><img
      alt="Diagram of glyph layout in distribute-letter aligned ruby when ruby text is shorter than base"
      height=91 src="images/ra-dl.gif" width=145><img
      alt="Diagram of glyph layout in distribute-letter aligned ruby when ruby text is longer than base"
      height=91 src="images/ra-dl-rb.gif" width=145>

     <p class=caption>‘<code class=css>space-between</code>’ ruby
      distribution
    </div>

   <dt><dfn id=space-around title="ruby-align:space-around">‘<code
    class=css>space-around</code>’</dfn>

   <dd>
    <p>As for ‘<code class=css>space-between</code>’ except that there
     exists an extra <a
     href="http://www.w3.org/TR/css3-text/#expansion-opportunity"><i>expansion
     opportunity</i></a> whose space is distributed half before and half
     after the ruby content.

    <div class=example>
     <p>Since a typical implementation will by default define <i>expansion
      opportunities</i> between every adjacent pair of CJK <i>characters</i>
      and not between adjacent pairs of Latin <i>characters</i>, this should
      result in the behavior recommended by <a
      href="#ref-JLREQ">[JLREQ]<!--{{JLREQ}}--></a>: for wide-cell ruby
      content to be distributed...

     <div class=figure>
      <p><img
       alt="Diagram of glyph layout in auto aligned ruby when ruby text is shorter than base"
       height=91 src="images/ra-ds.gif" width=145><img
       alt="Diagram of glyph layout in auto aligned ruby when ruby text is longer than base"
       height=91 src="images/ra-ds-rb.gif" width=145>

      <p class=caption>Wide-cell text in ‘<code
       class=css>space-around</code>’ ruby distribution is spaced apart
     </div>

     <p>... and narrow-cell glyph ruby to be centered.

     <div class=figure>
      <p><img
       alt="Diagram of glyph layout in auto aligned ruby when halfwidth ruby text is shorter than base"
       height=91 src="images/ra-c-h.gif" width=145><img
       alt="Diagram of character layout in auto aligned ruby when ruby text is longer than narrow-width base"
       height=91 src="images/ra-c-rb-h.gif" width=145>

      <p class=caption>Narrow-width ruby text in ‘<code
       class=css>space-around</code>’ ruby distribution is centered
     </div>
    </div>
  </dl>

  <p class=issue>Add a paragraph explaining how to distribute space in
   situations with spanning annotations. <!--
	<p>For a complex ruby with spanning elements, one additional consideration is
		required. If the spanning element spans multiple 'rows' (other rbc or rtc
		elements), and the ruby alignment requires space distribution among the
		'spanned' elements, a ratio must be determined among the 'columns' of spanned
		elements. This ratio is computed by taking into consideration the widest
		element within each column.</p>
-->

  <h2 id=edge-effects><span class=secno>4. </span> Edge Effects</h2>

  <h3 id=ruby-overhang><span class=secno>4.1. </span> Overhanging Ruby</h3>

  <p> When <a href="#ruby-annotation-box"><i>ruby annotation box</i></a> is
   longer than its corresponding <a href="#ruby-base-box"><i>ruby base
   box</i></a>, the <a href="#ruby-annotation-box"><i>ruby annotation
   box</i></a> may partially overhang adjacent boxes.

  <p> This level of the specification does not define how much the overhang
   may be allowed, and under what conditions.

  <p>If the ruby text is not allowed to overhang, then the ruby behaves like
   a traditional inline box, i.e. only its own contents are rendered within
   its boundaries and adjacent elements do not cross the box boundary:

  <div class=figure>
   <p><img
    alt="Diagram showing the ruby boxes interacting with adjacent text"
    src="images/ro-n.gif">

   <p class=caption>Simple ruby whose text is not allowed to overhang
    adjacent text
  </div>

  <p>However, if <a href="#ruby-annotation-box"><i>ruby annotation</i></a>
   content is allowed to overhang adjacent elements and it happens to be
   wider than its base, then the adjacent content is partially rendered
   within the area of the <a href="#ruby-container-box"><i>ruby container
   box</i></a>, while the <a href="#ruby-annotation-box"><i>ruby
   annotation</i></a> may partially overlap the upper blank parts of the
   adjacent content:

  <div class=figure>
   <p><img
    alt="Diagram showing the ruby boxes interacting with adjacent text"
    src="images/ro-a.gif">

   <p class=caption>Simple ruby whose text is allowed to overhang adjacent
    text
  </div>

  <p>The <a href="#ruby-annotation-box"><i>ruby annotations</i></a> related
   to a <a href="#ruby-base-box"><i>ruby base</i></a> must never overhang
   another <a href="#ruby-base-box"><i>ruby base</i></a>.

  <p>The alignment of the contents of the base or the ruby text is not
   affected by overhanging behavior. The alignment is achieved the same way
   regardless of the overhang behavior setting and it is computed before the
   space available for overlap is determined. It is controlled by the ‘<a
   href="#ruby-align"><code class=property>ruby-align</code></a>’ property.

  <p class=issue> I suspect overhanging interacts with alignment in some
   cases; might need to look into this later.

  <p>This entire logic applies the same way in vertical ideographic layout,
   only the dimension in which it works in such a layout is vertical, instead
   of horizontal.

  <div class=example>
   <p> The user agent may use <a
    href="#ref-JIS4051">[JIS4051]<!--{{JIS4051}}--></a> recommendation of
    using one ruby text character length as the maximum overhang length.
    Detailed rules for how ruby text can overhang adjacent characters for
    Japanese are described by <a
    href="#ref-JLREQ">[JLREQ]<!--{{JLREQ}}--></a>.
  </div>

  <h3 id=line-edge><span class=secno>4.2. </span> Line-edge Alignment</h3>

  <p> When a <a href="#ruby-annotation-box"><i>ruby annotation box</i></a>
   that is longer than its <a href="#ruby-base-box"><i>ruby base</i></a> is
   at the start or end edge of a line, the user agent <em>may</em> force the
   side of the <a href="#ruby-annotation-box"><i>ruby annotation</i></a> that
   touches the edge of the line to align to the corresponding edge of the
   base. This type of alignment is described by <a
   href="#ref-JLREQ">[JLREQ]<!--{{JLREQ}}--></a>.

  <p> This level of the specification does not provide a mechanism to control
   this behavior.

  <div class=figure>
   <p><img
    alt="Diagram of glyph layout in line-edge aligned ruby when ruby text is shorter than base"
    src="images/ra-le-l.gif"> <img
    alt="Diagram of glyph layout in line-edge aligned ruby when ruby text is longer than base"
    src="images/ra-le-r.gif">

   <p class=caption>Line-edge alignment
  </div>
  <!--
<h3 id="rubyover">
Ruby overhanging: the 'ruby-overhang' property</h3>

  <table class="propdef">
    <tr>
      <th>Name:
      <td><dfn>ruby-overhang</dfn>
    <tr>
      <th>Value:
      <td>auto | start | end | none
    <tr>
      <th>Initial:
      <td>none
    <tr>
      <th>Applies to:
      <td>the parent of elements with display: ruby-text
    <tr>
      <th>Inherited:
      <td>yes
    <tr>
      <th>Percentages:
      <td>N/A
    <tr>
      <th>Media:
      <td>visual
    <tr>
      <th>Computed value:
      <td>specified value (except for initial and inherit)
  </table>

<p>This property determines whether, and on which side, ruby text is allowed
to partially overhang any adjacent text in addition to its own base, when the
ruby text is wider than the ruby base. Note that ruby text is never allowed to
overhang glyphs belonging to another ruby base. <span class="issue"><span class="issuehead">Issue: </span> This rule must be broken if we are to allow support for jukugo ruby.</span> Also the user agent is free to assume
a maximum amount by which ruby text may overhang adjacent text. The user agent may use
the [[JIS4051]] recommendation of using one ruby text character
length as the maximum overhang length. Detailed rules for how ruby text can overhang adjacent characters for Japanese are described by [[JLREQ]].</p>

<p>Possible values:</p>
<dl>
  <dt><strong>auto</strong></dt>
    <dd>The ruby text can overhang text adjacent to the base on either side.   	  [[JLREQ]] and [[JIS4051]] specify the categories of characters that
      ruby text can overhang. The user agent is free to follow those recommendations or specify its own classes of
      characters to overhang. This is the initial value.
		<div class="figure">
      <p><img class="example" width="177" height="91"
      alt="Diagram of glyph layout in overhanging ruby" src="images/ro-a.gif" /></p>
      <p><b>Figure 4.3.1</b>: Ruby overhanging adjacent text</p>
      </div>
    </dd>
  <dt><strong>start</strong></dt>
    <dd>The ruby text can only overhang the text that precedes it. That means, for
      example, that ruby cannot overhang text that is to the right of it in
      horizontal LTR layout, and it cannot overhang text that is below it in
      vertical-ideographic layout.
		<div class="figure">
      <p><img class="example" width="199" height="91"
      alt="Diagram of glyph layout when ruby overhangs the preceding glyphs only"
      src="images/ro-s.gif" /></p>
      <p><b>Figure 4.3.2</b>: Ruby overhanging preceding text only</p>
      </div>
    </dd>
  <dt><strong>end</strong></dt>
    <dd>The ruby text can only overhang the text that follows it. That means, for
      example, that ruby cannot overhang text that is to the left of it in
      horizontal LTR layout, and it cannot overhang text that is above it in
      vertical-ideographic layout.
		<div class="figure">
      <p><img class="example" width="198" height="91"
      alt="Diagram of glyph layout when ruby overhangs the following characters only"
      src="images/ro-e.gif" /></p>
      <p><b>Figure 4.3.3</b>: Ruby overhanging following text only</p>
      </div>
    </dd>
  <dt><strong>none</strong></dt>
    <dd>The ruby text cannot overhang any text adjacent to its base, only its
      own base.

      <div class="figure">
      <p><img class="example" width="220" height="91"
      alt="Diagram of glyph layout in non-overhanging ruby"
      src="images/ro-n.gif" /></p>
      <p><b>Figure 4.3.4</b>: Ruby not allowed to overhang adjacent text</p>
      </div>
    </dd>
</dl>

<h3 id="rubyspan">
Ruby annotation spanning: the 'ruby-span' property</h3>

  <table class="propdef">
    <tr>
      <th>Name:
      <td><dfn>ruby-span</dfn>
    <tr>
      <th>Value:
      <td>attr(x) |  none
    <tr>
      <th>Initial:
      <td>none
    <tr>
      <th>Applies to:
      <td>elements with display: ruby-text
    <tr>
      <th>Inherited:
      <td>no
    <tr>
      <th>Percentages:
      <td>N/A
    <tr>
      <th>Media:
      <td>visual
    <tr>
      <th>Computed value:
      <td>&lt;number&gt;
  </table>

<p>This property controls the spanning behavior of annotation elements. </p>

<p class="note"><span class="note-label">Note:</span> A XHTML user agent may also use the <samp>rbspan</samp> 
attribute to get the same effect.</p>

<p>Possible values:</p>

<dl>
  <dt><strong>attr(x)</strong></dt>
    <dd>The value of attribute 'x' as a string value. The string value is 
    evaluated as a &lt;number&gt; to determine the number of ruby base elements to be 
    spanned by the annotation element. If the &lt;number&gt; is '0', it is replaced by 
    '1'.The &lt;number&gt; is the computed value. </dd>
  <dt>none</dt>
  <dd>No spanning. The computed value is '1'.</dd>
</dl>

<p>The following example shows an XML example using the 'display' property 
values associated with the 'ruby structure and the 'ruby-span' property</p>
<pre class="xml">myruby       { display: ruby; }
myrbc        { display: ruby-base-container; }
myrb         { display: ruby-base; }
myrtc.before { display: ruby-text-container; ruby-position: before}
myrtc.after  { display: ruby-text-container; ruby-position: after}
myrt         { display: ruby-text; ruby-span: attr(rbspan); }
...
&lt;myruby&gt;
  &lt;myrbc&gt;
    &lt;myrb&gt;10&lt;/myrb&gt;
    &lt;myrb&gt;31&lt;/myrb&gt;
    &lt;myrb&gt;2002&lt;/myrb&gt;
  &lt;/myrbc&gt;
  &lt;myrtc class=&quot;before&quot;&gt;
    &lt;myrt&gt;Month&lt;/myrt&gt;
    &lt;myrt&gt;Day&lt;/myrt&gt;
    &lt;myrt&gt;Year&lt;/myrt&gt;
  &lt;/myrtc&gt;
  &lt;myrtc class=&quot;after&quot;&gt;
    &lt;myrt rbspan=&quot;3&quot;&gt;Expiration Date&lt;/myrt&gt;
  &lt;/myrtc&gt;
&lt;/myruby&gt;</pre>
	-->

  <h2 class=no-num id=default-stylesheet> Appendix A: Default Style Sheet</h2>

  <p><em>This section is informative.</em>

  <h3 class=no-num id=default-ua-ruby> Supporting Ruby Layout</h3>

  <p>The following represents a default UA style sheet for rendering HTML and
   XHTML ruby markup as ruby layout:

  <pre>
<!--	-->ruby { display: ruby; }
<!--	-->rb   { display: ruby-base; white-space: nowrap; }
<!--	-->rp   { display: none; }
<!--	-->rt   { display: ruby-text; white-space: nowrap; font-size: 50%; }
<!--	-->rbc  { display: ruby-base-container; }
<!--	-->rtc  { display: ruby-text-container; }
<!--	-->ruby, rb, rt, rbc, rtc { unicode-bidi: isolate; }</pre>

  <p>Additional rules for UAs supporting the relevant features of <a
   href="#ref-CSS3-TEXT-DECOR">[CSS3-TEXT-DECOR]<!--{{CSS3-TEXT-DECOR}}--></a>
   and <a href="#ref-CSS3-FONTS">[CSS3-FONTS]<!--{{CSS3-FONTS}}--></a>:

  <pre>rt { font-variant-east-asian: ruby; text-emphasis: none; }</pre>

  <p class=note>Authors should not use the above rules; a UA that supports
   ruby layout should provide these by default.

  <h3 class=no-num id=default-inline> Inlining Ruby Annotations</h3>

  <p>The following represents a sample style sheet for rendering HTML and
   XHTML ruby markup as inline annotations:

  <pre>ruby, rb, rt, rbc, rtc, rp {
<!--	-->  display: inline; white-space: inherit;
<!--	-->  font-variant-east-asian: inherit; text-emphasis: inherit; }</pre>

  <h3 class=no-num id=default-parens> Generating Parentheses</h3>

  <p>Unfortunately, because Selectors cannot match against text nodes, it's
   not possible with CSS to express rules that will automatically and
   correctly add parentheses to unparenthesized ruby annotations in HTML.
   (This is because HTML ruby allows implying the <a
   href="#ruby-base-box"><i>ruby base</i></a> from raw text, without a
   corresponding element.) However, these rules will handle cases where
   either <code>&lt;rb&gt;</code> or <code>&lt;rtc&gt;</code> is used
   rigorously.

  <pre>
<!--	-->/* Parens around &lt;rtc> */
<!--	-->rtc::before { content: "("; }
<!--	-->rtc::after  { content: ")"; }

<!--	-->/* Parens before first &lt;rt> not inside &lt;rtc> */
<!--	-->rb  + rt::before,
<!--	-->rtc + rt::before { content: "("; }

<!--	-->/* Parens after &lt;rt> not inside &lt;rtc> */
<!--	-->rb ~ rt:last-child::after,
<!--	-->rt + rb::before  { content: ")"; }
<!--	-->rt + rtc::before { content: ")("; }</pre>

  <h2 id=glossary><span class=secno>5. </span> Glossary</h2>

  <dl>
   <dt><a id=g-bopomofo><strong><span lang=zh>Bopomofo</span></strong></a>

   <dd>37 characters and 4 tone markings used as phonetics in Chinese,
    especially standard Mandarin.

   <dt><a id=g-hanja><strong><span lang=ko>Hanja</span></strong></a>

   <dd>Subset of the Korean writing system that utilizes ideographic
    characters borrowed or adapted from the Chinese writing system. Also see
    <a href="#g-kanji"><span lang=ja>Kanji</span></a>.

   <dt><a id=g-hiragana><strong><span lang=ja>Hiragana</span></strong></a>

   <dd>Japanese syllabic script, or character of that script. Rounded and
    cursive in appearance. Subset of the Japanese writing system, used
    together with kanji and katakana. In recent times, mostly used to write
    Japanese words when kanji are not available or appropriate, and word
    endings and particles. Also see <a href="#g-katakana"><span
    lang=ja>Katakana</span></a>.

   <dt><a id=g-ideogram><strong>Ideograph</strong></a>

   <dd>A character that is used to represent an idea, word, or word
    component, in contrast to a character from an alphabetic or syllabic
    script. The most well-known ideographic script is used (with some
    variation) in East Asia (China, Japan, Korea,...).

   <dt><a id=g-kana><strong><span lang=ja>Kana</span></strong></a>

   <dd>Collective term for hiragana and katakana.

   <dt><a id=g-kanji><strong>Kanji</strong></a>

   <dd>Japanese term for ideographs; ideographs used in Japanese. Subset of
    the Japanese writing system, used together with hiragana and katakana.
    Also see <a href="#g-hanja"><span lang=ko>Hanja</span></a>.

   <dt><a id=g-katakana><strong><span lang=ja>Katakana</span></strong></a>

   <dd>Japanese syllabic script, or character of that script. Angular in
    appearance. Subset of the Japanese writing system,  used together with
    kanji and hiragana. In recent times, mainly used to write foreign words.
    Also see <a href="#g-hiragana"><span lang=ja>Hiragana</span></a>.
  </dl>

  <h2 id=conformance><span class=secno>6. </span> Conformance</h2>

  <h3 id=conventions><span class=secno>6.1. </span> Document conventions</h3>

  <p>Conformance requirements are expressed with a combination of descriptive
   assertions and RFC 2119 terminology. The key words “MUST”, “MUST
   NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”,
   “SHOULD NOT”, “RECOMMENDED”, “MAY”, and “OPTIONAL” in the
   normative parts of this document are to be interpreted as described in RFC
   2119. However, for readability, these words do not appear in all uppercase
   letters in this specification.

  <p>All of the text of this specification is normative except sections
   explicitly marked as non-normative, examples, and notes. <a
   href="#ref-RFC2119">[RFC2119]<!--{{!RFC2119}}--></a>

  <p>Examples in this specification are introduced with the words “for
   example” or are set apart from the normative text with
   <code>class="example"</code>, like this:

  <div class=example>
   <p>This is an example of an informative example.
  </div>

  <p>Informative notes begin with the word “Note” and are set apart from
   the normative text with <code>class="note"</code>, like this:

  <p class=note>Note, this is an informative note.

  <h3 id=conformance-classes><span class=secno>6.2. </span> Conformance
   classes</h3>

  <p>Conformance to CSS Ruby Module is defined for three conformance classes:

  <dl>
   <dt><dfn id=style-sheet title="style sheet!!as conformance class">style
    sheet</dfn>

   <dd>A <a href="http://www.w3.org/TR/CSS21/conform.html#style-sheet">CSS
    style sheet</a>.

   <dt><dfn id=renderer>renderer</dfn>

   <dd>A <a href="http://www.w3.org/TR/CSS21/conform.html#user-agent">UA</a>
    that interprets the semantics of a style sheet and renders documents that
    use them.

   <dt><dfn id=authoring-tool>authoring tool</dfn>

   <dd>A <a href="http://www.w3.org/TR/CSS21/conform.html#user-agent">UA</a>
    that writes a style sheet.
  </dl>

  <p>A style sheet is conformant to CSS Ruby Module if all of its statements
   that use syntax defined in this module are valid according to the generic
   CSS grammar and the individual grammars of each feature defined in this
   module.

  <p>A renderer is conformant to CSS Ruby Module if, in addition to
   interpreting the style sheet as defined by the appropriate specifications,
   it supports all the features defined by CSS Ruby Module by parsing them
   correctly and rendering the document accordingly. However, the inability
   of a UA to correctly render a document due to limitations of the device
   does not make the UA non-conformant. (For example, a UA is not required to
   render color on a monochrome monitor.)

  <p>An authoring tool is conformant to CSS Ruby Module if it writes style
   sheets that are syntactically correct according to the generic CSS grammar
   and the individual grammars of each feature in this module, and meet all
   other conformance requirements of style sheets as described in this
   module.

  <h3 id=partial><span class=secno>6.3. </span> Partial implementations</h3>

  <p>So that authors can exploit the forward-compatible parsing rules to
   assign fallback values, CSS renderers <strong>must</strong> treat as
   invalid (and <a
   href="http://www.w3.org/TR/CSS21/conform.html#ignore">ignore as
   appropriate</a>) any at-rules, properties, property values, keywords, and
   other syntactic constructs for which they have no usable level of support.
   In particular, user agents <strong>must not</strong> selectively ignore
   unsupported component values and honor supported values in a single
   multi-value property declaration: if any value is considered invalid (as
   unsupported values must be), CSS requires that the entire declaration be
   ignored.

  <h3 id=experimental><span class=secno>6.4. </span> Experimental
   implementations</h3>

  <p>To avoid clashes with future CSS features, the CSS2.1 specification
   reserves a <a
   href="http://www.w3.org/TR/CSS21/syndata.html#vendor-keywords">prefixed
   syntax</a> for proprietary and experimental extensions to CSS.

  <p>Prior to a specification reaching the Candidate Recommendation stage in
   the W3C process, all implementations of a CSS feature are considered
   experimental. The CSS Working Group recommends that implementations use a
   vendor-prefixed syntax for such features, including those in W3C Working
   Drafts. This avoids incompatibilities with future changes in the draft.

  <h3 id=testing><span class=secno>6.5. </span> Non-experimental
   implementations</h3>

  <p>Once a specification reaches the Candidate Recommendation stage,
   non-experimental implementations are possible, and implementors should
   release an unprefixed implementation of any CR-level feature they can
   demonstrate to be correctly implemented according to spec.

  <p>To establish and maintain the interoperability of CSS across
   implementations, the CSS Working Group requests that non-experimental CSS
   renderers submit an implementation report (and, if necessary, the
   testcases used for that implementation report) to the W3C before releasing
   an unprefixed implementation of any CSS features. Testcases submitted to
   W3C are subject to review and correction by the CSS Working Group.

  <p>Further information on submitting testcases and implementation reports
   can be found from on the CSS Working Group's website at <a
   href="http://www.w3.org/Style/CSS/Test/">http://www.w3.org/Style/CSS/Test/</a>.
   Questions should be directed to the <a
   href="http://lists.w3.org/Archives/Public/public-css-testsuite">public-css-testsuite@w3.org</a>
   mailing list.

  <h2 class=no-num id=acknowledgments> Acknowledgments</h2>

  <p>This specification would not have been possible without the help from:

  <p>Stephen Deach, Martin Dürst,  Hideki Hiura(<span lang=ja>樋浦
   秀樹</span>), Masayasu Ishikawa(<span lang=ja>石川 雅康</span>),
   Chris Pratley, Takao Suzuki(<span lang=ja>鈴木 孝雄</span>), Frank
   Yung-Fong Tang, Chris Thrasher, Masafumi Yabe<span lang=ja>家辺
   勝文</span>), Steve Zilles.

  <h2 class=no-num id=changes> Changes</h2>

  <p>The following major changes have been made since the previous Working
   Draft:

  <dl>
   <dt>Remove ‘<code class=property>ruby-span</code>’ and mentions of
    <code>rbspan</code>.

   <dd> Explicit spanning is not used in HTML ruby in favor of implicit
    spanning. This can't handle some pathological double-sided spanning
    cases, but there seems to be no requirement for these at the moment. (For
    implementations that support full complex XHTML Ruby, they can imply
    spanning from the markup the same magic way that we handle cell spanning
    from tables. It doesn't seem necessary to include controls this in Level
    1.)

   <dt>Defer ‘<code class=property>ruby-overhang</code>’ and ‘<code
    class=css>ruby-align: line-end</code>’ to Level 2.

   <dd> It's somewhat complicated, advanced feature. Proposal is to make this
    behavior UA-defined and provide some examples of acceptable options.

   <dt>Close issue requesting ‘<code class=css>display: rp</code>’: use
    ‘<code class=css>display: none</code>’.

   <dd> The Internationalization WG added an issue requesting a display value
    for &lt;rp> elements. They're supposed to be hidden when &lt;ruby> is
    displayed as ruby. But this is easily accomplished already with ‘<code
    class=css>display: none</code>’.

   <dt>Change ‘<a href="#ruby-position"><code
    class=property>ruby-position</code></a>’ values to match ‘<code
    class=property>text-emphasis-position</code>’.

   <dd> Other than ‘<code class=css>inter-character</code>’, which we
    need to keep, it makes more sense to align ruby positions with ‘<code
    class=property>text-emphasis-position</code>’, which can correctly
    handle various combinations of horizontal/vertical preferences.

   <dt>Remove unused values of ‘<a href="#ruby-align"><code
    class=property>ruby-align</code></a>’.

   <dd> ‘<code class=css>left</code>’, ‘<code
    class=css>right</code>’, and ‘<code class=css>end</code>’ are not
    needed.

   <dt>Replace ‘<code class=css>auto</code>’, ‘<code
    class=css>distribute-letter</code>’, and ‘<code
    class=css>distribute-space</code>’ from ‘<a href="#ruby-align"><code
    class=property>ruby-align</code></a>’ with ‘<code
    class=css>space-between</code>’ and ‘<code
    class=css>space-around</code>’.

   <dd> The ‘<code class=css>auto</code>’ value relied on inspecting
    content to determine behavior; this can be avoided by just using ‘<code
    class=css>space-around</code>’ with standard justification rules (which
    allow spacing between CJK but not between Latin). Replaced ‘<code
    class=css>distribute-letter</code>’ and ‘<code
    class=css>distribute-space</code>’ with ‘<code
    class=css>space-between</code>’ and ‘<code
    class=css>space-around</code>’ for consistency with distribution
    keywords in <a
    href="#ref-CSS3-FLEXBOX">[CSS3-FLEXBOX]<!--{{CSS3-FLEXBOX}}--></a> and <a
    href="#ref-CSS3-ALIGN">[CSS3-ALIGN]<!--{{CSS3-ALIGN}}--></a> and to avoid
    any links to the definition of ‘<code class=css>text-justify:
    distribute</code>’.

   <dt>Added ‘<a href="#ruby-merge"><code
    class=property>ruby-merge</code></a>’ property to control jukugo
    rendering.

   <dd> This is a stylistic effect, not a structural one; the previous model
    assumed that it was structural and suggested handling it by changing
    markup. :(

   <dt>Remove ‘<code class=css>inline</code>’ from ‘<a
    href="#ruby-position"><code class=property>ruby-position</code></a>’.

   <dd> This is do-able via ‘<code class=css>display: inline</code>’ on
    all the ruby-related elements, see <a href="#default-inline">Appendix
    A</a>

   <dt>Added <a href="#default-style">Default Style</a> rules

   <dd> As requested by Internationalization WG.

   <dt>Wrote anonymous box generation rules

   <dd> And defined pairing of bases and annotations. Should now handle all
    the crazy proposed permutations of HTML ruby markup.

   <dt>Defined layout of ruby

   <dd> Defined in detail space distribution, white space handling, line
    breaking, line stacking, etc. Open issue left for bidi.
  </dl>

  <h2 class=no-num id=references> References</h2>

  <h3 class=no-num id=normative-references> Normative references</h3>
  <!--begin-normative-->
  <!-- Sorted by label -->

  <dl class=bibliography><!---->

   <dt id=CSS-TEXT-3>[CSS-TEXT-3]

   <dd>Elika J. Etemad; Koji Ishii. <a
    href="http://www.w3.org/TR/2013/WD-css-text-3-20131010/"><cite>CSS Text
    Module Level 3.</cite></a> 10 October 2013. W3C Last Call Working Draft.
    (Work in progress.) URL: <a
    href="http://www.w3.org/TR/2013/WD-css-text-3-20131010/">http://www.w3.org/TR/2013/WD-css-text-3-20131010/</a>
   </dd>
   <!---->

   <dt id=CSS21>[CSS21]

   <dd>Bert Bos; et al. <a
    href="http://www.w3.org/TR/2011/REC-CSS2-20110607"><cite>Cascading Style
    Sheets Level 2 Revision 1 (CSS 2.1) Specification.</cite></a> 7 June
    2011. W3C Recommendation. URL: <a
    href="http://www.w3.org/TR/2011/REC-CSS2-20110607">http://www.w3.org/TR/2011/REC-CSS2-20110607</a>
   </dd>
   <!---->

   <dt id=RFC2119>[RFC2119]

   <dd>S. Bradner. <a href="http://www.ietf.org/rfc/rfc2119.txt"><cite>Key
    words for use in RFCs to Indicate Requirement Levels.</cite></a> 2119.
    RFC. URL: <a
    href="http://www.ietf.org/rfc/rfc2119.txt">http://www.ietf.org/rfc/rfc2119.txt</a>
   </dd>
   <!---->
  </dl>
  <!--end-normative-->

  <h3 class=no-num id=other-references> Other references</h3>
  <!--begin-informative-->
  <!-- Sorted by label -->

  <dl class=bibliography><!---->

   <dt id=CSS3-ALIGN>[CSS3-ALIGN]

   <dd>Elika J. Etemad; Tab Atkins Jr. <a
    href="http://www.w3.org/TR/2013/WD-css3-align-20130514/"><cite>CSS Box
    Alignment Module Level 3.</cite></a> 14 May 2013. W3C Working Draft.
    (Work in progress.) URL: <a
    href="http://www.w3.org/TR/2013/WD-css3-align-20130514/">http://www.w3.org/TR/2013/WD-css3-align-20130514/</a>
   </dd>
   <!---->

   <dt id=CSS3-FLEXBOX>[CSS3-FLEXBOX]

   <dd>Tab Atkins Jr.; Elika J. Etemad; Alex Mogilevsky. <a
    href="http://www.w3.org/TR/2012/CR-css3-flexbox-20120918/"><cite>CSS
    Flexible Box Layout Module.</cite></a> 18 September 2012. W3C Candidate
    Recommendation. (Work in progress.) URL: <a
    href="http://www.w3.org/TR/2012/CR-css3-flexbox-20120918/">http://www.w3.org/TR/2012/CR-css3-flexbox-20120918/</a>
   </dd>
   <!---->

   <dt id=CSS3-FONTS>[CSS3-FONTS]

   <dd>John Daggett. <a
    href="http://www.w3.org/TR/2013/CR-css-fonts-3-20131003/"><cite>CSS Fonts
    Module Level 3.</cite></a> 3 October 2013. W3C Candidate Recommendation.
    (Work in progress.) URL: <a
    href="http://www.w3.org/TR/2013/CR-css-fonts-3-20131003/">http://www.w3.org/TR/2013/CR-css-fonts-3-20131003/</a>
   </dd>
   <!---->

   <dt id=CSS3-TEXT-DECOR>[CSS3-TEXT-DECOR]

   <dd>Elika J. Etemad; Koji Ishii. <a
    href="http://www.w3.org/TR/2013/CR-css-text-decor-3-20130801/"><cite>CSS
    Text Decoration Module Level 3.</cite></a> 1 August 2013. W3C Candidate
    Recommendation. (Work in progress.) URL: <a
    href="http://www.w3.org/TR/2013/CR-css-text-decor-3-20130801/">http://www.w3.org/TR/2013/CR-css-text-decor-3-20130801/</a>
   </dd>
   <!---->

   <dt id=CSS3VAL>[CSS3VAL]

   <dd>Håkon Wium Lie; Tab Atkins; Elika J. Etemad. <a
    href="http://www.w3.org/TR/2013/CR-css3-values-20130730/"><cite>CSS
    Values and Units Module Level 3.</cite></a> 30 July 2013. W3C Candidate
    Recommendation. (Work in progress.) URL: <a
    href="http://www.w3.org/TR/2013/CR-css3-values-20130730/">http://www.w3.org/TR/2013/CR-css3-values-20130730/</a>
   </dd>
   <!---->

   <dt id=JIS4051>[JIS4051]

   <dd><cite>Formatting rules for Japanese documents
    (『日本語文書の組版方法』).</cite> Japanese Standards
    Association. 2004. JIS X 4051:2004. In Japanese</dd>
   <!---->

   <dt id=JLREQ>[JLREQ]

   <dd>Yasuhiro Anan (阿南 康宏); et al. <a
    href="http://www.w3.org/TR/2012/NOTE-jlreq-20120403/"><cite>Requirements
    for Japanese Text Layout.</cite></a> 3 April 2012. W3C Working Group
    Note. URL: <a
    href="http://www.w3.org/TR/2012/NOTE-jlreq-20120403/">http://www.w3.org/TR/2012/NOTE-jlreq-20120403/</a>
   </dd>
   <!---->

   <dt id=RUBY>[RUBY]

   <dd>Marcin Sawicki; et al. <a
    href="http://www.w3.org/TR/2001/REC-ruby-20010531"><cite>Ruby
    Annotation.</cite></a> 31 May 2001. W3C Recommendation. URL: <a
    href="http://www.w3.org/TR/2001/REC-ruby-20010531">http://www.w3.org/TR/2001/REC-ruby-20010531</a>
   </dd>
   <!---->
  </dl>
  <!--end-informative-->

  <h2 class=no-num id=index> Index</h2>
  <!--begin-index-->

  <ul class=indexlist>
   <li>annotation level, <a href="#level"
    title="section 2.3."><strong>2.3.</strong></a>

   <li>Annotation pairing, <a href="#annotation-pairing"
    title="section 2.3."><strong>2.3.</strong></a>

   <li>authoring tool, <a href="#authoring-tool"
    title="section 6.2."><strong>6.2.</strong></a>

   <li>hidden annotation, <a href="#hidden"
    title="section 2.4."><strong>2.4.</strong></a>

   <li>hidden ruby annotation, <a href="#hidden"
    title="section 2.4."><strong>2.4.</strong></a>

   <li>level, <a href="#level" title="section 2.3."><strong>2.3.</strong></a>

   <li>renderer, <a href="#renderer"
    title="section 6.2."><strong>6.2.</strong></a>

   <li>Ruby, <a href="#ruby" title="section 1.4."><strong>1.4.</strong></a>

   <li>ruby-align, <a href="#ruby-align"
    title="section 3.3."><strong>3.3.</strong></a>

   <li>ruby-align:center, <a href="#center"
    title="section 3.3."><strong>3.3.</strong></a>

   <li>ruby-align:space-around, <a href="#space-around"
    title="section 3.3."><strong>3.3.</strong></a>

   <li>ruby-align:space-between, <a href="#space-between"
    title="section 3.3."><strong>3.3.</strong></a>

   <li>ruby-align:start, <a href="#start"
    title="section 3.3."><strong>3.3.</strong></a>

   <li>ruby annotation, <a href="#ruby-annotation"
    title="section 2."><strong>2.</strong></a>, <a
    href="#ruby-annotation-box"
    title="section 2.1."><strong>2.1.</strong></a>

   <li>ruby annotation box, <a href="#ruby-annotation-box"
    title="section 2.1."><strong>2.1.</strong></a>

   <li>ruby annotation container, <a href="#ruby-annotation-container-box"
    title="section 2.1."><strong>2.1.</strong></a>

   <li>ruby annotation container box, <a
    href="#ruby-annotation-container-box"
    title="section 2.1."><strong>2.1.</strong></a>

   <li>ruby base, <a href="#ruby-base"
    title="section 2."><strong>2.</strong></a>, <a href="#ruby-base-box"
    title="section 2.1."><strong>2.1.</strong></a>

   <li>ruby base box, <a href="#ruby-base-box"
    title="section 2.1."><strong>2.1.</strong></a>

   <li>ruby base container, <a href="#ruby-base-container-box"
    title="section 2.1."><strong>2.1.</strong></a>

   <li>ruby base container box, <a href="#ruby-base-container-box"
    title="section 2.1."><strong>2.1.</strong></a>

   <li>ruby container, <a href="#ruby-container-box"
    title="section 2.1."><strong>2.1.</strong></a>

   <li>ruby container box, <a href="#ruby-container-box"
    title="section 2.1."><strong>2.1.</strong></a>

   <li>ruby-merge, <a href="#ruby-merge"
    title="section 3.2."><strong>3.2.</strong></a>

   <li>ruby-merge:auto, <a href="#auto"
    title="section 3.2."><strong>3.2.</strong></a>

   <li>ruby-merge:collapse, <a href="#collapse"
    title="section 3.2."><strong>3.2.</strong></a>

   <li>ruby-merge:separate, <a href="#separate"
    title="section 3.2."><strong>3.2.</strong></a>

   <li>ruby-position, <a href="#ruby-position"
    title="section 3.1."><strong>3.1.</strong></a>

   <li>ruby-position:inter-character, <a href="#inter-character"
    title="section 3.1."><strong>3.1.</strong></a>

   <li>ruby-position:left, <a href="#left"
    title="section 3.1."><strong>3.1.</strong></a>

   <li>ruby-position:over, <a href="#over"
    title="section 3.1."><strong>3.1.</strong></a>

   <li>ruby-position:right, <a href="#right"
    title="section 3.1."><strong>3.1.</strong></a>

   <li>ruby-position:under, <a href="#under"
    title="section 3.1."><strong>3.1.</strong></a>

   <li>ruby segments, <a href="#ruby-segments"
    title="section 2."><strong>2.</strong></a>

   <li>style sheet
    <ul>
     <li>as conformance class, <a href="#style-sheet"
      title="section 6.2."><strong>6.2.</strong></a>
    </ul>
  </ul>
  <!--end-index-->

  <h2 class=no-num id=property-index> Property index</h2>
  <!--begin-properties-->

  <table class=proptable>
   <thead>
    <tr>
     <th>Property

     <th>Values

     <th>Initial

     <th>Applies to

     <th>Inh.

     <th>Percentages

     <th>Media

   <tbody>
    <tr>
     <th><a class=property href="#ruby-align">ruby-align</a>

     <td>start | center | space-between | space-around

     <td>space-around

     <td>ruby bases, ruby annotations, ruby base containers, ruby annotation
      containers

     <td>yes

     <td>N/A

     <td>visual

    <tr>
     <th><a class=property href="#ruby-merge">ruby-merge</a>

     <td>separate | collapse | auto

     <td>separate

     <td>ruby annotation containers

     <td>yes

     <td>N/A

     <td>visual

    <tr>
     <th><a class=property href="#ruby-position">ruby-position</a>

     <td>[ over | under | inter-character ] && [ right | left ]

     <td>over right

     <td>ruby annotation containers

     <td>yes

     <td>N/A

     <td>visual
  </table>
  <!--end-properties-->
</html>
<!-- Keep this comment at the end of the file
Local variables:
mode: sgml
sgml-declaration:"~/SGML/HTML4.decl"
sgml-default-doctype-name:"html"
sgml-minimize-attributes:t
sgml-nofill-elements:("pre" "style" "br")
sgml-live-element-indicator:t
sgml-omittag:nil
sgml-shorttag:nil
sgml-namecase-general:t
sgml-general-insert-case:lower
sgml-always-quote-attributes:t
sgml-indent-step:nil
sgml-indent-data:t
sgml-parent-document:nil
sgml-exposed-tags:nil
sgml-local-catalogs:nil
sgml-local-ecat-files:nil
End:
-->
