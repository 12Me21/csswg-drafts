<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8" >
    <title>CSS Device Adaptation</title>
    <link href="default.css" rel="stylesheet" type="text/css">
    <link href="../default.css" rel="stylesheet" type="text/css">
    <link href="http://www.w3.org/StyleSheets/TR/W3C-[STATUS]" rel="stylesheet" type="text/css">
  </head>
  <body class="draft">
    <div class="head">
      <!--logo-->

      <h1>CSS Device Adaptation</h1>

      <h2 class="no-num no-toc">[LONGSTATUS] [DATE]</h2>

      <dl>
        <dt>This version:</dt>
        <dd>$Date$ (editor's draft)
        <!--<dd><a href="[VERSION]">http://www.w3.org/TR/[YEAR]/WD-css-device-adapt-[CDATE]/</a></dd>-->

        <dt>Latest version:</dt>
        <dd><a href="http://www.w3.org/TR/css-device-adapt/">http://www.w3.org/TR/css-device-adapt/</a></dd>

        <dt>Latest editor's draft:</dt>
        <dd><a href="http://dev.w3.org/csswg/css3-device-adapt/">http://dev.w3.org/csswg/css-device-adapt/</a></dd>

        <dt>Previous version:</dt>
        <dd><a href="http://www.w3.org/TR/2011/WD-css-device-adapt-20110915/">
	    http://www.w3.org/TR/2011/WD-css-device-adapt-20110915/</a></dd>

	<dt>Issues List:</dt>
	<dd><a href="https://www.w3.org/Bugs/Public/buglist.cgi?product=CSS&component=Device%20Adaptation">W3C Bugzilla</a></dd>

	<dt>Feedback:</dt>
	<dd><a href="mailto:www-style@w3.org?subject=%5Bcss-device-adapt%5D%20feedback"
         >www-style@w3.org</a> 
         with subject line &ldquo;<kbd>[css-device-adapt] 
         <var>&hellip; message topic &hellip;</var></kbd>&rdquo;
         (<a rel="discussion" href="http://lists.w3.org/Archives/Public/www-style/"
           >archives</a>)</dd>

        <dt>Editors:</dt>
        <dd><a href="mailto:rune@opera.com">Rune Lillesveen</a> (<a href="http://www.opera.com/">Opera Software</a>)</dd>
        <dd><a href="mailto:oyvinds@opera.com">Ã˜yvind Stenhaug</a> (<a href="http://www.opera.com/">Opera Software</a>)</dd>
        <dd><a href="mailto:florian@rivoal.net">Florian Rivoal</a> (invited expert)</dd>

	<dt>Previous Editors:</dt>
        <dd><a href="mailto:rbetts@adobe.com">Ryan Betts</a> (<a href="http://www.adobe.com/">Adobe Systems</a>)</dd>
      </dl>

      <!--copyright-->

      <hr title="Separator for header">
    </div>

    <h2 class="no-num no-toc">Abstract</h2>

    <p>This specification provides a way for an author to
      specify, in CSS, the size, zoom factor, and orientation of the viewport
      that is used as the base for the initial containing block.</p>

    <h2 class="no-num no-toc">Status of this document</h2>
    <!--status-->

    <h2 class="no-num no-toc">Table of Contents</h2>
    <!--toc-->

    <h2>Introduction</h2>

    <p><em>This section is not normative.</em></p>

    <p>CSS 2.1 [[!CSS21]] specifies an
      <a href="http://www.w3.org/TR/CSS21/visudet.html#containing-block-details">
      initial containing block</a> for continuous media that has the dimensions
      of the <a href="http://www.w3.org/TR/CSS21/visuren.html#viewport">
      viewport</a>. Mobile/handheld device browsers have a viewport that is
      generally a lot narrower than a desktop browser window at a zoom level
      that gives a CSS pixel size
      <a href="http://www.w3.org/TR/CSS21/syndata.html#length-units">recommended
      </a> by CSS 2.1.</p>

    <p>The narrow viewport is a problem for documents designed to look good in
      desktop browsers. The result is that mobile browser vendors use a fixed
      initial containing block size that is different from the viewport size,
      and close to that of a typical desktop browser window. In addition to
      scrolling or panning, zooming is often used to change between an overview
      of the document and zoom in on particular areas of the document to read
      and interact with.</p>

    <p>Certain DOCTYPEs (for instance XHTML Mobile Profile) are used to recognize
      mobile documents which are assumed to be designed for handheld devices,
      hence using the viewport size as the initial containing block size.</p>

    <p>Additionally, an HTML <code class="html">META</code> tag has been introduced for allowing an
      author to specify the size of the initial containing block, and the initial
      zoom factor directly. It was first implemented by Apple for the Safari/iPhone
      browser, but has since been implemented for the Opera, Android, and Fennec
      browsers. These implementations are not fully interoperable and this
      specification is an attempt at standardizing the functionality provided by
      the viewport <code class="html">META</code> tag in CSS.</p>

    <h2>Values</h2>

    <p>This specification follows the <a
      href="http://www.w3.org/TR/css3-syntax/#property-defs">CSS property
      definition conventions</a> from [[!CSS3SYN]].</p>

    <p>Value types are defined in [[!CSS3VAL]].</p>


    <h2>The viewport</h2>

    <p>In CSS 2.1 a <a href="http://www.w3.org/TR/CSS21/visuren.html#viewport">viewport</a>
      is a feature of a user agent for continuous media and used to establish
      the initial containing block for continuous media. For paged media, the
      initial containing block is based on the page area. The page area can be
      set through @page rules. Hence, @viewport applies to continuous media,
      and @page to paged media, and they will not interact or conflict.</p>

    <p>This specification introduces a way of overriding the size of the viewport
      provided by the user agent (UA). Because of this, we need to introduce the
      difference between the <span>initial viewport</span> and the
      <span>actual viewport</span>.</p>

    <dl>
      <dt><dfn>initial viewport</dfn></dt>
      <dd>This refers to the viewport before any UA or author styles have
	overridden the viewport given by the window or viewing area of the UA.
	Note that the initial viewport size will change with the size of the
	window or viewing area.</dd>
      <dt><dfn>actual viewport</dfn></dt>
      <dd>This is the viewport you get after the cascaded viewport descriptors,
	  and the following <a href="#constraining-procedure">constraining procedure</a>
	  have been applied.</dd>
    </dl>

    <p>When the <span>actual viewport</span> cannot fit inside the window or
      viewing area, either because the <span>actual viewport</span> is larger
      than the <span>initial viewport</span> or the zoom factor causes only parts
      of the <span>actual viewport</span> to be visible, the UA should offer a
      scrolling or panning mechanism.</p>

    <p>It is recommended that initially the upper-left corners of the <span>
      actual viewport</span> and the window or viewing area are aligned if the
      base direction of the document is ltr. Similarly, that the upper-right
      corners are aligned when the base direction is rtl. The base direction for
      a document is defined as the computed value of the
      <code class="property">direction</code> property for the first
      <code class="html">BODY</code> element of an HTML or XHTML document. For
      other document types, it is the computed
      <code class="property">direction</code> for the root element.</p>

    <p class="issue">"dbaron: The question is, what does this do on the desktop
      browser? (And what's a desktop browser)". Need to say that a "desktop"
      browser typically have no UA styles, as opposed to the
      <a href="#ua-stylesheet">UA stylesheet</a> outlined for current mobile
      behaviour, and that no UA styles for @viewport will give "desktop"
      behaviour per default (actual viewport is initial viewport).</p>


    <h2>The <code class="css">@viewport</code> rule</h2>

    <p>The <code class="css">@viewport</code> <a
      href="http://www.w3.org/TR/CSS21/syndata.html#at-rules">at-rule</a>
      consists of the @-keyword followed by a block of descriptors
      describing the viewport.</p>

    <p>The descriptors inside an <code class="css">@viewport</code>
      rule are per document and there is no inheritance involved. Hence
      declarations using the &lsquo;<code class="css">inherit</code>&rsquo;
      keyword will be dropped. They work similarly to <code class="css">@page</code>
      descriptors and follow the cascading order of CSS. Hence, descriptors in
      <code class="css">@viewport</code> rules will override descriptors from
      preceding rules. The declarations allow !important which will affect
      cascading of descriptors accordingly.
    </p>

    <p class="issue">Should the @viewport rule apply to top-level documents only?
      If not, we need to say something about different zoom factors in frames.</p>

    <p class="issue">Bert: What's interactions of @viewport and @page</p>

    <div class="example">
      <p>This example sets the viewport to fit the width of the device. Note
        that it is enough to set the width as the height will be resolved from
        the width.</p>
      <pre><!--
	-->@viewport {
<!--    -->  width: device-width;
<!--    -->}<!--
   --></pre>
    </div>

    <h3>Syntax</h3>

    <p>The syntax for the <code class="css">@viewport</code> rule is as follows
      (using the notation from the <a
      href="http://www.w3.org/TR/CSS21/grammar.html">Grammar appendix</a> of CSS
      2.1 [[!CSS21]]):</p>

    <pre><!--
    -->viewport
<!---->  : VIEWPORT_SYM S*
<!---->    '{' S* declaration? [ ';' S* declaration? ]* '}' S*<!--
      -->;</pre>

    <p>with the new token:</p>

    <pre>@{V}{I}{E}{W}{P}{O}{R}{T} {return VIEWPORT_SYM;}</pre>

    <p>
      where:
    </p>

    <pre>V               v|\\0{0,4}(56|76)(\r\n|[ \t\r\n\f])?|\\v
<!--  -->W               w|\\0{0,4}(57|77)(\r\n|[ \t\r\n\f])?|\\w</pre>

    <p>The <code>viewport</code> non-terminal is added to the <code>stylesheet</code>
      production along with the <code>ruleset</code>, <code>media</code>, and
      <code>page</code> non-terminals:</p>

    <pre><!--
      -->stylesheet
<!--  -->  : [ CHARSET_SYM STRING ';' ]?
<!--  -->    [S|CDO|CDC]* [ import [ CDO S* | CDC S* ]* ]*
<!--  -->    [ [ ruleset | media | page | viewport ] [ CDO S* | CDC S* ]* ]*
<!--  -->  ;<!--
 --></pre>

    <p>It is also added to media production to allow
      <code class="css">@viewport</code> rules nested inside
      <code class="css">@media</code> rules <span class="note">This is extending
      the CSS 2.1 syntax. A draft of CSS3 Paged Media also allows page inside
      @media.</span>:</p>

    <pre><!--
      -->media
<!--  -->  : MEDIA_SYM S* media_list LBRACE S* [ ruleset | viewport ]* '}' S*
<!--  -->  ;<!--
 --></pre>

    <h2>Viewport descriptors</h2>

    <p>This section presents the descriptors that are allowed inside an
      <code class="css">@viewport</code> rule. Other descriptors than those
      listed here will be dropped.</p>

    <p>Relative length values are resolved against initial values. For instance
      'em's are resolved against the initial value of the
      <code class="property">font-size</code> property. Viewport lengths (vw,
      vh, vmin, vmax) are relative to the initial viewport.</p>

    <h3>The
      &lsquo;<code class="descriptor">min-width</code>&rsquo; and
      &lsquo;<code class="descriptor">max-width</code>&rsquo; descriptors</h3>

    <table class="descdef">
      <tbody>
	<tr>
	  <td><em>Name:</em></td>
	  <td><dfn>min-width</dfn></td>
	</tr>

	<tr>
	  <td><em>Value:</em></td>
	  <td><span>&lt;viewport-length&gt;</span></td>
	</tr>

	<tr>
	  <td><em>Initial:</em></td>
	  <td><span title="auto!!length">auto</span></td>
	</tr>

	<tr>
	  <td><em>Percentages:</em></td>
	  <td>Refer to the width of the <span>initial viewport</span></td>
	</tr>

	<tr>
	  <td><em>Media:</em></td>
	  <td>visual, continuous</td>
	</tr>

	<tr>
	  <td><em>Computed&nbsp;value:</em></td>
	  <td>&lsquo;<code class="css" title="auto!!length">auto</code>&rsquo;,
	    &lsquo;<code class="css">device-width</code>&rsquo;,
	    &lsquo;<code class="css">device-height</code>&rsquo;, an
	    absolute length, or a percentage as specified</td>
	</tr>
      </tbody>
    </table>

    <table class="descdef">
      <tbody>
	<tr>
	  <td><em>Name:</em></td>
	  <td><dfn>max-width</dfn></td>
	</tr>

	<tr>
	  <td><em>Value:</em></td>
	  <td><span>&lt;viewport-length&gt;</span></td>
	</tr>

	<tr>
	  <td><em>Initial:</em></td>
	  <td><span title="auto!!length">auto</span></td>
	</tr>

	<tr>
	  <td><em>Percentages:</em></td>
	  <td>Refer to the width of the <span>initial viewport</span></td>
	</tr>

	<tr>
	  <td><em>Media:</em></td>
	  <td>visual, continuous</td>
	</tr>

	<tr>
	  <td><em>Computed&nbsp;value:</em></td>
	  <td>&lsquo;<code class="css" title="auto!!length">auto</code>&rsquo;,
	    &lsquo;<code class="css">device-width</code>&rsquo;,
	    &lsquo;<code class="css">device-height</code>&rsquo;, an
	    absolute length, or a percentage as specified</td>
	</tr>
      </tbody>
    </table>

    <p>Specifies the minimum and maximum width of the
      <a href="http://www.w3.org/TR/CSS21/visuren.html#viewport">viewport</a>
      that is used to set the size of the
      <a href="http://www.w3.org/TR/CSS21/visudet.html#containing-block-details">
      initial containing block</a> where</p>

    <p style="margin: 1em"><var><dfn>&lt;viewport-length&gt;</dfn></var> = auto | device-width | device-height | <var>&lt;length&gt;</var> | <var>&lt;percentage&gt;</var></p>

    <p>and the values have the following meanings:</p>

    <dl>
      <dt>&lsquo;<code class="css"><dfn title="auto!!length">auto</dfn></code>&rsquo;</dt>
      <dd>The used value is calculated from the other descriptors' values
	according to the
	<a href="#constraining-procedure">constraining procedure</a>.</dd>

      <dt>&lsquo;<code class="css"><dfn>device-width</dfn></code>&rsquo;</dt>
      <dd>The width of the screen in CSS pixels at zoom factor 1.0.</dd>

      <dt>&lsquo;<code class="css"><dfn>device-height</dfn></code>&rsquo;</dt>
      <dd>The height of the screen in CSS pixels at zoom factor 1.0.</dd>

      <dt><var>&lt;length&gt;</var></dt>
      <dd>
	<p>A non-negative absolute or relative length.</p>
      </dd>

      <dt><var>&lt;percentage&gt;</var></dt>
      <dd>
	<p>A percentage value relative to the width or height of the
	  <span>initial viewport</span> at zoom factor 1.0,
	  for horizontal and vertical lengths respectively. Must be non-negative.
	</p>
      </dd>
    </dl>

    <p>The min-width and max-width descriptors are inputs to the
      <a href="#constraining-procedure">constraining procedure</a>.
      The width will initially be set as close as possible to the
      <span>initial viewport</span> width within the min/max
      constraints.</p>

    <h3>The
      &lsquo;<code class="descriptor">width</code>&rsquo;
      shorthand descriptor</h3>

    <table class="descdef">
      <tbody>
	<tr>
	  <td><em>Name:</em></td>
	  <td><dfn>width</dfn></td>
	</tr>

	<tr>
	  <td><em>Value:</em></td>
	  <td><span>&lt;viewport-length&gt;</span>{1,2}</td>
	</tr>

	<tr>
	  <td><em>Initial:</em></td>
	  <td>See individual descriptors</td>
	</tr>

	<tr>
	  <td><em>Percentages:</em></td>
	  <td>See individual descriptors</td>
	</tr>

	<tr>
	  <td><em>Media:</em></td>
	  <td>visual, continuous</td>
	</tr>

	<tr>
	  <td><em>Computed&nbsp;value:</em></td>
	  <td>See individual descriptors</td>
	</tr>
      </tbody>
    </table>

    <p>This is a shorthand descriptor for setting both min-width and max-width.
      One <span>&lt;viewport-length&gt;</span> value will set both min-width and max-width
      to that value. Two <span>&lt;viewport-length&gt;</span> values will set min-width to
      the first and max-width to the second.</p>

    <h3>The &lsquo;<code class="descriptor">min-height</code>&rsquo; and
      &lsquo;<code class="descriptor">max-height</code>&rsquo; descriptor</h3>

    <table class="descdef">
      <tbody>
	<tr>
	  <td><em>Name:</em></td>
	  <td><dfn>min-height</dfn></td>
	</tr>

	<tr>
	  <td><em>Value:</em></td>
	  <td><span>&lt;viewport-length&gt;</span></td>
	</tr>

	<tr>
	  <td><em>Initial:</em></td>
	  <td><span title="auto!!length">auto</span></td>
	</tr>

	<tr>
	  <td><em>Percentages:</em></td>
	  <td>Refer to the height of the <span>initial viewport</span></td>
	</tr>

	<tr>
	  <td><em>Media:</em></td>
	  <td>visual, continuous</td>
	</tr>

	<tr>
	  <td><em>Computed&nbsp;value:</em></td>
	  <td>&lsquo;<code class="css" title="auto!!length">auto</code>&rsquo;,
	    &lsquo;<code class="css">device-width</code>&rsquo;,
	    &lsquo;<code class="css">device-height</code>&rsquo;, an
	    absolute length, or a percentage as specified</td>
	</tr>
      </tbody>
    </table>

    <table class="descdef">
      <tbody>
	<tr>
	  <td><em>Name:</em></td>
	  <td><dfn>max-height</dfn></td>
	</tr>

	<tr>
	  <td><em>Value:</em></td>
	  <td><span>&lt;viewport-length&gt;</span></td>
	</tr>

	<tr>
	  <td><em>Initial:</em></td>
	  <td><span title="auto!!length">auto</span></td>
	</tr>

	<tr>
	  <td><em>Percentages:</em></td>
	  <td>Refer to the height of the <span>initial viewport</span></td>
	</tr>

	<tr>
	  <td><em>Media:</em></td>
	  <td>visual, continuous</td>
	</tr>

	<tr>
	  <td><em>Computed&nbsp;value:</em></td>
	  <td>&lsquo;<code class="css" title="auto!!length">auto</code>&rsquo;,
	    &lsquo;<code class="css">device-width</code>&rsquo;,
	    &lsquo;<code class="css">device-height</code>&rsquo;, an
	    absolute length, or a percentage as specified</td>
	</tr>
      </tbody>
    </table>

    <p>Specifies the minimum and maximum height of the
      <a href="http://www.w3.org/TR/CSS21/visuren.html#viewport">viewport</a>
      that is used to set the size of the
      <a href="http://www.w3.org/TR/CSS21/visudet.html#containing-block-details">
      initial containing block</a>.</p>

    <p>The min-height and max-height descriptors are inputs to the
      <a href="#constraining-procedure">constraining procedure</a>.
      The height will initially be set as close as possible to the
      <span>initial viewport</span> height within the min/max
      constraints.</p>


    <h3>The &lsquo;<code class="descriptor">height</code>&rsquo; shorthand descriptor</h3>

    <table class="descdef">
      <tbody>
	<tr>
	  <td><em>Name:</em></td>
	  <td><dfn>height</dfn></td>
	</tr>

	<tr>
	  <td><em>Value:</em></td>
	  <td><span>&lt;viewport-length&gt;</span>{1,2}</td>
	</tr>

	<tr>
	  <td><em>Initial:</em></td>
	  <td>See individual descriptors</td>
	</tr>

	<tr>
	  <td><em>Percentages:</em></td>
	  <td>See individual descriptors</td>
	</tr>

	<tr>
	  <td><em>Media:</em></td>
	  <td>visual, continuous</td>
	</tr>

	<tr>
	  <td><em>Computed&nbsp;value:</em></td>
	  <td>See individual descriptors</td>
	</tr>
      </tbody>
    </table>

    <p>This is a shorthand descriptor for setting both min-height and max-height.
      One <span>&lt;viewport-length&gt;</span> value will set both min-height and max-height
      to that value. Two <span>&lt;viewport-length&gt;</span> values will set min-height to
      the first and max-height to the second.</p>

    <h3>The &lsquo;<code class="descriptor" title="zoom!!descriptor">zoom</code>&rsquo; descriptor</h3>

    <table class="descdef">
      <tbody>
	<tr>
	  <td><em>Name:</em></td>
	  <td><dfn>zoom</dfn></td>
	</tr>

	<tr>
	  <td><em>Value:</em></td>
	  <td>auto | &lt;number&gt; | &lt;percentage&gt;</td>
	</tr>

	<tr>
	  <td><em>Initial:</em></td>
	  <td><span title="auto!!zoom">auto</span></td>
	</tr>

	<tr>
	  <td><em>Percentages:</em></td>
	  <td>The zoom factor itself</td>
	</tr>

	<tr>
	  <td><em>Media:</em></td>
	  <td>visual, continuous</td>
	</tr>

	<tr>
	  <td><em>Computed&nbsp;value:</em></td>
	  <td>&lsquo;<code class="css" title="auto!!zoom">auto</code>&rsquo;, or a non-negative
	    number or percentage as specified.</td>
	</tr>
      </tbody>
    </table>

    <p>Specifies the initial zoom factor for the window or viewing area. This is
      a magnifying glass type of zoom. Interactively changing the zoom factor
      from the initial zoom factor does not affect the size of the initial or
      the actual viewport.</p>

    <p>Values have the following meanings:</p>

    <dl>
      <dt>&lsquo;<code class="css"><dfn title="auto!!zoom">auto</dfn></code>&rsquo;</dt>
      <dd>The zoom factor is UA-dependent. The UA may use the size of the area
        of the canvas on which the document is rendered to find that initial
        zoom factor. See <a href="#handling-auto-zoom">this section</a> for a
        proposed way of handling
        &lsquo;<code class="css" title="auto!!zoom">auto</code>&rsquo; values
        for &lsquo;<code class="descriptor" title="zoom!!descriptor">zoom</code>&rsquo;.</dd>

      <dt><var>&lt;number&gt;</var></dt>
      <dd>
        <p>A non-negative number used as a zoom factor. A factor of 1.0 means
          that no zooming is done. Values larger than 1.0 gives a zoomed-in
          effect and values smaller than 1.0 a zoomed-out effect.</p>
      </dd>

      <dt><var>&lt;percentage&gt;</var></dt>
      <dd>
        <p>A non-negative percentage value used as a zoom factor. A factor of
          100% means that no zooming is done. Values larger than 100% gives a
          zoomed-in effect and values smaller than 100% a zoomed-out effect.</p>
      </dd>
    </dl>


    <h3>The &lsquo;<code class="descriptor">min-zoom</code>&rsquo; descriptor</h3>

    <table class="descdef">
      <tbody>
	<tr>
	  <td><em>Name:</em></td>
	  <td><dfn>min-zoom</dfn></td>
	</tr>

	<tr>
	  <td><em>Value:</em></td>
	  <td>auto | &lt;number&gt; | &lt;percentage&gt;</td>
	</tr>

	<tr>
	  <td><em>Initial:</em></td>
	  <td><span title="auto!!min-zoom">auto</span></td>
	</tr>

	<tr>
	  <td><em>Percentages:</em></td>
	  <td>The zoom factor itself</td>
	</tr>

	<tr>
	  <td><em>Media:</em></td>
	  <td>visual, continuous</td>
	</tr>

	<tr>
	  <td><em>Computed&nbsp;value:</em></td>
	  <td>&lsquo;<code class="css" title="auto!!min-zoom">auto</code>&rsquo;, or a non-negative
	    number or percentage as specified.</td>
	</tr>
      </tbody>
    </table>

    <p>Specifies the smallest allowed zoom factor. It is used as input to the
      <a href="#constraining-procedure">constraining procedure</a> to constrain
      non-&lsquo;<code class="css" title="auto!!zoom">auto</code>&rsquo;
      &lsquo;<code class="descriptor" title="zoom!!descriptor">zoom</code>&rsquo;
      values, but also to limit the allowed zoom factor that can be set through
      user interaction. The UA should also use this value as a constraint when
      choosing an actual zoom factor when the used value of
      &lsquo;<code class="descriptor" title="zoom!!descriptor">zoom</code>&rsquo; is
      &lsquo;<code class="css" title="auto!!zoom">auto</code>&rsquo;.</p>

    <p>Values have the following meanings:</p>

    <dl>
      <dt>&lsquo;<code class="css"><dfn title="auto!!min-zoom">auto</dfn></code>&rsquo;</dt>
      <dd>The lower limit on zoom factor is UA dependant. There will be no minimum
        value constraint on the &lsquo;<code class="descriptor"
        title="zoom!!descriptor">zoom</code>&rsquo; descriptor used in the
        <a href="#constraining-procedure">constraining procedure</a></dd>

      <dt><var>&lt;number&gt;</var></dt>
      <dd>
	<p>A non-negative number limiting the minimum value of the zoom factor.</p>
      </dd>

      <dt><var>&lt;percentage&gt;</var></dt>
      <dd>
	<p>A non-negative percentage limiting the minimum value of the zoom factor.</p>
      </dd>
    </dl>


    <h3>The &lsquo;<code class="descriptor">max-zoom</code>&rsquo; descriptor</h3>

    <table class="descdef">
      <tbody>
	<tr>
	  <td><em>Name:</em></td>
	  <td><dfn>max-zoom</dfn></td>
	</tr>

	<tr>
	  <td><em>Value:</em></td>
	  <td>auto | &lt;number&gt; | &lt;percentage&gt;</td>
	</tr>

	<tr>
	  <td><em>Initial:</em></td>
	  <td><span title="auto!!max-zoom">auto</span></td>
	</tr>

	<tr>
	  <td><em>Percentages:</em></td>
	  <td>The zoom factor itself</td>
	</tr>

	<tr>
	  <td><em>Media:</em></td>
	  <td>visual, continuous</td>
	</tr>

	<tr>
	  <td><em>Computed&nbsp;value:</em></td>
	  <td>&lsquo;<code class="css" title="auto!!max-zoom">auto</code>&rsquo;, or a non-negative
	    number or percentage as specified.</td>
	</tr>
      </tbody>
    </table>

    <p>Specifies the largest allowed zoom factor. It is used as input to the
      <a href="#constraining-procedure">constraining procedure</a> to constrain
      non-&lsquo;<code class="css" title="auto!!zoom">auto</code>&rsquo;
      &lsquo;<code class="descriptor" title="zoom!!descriptor">zoom</code>&rsquo;
      values, but also to limit the allowed zoom factor that can be set through
      user interaction. The UA should also use this value as a constraint when
      choosing an actual zoom factor when the used value of
      &lsquo;<code class="descriptor" title="zoom!!descriptor">zoom</code>&rsquo; is
      &lsquo;<code class="css" title="auto!!zoom">auto</code>&rsquo;.</p>

    <p>Values have the following meanings:</p>

    <dl>
      <dt>&lsquo;<code class="css"><dfn title="auto!!max-zoom">auto</dfn></code>&rsquo;</dt>
      <dd>The upper limit on zoom factor is UA dependant. There will be no maximum
        value constraint on the &lsquo;<code class="descriptor">zoom</code>&rsquo;
        descriptor used in the <a href="#constraining-procedure">constraining
        procedure</a></dd>

      <dt><var>&lt;number&gt;</var></dt>
      <dd>
	<p>A non-negative number limiting the maximum value of the zoom factor.</p>
      </dd>

      <dt><var>&lt;percentage&gt;</var></dt>
      <dd>
	<p>A non-negative percentage limiting the maximum value of the zoom factor.</p>
      </dd>
    </dl>


    <h3>The &lsquo;<code class="descriptor">user-zoom</code>&rsquo; descriptor</h3>

    <table class="descdef">
      <tbody>
	<tr>
	  <td><em>Name:</em></td>
	  <td><dfn>user-zoom</dfn></td>
	</tr>

	<tr>
	  <td><em>Value:</em></td>
	  <td>zoom | fixed</td>
	</tr>

	<tr>
	  <td><em>Initial:</em></td>
	  <td><span title="zoom!!value">zoom</span></td>
	</tr>

	<tr>
	  <td><em>Percentages:</em></td>
	  <td>N/A</td>
	</tr>

	<tr>
	  <td><em>Media:</em></td>
	  <td>visual, continuous</td>
	</tr>

	<tr>
	  <td><em>Computed&nbsp;value:</em></td>
	  <td>&lsquo;<code class="css" title="zoom!!value">zoom</code>&rsquo; or
	    &lsquo;<code class="css">fixed</code>&rsquo; as specified.</td>
	</tr>
      </tbody>
    </table>

    <p>Specifies if the zoom factor can be changed by user interaction or not.</p>

    <p>Values have the following meanings:</p>

    <dl>
      <dt>&lsquo;<code class="css"><dfn title="zoom!!value">zoom</dfn></code>&rsquo;</dt>
      <dd>The user can interactively change the zoom factor.</dd>

      <dt>&lsquo;<code class="css"><dfn>fixed</dfn></code>&rsquo;</dt>
      <dd>The user cannot interactively change the zoom factor.</dd>
    </dl>


    <h3>The &lsquo;<code class="descriptor">orientation</code>&rsquo; descriptor</h3>

    <table class="descdef">
      <tbody>
	<tr>
	  <td><em>Name:</em></td>
	  <td><dfn>orientation</dfn></td>
	</tr>

	<tr>
	  <td><em>Value:</em></td>
	  <td>auto | portrait | landscape</td>
	</tr>

	<tr>
	  <td><em>Initial:</em></td>
	  <td><span title="auto!!orientation">auto</span></td>
	</tr>

	<tr>
	  <td><em>Percentages:</em></td>
	  <td>N/A</td>
	</tr>

	<tr>
	  <td><em>Media:</em></td>
	  <td>visual, continuous</td>
	</tr>

	<tr>
	  <td><em>Computed&nbsp;value:</em></td>
	  <td>&lsquo;<code class="css" title="auto!!orientation">auto</code>&rsquo;,
	    &lsquo;<code class="css">portrait</code>&rsquo;, or
	    &lsquo;<code class="css">landscape</code>&rsquo; as specified.</td>
	</tr>
      </tbody>
    </table>

    <p>This descriptor is used to request that a document is displayed in portrait
      or landscape mode. For a UA/device where the orientation is changed upon
      tilting the device, an author can use this descriptor to inhibit the
      orientation change. The descriptor should be respected for
      standalone web applications, and when the document is displayed
      in fullscreen. It is recommended that it is ignored for normal
      web navigation to avoid confusing the user.</p>

    <p>Values have the following meanings:</p>

    <dl>
      <dt>&lsquo;<code class="css"><dfn title="auto!!orientation">auto</dfn></code>&rsquo;</dt>
      <dd>The UA automatically chooses the orientation based on the device's
	normal mode of operation. The UA may choose to change the orientation
	of the presentation when the device is tilted.</dd>

      <dt>&lsquo;<code class="css"><dfn>portrait</dfn></code>&rsquo;</dt>
      <dd>The document should be locked to portrait presentation.</dd>

      <dt>&lsquo;<code class="css"><dfn>landscape</dfn></code>&rsquo;</dt>
      <dd>The document should be locked to landscape presentation.</dd>
    </dl>

    <h2>Constraining viewport descriptor values</h2>

    <h3>Definitions</h3>

    <p>For the procedure below:</p>

    <p>Descriptors refer to the values resolved/constrained to at that point in
      the procedure. They are initially resolved to their computed values.
    </p>

    <p><code class="index" title="width!!resolved">width</code> and
      <code class="index" title="height!!resolved">height</code> refer to the
      resolved viewport size and not the shorthand descriptors. They are both
      initially &lsquo;<code class="css" title="auto!!length">auto</code>&rsquo;.
    </p>

    <p>
      <code>MIN/MAX</code> computations where one of the arguments is
      &lsquo;<code class="css">auto</code>&rsquo; resolve to the other argument.
      For instance, <code>MIN(0.25, 'auto') = 0.25</code>, and
      <code>MAX(5, 'auto') = 5</code>.
    </p>

    <p>
      <code class="index" title="width!!initial">initial-width</code> is the
      width of the <span>initial viewport</span> in pixels at zoom factor 1.0.
    </p>

    <p>
      <code class="index" title="height!!initial">initial-height</code> is the
      height of the <span>initial viewport</span> in pixels at zoom factor 1.0.
    </p>

    <h3 id="constraining-procedure">The procedure</h3>

    <p>The used values are resolved from the computed values going
      through the steps below.</p>

    <p>User agents are expected, but not required, to re-run this procedure and
      re-layout the document, if necessary, in response to changes in the user
      environment, for example if the device is tilted from landscape to
      portrait mode or the window that forms the
      <span>initial viewport</span> is resized.</p>

    <p>However, Media Queries and Device Adaption are <dfn title="Specifications
      whose evaluations are both affected by the same changes to the user 
      environment, and so always must be evaluated together in order to ensure 
      proper rendering.">tethered specifications</dfn>. As a result, UAs that also 
      support <a href="http://www.w3.org/TR/css3-mediaqueries/">Media Queries</a>
      must re-run this procedure and re-layout the document in all cases where
      changes in the user environment would cause them to re-evaluate Media  
      Queries.</p>

    <h4 class="no-num no-toc">Resolve <code title="min-zoom!!resolved">min-zoom</code>
      and <code title="max-zoom!!resolved">max-zoom</code> values</h4>

    <ol>
      <li>If <code title="min-zoom!!resolved">min-zoom</code> is not
	&lsquo;<code class="css" title="auto!!min-zoom">auto</code>&rsquo; and
	<code title="max-zoom!!resolved">max-zoom</code> is not
	&lsquo;<code class="css" title="auto!!max-zoom">auto</code>&rsquo;,
	set <code>max-zoom = MAX(min-zoom, max-zoom)</code></li>
    </ol>

    <h4 class="no-num no-toc">Constrain <code title="zoom!!resolved">zoom</code>
      value to the <code>[min-zoom, max-zoom]</code> range</h4>

    <ol id="ol2">
      <li>If <code title="zoom!!resolved">zoom</code> is not
      &lsquo;<code class="css" title="auto!!zoom">auto</code>&rsquo;,
      set <code>zoom = MAX(min-zoom, MIN(max-zoom, zoom))</code></li>
    </ol>

    <h4 id="resolve-px" class="no-num no-toc">Resolve non-&lsquo;<code class="css" title="auto!!length">auto</code>&rsquo; lengths to pixel lengths</h4>

    <ol id="ol3">
      <li>Resolve relative and absolute lengths, percentages, and
	keywords (&lsquo;<code class="css">device-width</code>&rsquo;,
	&lsquo;<code class="css">device-height</code>&rsquo;) to pixel
	values for the &lsquo;<code class="descriptor">min-width</code>&rsquo;,
	&lsquo;<code class="descriptor">max-width</code>&rsquo;,
	&lsquo;<code class="descriptor">min-height</code>&rsquo; and
	&lsquo;<code class="descriptor">max-height</code>&rsquo;
	descriptors.
      </li>
    </ol>

    <h4 class="no-num no-toc">Resolve initial <code title="width!!resolved">width</code> and
      <code title="height!!resolved">height</code> from min/max descriptors</h4>

    <ol id="ol4">
      <li>If <code title="min-width!!resolved">min-width</code> or
	<code title="max-width!!resolved">max-width</code> is not
	&lsquo;<code class="css" title="auto!!length">auto</code>&rsquo;, set
	<code>width = MAX(min-width, MIN(max-width, initial-width))</code></li>

      <li>If <code title="min-height!!resolved">min-height</code> or
	<code title="max-height!!resolved">max-height</code> is not
	&lsquo;<code class="css" title="auto!!length">auto</code>&rsquo;, set
	<code>height = MAX(min-height, MIN(max-height, initial-height))</code></li>
    </ol>

    <h4 class="no-num no-toc">Resolve <code title="width!!resolved">width</code>
      value</h4>

    <ol id="ol6">
      <li>If <code title="width!!resolved">width</code> and
	<code title="height!!resolved">height</code> are both
	&lsquo;<code class="css">auto</code>&rsquo;, set <code>width =
	initial-width</code></li>

      <li>If <code title="width!!resolved">width</code> is
	&lsquo;<code class="css">auto</code>&rsquo;, set <code>width = height *
	(initial-width / initial-height)</code>, or <code>width = initial-width</code>
	if <code class="index" title="height!!initial">initial-height</code> is 0.</li>
    </ol>

    <h4 class="no-num no-toc">Resolve <code title="height!!resolved">height</code>
      value</h4>

    <ol id="ol8">
      <li>If <code title="height!!resolved">height</code> is
	&lsquo;<code class="css">auto</code>&rsquo;, set <code>height = width *
	(initial-height / initial-width)</code>, or <code>height = initial-height</code>
	if <code class="index" title="width!!initial">initial-width</code> is 0.</li>
    </ol>


    <h2>Media Queries</h2>

    <p>For several media features, the size of the initial containing block and
      the orientation of the device affects the result of a media query
      evaluation, which means that the effect of
      <code class="css">@viewport</code> rules on media queries needs extra
      attention.</p>

    <p class="issue">Bert: If you put @viewport, can you put @viewport in
      @media? Say what it means?</p>

    <p>From the Media Queries specification [[!MEDIAQ]]:</p>

      <blockquote><p>&ldquo;To avoid circular dependencies, it is never necessary to apply the style
      sheet in order to evaluate expressions. For example, the aspect ratio of a
      printed document may be influenced by a style sheet, but expressions
      involving &lsquo;device-aspect-ratio&rsquo; will be based on the default aspect ratio
      of the user agent.&rdquo;</p></blockquote>

    <p>For <code class="css">@viewport</code> rules, though, the UA must cascade
      them separately with the <span>initial viewport</span> size used for
      evaluating media feature expressions and other values that depend on the
      viewport size to avoid circular dependencies, but use the actual viewport
      size when cascading all other rules.</p>

    <p>Procedure for applying CSS rules:</p>

    <ol>
      <li>Cascade all <code class="css">@viewport</code> rules using the
        <span>initial viewport</span> size for values and evaluations which rely
	on viewport size</li>
      <li>Compute the <span>actual viewport</span> from the cascaded viewport
        descriptors</li>
      <li>Cascade all other rules using the <span>actual
        viewport</span> size</li>
    </ol>

    <p class="note">The rationale for using the viewport descriptors obtained from applying
      the <code class="css">@viewport</code> rules for evaluating media
      queries for style rules, is that media queries should match the
      <span>actual viewport</span> that the document will be
      layed out in and not the initial or the one specified in the UA stylesheet.
      Consider the example below given that the UA stylesheet has a viewport
      width of 980px, but a device-width and <span>initial
      viewport</span> width of 320px. The author has made separate styles to make
      the document look good for initial containing block widths above or below
      400px. The <span>actual viewport</span> used will be
      320px wide, and in order to match the styles with the
      <span>actual viewport</span> width, the viewport
      resulting from applying the <code class="css">@viewport</code> rules
      should be used to evaluate the media queries.</p>

    <div class="example">
      <p>Given a device-width of 320px and a UA stylesheet viewport width of
	980px, the first media query will not match, but the second will.</p>
      <pre><!--
	-->@viewport {
<!--    -->  width: device-width;
<!--    -->}
<!--    -->
<!--    -->@media screen and (min-width: 400px) {
<!--    -->  div { color: red; }
<!--    -->}
<!--    -->
<!--    -->@media screen and (max-width: 400px) {
<!--    -->  div { color: green; }
<!--    -->}<!--
   --></pre>
    </div>

    <p>Another example:</p>

    <div class="example">
      <p>The media query below should match because the
	<code class="css">@viewport</code> rule is applied before the media
	query is evaluated.</p>
      <pre><!--
	-->@media screen and (width: 397px) {
<!--    -->  div { color: green; }
<!--    -->}
<!--    -->
<!--    -->@viewport {
<!--    -->  width: 397px;
<!--    -->}<!--
   --></pre>
    </div>

    <p>Below is an example where an <code class="css">@viewport</code> rule
      relies on a media query affected by the viewport descriptors.</p>

    <div class="example">
      <p>The green color should be applied to a div because the
	<span>initial viewport</span>
	width is used to evaluate the media query for the second
	<code class="css">@viewport</code> rule, but the
	<span>actual viewport</span> is
	used for evaluating the media query when applying style rules.</p>
      <pre><!--
        -->@viewport {
<!--    -->  width: 397px;
<!--    -->}
<!--    -->
<!--    -->@media screen and (width: 397px) {
<!--    -->  @viewport {
<!--    -->    width: 500px;
<!--    -->  }
<!--    -->}
<!--    -->
<!--    -->@media screen and (width: 397px) {
<!--    -->  div { color: green; }
<!--    -->}<!--
   --></pre>
    </div>

    <p>It is recommended that authors do not write
      <code class="css">@viewport</code> rules that rely on media queries
      whose evaluation is affected by viewport descriptors. Is is also
      recommended that the <code class="css">@viewport</code> rule(s) is
      placed as early in the document as possible to avoid unnecessary
      re-evaluation of media queries or reflows.</p>


    <h2>CSSOM</h2>

    <p class="issue">Properties in the CSSOM and CSSOM View specifications refer
      to the <span>viewport</span> and the <span>initial containing block</span>.
      If any of those properties should refer to the <span>initial viewport</span>
      and not the <span>actual viewport</span>, those exceptions need to be
      adressed.</p>

    <h2>DOM Interfaces</h2>

    <p>The <code class="css">@viewport</code> rule is exposed to the CSSOM
      through a new CSSRule interface</p>

    <dl>
      <dt>
        <b>Interface <i><a id="DOM-CSSRule" name="DOM-CSSRule">CSSRule</a></i></b>
      </dt>
      <dd>
        <p>The following rule type is added to the <code>CSSRule</code>
          interface. It provides identification for the new viewport rule.</p>
        <dl>
          <dt>
            <b>IDL Definition</b>
          </dt>
          <dd>
            <div class="idl-code">
              <pre><!--
                -->interface CSSRule {
<!--            -->    ...
<!--            -->    const unsigned short VIEWPORT_RULE = 15;
<!--            -->    ...
<!--            -->};<!--
           --></pre>
            </div>
          </dd>
        </dl>
      </dd>

      <dt>
        <b>Interface <i><a id="DOM-CSSViewportRule" name="DOM-CSSViewportRule">CSSViewportRule</a></i></b>
      </dt>
      <dd>
        <p>The <code>CSSViewportRule</code> interface represents the style rule
          for an <code class="css">@viewport</code> rules</p>
        <dl>
          <dt>
            <b>IDL Definition</b>
          </dt>
          <dd>
            <div class="idl-code">
              <pre><!--
                -->interface CSSViewportRule : CSSRule {
<!--            -->  readonly attribute CSSStyleDeclaration style;
<!--            -->};<!--
           --></pre>
            </div>
          </dd>
          <dt>
            <b>Attributes</b>
          </dt>
          <dd>
            <dl>
              <dt>
                <code class="attribute-name"><a id="DOM-CSSViewportRule-style" name="DOM-CSSViewportRule-style">style</a></code> of type <code>CSSStyleDeclaration</code>
              </dt>
              <dd>
                This attribute represents the viewport descriptors associated
                with this <code class="css">@viewport</code> rule.
              </dd>
            </dl>
          </dd>
          <dt>
            <b>No Methods</b>
          </dt>
        </dl>
      </dd>
    </dl>


    <h2>Conformance</h2>

    <p>Requirements for a conforming UA:</p>
    <ul>
	<li><p>The &lsquo;<code class="descriptor">min-width</code>&rsquo;,
	  &lsquo;<code class="descriptor">max-width</code>&rsquo;,
	  &lsquo;<code class="descriptor">width</code>&rsquo;,
	  &lsquo;<code class="descriptor">min-height</code>&rsquo;,
	  &lsquo;<code class="descriptor">max-height</code>&rsquo;, and
	  &lsquo;<code class="descriptor">height</code>&rsquo; descriptors must be supported.</p></li>
	<li><p>The &lsquo;<code class="descriptor">min-zoom</code>&rsquo;,
	  &lsquo;<code class="descriptor">max-zoom</code>&rsquo;, and
	  &lsquo;<code class="descriptor" title="zoom!!descriptor">zoom</code>&rsquo; descriptors must be supported as
	  input to the
	  <a href="#constraining-procedure">constraining procedure</a>. However,
	  the UA may choose to use a different zoom factor when presenting the
	  document to the user, and use different minimum and maximum zoom
	  limits for the user interaction.</p>
	  <p>This will for instance allow UAs without zooming capabilities to
	  conform and still have interoperable implementations when it comes to
	  viewport dimensions. It will also allow the UA to choose a different
	  zoom factor when content overflows the <span>actual viewport</span>.</p></li>
	<li><p>Support for the &lsquo;<code class="descriptor">user-zoom</code>&rsquo;
	  and &lsquo;<code class="descriptor">orientation</code>&rsquo;
	  descriptors is optional.</p></li>
    </ul>

    <h2 id="viewport-meta">Viewport <code class="html">META</code> element</h2>

    <p><em>This section is not normative.</em></p>

    <p>This section describes a mapping from the content attribute of the
      viewport <code class="html">META</code> element, first implemented by Apple in the iPhone
      Safari browser, to the descriptors of the
      <code class="css">@viewport</code> rule described in this
      specification.</p>

    <p>In order to match the Safari implementation, the following parsing
      algorithm and translation rules rely on the UA stylesheet below. See the
      section on <a href="#ua-stylesheets">UA stylesheets</a> for an elaborate
      description.</p>

    <pre><!--
      -->@viewport {
<!--  -->  width: extend-to-zoom 980px;
<!--  -->  min-zoom: 0.25;
<!--  -->  max-zoom: 5;
<!--  -->}<!--
 --></pre>

    <p class="note">Note that these values might not fit well with all UAs. For
      instance, with a min-zoom of 0.25 you will be able to fit the whole width
      of the document inside the window for widths up to 1280px on a 320px wide
      device like the original iPhone, but only 960px if you have a 240px
      display (all widths being given in CSS pixel units).</p>

    <h3 id="meta-properties">Properties</h3>

    <p>The recognized properties in the viewport <code class="html">META</code> element are:</p>

    <ul>
      <li><code class="index" title="width!!viewport META">width</code></li>
      <li><code class="index" title="height!!viewport META">height</code></li>
      <li><code class="index">initial-scale</code></li>
      <li><code class="index">minimum-scale</code></li>
      <li><code class="index">maximum-scale</code></li>
      <li><code class="index">user-scalable</code></li>
    </ul>

    <h3 id="parsing-algorithm">Parsing algorithm</h3>

    <p>Below is an algorithm for parsing
      the <code class="html">content</code> attribute of the <code class="html">META</code> tag
      produced from testing Safari on the iPhone. <span id="tested-safari"
      class="note">The testing was done on an iPod touch running iPhone OS 4.
      The UA string of the browser: <code>"Mozilla/5.0 (iPod; U; CPU
      iPhone OS 4_0 like Mac OS X; en-us) AppleWebKit/532.9 (KHTML, like Gecko)
      Version/4.0.5 Mobile/8A293 Safari/6531.22.7"</code>.</span> The pseudo
      code notation used is based on the notation used in <a href="#Algorithms"
      rel="biblioentry">[Algorithms]</a>.</p>
    <p>The whitespace class contains the following characters (ascii):</p>
    <ul>
      <li>Horizontal tab (0x09)</li>
      <li>Line feed (0x0a)</li>
      <li>Carriage return (0x0d)</li>
      <li>Space (0x20)</li>
    </ul>
    <p>The recognized separator between property/value pairs is comma for the
      Safari implementation. Some implementations have supported both commas
      and semicolons. Because of that, existing content use semicolons instead
      of commas. Authors should be using comma in order to ensure content works
      as expected in all UAs, but implementors may add support for both to ensure
      interoperability for existing content.</p>
    <p>The separator class contains the following characters (ascii), with comma
      as the preferred separator and semicolon as optional:</p>
    <ul>
      <li>Comma (0x2c)</li>
      <li>Semicolon (0x3b)</li>
    </ul>

    <pre class="algorithm"><!--
    --><span class="method"><span class="method-name">Parse-Content</span>(<span class="variable">S</span>)</span>
<!----><span class="statement"><span class="variable">i</span> &larr; 1</span>
<!----><span class="statement"><span class="keyword">while</span> <span class="variable">i</span> &le; <span class="op">length</span>[<span class="variable">S</span>]</span>
<!----><span class="statement">    <span class="keyword">do</span> <span class="keyword">while</span> <span class="variable">i</span> &le; <span class="op">length</span>[<span class="variable">S</span>] and <span class="variable">S</span>[<span class="variable">i</span>] in [whitespace, separator, '=']</span>
<!----><span class="statement">        <span class="keyword">do</span> <span class="variable">i</span> &larr; <span class="variable">i</span> + 1</span>
<!----><span class="statement">    <span class="keyword">if</span> <span class="variable">i</span> &le; <span class="op">length</span>[<span class="variable">S</span>]</span>
<!----><span class="statement">        <span class="keyword">then</span> <span class="variable">i</span> &larr; <span class="method-name">Parse-Property</span>(<span class="variable">S</span>, <span class="variable">i</span>)</span>
<!---->
<!----><span class="method"><span class="method-name">Parse-Property</span>(<span class="variable">S</span>, <span class="variable">i</span>)</span>
<!----><span class="statement"><span class="variable">start</span> &larr; <span class="variable">i</span></span>
<!----><span class="statement"><span class="keyword">while</span> <span class="variable">i</span> &le; <span class="op">length</span>[<span class="variable">S</span>] and <span class="variable">S</span>[<span class="variable">i</span>] <span class="keyword">not</span> in [whitespace, separator, '=']</span>
<!----><span class="statement">    <span class="keyword">do</span> <span class="variable">i</span> &larr; <span class="variable">i</span> + 1</span>
<!----><span class="statement"><span class="keyword">if</span> <span class="variable">i</span> &gt; <span class="op">length</span>[<span class="variable">S</span>] or <span class="variable">S</span>[<span class="variable">i</span>] in [separator]</span>
<!----><span class="statement">    <span class="keyword">then</span> <span class="keyword">return</span> <span class="variable">i</span></span>
<!----><span class="statement"><span class="variable">property-name</span> &larr; <span class="variable">S</span>[<span class="variable">start</span> .. (<span class="variable">i</span> - 1)]</span>
<!----><span class="statement"><span class="keyword">while</span> <span class="variable">i</span> &le; <span class="op">length</span>[<span class="variable">S</span>] and <span class="variable">S</span>[<span class="variable">i</span>] <span class="keyword">not</span> in [separator, '=']</span>
<!----><span class="statement">    <span class="keyword">do</span> <span class="variable">i</span> &larr; <span class="variable">i</span> + 1</span>
<!----><span class="statement"><span class="keyword">if</span> <span class="variable">i</span> &gt; <span class="op">length</span>[<span class="variable">S</span>] or <span class="variable">S</span>[<span class="variable">i</span>] in [separator]</span>
<!----><span class="statement">    <span class="keyword">then</span> <span class="keyword">return</span> <span class="variable">i</span></span>
<!----><span class="statement"><span class="keyword">while</span> <span class="variable">i</span> &le; <span class="op">length</span>[<span class="variable">S</span>] and <span class="variable">S</span>[<span class="variable">i</span>] in [whitespace, '=']</span>
<!----><span class="statement">    <span class="keyword">do</span> <span class="variable">i</span> &larr; <span class="variable">i</span> + 1</span>
<!----><span class="statement"><span class="keyword">if</span> <span class="variable">i</span> &gt; <span class="op">length</span>[<span class="variable">S</span>] or <span class="variable">S</span>[<span class="variable">i</span>] in [separator]</span>
<!----><span class="statement">    <span class="keyword">then</span> <span class="keyword">return</span> <span class="variable">i</span></span>
<!----><span class="statement"><span class="variable">start</span> &larr; <span class="variable">i</span></span>
<!----><span class="statement"><span class="keyword">while</span> <span class="variable">i</span> &le; <span class="op">length</span>[<span class="variable">S</span>] and <span class="variable">S</span>[<span class="variable">i</span>] <span class="keyword">not</span> in [whitespace, separator, '=']</span>
<!----><span class="statement">    <span class="keyword">do</span> <span class="variable">i</span> &larr; <span class="variable">i</span> + 1</span>
<!----><span class="statement"><span class="variable">property-value</span> &larr; <span class="variable">S</span>[<span class="variable">start</span> .. (<span class="variable">i</span> - 1)]</span>
<!----><span class="statement"><span class="method-name">Set-Property</span>(<span class="variable">property-name</span>, <span class="variable">property-value</span>)</span>
<!----><span class="statement"><span class="keyword">return</span> <span class="variable">i</span></span><!--
 --></pre>

    <p>
      <span class="method-name">Set-Property</span> matches the
      <a href="#meta-properties">listed property names</a> case-insensitively.
      The <code class="variable">property-value</code> strings are interpreted
      as follows:
    </p>

    <ol>
      <li>If a prefix of
	<code class="variable">property-value</code> can be
	converted to a number using <code>strtod</code>, the
	value will be that number. The remainder of the string is
	ignored.</li>
      <li>If the value can not be converted to a number as described above,
	the whole <code class="variable">property-value</code> string
	will be matched with the following strings
	case-insensitively: <code class="index">yes</code>,
	<code class="index">no</code>, <code class="index"
	title="device-width!!viewport META">device-width</code>,
	<code  class="index" title="device-height!!viewport META">device-height</code></li>
      <li>If the string did not match any of the known strings, the
	value is unknown.</li>
    </ol>


    <h3>&lsquo;<code class="css" title="extend-to-zoom">extend-to-zoom</code>&rsquo;</h3>

    <p>In order to be able to implement the functionality from
      <code class="html">META</code> viewport where the viewport width or height
      is extended to fill the viewing area at a given zoom level, we introduce
      a UA internal value to the list of <span>&lt;viewport-length&gt;</span>
      values called &lsquo;<code class="css" title="extend-to-zoom">extend-to-zoom</code>&rsquo;
      It will be used in width and height declarations in the translation
      outlined in the section below.</p>
      
    <p>This new value is necessary in order to implement the mapping for two
      reasons. First, whether resolving the width/height needs to extend the
      pixel length to the visible width/height for a given zoom factor depends
      on the current initial width/height.
      <code class="html">&lt;meta name="viewport" content="width=400, initial-scale=1"&gt;</code>
      yields a width of 400px for an initial-width of 320px, and 640px for an
      initial width of 640px. This can not be expressed as normative min/max
      descriptors that would constrain correctly when the initial width changes
      like for an orientation change.</p>
    <p>Secondly, the extended width/height also relies on cascading viewport
      properties from different sources, including
      &lsquo;<code class="descriptor">min-zoom</code>&rsquo; and
      &lsquo;<code class="descriptor">max-zoom</code>&rsquo; from the UA
      stylesheet. For instance, if the UA stylesheet has
      <code class="css">max-zoom: 5</code>, and the initial width is 320px,
      <code class="html">&lt;meta name="viewport" content="width=10"&gt;</code>
      will resolve to 64px.</p>

    <h4 class="no-num no-toc">Resolving &lsquo;<code class="css" title="extend-to-zoom">extend-to-zoom</code>&rsquo;</h4>

    <p>The &lsquo;<code class="css" title="extend-to-zoom">extend-to-zoom</code>&rsquo;
      value is resolved to pixel or auto lengths as part of
      <a href="#resolve-px">step 3</a> of the
      <a href="#constraining-procedure">constraining procedure</a>. Since this
      is a <em>non-normative</em> descriptor value, the resolution is described
      here. Note that max-descriptors need to be resolved to pixel lengths
      <em>before</em> min-descriptors when
      &lsquo;<code class="css" title="extend-to-zoom">extend-to-zoom</code>&rsquo;
      is a valid value.</p>

    <p>Let <code>extend-zoom = MIN(zoom, max-zoom)</code></p>
    <p>For non-&lsquo;<code class="css" title="auto!!zoom">auto</code>&rsquo;
      <code>extend-zoom</code>, let:</p>
    <pre><!--
     -->extend-width = initial-width / extend-zoom
<!-- -->extend-height = initial-height / extend-zoom<!--
 --></pre>

    <p>Then, resolve for
      &lsquo;<code class="css" title="extend-to-zoom">extend-to-zoom</code>&rsquo;
      as follows:</p>

    <ul>
    <li>If <code>extend-zoom</code> is
      &lsquo;<code class="css" title="auto!!zoom">auto</code>&rsquo;:
      <ol>
	<li>If <code title="max-width!!resolved">max-width</code> is
	&lsquo;<code class="css">extend-to-zoom</code>&rsquo;, set
	<code>max-width = 'auto'</code></li>
	<li>If <code title="max-height!!resolved">max-height</code> is
	&lsquo;<code class="css">extend-to-zoom</code>&rsquo;, set
	<code>max-height = 'auto'</code></li>
	<li>If <code title="min-width!!resolved">min-width</code> is
	&lsquo;<code class="css">extend-to-zoom</code>&rsquo;, set
	<code>min-width = max-width</code></li>
	<li>If <code title="min-height!!resolved">min-height</code> is
	&lsquo;<code class="css">extend-to-zoom</code>&rsquo;, set
	<code>min-height = max-height</code></li>
      </ol>
    </li>

    <li>If <code>extend-zoom</code> is
      non-&lsquo;<code class="css" title="auto!!zoom">auto</code>&rsquo;:
      <ol>
	<li>If <code title="max-width!!resolved">max-width</code> is
	&lsquo;<code class="css">extend-to-zoom</code>&rsquo;, set
	<code>max-width = extend-width</code></li>
	<li>If <code title="max-height!!resolved">max-height</code> is
	&lsquo;<code class="css">extend-to-zoom</code>&rsquo;, set
	<code>max-height = extend-height</code></li>
	<li>If <code title="min-width!!resolved">min-width</code> is
	&lsquo;<code class="css">extend-to-zoom</code>&rsquo;, set
	<code>min-width = MAX(extend-width, max-width)</code></li>
	<li>If <code title="min-height!!resolved">min-height</code> is
	&lsquo;<code class="css">extend-to-zoom</code>&rsquo;, set
	<code>min-height = MAX(extend-height, max-height)</code></li>
      </ol>
    </li>
    </ul>

    <h3>Translation into <code class="css">@viewport</code> descriptors</h3>

    <p>The Viewport <code class="html">META</code> element is placed in the
      cascade as if it was a <code class="html">STYLE</code> element, in the
      exact same place in the dom, that only contains a single
      <code class="css">@viewport</code> rule.</p>

    <p>Each of the property/value pair from the parsing in the
      previous section are translated, and added to that single at-rule
      as follows:</p>

    <h4 class="no-num no-toc">Unknown properties</h4>

    <p>Unknown properties are dropped.</p>

    <h4 class="no-num no-toc">The
      <code class="index" title="width!!viewport META">width</code>
      and <code class="index" title="height!!viewport META">height</code>
      properties</h4>

    <p>The <code class="index" title="width!!viewport META">width</code> and
      <code class="index" title="height!!viewport META">height</code> viewport
      <code class="html">META</code> properties are translated into
      &lsquo;<code class="descriptor">width</code>&rsquo; and
      &lsquo;<code class="descriptor">height</code>&rsquo; descriptors, setting
      the &lsquo;<code class="descriptor">min</code>&rsquo; value to
      &lsquo;<code class="css">extend-to-zoom</code>&rsquo; and the
      &lsquo;<code class="descriptor">max</code>&rsquo; value to the pixel
      length from the viewport <code class="html">META</code> property.</p>

    <ol>
      <li>Non-negative number values are translated to pixel lengths, clamped to
	the range: <code>[1px, 10000px]</code></li>
      <li>Negative number values are dropped</li>
      <li><code class="index" title="device-width!!viewport META">device-width</code>
	and <code class="index" title="device-height!!viewport META">device-height</code>
	are used as keywords</li>
      <li>Other keywords and unknown values translate to 1px</li>
    </ol>

    <div class="example">
      <p>This <code class="html">META</code> element:</p>
      <pre><!--
	-->&lt;meta name="viewport" content="width=500, height=600"&gt;<!--
   --></pre>
      <p>translates into:</p>
      <pre><!--
	-->@viewport {
<!--	-->  width: extend-to-zoom 500px;
<!--	-->  height: extend-to-zoom 600px;
<!--	-->}<!--
   --></pre>
    </div>

    <p>For a viewport <code class="html">META</code> element that translates
      into an <code class="css">@viewport</code> rule with a
      non-&lsquo;<code class="css">auto</code>&rsquo;
      &lsquo;<code class="descriptor" title="zoom!!descriptor">zoom</code>&rsquo;
      declaration and no &lsquo;<code class="descriptor">width</code>&rsquo;
      declaration:</p>

    <ul>
      <li>If it adds a &lsquo;<code class="descriptor">height</code>&rsquo;
	descriptor, add:
	<pre>width: auto;</pre>
      </li>
      <li>Otherwise, add:
	<pre>width: extend-to-zoom;</pre>
      </li>
    </ul>
    
    <p>to the <code class="css">@viewport</code> rule.</p>

    <div class="example">
      <p>This <code class="html">META</code> element:</p>
      <pre><!--
	-->&lt;meta name="viewport" content="initial-scale=1.0"&gt;<!--
   --></pre>
      <p>translates into:</p>
      <pre><!--
	-->@viewport {
<!--	-->  zoom: 1.0;
<!--	-->  width: extend-to-zoom;
<!--	-->}<!--
   --></pre>
    </div>

    <div class="example">
      <p>This <code class="html">META</code> element:</p>
      <pre><!--
	-->&lt;meta name="viewport" content="initial-scale=2.0, height=device-width"&gt;<!--
   --></pre>
      <p>translates into:</p>
      <pre><!--
	-->@viewport {
<!--	-->  zoom: 2.0;
<!--	-->  width: auto;
<!--	-->  height: extend-to-zoom device-width;
<!--	-->}<!--
   --></pre>
    </div>

    <h4 class="no-num no-toc">The <code class="index">initial-scale</code>,
      <code class="index">minimum-scale</code>, and
      <code class="index">maximum-scale</code> properties</h4>

    <p>The properties are translated into
      &lsquo;<code class="descriptor" title="zoom!!descriptor">zoom</code>&rsquo;,
      &lsquo;<code class="descriptor">min-zoom</code>&rsquo;,
      and &lsquo;<code class="descriptor">max-zoom</code>&rsquo;
      respectively with the following translations of values.</p>

    <ol>
      <li>Non-negative number values are translated to &lt;number&gt; values,
	clamped to the range <code>[0.1, 10]</code></li>
      <li>Negative number values are dropped</li>
      <li><code class="index">yes</code> is translated to 1</li>
      <li><code class="index" title="device-width!!viewport META">device-width</code>
	and <code class="index" title="device-height!!viewport META">device-height</code>
	are translated to 10</li>
      <li><code class="index">no</code> and unknown values are translated to 0.1</li>
    </ol>

    <p>For a viewport <code class="html">META</code> element that translates into an <code class="css">
      @viewport</code> rule with no &lsquo;<code class="descriptor">max-zoom</code>&rsquo; declaration and a non-&lsquo;<code class="css">auto</code>&rsquo;
      &lsquo;<code class="descriptor">min-zoom</code>&rsquo; value that is larger than the &lsquo;<code class="descriptor">max-zoom</code>&rsquo; value of the UA stylesheet,
      the &lsquo;<code class="descriptor">min-zoom</code>&rsquo; declaration value is clamped to the UA stylesheet &lsquo;<code class="descriptor">max-zoom</code>&rsquo;
      value.</p>

    <h4 class="no-num no-toc">The <code class="index">user-scalable</code> property</h4>

    <p>The <code class="index">user-scalable</code> property is translated into
      &lsquo;<code class="descriptor">user-zoom</code>&rsquo;
      with the following value translations.</p>

    <ol>
      <li><code class="index">yes</code> and <code class="index">no</code> are
	translated into
	&lsquo;<code class="css" title="zoom!!value">zoom</code>&rsquo; and
	&lsquo;<code class="css">fixed</code>&rsquo; respectively.</li>
      <li>Numbers &ge; 1, numbers &le; -1,
	<code class="index" title="device-width!!viewport META">device-width</code>
	and <code class="index" title="device-height!!viewport META">device-height</code>
	are mapped to
	&lsquo;<code class="css" title="zoom!!value">zoom</code>&rsquo;</li>
      <li>Numbers in the range <code>&lt;-1, 1&gt;</code>, and unknown values,
	are mapped to &lsquo;<code class="css">fixed</code>&rsquo;</li>
    </ol>

    <div class="example">
      <p>This <code class="html">META</code> element:</p>
      <pre>&lt;meta name="viewport" content="width=480, initial-scale=2.0, user-scalable=1"&gt;</pre>
      <p>will translate into this <code class="css">@viewport</code> block:</p>
      <pre><!--
	-->@viewport {
<!--	-->  width: 480px;
<!--	-->  zoom: 2.0;
<!--	-->  user-zoom: zoom;
<!--	-->}<!--
   --></pre>
    </div>


    <h2 id="handling-auto-zoom">Handling &lsquo;<code class="css" title="auto!!zoom">auto</code>&rsquo;
      for &lsquo;<code class="descriptor" title="zoom!!descriptor">zoom</code>&rsquo;</h2>

    <p><em>This section is not normative.</em></p>

    <p>This section presents one way of picking an actual value for the
      &lsquo;<code class="descriptor" title="zoom!!descriptor">zoom</code>&rsquo;
      descriptor when the used value is
      &lsquo;<code class="css" title="auto!!zoom">auto</code>&rsquo;.</p>

    <p>Given an <span>initial viewport</span> with size <code>(initial-width,
      initial-height)</code>, and a finite region within the
      <a href="http://www.w3.org/TR/CSS21/intro.html#canvas">canvas</a> where
      the formatting structure is rendered <code>(rendered-width,
      rendered-height)</code>. That region is at least as large as the
      <span>actual viewport</span>.

    <p>Then, if the used value of
      &lsquo;<code class="descriptor" title="zoom!!descriptor">zoom</code>&rsquo; is
      &lsquo;<code class="css" title="auto!!zoom">auto</code>&rsquo;, let the
      actual zoom factor be:</p>

    <pre>
<!---->zoom = MAX(initial-width / rendered-width, initial-height / rendered-height)<!--
 --></pre>

    <p>The actual zoom factor should also be further limited by the [min-zoom,
      max-zoom] range.</p>


    <h2 id="ua-stylesheets">UA stylesheets</h3>

    <p><em>This section is informative</em></p>

    <p>With the term desktop browser below, we mean a browser which has a size of
      the initial viewport, in CSS pixels, that is at least as large as the
      smallest viewport or viewing area you would expect a user of a desktop
      computer to have. In that sense, it could include tablet PC and TV browsers.</p>

    <h3>Desktop UA styles</h2>

    <p>For a desktop browser, the recommendation is to have no UA styles. That
      means that it will have all descriptors initially set to
      &lsquo;<code class="css">auto</code>&rsquo;, and behave as it would have
      without support for viewport descriptors if there are no viewport descriptors
      in the user or author styles.</p>

    <h3>Small screen UA styles</h3>

    <p>For smaller screen UAs like smartphone browsers, the UA could typically
      set the minimum viewport width to something that is at least as large as
      the narrowest width an author would expect a desktop user would use to
      view documents.</p>

    <div class="example">
      <pre><!--
        -->@viewport {
<!--    -->  min-width: 980px;
<!--    -->}<!--
   --></pre>
    </div>

    <p>It is recommended that limitations in zooming capabilities are not
      reflected in the UA styles but rather only affect the used values for
      zoom. The min-zoom/max-zoom UA styles mentioned in the
      <a href="#viewport-meta">Viewport META section</a> are there to give an
      accurate description of how the Safari browser behaves, not as part of a
      recommended UA stylesheet.</p>


    <h2 class="no-num">Acknowledgments</h2>

    <h2 class="no-num">References</h2>

    <h3 class="no-num">Normative references</h3>
    <!--normative-->

    <h3 class="no-num">Other references</h3>

    <dl class="bibliography">
      <dt id="Algorithms">[Algorithms]</dt>

      <dd>Thomas H. Cormen; et al. <cite>Introduction to
	  Algorithms, Second Edition, MIT Press.</cite>
      </dd>
    </dl>

    <h2 class="no-num">Descriptor index</h2>
    <!--descriptors-->

    <h2 class="no-num">Index</h2>
    <!--index-->

  </body>
</html>
