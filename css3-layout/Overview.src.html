<!DOCTYPE html public '-//W3C//DTD HTML 4.01//EN'>

<html lang=en>
<head profile="http://microformats.org/profile/hcard
  http://microformats.org/wiki/rel-license">

  <meta http-equiv=content-type content="text/html; charset=utf-8">
  <title>CSS Template Layout Module</title>
  <link rel=stylesheet type="text/css" href="../default.css">
  <link rel=stylesheet type="text/css"
  href="http://www.w3.org/StyleSheets/TR/W3C-MO.css">


<div class=head>
<!--logo-->

<h1>CSS Template Layout Module</h1>

<h2 class="no-num no-toc">[LONGSTATUS] [DATE: 3 August 2004]</h2>
<dl>
  <dt>This version: </dt>
    <dd><a href="[VERSION]">
	http://www.w3.org/TR/[YEAR]/ED-[SHORTNAME]-[CDATE]/</a>
  <dt>Latest version:</dt>
    <dd><a
      href="[LATEST]">
	http://www.w3.org/TR/css3-layout/</a>
  <dt>Previous version:</dt>
    <dd><a href="http://www.w3.org/TR/2011/WD-css3-layout-20111129/">
	http://www.w3.org/TR/2011/WD-css3-layout-20111129/</a>
  <dt>Editors:</dt>
    <dd class=vcard><span class=fn>Bert Bos</span>
    (<span class=org>W3C</span>) <a class=email
    href="mailto:bert@w3.org">bert@w3.org</a>
    <dd class=vcard><span class=fn>César Acebal</span>
    (<span class=org>University of Oviedo</span>)
</dl>
<!--copyright-->

<hr title="Separator for header">
</div>

<h2 class="no-num no-toc" id=abstract>Abstract</h2>

<div class=sidefigure>
  <p><img src="diagram.png" alt="Image: four elements move to four
  slots in a template" longdesc="diagram.desc">

  <p class=caption>Above: a typical Web page. Below: the underlying
  grid template.
</div>

<p>CSS is a simple, declarative language for creating style sheets
that specify the rendering of HTML and other structured documents.
This module contains CSS features to describe layouts at a high level,
meant for tasks such as the positioning and alignment of “widgets” in
a graphical user interface or the layout grid for a page or a window.

<p>A layout grid or “template” defines one or more “slots” that an
element's content can flow into. This allows elements to have
complex shapes and it allows the visual order to be different from the
order of the elements in the source document.

<p class=level4>A '::slot' selector allows elements to be styled
differently based on which slot they appear in.

<h2 class="no-num no-toc" id=status>Status of this document</h2>
<!--status-->

<p>This draft is related to the drafts about positoning with grid
units ('gr'), creating and naming grids and regions
[[CSS3-GRID-LAYOUT]], flexible <abbr title="Graphical User
Interfaces">GUIs</abbr> [[CSS3-FLEXBOX]], and tables [[!CSS3TBL]]. The
CSS Working Group is considering combining some or all of these into a
single specification with all matrix-based layouts.

<p>The section on <a href="#cr-exit-criteria">“CR exit criteria”</a>
lists some conditions for this specification to become a W3C
Recommendation.

<p>Issues on this draft are mentioned in the text itself
(<span class=issue>like this</span>) and/or in the on-line Tracker
under <a href="http://www.w3.org/Style/CSS/Tracker/products/15"
>“Details on Product CSS3 Template Layout.”</a>

<h2 class="no-num no-toc" id=contents>Table of contents</h2>
<!--toc-->


<h2 id=dependencies>Dependencies on other modules</h2>

<p>This CSS3 module depends on the following other CSS3 modules:
<ul>
  <li><cite>CSS syntax module</cite> [[!CSS3SYN]] &ndash;
  <dfn>interactive</dfn> vs <dfn>non-interactive</dfn> media.

  <li><cite>CSS values and Units module</cite> [[!CSS3VAL]] &ndash; <a
  href="/TR/css3-values#strings">
  <dfn><var>&lt;string&gt;</var></dfn></a> and <a
  href="/TR/css3-values#length-value">
  <dfn><var>&lt;length&gt;</var></dfn></a>.

  <li><cite>CSS box module</cite> [[!CSS3BOX]] &ndash; properties
  <dfn>width</dfn>, <dfn>height</dfn>, <dfn>float</dfn>,
  <dfn>display</dfn> and <dfn>overflow</dfn>

  <li><cite>CSS text layout</cite> [[!CSS3TEXTLAYOUT]] &ndash;
  properties <dfn>direction</dfn> and <dfn>block-flow</dfn>

  <li><cite>CSS positioning</cite> [[!CSS3POS]] &ndash; property
  <dfn>z-index</dfn>
    
  <li><cite>CSS paged media</cite> [[!CSS3PAGE]] &ndash; properties
  <dfn>page-break-before</dfn>, <dfn>page-break-after</dfn> and
  <dfn>page</dfn>; <a href="/TR/css3-page#page-area0"><dfn>page
  area</dfn></a> (in particular its width &amp; height).

  <li><cite>CSS background and borders</cite> [[!CSS3BG]] &ndash;
  property <dfn>background</dfn> <span
  class=issue>and <dfn>box-shadow</dfn>?</span>

  <li><cite>CSS tables</cite> [[!CSS3TBL]] &ndash; property
  <dfn>vertical-align</dfn>. <span class=issue>[or Box Module?]</span>

  <li><cite>CSS Multi-column Layout Module</cite> [[!CSS3COL]] &ndash;
  properties <dfn>break-before</dfn>, <dfn>break-after</dfn> and
  <dfn>break-inside</dfn>.
</ul>

<p class=issue>Add to the above all the properties that are allowed on
slots (see <a href="#slot-pseudo" >“The '::slot()'
pseudo-element”</a>).

<p>It has non-normative (informative) references to the following
other CSS3 modules:
<ul>
  <li><cite>Selectors</cite> [[SELECT]]
</ul>

<p>See <a
href="http://www.w3.org/TR/CSS21/about.html#property-defs">section&nbsp;1.4.2
of CSS level&nbsp;2</a> [[CSS21]] for the grammar and other notations
that this specification uses in property definitions.

<h2>Introduction</h2>

<p><em>(This section is not normative.)</em>

<div class=sidefigure>
  <p><img src="diagram.png" alt="Image: four elements move to four
  slots in a template" longdesc="diagram.desc">

  <p class=caption>Above: a typical Web page. Below: the underlying
  grid template. It has four slots, a, b, c and d and the grid
  template is defined by 'grid: "aaaaaaa" "bccccdd"'.
</div>

<p class=mtb>The styling of a Web page, a form or a graphical user
interface can roughly be divided in two parts: (1) defining the
overall “grid” of the page or window and (2) specifying the fonts,
indents, colors, etc., of the text and other objects. The two are not
completely separate, of course, because indenting or coloring a text
influences the perceived grid as well. Nevertheless, when one
separates the parts of a style that should change when the window gets
bigger from the parts that stay the same, one often finds that the
grid changes (room for a sidebar, extra navigation bar, big margins,
larger images…), while fonts, colors, indents, numbering styles, and
many other things don't have to change, until the size of the window
becomes extreme.

<p>The properties in this specification work by associating a
<em>layout policy</em> with an element. Rather than letting an element
lay out its descendants in a single flow, the policy defined in this
module gives an element a <span>grid template,</span> which is a set
of <span>slots</span> aligned to an invisible grid, where each slot is
a <em>separate</em> flow. The descendants are given a 'flow' property
to designate the slot into which they flow.

<p>Because layouts on the Web have to adapt to different window and
paper sizes, the rows and columns of the grid can be made fixed or
flexible in size.

<p>The typical use cases for these properties include:

<ul>
  <li>Complex Web pages, with multiple navigation bars in fixed
  positions, areas for advertisements, etc.

  <li>Complex forms, where the alignment of labels and form fields may
  be easier with the properties of this module than with the
  properties for tables and margins.

  <li>GUIs, where buttons, toolbars, labels, icons, etc., are aligned
  in complex ways and have to stay aligned (and not wrap, for example)
  when the window is resized.

  <li class=level4>Paged displays (e.g., printed media) where each
  page is divided in fixed areas for different kinds of content.

  <li class=level4>Complex pages with multiple regions, where the
  style of the text does not only depend on the type of element it
  comes from, but also on the region it is displayed in.
</ul>

<p>Template-based positioning is an alternative to absolute
positioning, which, like absolute positioning, is especially useful
for aligning elements that don't have simple relationships in the
source (parent-child, ancestor-descendant, immediate sibling). But in
contrast to absolute positioning, the elements are not positioned with
the help of horizontal and vertical coordinates, but by mapping them
into slots in a table-like template. The relative size and alignment
of elements is thus governed implicitly by the rows and columns of the
template. A template doesn't allow elements to overlap, but it provides
layouts that adapt better to different widths.

<p class=issue>Call it a “slot” or rather a “region”?

<p>The mapping is done with the 'position' property, which specifies
in this case into which slot of the template the element goes. The
template itself is specified on the 'display' property of some
ancestor of the elements to remap.

<div class=example>
<p>In this example, the four children of an element are assigned to
four slots (called a, b, c and d) in a 2×2 template. (All mark-up
examples in this specification are HTML fragments, unless otherwise
stated.)

<div class=sidefigure>
  <p><img src="aapje.png" alt="Image: sample rendering" longdesc="aapje.desc">
  <p class=caption>Each element occupies one slot. In this template,
  all slots have the same size.
</div>

<pre>
&lt;style type="text/css"&gt;
  dl { display: "ab"
                "cd" }
  #sym1 { position: a }
  #lab1 { position: b }
  #sym2 { position: c }
  #lab2 { position: d }
&lt;/style&gt;
&lt;dl&gt;
  &lt;dt id=sym1&gt;A
  &lt;dd id=lab1&gt;A is een aapje
  &lt;dt id=sym2&gt;B
  &lt;dd id=lab2&gt;B is de bakker
&lt;/dl&gt;
</pre>
</div>

<div class=example>
<p>Templates can also help with device-independence. This example uses
Media Queries [[MEDIAQ]] to change the overall layout of a page from
3-column layout for a wide screen to a 1-column layout for a narrow
screen. It assumes the page has been marked-up with logical sections
with IDs.

<pre>
@media all
{
  body { display: "aaa"
                  "bcd" }
  #head { position: a }
  #nav { position: b }
  #adv { position: c }
  #body { position: d }
}
@media all and (max-width: 500px)
{
  body { display: "a"
                  "b"
                  "c" }
  #head { position: a }
  #nav { position: b }
  #adv { display: none }
  #body { position: c }
}</pre>
</div>

<div class=example>
<p>Elements can be positioned this way, but not made to overlap,
unless with negative margins. Here is how the <a
href="http://www.csszengarden.com/?cssfile=/026/026.css&amp;page=0">
“zunflower” design</a> of the Zen Garden could be done:

<pre>
#container { display: "abc" }
#intro { position: a; margin-right: -2em; box-shadow: 0.5em 0.5em 0.5em }
#supportingText { position: b; box-shadow: 0.5em 0.5em 0.5em }
#linkList { position: c }
</pre>
</div>

<div class=example>
<p>Template-based positioning borrows some concepts from table layout,
in particular the idea of aligning elements in rows and columns, so
that they constrain each other's size. But there are also differences. 
This example shows some of them. Assume this document fragment:

<pre>
&lt;div class=group>
 &lt;div>aa aa aa aa aa aa&lt;/div>
 &lt;div>bbb&lt;/div>
 &lt;div class=menu>ccccc&lt;/div>
&lt;/div>
</pre>

<p>We can lay it out as three columns, as the following illustrations
show. The style sheet would contain the following.

<pre>
.group {display: table}
.group > div {display: table-cell}
</pre>

<div class=figure>
  <p><img src="table1.png" alt="[Three unequal cells]" longdesc="table1.desc">

  <p class=caption>Example of rendering with a table.
</div>

<p>We can also use a template, in which case the style sheet would
contain this:

<pre>
.group {display: "abc"}
.group > div {position: a}
.group > div + div {position: b}
.group > div + div + div {position: c}
</pre>

<p>By default, the table is as wide as needed to fit its contents. To
make sure it is as wide as its containing block, we need to add

<pre>.group {display: table; width: 100%}</pre>

<p>That is not needed for the template, but, on the other hand, if we
want the template to fit its contents, we would need to say so:

<pre>.group {display: "abc"; width: fit-content}</pre>

<p>(See [[!CSS3BOX]] for the definition of the 'width' property.) The
columns of the template are by default all the same size. The columns
of the table satisfy certain constraints, but the exact size is not
defined. We can make them all the same by adding a rule (see
[[!CSS3TBL]]):

<pre>.group {display: table; width: 100%; table-layout: fixed}</pre>

<div class=figure>
  <p><img src="table2.png" alt="[Three equal cells]" longdesc="table2.desc">

  <p class=caption>Example of rendering with equal columns.
</div>

<p>In both styles, we can set a column to a certain size:

<pre>div.menu {width: 3em}</pre>

<p>resp.,

<pre>.group {display: "abc" * * 3em}</pre>

<div class=figure>
  <p><img src="table3.png" alt="[Two equal cells, third is 3em wide]"
  longdesc="table3.desc">

  <p class=caption>Example of rendering with a fixed third column and
  the other two columns of equal width.
</div>

<p>If there is an unknown number of columns (children of the div.group
element), the style sheet for the table model will automatically take
them into account. The style sheet for the template model, however,
creates a template of exactly three columns and can't handle tables
with an unknown number of columns. The extra elements will be added
into the default slot (in this case the ''a'' slot).

<p>In both models, elements can have borders, but only in the table
model can borders be collapsed, which makes setting borders a little
easier in the table model:

<pre>
.group {display: table; border-collapse: collapse}
.group > div {border: solid}
</pre>

<p>resp.,

<pre>
.group > div {border: solid; border-left: none}
.group > div:first-child {border-left: solid}
</pre>

<p>In the template model, the order of the elements is explicit, and
thus it is possible to reverse the order of the columns:

<pre>
.group > div {position: c}
.group > div + div {position: b}
.group > div + div + div {position: a}
</pre>

<div class=figure>
  <p><img src="table4.png" alt="[Different contents for the cells]"
  longdesc="table4.desc">

  <p class=caption>Example of rendering with the contents of the three
  columns reversed: the third element is shown in the first slot and
  the first element in the third slot.
</div>

<p>In the table model, the order of the rows and columns is given by
the document source and thus can't be changed.
</div>

<div class=example>
<p>This example shows a way to move notes to the end of a section. 
“Notes” in this example refers to elements in HTML with a class of 
“note”. A fragment of HTML such as
<pre>
&lt;div class=section>
  &lt;p>The balubious coster of the fifth secter&lt;span
    class=note> The sixth secter coster is a difter
    manon.&lt;/span> of The Rollow Carpug mentizes a costernica.
  &lt;p>&hellip;
&lt;/div>
</pre>
<p>with this style sheet
<pre>
div.section {
    display: "@" available
             "F" available}
.note {
    position: F;
    content: counter(note) ".\A0" contents;
    counter-increment: note;
    font-size: smaller}
.note::before {
    content: counter(note);
    position: @;
    vertical-align: super;
    font-size: larger}
</pre>
<p>results in a rendering similar to this:
<div class=figure>
<p><img src="footnotes.png" alt="Same text, with the SPAN replaced by
“(1)” and its content moved to the end." longdesc="footnotes.desc">
<p class=caption>Rendering of a text with footnotes.
</div>
</div>

<div class=example>
<p>This example shows the use of chained regions: text from region 1
continues in region 2, 3 and 4. And it shows how to use
pseudo-elements to style text in a particular region: text in region 1
is bigger than in other regions.

<div class=figure>
<p><img src="regions-intro-rendering.png" alt="Image of a complex,
3-column layout" longdesc="regions-intro-rendering.desc">
<p class=caption>Example rendering
</div>

<p>We assume a document fragment similar to this:

<pre>
&lt;div id=article>
  &lt;p>&lt;img src="sunset" alt="">
  &lt;h1>Introduction&lt;/h1>
  &lt;p>This is an example…
    
  &lt;h1>More Details&lt;/h1>
  &lt;p>This illustrates…
  &lt;p>Then, the example…
  &lt;p>Finally, this…
&lt;/div>
</pre>

<p>The style sheet makes the DIV into a template element with five
regions, called A, 1, 2, 3 and 4. The regions are grouped into two
chains: region A on its own, and the chain consisting of 1, 2, 3 and 4.

<pre>
#article {
  display: "A A 4"
           "A A 4"
           "1 1 4"
           "2 3 4";
  chains: 1 2 3 4 }
</pre>

<p>All children go into region 1 (and continue in 2, 3 and 4 as
needed). The IMG element goes into region A. We assume for simplicity
that there is only one IMG element:

<pre>
#article > * { position: 1 }
#article img { position: A }
</pre>

<p>The text in region 1 is bolder, larger and a different color than
in the other regions. Also, an H1 that falls into this region is
rendered differently from other H1s:

<pre>
::slot(1) {
  font-weight: bold;
  color: #0C3D5F;
  font-size: larger }
h1::slot(1) {
  color: crimson;
  display: run-in }
</pre>

<p>(For brevity, the example doesn't show the style rules to set the
color and background, to make the text justified, add the left border
to the second H1, etc.)
</div>

<h2 id=accessibility>A note about accessibility</h2>

<p><em>(This section is not normative.)</em>

<p>The facilities in this specification allow elements from a document
to be displayed in a visual order that is to a large extent
independent of the order in the document. That may have both positive
and negative effects on accessibility. The positive aspect is that it
allows the content in the document to be kept in logical order, so
that the document is as functional as possible without the style sheet
and on media where the style sheet doesn't apply. A negative aspect is
that a document that has a defined tab order (the order in which
elements get the focus when the tab-key is pressed) will show on the
screen with a tab order unrelated to the visual order. It may be
necessary to use the keyboard control features of the CSS Basic User
Interface module [[CSS3UI]] to ensure that the tab navigation follows
the visual order, or to refrain from positioning semantically related
elements in different parts of a template.

<p>The following two requirements from the Web Content Accessibility
Guidelines (WCAG) 2.0 [[WCAG20]] are particularly relevant. See that
specification for more information.

<blockquote>
<p><a
href="http://www.w3.org/TR/2008/REC-WCAG20-20081211/#content-structure-separation-sequence"
><strong>1.3.2 Meaningful Sequence:</strong></a> When the sequence in
which content is presented affects its meaning, a <a
href="http://www.w3.org/TR/2008/REC-WCAG20-20081211/#correct-reading-sequencedef"
>correct reading sequence</a> can be <a
href="http://www.w3.org/TR/2008/REC-WCAG20-20081211/#programmaticallydetermineddef
">programmatically determined.</a> (Level A)
</blockquote>

<blockquote>
<p><a
href="http://www.w3.org/TR/2008/REC-WCAG20-20081211/#navigation-mechanisms-focus-order"
><strong>2.4.3 Focus Order:</strong></a> If a <a
href="http://www.w3.org/TR/2008/REC-WCAG20-20081211/#webpagedef" >Web
page</a> can be <a
href="http://www.w3.org/TR/2008/REC-WCAG20-20081211/#nav-seqdef"
>navigated sequentially</a> and the navigation sequences affect
meaning or operation, focusable components receive focus in an order
that preserves meaning and operability. (Level A)
</blockquote>

<h2>Features out of scope</h2>

<p>A number of features that are related to grid layouts are not
handled in this module. Some of them are in other modules.

<h3>Repeating templates</h3>

<p>The templates defined by this specification have a fixed number of
slots, independent of the amount of content or the number of child
elements. In some situations it may be useful to define a template and
then, in the case there is more content than fits, automatically
create new copies of the template, to the side of or below the first
one, just like new pages are created in paged media or new columns in
multi-column layouts. 

<p>In some cases it may be possible to simulate that behavior by
putting the template element inside a column layout.

<h3>Non-rectangular shapes and wrap-arounds</h3>

<p>This specification allows to chain multiple slots together to form
complex shapes, but each of the slots is itself still rectangular.

<p>Another module, <cite>CSS exclusions and shapes</cite>
[[CSS3-EXCLUSIONS]], is expected to allow floating elements to have
non-rectangular shapes and allow positioned elements to cause
wrap-around.

<h2>Declaring templates: the 'display' property</h2>

<p class=issue><a href="http://www.w3.org/Style/CSS/Tracker/issues/123"
>ISSUE-123:</a> One way to experiment safely with implementations
before the specification reaches Candidate Recommendation status is to
add an identifier with a vendor prefix somewhere in the value, e.g.,
'display: -my-product "aa" "bc"' or 'display: -my-product("aa"
"bc")'.

<table class=propdef-extra>
    <tr>
      <td><em>Name:</em>
      <td>'display'
    <tr>
      <td><em>New value:</em>
      <td><var>&lt;display-type&gt;</var>? && [ [ <var>&lt;string&gt;</var> [ /
      <var>&lt;row-height&gt;</var> ]? ]+ ]
      <var>&lt;col-width&gt;</var>*
    <tr>
      <td><em>Percentages:</em>
      <td>N/A
    <tr>
      <td><em>Computed&nbsp;value:</em>
      <td>specified value
</table>

<p>A value of this form is called a <dfn>template.</dfn>

<p>An element with such a 'display' value is
similar to a table element, in that its content is laid out in rows and
columns. The two main differences are that the number of rows and
columns doesn't depend on the content, but is fixed by the value of
the property; and that the order of the descendants in the source
document may be different from the order in which they appear in the
rendered template.

<p>The <dfn><var>&lt;display-type&gt;</var></dfn> is one of the
following keywords. An omitted keyword is equivalent to ''block''.

<pre class=prod><dfn><var>&lt;display-type&gt;</var></dfn> = inline |
block | list-item | inline-block | table | inline-table |
table-row-group | table-header-group | table-footer-group | table-row
| table-column-group | table-column | table-cell | table-caption |
none</pre>

<dl>
<dt>''inline''
<dt>''inline-block''
<dt>''inline-table''
<dd>These three values are equivalent. The element is
an <em>inline-level</em> element.

<dt>''list-item''
<dd>The element is formatted as a list item. If the element has the
value ''inside'' for its 'list-style-position', that ''inside'' is
treated as if it were ''outside''.

<dt>''block''
<dt>''table''
<dd>These two values are equivalent.

<dt>''table-row-group''
<dt>''table-header-group''
<dt>''table-footer-group''
<dd>This creates a principal block-level box that is the template,
with around it an anonymous ''table-row'' box and around it a box of
the indicated type. Around it may be more anonymous boxes according to
the rules for <a href="/TR/CSS2/tables.html#anonymous-boxes"
>Anonymous table objects</a> [[!CSS21]].

<dt>''table-row''
<dd>This creates a principal block-level box that is the template and
around it a ''table-row'' box. Around it may be zero or more anonymous
boxes according to the rules
for <a href="/TR/CSS2/tables.html#anonymous-boxes" >Anonymous table
objects</a> [[!CSS21]].

<dt>''table-column-group''
<dt>''table-column''
<dd>The template is ignored and the element is treated as an element
of the indicated type.

<dt>''table-cell''
<dd>The element is a table cell with a template.

<dt>''table-caption''
<dd>The element is a table caption with a template.

<dt>''none''
<dd>The template is ignored and the element is treated as for
'display: none'.
</dl>

<p class=issue>Future display types added in other modules?


<p class=note>Note that 'display' is extended to apply to '@page'
rules as well and that it has a different default there, viz.,
''"@"''. See <a href="#paged">“Templates in paged media”</a> below.

<!-- If display becomes a shorthand for display-model and
display-role, explain that the former gets the template (and the
latter is inline or block depending on whether the inline
keyword is present). -->

<p>Each string consist of one or more at signs (“@”), letters (or
digits, see
<var>&lt;letter&gt;</var> below), periods
(“.”) and spaces. Each string represents
one row in the template, each character other than a space represents
one column in that row. Spaces have no meaning. They may be added for
readability.

<p>The symbols in the template have the following meaning
<dl>
  <dt>a letter
    <dd>slot for content.
  <dt>@
    <dd>(at sign) default slot for content.
  <dt>.
    <dd>(period) white-space.
</dl>

<p>Multiple identical letters in adjacent rows or columns form a
single <dfn>slot</dfn> that spans those rows and columns.
Ditto for multiple “@”s. Uppercase and lowercase are considered to be
the same letter (i.e., the template is case-insensitive).

<p>Non-rectangular slots and multiple slots with the same
letter are illegal. A template without any letter or
“@” is illegal. A template with more than one “@” slot is illegal. 
These errors cause the declaration to be ignored.

<p class=note>Note: non-rectangular and disconnected regions
may be permitted in a future update of CSS.

<p>Rows with fewer columns than other rows are implicitly padded with
periods (“.”) (that will thus not contain any elements).

<p>Each slot (letter or “@”) acts as a block element for its
contents.

<p>Each <dfn><var>&lt;row-height&gt;</var></dfn> sets the
height of the preceding row. The default is ''auto''. The values can
be as follows:

<dl>
  <dt><var>&lt;length&gt;</var>

  <dd>An explicit height for that row. Negative values make the
  template illegal. If the length is expressed in ''gr'' units, these
  refer to the inherited grid, not the grid defined by the template
  itself (see <a href="#gr-unit" >“Definition of the ''gr'' unit in a
  template element”</a>).

  <dt>auto

  <dd>The row's height is determined by its contents. See the <a
  href="#rowheight">algorithm</a> below.

  <dt>*

  <dd>(asterisk) All rows with an
  asterisk will be of equal height. See the <a
  href="#rowheight">algorithm</a> below.
</dl>

<p>Each <dfn><var>&lt;col-width&gt;</var></dfn> sets the width of a
column. If there are more <var>&lt;col-width&gt;</var>s then columns,
the last ones are ignored. If there are fewer, the missing ones are
assumed to be '*'. Each <var>&lt;col-width&gt;</var> can be one of the
following:

<dl>
  <dt><var>&lt;length&gt;</var>

  <dd>An explicit width for that column. Negative values make the
  template illegal.

  <dt>*

  <dd>(asterisk.) All columns with a '*' have
  the same width. See the <a href="#colwidth">algorithm</a> below.

  <dt>max-content,
  <dt>min-content

  <dd>The column's width is determined by its contents. See the
  <a href="#colwidth">algorithm</a> below.

  <dt>minmax(<var>p</var>,<var>q</var>)

  <dd>The column's width is constrained to be greater than or equal
  to <var>p</var> and less than or equal to <var>q</var>. <var>p</var>
  and <var>q</var> stand for [ <var>&lt;length&gt;</var> | max-content
  | min-content | * ]. There may be white space around the <var>p</var>
  and <var>q</var>. If <var>q</var> &lt; <var>p</var>,
  then <var>q</var> is ignored and
  ''minmax(<var>p</var>,<var>q</var>)'' is treated as
  'minmax(<var>p</var>,<var>p</var>)'.

  <dt>fit-content

  <dd>Equivalent to 'minmax(min-content, max-content)'.
</dl>

<p class=note>Note that it is legal to specify no widths at all. In
that case, all columns have the same width.

<div class=issue>
<p><a href="http://www.w3.org/Style/CSS/Tracker/issues/127"
>ISSUE-127:</a>
It has been suggested that the template may become too verbose in
the case of column widths that are very small factions, e.g., a column
of 1/40th of the width:
<pre>display: "abbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb"</pre>
<p>Abbreviating this with percentages ('2.5% 97.5%') introduces an
opportunity for errors (e.g., '3% 98%' causes the template to be
rejected). Abbreviating with numbers,
<pre>display: "ab"  * 39*</pre>
<p>(or even just '1 39') is safer. On the other hand, those 39
identical letters make it immediately clear what the intention
is&hellip;
<p>Percentages that do no sum to 100% need not be rejected, however:
they could be used to force overflow.
</div>

<p>The orientation of the template is independent of the writing mode
('direction' and 'block-flow' properties): the first string is the
topmost row and the first symbol in each string is the leftmost
column.

<div class=example>
<pre>&lt;style type="text/css"&gt;
  div { display: ".aa..bb." }
  p.left { position: a }
  p.right { position: b }
&lt;/style&gt;
&lt;div&gt;
  &lt;p class=left&gt;Left column
  &lt;p class=right&gt;Right column
&lt;/div&gt;</pre>
</div>

<p>An element with a template value for its 'display' property
is called a <dfn>template element</dfn>. An element's <dfn>template
ancestor</dfn> is defined (recursively) as follows:
<ul>
  <li>if the element has 'position: fixed', 'position: absolute', a
  value of 'float' that is not ''none'' or the element is the root
  element, than it has no template ancestor.

  <li>else, if the element's parent has a template as its
  'display', then that parent is the element's template
  ancestor.

  <li>else, the element's template ancestor is the same as its
  parent's template ancestor.
</ul>

<h2 id="slot-sizes">
Calculating the size of the grid</h2>

<p>For the purpose of the calculations below, each slot (letter or
“*”) in a grid has four dimensions associated with it, called
<var>MINW</var> (“minimum width”), <var>PREFW</var> (“preferred
width”), <var>MINH</var> (“minimum height”) and <var>PREFH</var>
(“preferred height”). We can think of them as the minimum and
preferred dimensions of the slot in isolation, i.e., if it wasn't
constrained by other slots in the same row or column. They are defined
as follows:

<dl>
<dt><var>MINW</var>
<dd>
    <ul>
     <li>If the slot spans only columns whose width does not depend on
     the contents of the column (i.e., the column widths are specified
     with only <var>&lt;length&gt;</var> values, '*',
     <var>&lt;fraction&gt;</var> values, or any combination of those),
     then <var>MINW</var> is 0. <span class=note>(Note that
     <var>&lt;length&gt;</var> values can be specified with 'calc()'
     as well, see [CSS3VALUES]].)</span>

     <li>Otherwise, if the slot is <em>vertical,</em> then
     <var>MINW</var> is the <em>block dimension</em> of the slot, plus
     its horizontal padding, border and margin (i.e., any
     'margin-left', 'margin-right', etc., that is set on it by means
     of the '::slot()' pseudo-element). Any ''auto'' margins are
     counted as 0 in this case.

     <li>Otherwise, if the slot spans at least one column whose width
     is specified as ''max-content'' (or 'minmax()' with a first
     argument of 'max-content'), then <var>MINW</var> is the intrinsic
     preferred width (see [[!CSS3BOX]]) of the slot plus its
     horizontal margin, border and padding. Any ''auto'' margins are
     counted as 0 in this case.

     <li>Otherwise (i.e., the slot spans at least one column whose
     width is specified as ''min-content'' or ''minmax()'' with a
     first argument of ''min-content'', but no ''max-content'')
     <var>MINW</var> is the intrinsic minimum width (see [[!CSS3BOX]]
     of the slot, plus its horizontal padding, border and margin.
    </ul>

<dt><var>PREFW</var>
<dd>
    <ul>
     <li>If the slot spans only columns whose width does not depend on
     the contents of the column (i.e., the column widths are specified
     with only <var>&lt;length&gt;</var> values, '*',
     <var>&lt;fraction&gt;</var> values, or any combination of those),
     then <var>PREFW</var> is infinite.

     <li>Otherwise, if the slot is <em>vertical,</em> then
     <var>PREFW</var> is the <em>block dimension</em> of the slot, plus
     its horizontal padding, border and margin.

     <li>Otherwise, if the slot spans at least one column whose width
     is specified as ''max-content'' (or 'minmax()' with a first
     argument of 'max-content'), then <var>PREFW</var> is the intrinsic
     preferred width (see [[!CSS3BOX]]) of the slot plus its
     horizontal margin, border and padding.

     <li>Otherwise <var>PREFW</var> is the intrinsic minimum width
     (see [[!CSS3BOX]] of the slot, plus its horizontal padding,
     border and margin.
    </ul>

<dt><var>MINH</var>
<dd>
    <ul>
     <li>If the slot spans only rows whose height does not depend on
     the contents of the column (i.e., the row heights are specified
     with only <var>&lt;length&gt;</var> values, '*',
     <var>&lt;fraction&gt;</var> values, or any combination of those),
     then <var>MINH</var> is 0.

     <li>Otherwise, if the slot is <em>horizontal,</em> then
     <var>MINH</var> is the <em>block dimension</em> of the slot, plus
     its vertical padding, border and margin

     <li>Otherwise, if the slot spans at least one row whose height is
     specified as ''max-content'' (or 'minmax()' with a first argument
     of 'max-content'), then <var>MINH</var> is the intrinsic
     preferred height (see [[!CSS3BOX]]) of the slot plus its vertical
     margin, border and padding.

     <li>Otherwise <var>MINH</var> is the intrinsic minimum height
     (see [[!CSS3BOX]] of the slot, plus its vertical padding, border
     and margin.
    </ul>

<dt><var>PREFH</var>
<dd>
    <ul>
     <li>If the slot spans only rows whose height does not depend on
     the contents of the column (i.e., the row heights are specified
     with only <var>&lt;length&gt;</var> values, '*',
     <var>&lt;fraction&gt;</var> values, or any combination of those),
     then <var>MINH</var> is infinite.

     <li>Otherwise, if the slot is <em>horizontal,</em> then
     <var>PREFH</var> is the <em>block dimension</em> of the slot, plus
     its vertical padding, border and margin

     <li>Otherwise, if the slot spans at least one row whose height is
     specified as ''max-content'' (or 'minmax()' with a first argument
     of 'max-content'), then <var>PREFH</var> is the intrinsic
     preferred height (see [[!CSS3BOX]]) of the slot plus its vertical
     margin, border and padding.

     <li>Otherwise <var>PREFH</var> is the intrinsic minimum height
     (see [[!CSS3BOX]] of the slot, plus its vertical padding, border
     and margin.
    </ul>
</dl>

<div class=example>
   <p>For example, the <var>MINW</var> values of the slots in this grid

   <pre>grid: "    a      a      ."
      "    b      .      c"
      fit-content *    10em</pre>

   <p>are as follows:
   <dl>
    <dt>a <dd>'min-content' (because the slot spans at least one
    column with a width specified as 'min-content' or 'fit-content').

    <dt>b <dd>'min-content' (ditto).

    <dt>c <dd>0 (because the slot spans only columns with a width that
    is independent of the content).
   </dl>
</div>

<p>The UA must choose the widths and heights of all columns and rows
such that the following constraints are satisfied.

<ol>
   <!-- Constraints relating to the element's own width and
   height. These constraints may be dropped if overconstrained -->

   <li>
    <p>If the element has an a-priori known content height, then the
    sum of the heights of all rows must be equal to the element's
    height.

    <div class=example>
     <p>For example, the two rows in this grid must be 8em each so
     that the total height matches the height of the element:

     <pre>div {
  height: 16em;
  grid: "a.b"/*
        "ac."/* }</pre>
    </div>

   <li>
    <p>If the grid element has an a-priori known content width, then
    the sum of the widths of all columns must be equal to the
    element's width .

    <div class=example>
     <p>For example, the three columns in this grid must be 20em each:
     <pre>div {width: 60em; grid: "abc"}</pre>
    </div>

   <!-- Constraints relating to fixed-size rows and columns -->

   <li>Each row with a height specified as a <var>&lt;length&gt;</var>
   must have exactly that height.

   <li>Each column with a width specified as a
   <var>&lt;length&gt;</var> must have exactly that width.

   <!-- Constraints on rows and column with fractional sizes. -->

   <li>All rows with a height specified as '*' must have the same
   height.

    <p class=issue>If we have both '*' and 'fr', then '*' will be
    defined as '1fr' and we can drop this rule and the next. Otherwise
    either these two rules or the next two must be removed.

   <li>All columns with a width specified as '*' must have the same
   width.

   <li>For any pair (<var>i</var>,<var>j</var>) of rows whose
   <var>&lt;row-height&gt;</var> values h<sub>i</sub> and
   h<sub>j</sub> are both specified in 'fr', the computed heights
   H<sub>i</sub> and H<sub>j</sub> must be such that H<sub>i</sub> *
   h<sub>j</sub> = H<sub>j</sub> * h<sub>i</sub>. (I.e., their heights
   are proportional to their number of 'fr' units.)

   <li>For any pair (<var>i</var>,<var>j</var>) of columns whose
   <var>&lt;col-width&gt;</var> values w<sub>i</sub> and w<sub>j</sub>
   are both specified in 'fr', the computed width W<sub>i</sub> and
   W<sub>j</sub> must be such that W<sub>i</sub> * w<sub>j</sub> =
   W<sub>j</sub> * W<sub>i</sub>. (I.e., their widths are proportional
   to their number of 'fr' units.)

   <!-- Constraints relating to rows and columns without slots that
   span into other rows or columns, i.e., cases where the size of a
   slot can be used to put an upper limits on the size of a row or
   column -->

   <li>
    <p>Each row that contains slots that span only one row and no
    slots that span more than one row, must not be higher than the
    largest <var>PREFH</var> of all slots in the row.

    <div class=example>
     <p>For example, the second row in this grid

     <pre>grid: "a.c.." / 5em
      "....b" / fit-content</pre>

     <p>must not be taller than the height (<span>block
     dimension</span>) of slot b. The first row contains a slot that
     spans two rows (slot a), so this rule does not apply to that row.
    </div>

   <li>
    <p>Each column that contains slots that span only one column and no
    slots that span more than one column, must not be wider than the
    largest <var>PREFW</var> of all slots in the column.

    <div class=example>
     <p>For example, in this grid

     <pre>grid: "ac"
      "ab"
      fit-content *</pre>

     <p>the first column must not be wider than the <var>PREFW</var>
     of slot a. Both slots in the second column have an infinite
     <var>PREFW</var>, so this rule effectively puts no constraint on
     that column.
    </div>

   <!-- Constraints on slots, only to set lower limits.  -->

   <li>Each slot must be at least as wide as its <var>MINW</var>.

   <li>Each slot must be at least as high as its <var>MINH</var>.
</ol>

<p>If it is impossible to choose such widths and heights, then try
without constraint 1. If it is still impossible, try without
constraint 2 instead. And, finally, try with both 1 and 2 dropped.

<div class=example>
<p>For example, the sum of the row heights in this example can never
be the same as the height of the element:
<pre>div {
  height: 20em;
  grid: "a b c" / 7em
        "a . c" / 7em }
</pre>
<p>The first constraint is therefore ignored, the rows are 7em each
and 6em of space below the grid remains empty.
</div>

<p>If there are multiple solutions, and constraint 1 was dropped or
did not apply, then the sizes must additionally be chosen such that
the sum of the heights of the rows is minimized.

<p>If there are still multiple solutions, and constraint 2 was dropped
or did not apply, then the sizes must additionally be chosen such that
the sum of the widths of the columns is minimized.

  <div class=example>
   <p>For example, there would be multiple solutions for this grid:

   <pre>&lt;DIV STYLE="float: left; grid: "a.b">
 &lt;P STYLE="flow: a">Two words
 &lt;P STYLE="flow: b">Only three words
&lt;/DIV></pre>

   <p>The columns must have equal width, but there is no other constraint on
    the width. They could be narrow:

   <blockquote>
    <p><code class=visible style="display:
    inline-block">Two  <br>words<br>     </code><code class=visible
    style="display: inline-block">     <br>     <br>     </code><code
    class=visible style="display:
    inline-block">Only <br>three<br>words</code>
   </blockquote>

   <p>or wider:

   <blockquote>
    <p><code class=visible style="display:
    inline-block">Two words       </code><code class=visible
    style="display: inline-block">                </code><code
    class=visible style="display:
    inline-block">Only three words</code>
   </blockquote>

   <p>or even wider still, e.g.:

   <blockquote>
    <p><code class=visible style="display:
    inline-block">Two words          </code><code class=visible
    style="display: inline-block">                   </code><code
    class=visible style="display:
    inline-block">Only three words   </code>
   </blockquote>

   <p>The rule to minimize height excludes the first, narrow
   solution. The rule to minimize width excludes the third and all
   wider solutions. So the second layout, the narrowest that has all
   words on one line, is the correct one.

   <p>(This example assumes the width of the floating DIV's containing
   block is large enough. The default width of a float is actually
   'fit-content', and thus if the containing block is too narrow, the
   result will be narrower, too, because the calculation will have to
   be redone using that width as the a-priori width for the DIV.)
  </div>

<p class=note>The width isn't known a-priori, if, e.g., 'width' is
''auto'' and the element is floating, absolutely positioned,
inline-block or a child of a block with vertical writing mode.


<p>An extra step may be necessary in paged media if a page break
occurs inside a template (only in the case of an <em>element-based
template,</em> see <a href="#element-based-page-break" >below</a>). If
the template, after computing the width and height, is too big to fit
on the current page, and if a suitable break point exists, the part of
the template after that break point is put on the next page. The width
of the containing block on that page may be different if that page has
different margins from the current page (see [[!CSS3PAGE]]) and thus
the width and height of that part of the template must be recalculated
in the new context.

<p class=note>Note that the widths of the columns can be completely
determined before laying out any of the contents as long as there are
no columns with a <var>&lt;col-width&gt;</var> of ''min-content'' or
''max-content''.

<p class=issue>Do we define restrictions or approximations for slots
that are part of a <em>chain</em> to avoid complicated optimization
algorithms?

<p class=note>Note: In a future update of CSS, rows might get a
property to specify how the height of that row is adjusted in case the
above calculation yields a template that is less tall than the element
itself.

<p>The height of a slot is measured as if the slot had one <dfn
title="anonymous block of a slot">anonymous block</dfn> as a child that
contains all the slot's contents and the anonymous
block is a <em>flow root</em> (see [[!CSS3BOX]]).

<div class=example>
<p>This example divides the window in three rows and three columns,
separated by 1em of white space. The middle row and the middle column
are flexible, the others are fixed at a specific size. The first
column is 5em wide, the last one 10em.

<pre>
&lt;style type="text/css"&gt;
  body {
    height: 100%;
    display: "a   .   b   .   c"  /2em
             ".   .   .   .   ."  /1em
             "d   .   e   .   f"
             ".   .   .   .   ."  /1em
             "g   .   h   .   i"  /2em
             5em 1em  *  1em 10em}
  #logo {position: a}
  #motto {position: b}
  #date {position: c}
  #main {position: e}
  #adv {position: f}
  #copy {position: g}
  #about {position: h}
&lt;/style&gt;
&lt;p id=logo&gt;&lt;img src=...
&lt;p id=motto&gt;Making Web pages since 1862
&lt;p id=date&gt;August 2, 2004
...</pre>
</div>

<p class=issue>[Add example with three columns, first two as narrow as
possible, third one taking up all remaining space.]

<h2 id=position>Flowing content into the template: the 'position'
property</h2>

<p class=issue>One way to experiment safely with implementations
before the specification reaches Candidate Recommendation status is to
add an identifier with a vendor prefix somewhere in the value, e.g.,
'position: a -my-product' or 'position: -my-product(a)'.

<p class=issue><a
href="http://www.w3.org/Style/CSS/Tracker/issues/201">ISSUE-201:</a>
Terra Informatica's <a
href="http://www.terrainformatica.com/htmlayout/" >HTMLayout</a>
program proposes an interesting shortcut: if a slot's name is a number
(instead of a letter), it refers directly to the child with that
number. That child is positioned in the slot and doesn't need a
'position' property. See <a
href="http://www.terrainformatica.com/w3/flex-layout/flex-layout.htm"
>the documentation by Andrew Fedoniouk and Ivan Goroun.</a> E.g.,
<code>&lt;ul style="display: '2 1'">&lt;li>one &lt;li>two
&lt;/ul></code> puts “two” on the left and “one” on the right. (Note
that this requires that the names of slots are separated by spaces.) 
It is thus also a shortcut for some applications of <a
href="http://www.w3.org/TR/css3-flexbox/#flex-order">'flex-order'.</a>

<table class=propdef-extra>
    <tr>
      <td><em>Name:</em>
      <td><dfn>position</dfn>
    <tr>
      <td><em>New value:</em>
      <td><var>&lt;letter&gt;</var> | same
    <tr>
      <td><em>Percentages:</em>
      <td>N/A
    <tr>
      <td><em>Computed&nbsp;value:</em>
      <td>'<var>&lt;letter&gt;</var>' or ''static''; see text
</table>

<p>This value of the 'position' property specifies into which row and
column of a template the element is placed.
The <dfn>&lt;letter&gt;</dfn> must be a single letter or digit, with category
Lu, Ll, Lt or Nd in Unicode [[!UNICODE]]), or a “@” symbol.

<dl>
  <dt><var>&lt;letter&gt;</var>

  <dd>The element is taken out of the flow of its parent and put into
  the specified slot in its <em>template
  ancestor.</em> <span class=issue>[If the slot is the first of a
  chain, see 'chains', the element is put in that chain, not
  necessarily in the first slot.]</span> If there is no slot of this
  name, the computed value is ''static''. <span class=issue>[If the
  slot is part of a chain, but not the first slot in the chain, the
  computed value is likewise ''static''.]</span>

  <dt>same

  <dd>A value of ''same'' computes to the same letter as the most
  recent element with a letter as computed value that has the
  same <em>template ancestor</em>. If there is no such element, the
  value computes to ''static''.
</dl>

<p id=containing-block>The <em>containing block</em> of an element
with one of these values for 'position' is the slot in the template
into which it is flowed.

<p>Multiple elements may be put into the same slot. They will be
laid-out according to their 'display' property in the order they
occur in the source document.

<p>The content of a <em>template element</em> is put in the slot
marked with “@”s. If there is no such slot, the content is put in the
first (leftmost) slot on the first row that doesn't consist of only
“.”. <span class=issue>[If the slot is part of a <em>chain,</em>, the
content is put in that chain instead.]</span>

<div class=example>
<p>A common markup in HTML for illustrations with captions is as
follows:
<pre>
&lt;div class=figure>
 &lt;p>&lt;img src="paul.jpg" alt="...">
 &lt;p class=caption>A pond in a playground in Amsterdam
&lt;/div>
</pre>
<p>The caption can be put above the image by using a template as
follows:
<pre>
div.figure {display: "aaa"
                     ".b."
                     * min-content *}
div.figure p {position: b}
div.figure p.caption {position: a; text-align: center}
</pre>
<p>The caption can be wider than the image and the image will be
centered.

<p>When the figure is floating, it is probably better to not let the
caption become wider than the image (unless the caption cannot be made
narrow enough):
<pre>
div.figure {float: right; display: "a" "b" min-content}
div.figure p {position: b}
div.figure p.caption {position: a; text-align: center}
</pre>
</div>

<!--
<div class=example>
<p>The FIG element, that was once proposed for HTML, has an attribute
that points to an image, a CAPTION child and some fallback text. The
template below uses “@” to indicate where the image (or the fallback)
goes, in relation to the caption.

<pre>
/* &lt;FIG SRC=...&gt;&lt;CAPTION&gt;...&lt;/&gt; Fallback&lt;/&gt; */
FIG {
  /* See Generated Content Module */
  content: attr(SRC, url), normal;
  /* Caption may be wider than image */
  display: ".@."
           "xxx"
           * min-content * }
CAPTION { position: x }</pre>
</div>
-->

<div class=example>
<p>In this example, a form is laid out on a grid, with two labels and
two input boxes and a submit and a reset button:

<pre>
form {
  border: thin solid;
  display: "aaaa.bbbb"
           "........."/1em
           "cccc.dddd"
           "........."/1em
           "...ee..ff" }
label[for=minv] { position: a }
input#minv { position: b; display: block }
label[for=maxv] { position: c }
input#maxv { position: d; display: block }
input[type=submit] { position: e; display: block }
input[type=reset] { position: f; display: block }
</pre>

<p>Here is the fragment of HTML that the style is applied to:

<pre>
&lt;form action="./"&gt;
  &lt;label for=minv&gt;Enter minimum value:&lt;/label&gt;
  &lt;input id=minv name=minv&gt;
  &lt;label for=maxv&gt;Enter maximum value:&lt;/label&gt;
  &lt;input id=maxv name=maxv&gt;
  &lt;input type=submit value="OK"&gt;
  &lt;input type=reset value="Reset"&gt;
&lt;/form&gt;
</pre>

<p>The addition of 'display: block' causes
the form controls to use the width computation of blocks, in other
words: they will be as wide as their containing block, which in this
case means that they will be as wide as the slot they are assigned
to. Without it, they would be inline elements and just be left-aligned
in their slots.

<div class="figure">
<p><img alt="Image simulating the layout of the example" src="form.png"
longdesc="form.desc">

<p class="caption">Possible rendering of the example.
</div>
</div>

<div class=example>
<p>This example shows that templates can be nested. The body has two
columns. The #content element that goes into the second column has
itself another template, into which the various “modules”
are placed.

<div class=figure>
  <p><img src="table5.png" alt="[Screendump with nested templates]"
  longdesc="table5.desc">

  <p class=caption>Possible rendering of the nested templates. (The
  borders are added for clarity, they don't occur in the style rules
  below. The red border is the inner template.)
</div>

<p>For clarity, the inner template uses different letters for the
slots than the outer template. This is not required.

<pre>
&lt;style type="text/css">
body {
     display: "a   b"
              10em *;
}
#nav {
     position: a;
}
#content {
     position: b;
     display: "c   .   d   .   e   "
              ".   .   .   .   .   "/1em
              ".   .   f   .   .   "
               *  1em  *  1em  *;
}
.module.news {
     position: c;
}
.module.sports {
     position: d;
}
.module.personal {
     position: e;
}
#foot {
     position: f;
}
&lt;/style>
&lt;body>
&lt;ul id="nav">
     &lt;li>navigation&lt;/li>
&lt;/ul>
&lt;div id="content">
    &lt;div class="module news">
         &lt;h3>Weather&lt;/h3>
         &lt;p>There will be weather&lt;/p>
    &lt;/div>
    &lt;div class="module sports">
         &lt;h3>Football&lt;/h3>
         &lt;p>People like football.&lt;/p>
    &lt;/div>
    &lt;div class="module sports">
         &lt;h3>Chess&lt;/h3>
         &lt;p>There was a brawl at the chess tournament&lt;/p>
    &lt;/div>
    &lt;div class="module personal">
         &lt;h3>Your Horoscope&lt;/h3>
         &lt;p>You're going to die (eventually).&lt;/p>
    &lt;/div>
    &lt;p id="foot">Copyright some folks&lt;/p>
&lt;/div>

&lt;/body>
</pre>
</div>

<div class=example>
<p>This example shows the use of ''same'' to put <code>DD</code>
elements in the same slot as the preceding <code>DT</code>.

<pre>
...
DL {display: "a.b.c"  * 2em * 2em *}
DT.mineral {position: a}
DT.animal {position: b}
DT.plant {position: c}
DD {position: same; margin-left: 1em}
...
<b>&lt;DL></b>
 <b>&lt;DT class=animal></b>falcon
 <b>&lt;DD></b>This bird of prey...
 <b>&lt;DT class=animal></b>rabbit
 <b>&lt;DD></b>Local restaurants...
 <b>&lt;DT class=mineral></b>granite
 <b>&lt;DD></b>This rock occurs...
 <b>&lt;DT class=plant></b>olive
 <b>&lt;DD></b>The fruit of...
 <b>&lt;DT class=mineral></b>limestone
 <b>&lt;DD></b>A rock composed of...
 <b>&lt;DT class=plant></b>pine
 <b>&lt;DD></b>The western half...
<b>&lt;/DL></b>
</pre>

<div class=figure>
  <p><img src="granite.png" alt="screendump" longdesc="granite.desc">
  <p class=caption>Possible rendering of the <code>DL</code> list,
  with items sorted into three columns.
</div><!-- .figure -->
</div><!-- .example -->

<p class=issue>Another, more verbose syntax could be more readable for
infrequent users: 'position: slot(a)'. (But maybe harder to remember
when writing style rules?)

<h2 id=slot-pseudo>The ''::slot()'' pseudo-element</h2>

<p>The slots of a <em>template element</em> can be individually
addressed with the <dfn>''slot()'' pseudo-element.</dfn>

<div class=example>
<p>For example, the following sets the color and vertical alignment of
some of the slots in a template:

<pre>
body { display: "aaa"
                "bcd" }
body::slot(b) { background: #FF0 }
body::slot(c), body::slot(d) { vertical-align: bottom }
</pre>
</div>

<p>The selector ''<var>E</var>::slot(<var>X</var>)'' selects the part
of an element <var>E</var> that falls inside the slot with name
<var>X</var> of a template <var>T</var>, where <var>T</var> is either
the template of <var>E</var> itself (if <var>E</var> is a <em>template
element</em>) or the template of the <em>template ancestor</em> of
<var>E</var>. If there is no such template <var>T</var>, or if it does
not contain a slot called <var>X</var>, the selector matches nothing.

<p class=issue>This is ambiguous if <var>E</var> is a template element
and also has a template ancestor. We could call the slot '::slot()'
and the part of an element that falls in a slot ':fragment()'

<div class=example>
<p>The following example shows the difference between using the
'::slot()' pseudo-element in combination with a template element and
in combination with a descendant of such an element.

<pre>
body { display: "a b c" }          /* Make BODY a template element */
body::slot(a) { background: #FF0 } /* Color whole slot */
p::slot(a) { background: #FC0 }    /* Color intersection of P and slot a */
</pre>

<p class=issue>Expand example with a screen shot.
</div>

<p>Only the following properties apply to the ''slot()''
pseudo-element. Those marked with a * apply only to the ''slot()''
pseudo-element of a template element.

<div class=example>
<p>For example, if P is a child of DIV, then the 2nd rule below
specifies the alignment of content in slot a, but the 3rd rule has no
effect:

<pre>
DIV { display: "a b b" }                 /* Rule 1 */
DIV::slot(a) { vertical-align: bottom }  /* Rule 2 */
P::slot(a) { vertical-align: bottom }    /* Rule 3 */
</pre>
</div>

<ul>
<li>background properties
<li>* 'vertical-align' (see <a href="#vertical-align">“vertical
alignment”</a> below)
<li>* 'overflow' (see the sections on <a
href="#vertical-align">vertical alignment</a> and <a
href="#paged">paged media</a> below)
<li class=issue>'block-flow' and 'direction' properties?
<li>* 'box-shadow'
<li>font properties
<li>'color'
<li>'word-spacing'
<li>'letter-spacing'
<li>'text-decoration'
<li>'text-transform'
<li>'line-height'
<li>* border properties <span class=issue
>(<a href="http://www.w3.org/Style/CSS/Tracker/issues/37"
>ISSUE-37:</a> Can a slot have a border and if so, where is it
drawn?)</span>
<li>* padding properties
<li>'text-shadow'
<li>* 'box-decoration-break'
<li>* text-align <span class=issue
>(<a href="http://www.w3.org/Style/CSS/Tracker/issues/38"
>ISSUE-38:</a> Align content in a column on decimal points,
etc.)</span>
<li>* column properties
<li>* 'content' <span class=issue>Useful? Gives the first content for
the slot, more can be added by positioning other elements in the
slot. Would this allow repeating a heading above a slot if a flow
continues in a second slot (with 'running()' from GCPM) or adding
“continued on page 7” at below a slot (with 'target-counter()' from
GCPM)? (See also the <a href="#see-page">issue about “continued
on.”)</a></span>
</ul>

<div class=issue>
<p>What is the text indent of a P that starts in slot a? 10pt or 20pt?
<pre>
P { font-size: 10pt; text-indent: 1em }
P::slot(a) { font-size: 20pt }
</pre>
</div>

<p>The background of a slot is drawn immediately on top of the
background of the element itself. E.g., the background set on
''P::slot(a)'' is immediately in front of the background set on ''P''.

<p class=issue>Need to define exactly how properties apply, similarly
to :first-line: fictional tag sequence, ambiguous cases…

<p class=issue>Need to define the width when a slot has padding and
border, including when the width is too small.

<p class=note>Note that slots can have borders and padding, but no
margins (cf. table cells).

<h2 id=vertical-alignment>Vertical alignment</h2>

<p>The 'vertical-align' property of a '::slot()' pseudo-element can be
used to align elements vertically in a slot. The effect is as if the
<em title="anonymous block of a slot">hypothetical anonymous
block</em> that contains the slot's contents is positioned as
follows:
<dl>

  <dt>bottom

  <dd>The content of the slot is aligned to the bottom of the slot:
  the bottom margin edge of the anonymous block coincides with the
  bottom of the slot.

  <dt>middle

  <dd>The content of the slot is vertically centered in the slot: the
  distance between the top margin edge of the anonymous block and the
  top of the slot is equal to the distance between the bottom margin
  edge of the anonymous block and the bottom of the slot. <span
  class=note>(Note that if the content overflows the slot, it will
  overflow both at the top and at the bottom.)</span>

  <dt>baseline

  <dd>The anonymous block that encloses the content is placed as high
  as possible under two constraints:
  <ol>
  <li>The top margin edge of the anonymous block may not be higher
  than the top edge of the slot.

  <li>The topmost baseline in the content may not be higher than the
  topmost baseline of content in any other slot in the same row that
  also has 'vertical-align: baseline'. Baselines of content inside
  floats are not taken into account. Slots that span several rows are
  considered to occur in their topmost row.
  </ol>
</dl>

<p>For all other values, the content is top aligned: the top margin
edge of the anonymous box coincides with the top edge of the slot.



<h2 id=paged>Page-based templates and other templates in paged media</h2>

<p>A template can also be attached to a page, rather than an element. 
Such a template is called a <dfn>page-based template</dfn> as opposed
to an <dfn>element-based template.</dfn>

<p>The difference between page-based layout templates and
element-based ones is that the size of a slot in a page-based layout
template only depends on the template and the page size, never on the
intrinsic size of the content.

<p>Another difference is that content that overflows a slot may cause
a page break: the rest of the content is put on another page. See <a
href="#page-break">below.</a>

<p>The syntax of a page-based template is the same as that of an
element-based one, but the declaration appears in an '@page' rule and
any <var>&lt;col-width&gt;</var> or <var>&lt;row-height&gt;</var>
that is neither '*' nor a <var>&lt;length&gt;</var> is treated as if
it were '*'.

<p>Also, a <var>&lt;display-type&gt;</var> may be present, but has no
effect.

<p class=note>Although the occurrence of keywords, such as
''fit-content'' or ''auto'', is valid and well defined, a UA,
especially an editor, may want to issue a warning, because those
keywords don't have any useful function in page-based templates.

<div class=example>
<pre>
@page :first { display: "abc" "def" }
@page { display: "def" }

body {position: e}
h1 {position: b}
</pre>
</div>

<p>The default 'display' value of a page is ''display: "@"''.

<div class=example>
<p>The following rule is typically not needed, because it is the
default:

<pre>@page { display: "@" }</pre>
</div>

<p>The height of the slots in a template is computed as in the section
<a href="#rowheight">“Computing the height of the slots,”</a> except
that the <em title="page area">page area's</em> height [[!CSS3PAGE]]
is used instead of the
element's height. Similarly, the width of the slots is computed as in
the section <a href="#colwidth">“Computing the width of the slots,”
</a> but with the page area's width replacing the element's width.

<p class=note>Note that certain rules in those sections are never
applied, because the page area's width and height are always known
a-priori and the width and height of slots is always a
<var>&lt;length&gt;</var> or '*'.

<p id=page-break>If a slot of a page-based template on
<em>non-interactive</em> media has an 'overflow' property of
''visible'', then content that overflows that slot in the block
progression direction (i.e., below the slot in the case of horizontal
text) causes a page break and is continued on the next page. <span
class=issue>[What happens in non-interactive media with an 'overflow'
of ''scroll'' or ''auto''?]</span>

<p>For page breaking purposes, each slot is considered as a page and
the page break properties on the elements in that slot determine where
the content for that slot is broken. Content after the page break is
put in the slot of the same name on the next page that has such a
slot. If there is no such page <span class=issue>the content after the
page break is not displayed? displayed in the default slot?</span>

<p class=note>Note that this may happen if the template for the first
page ('@page :first') uses a letter that occurs in no other @page
rule. Possibly also if a page template is bound to a “named page”
[[CSS3GCPM]] and that named page is not allowed to repeat. (At the
time of writing, this is only a proposal in the GCPM Module.)

<p class=note>Note that an element <var>A</var> that appears later in
the document than an element <var>B</var> may thus be displayed on an
earlier page than element <var>B</var>, because their respective slots
are broken across pages in different ways.

<p>Because of limitations of a device (e.g., limited memory), it may
be that a UA has to print a page (force page breaks) even though some
slots aren't filled yet.

<div class=example>
<p>This example shows how the first page may have a different layout
from the other pages. The slot ''a'' only occurs on the first page. If
the content for that slot (in this case: all H1 elements) is too long,
the remaining content of that slot <span class=issue>will not be
displayed.</span> The slot ''@'' occurs on normal pages and all its
content can thus be displayed by adding additional pages.

<pre>
@page :first { display: "a" "@" }
@page { display: "@" /* This is the default */ }
h1 {position: a}
</pre>
</div>

<p class=note>Note that “page masters” (sequences of
different templates for sequences of pages) can be made with the
selectors defined in <span class=issue>[not yet decided].</span>

<p id=element-based-page-break>Element-based templates in paged media
may be broken across pages,
subject to the page break properties. In addition to the break points
listed in the Paged Media module [[!CSS3PAGE]], a page break may occur
between two rows in a template, if there is a possible break point at
the same height or higher in all slots that span those two rows; and a
page break may occur inside a row if there is a possible break point
in all slots in that row.

<p class=issue>Try to be more precise?

<p>If 'page-break-before' or 'page-break-after' is ''right'', ''left''
or ''always'' on an element inside a slot in an element-based
template, the value is treated as ''auto'' instead.

<p>The 'page' property does not apply to elements inside a slot of an
element-based template.

<p>Any other forced page break (see section 5.5 of Paged Media
[[!CSS3PAGE]]) causes a new page to be created and all content in the
document after this page break will be put in slots on the new page or
on later pages: slots on any previous pages will not be further
filled.

<div class=example>
<p>A slide presentation can be made with a template for each page
(i.e., slide) and forced page break between the slides:

<pre>
@page	{ display: "a" / 5em
	           "@" / *
	           "b" / auto }
h1	{ page-break-before: always;
	  position: a }
p.note	{ position: b }
</pre>
<p>With a document similar to this: (fragment)
<pre>
<b>&lt;h1></b>Slide 1 title<b>&lt;/h1></b>
<b>&lt;ul></b>
 <b>&lt;li></b>Topic one
<b>&lt;/ul></b>
<b>&lt;h1></b>Slide 2 title<b>&lt;/h1></b>
<b>&lt;ul></b>
 <b>&lt;li></b>More topics
<b>&lt;/ul></b>
<b>&lt;p class=note></b>Note the note
</pre>
</div>

<div class=example>
<p>The document in the example above doesn't have an element that
corresponds to a slide; a slide simply starts at an H1 and ends before
the next H1. But if there is a DIV around each slide (as is the case
in many slide formats in practice), the same effect can also be
achieved without page-based templates, by using the ''vh'' unit
[[!CSS3VAL]]:

<pre>
div.slide {height: 100vh; display: "a"/5em "@" "b"/intrinsic;
    page-break-before: always}
h1 {position: a}
p.note {position: b}
</pre>

<p>With a document similar to this: (fragment)

<pre>
<b>&lt;div class=slide></b>
 <b>&lt;h1></b>Slide 1 title<b>&lt;/h1></b>
 <b>&lt;ul></b>
  <b>&lt;li></b>Topic one
 <b>&lt;/ul></b>
<b>&lt;/div></b>
<b>&lt;div class=slide></b>
 <b>&lt;h1></b>Slide 2 title<b>&lt;/h1></b>
 <b>&lt;ul></b>
  <b>&lt;li></b>More topics
 <b>&lt;/ul></b>
 <b>&lt;p class=note></b>Note the note
<b>&lt;/div></b>
</pre>
</div>

<div class=example>
<p>Both page-based and element-based templates can be used in the same
document.

<pre>
@page { display: "a@" }
:lang(fr} {position: a}
div.special {display: "abc" "abd"}
</pre>
</div>

<div class=example>
<p>Here is a page as one might find in a newspaper. It combines a
layout template with multicolumn layout.

<div class=figure>
  <p><img src="newspaper.png" alt="5-column newspaper page with some
  blocks of text that span several columns" longdesc="newspaper.desc">

  <p class=caption>The front page of a newspaper, with the first parts
  of several stories that are continued on other pages and headings
  and images that span several columns.
</div>

<pre>
@page :first {
  display: "A  A  A  A  A  A  A  A  A" / 5cm
           ".  .  .  .  .  .  .  .  ." / 0.25cm
           "B  .  C  C  C  C  C  C  C" / *
           "B  .  C  C  C  C  C  C  C" / *
           "B  .  C  C  C  C  C  C  C" / *
           "B  .  C  C  C  C  C  C  C" / *
           "B  .  C  C  C  C  C  C  C" / *
           "B  .  D  D  D  D  D  D  D" / *
           "B  .  D  D  D  D  D  D  D" / *
           "B  .  E  E  E  .  F  F  F" / *
           "B  .  E  E  E  .  F  F  F" / *
           "B  .  E  E  E  .  F  F  F" / *
            * 3em * 3em * 3em * 3em *
}
h1 {position: a; border-bottom: thick; margin-bottom: 1.5em}
#toc {position: b; margin-right: -1.5em; border-right: thin;
  padding-right: 1.5em}
#leader {position: c; columns: 4; column-gap: 3em}
#art1 {position: d; columns: 4; column-gap: 3em; border-top: thin}
#art2 {position: e; columns: 2; column-gap: 3em}
#art3 {position: f; columns: 2; column-gap: 3em}
</pre>
</div>

<p class=issue id=see-page>If a slot on a page is full and the content continues
on the next page, it may be useful to insert something like 
“continued on page X.” This is useful at any page break, but more
important if there are multiple “flows” of content on each page.
Maybe a page-break-content property? 'page-break-content: "▶ continued on
p. " targetcounter(???, page)' or extend text-overflow from [[!CSS3TEXT]]?

<p class=issue>How do you set the 'vertical-align' property of a slot
in a page? Does the '::slot()' pseudo-element apply? '@page :first
:slot(A) {vertical-align: bottom}'


<h2 id=stacking-order>Stacking order</h2>

<p>An element with a computed value of a letter for its 'position'
is a <em>positioned element</em> (see [[!CSS3POS]]) and thus the
'z-index' property applies to it. The general rules
for <a href="/TR/CSS21/zindex">stacking
contexts</a> <span class=issue>[ref in CSS3?]</span> apply.

<p class=note>Note that an element can only have such a computed value
if it has an ancestor that is a <em>template element.</em>

<div class=example>
<p>This example uses 'z-index' and negative margins to make the
element in the middle slot partly overlap the other slots:

<pre>
body { display: "a.b"
                ".c."
                "d.e";
       height: 240px;
       width: 240px }
::slot(a) { background: #0C0 }
::slot(b) { background: #C00 }
::slot(d) { background: #00C }
::slot(e) { background: #A0A }
#c { background: #FD0; height: 120px; position: c;
     margin: -20px; z-index: 1 }
</pre>

<div class=figure>
  <p><img src="overlap.png" alt="Five colored rectangles"
  longdesc="overlap.desc">
  <p class=caption>Rendering of the above example.
</div>
</div>

<h2>Floating elements inside templates</h2>

<p>An element may be positioned inside a template (computed value of
<var>&lt;letter&gt;</var> for its 'position' property) and be a
floating element at the same time (computed value of its 'float'
property is other than ''none''). The following cases must be
distinguished:

<ul>
  <li>Page-based floats &ndash; In paged media (see [[!CSS3PAGE]]), if
  the value of 'float' specifies that the element floats to the top or
  bottom of the page (in a horizontal writing mode) or the left or
  right of the page (in a vertical writing mode), the slot act as the
  page. (I.e., the element floats to the top, bottom, etc. of the
  slot, not of the page.

  <li>Footnotes &ndash; Likewise, the footnote area for elements with
  'float: footnote' is at the bottom of the slot, not of the page. The
  @footnote at-rule can position the footnote area at other places,
  such as the top, but always inside the slot.

  <li>Normal floats &ndash; In other cases, the element floats
  normally within its containing block, which in this case is its slot
  in the template (as defined <a href="#containing-block">above</a>).
</ul>

<h2 id=gr-unit>Definition of the ''gr'' unit in a template element</h2>

<p>The CSS Values and Units Module [[!CSS3VAL]] defines a ''gr'' unit
(for “<strong>gr</strong>id”) that
is usable with certain properties that position or size boxes.
A <em>template element</em> defines an <em>implicit grid</em> (in the
terminology of that module) for use with the ''gr'' unit. The vertical
grid lines are formed by the left and right content edges of the
template element and by the edges between the columns of the template.
The horizontal grid lines are formed by the top and bottom content
edges of the template element and by the edges between the rows of the
template. The top content edge and the left content edge have the
number 0.

<p class=note>In other words, a template with <var>n</var> columns
and <var>m</var> rows defines <var>n</var> + 1 vertical grid lines
numbered 0 to <var>n</var> and <var>m</var> + 1 horizontal grid lines
numbered 0 to <var>m</var>.

<div class=example>
<p>For example, with the following style sheet
<pre>
div {
  display: "abc"
           "def";
  position: relative}
p {
  position: f}
#p1 {
  position: absolute;
  top: 1gr;
  left: 2gr}
</pre>
<p>and this document fragment
<pre>
&lt;div>
 &lt;p>Lorem ipsum dolor sit amet, consectetaur adipisicing elit, sed
 do eiusmod tempor incididunt ut labore et dolore magna aliqua.
 &lt;p id=p1>Position me.
&lt;/div>
</pre>
<p>the “p1” element will be positioned with its top left corner
against the top left corner of slot f. But note that it is not part of
the content of slot f, it overlaps with it.
</div>

<h2 id=chains>Chaining slots: the 'chains' property</h2>

<p>Slots must be rectangular, but the appearance of non-rectangular
slots can be achieved to a large extent by chaining slots together.
Content that is positioned in the first slot of a chain is
automatically continued in the second slot if the first slot is full,
and then the third, etc.

<table class=propdef>
    <tr>
      <td>Name:
      <td><dfn>chains</dfn>
    <tr>
      <td>Value:
      <td>none | <var>&lt;letter&gt;</var>+
	[ , <var>&lt;letter&gt;</var>+ ]*
    <tr>
      <td>Initial:
      <td>none
    <tr>
      <td>Applies to:
      <td><span title="template element">template elements</span>
    <tr>
      <td>Inherited:
      <td>no
    <tr>
      <td>Percentages:
      <td>N/A
    <tr>
      <td>Media:
      <td>visual
    <tr>
      <td>Computed&nbsp;value:
      <td>specified value
</table>

<p>A value of ''none'' means the element's template has no chains.
Otherwise the value consists of one or more comma-separated lists of
letters. No letter may appear more than once in the value. Letters
that do not occur in the <em>template</em> are ignored, but do not
make the value invalid. A list with only ignored letters is itself
ignored.

<p>All the non-ignored letters in a list, except for the last one,
must refer to slots whose size does not depend on their contents,
otherwise the list is ignored. The size of a slot does not depend on
its content if all the columns and all the rows that the slot spans
have a width, respectively height, that is a <var>&lt;length&gt;</var>
or '*'.

<p>Each non-ignored list defines one <dfn>chain.</dfn>

<p>Each chain is filled with content in an analogous way to the pages
in paged media: all the content that is positioned to the first slot
in the chain is flowed, in document order, into the first slot in the
chain until the slot is full, the rest is flowed into the second slot
until it is full, etc.

<p>Content must only be split between slots at an allowed page break
[[!CSS3PAGE]]. As for page breaks, if a break occurs in the margin
between blocks, all adjoining margins are set to zero.

<p>CSS3 does not define what is the best break point to split content
over slots. However, it is recommended to use the last possible break
point that does not cause overflow. (If such a break point exists.)

<p class=note>Note: It is the author's responsibility to make the
height of relevant slots an integral number of lines if he wants to
ensure that the lines in chained slots are aligned. The height does
not automatically “snap” to a multiple of the line height.

<div class=example>
<p>The following template creates a double-staircase layout. In case
the content is too long for the staircase, a slot of flexible height
is added at the bottom.
<pre>
div { display: "@@..ff...." / 3.6em
               ".aa..gg..." / 3.6em
               "..bb..hh.." / 3.6em
               "...cc..ii." / 3.6em
               "....dd..jj" / 3.6em
               ".........." / 0.6em
               "eeee..kkkk" / auto;
   chains: @ a b c d e, f g h i j k}
#first { position: @ }
#second { position: f }
</pre>
<p>This could be applied to a document fragment such as
<pre>
&lt;DIV&gt;
  &lt;P ID=first&gt;...
  &lt;P ID=second&gt;...
&lt;/DIV&gt;
</pre>
</div>

<div class=example>
<p>Here is a paragraph shaped as a circle:
<pre>
p { width: 12em;
    display: ". . . . @ @ . . . ." / 1.2em
             ". . a a a a a a . ." / 1.2em
             ". b b b b b b b b ." / 1.2em
             ". b b b b b b b b ." / 1.2em
             "c c c c c c c c c c" / 1.2em
             "c c c c c c c c c c" / 1.2em
             ". d d d d d d d d ." / 1.2em
             ". d d d d d d d d ." / 1.2em
             ". . e e e e e e . ." / 1.2em
             ". . . . f f . . . ." / 1.2em
             "g g g g g g g g g g" / auto;
   chains: @ a b c d e f g }
</pre>
</div>

<div class=example>
<p>Here is a page-based template that creates a two-column layout
with a “hole” in the center:
<pre>
@page:first {
    display:
    "aaaaaaa.ddddddd"
    "aaaaaaa.ddddddd"
    "aaaaaaa.ddddddd"
    "aaaaaaa.ddddddd"
    "bbbb.......eeee"
    "bbbb.ggggg.eeee"
    "bbbb.ggggg.eeee"
    "bbbb.ggggg.eeee"
    "bbbb.......eeee"
    "ccccccc.fffffff"
    "ccccccc.fffffff"
    "ccccccc.fffffff"
    "ccccccc.fffffff";
    chains: a b c d e f }
@page::slot(g) {
    vertical-align: middle }

body { position: a }
h1 { position: g }
</pre>
</div>

<p class=note>Note: For more anaylysis of the possibilities and limits
of non-rectangular slots, see the PhD thesis of César Acebal
[[ACEBAL2010]].

<div class=issue>
<p>Chaining of rectangular slots is not enough to create layouts with
holes, e.g., an image in the middle of a text. Allowing
non-rectangular, <em>connected</em> regions (in addition to chaining)
would allow an example such as this:
<pre>
display: "A A A . . ."
         "A . A . . ."
         "A A A . . ."
         ". . . B B B"
         ". . . B . B"
         ". . . B B B";
chains: a b;
</pre>
<p>Such cutouts in the middle of text usually create text that is
difficult to read, and that is why there is no 'float: center', e.g.
But the CSS WG is considering a new property 'wrap-flow' for
absolutely positioned elements that would allow, e.g.: 'p {position:
absolute; top: 1fr; left: 1fr; width: 1fr; height: 1fr; wrap-flow:
both}' to absolutely position a P element on top of a template element
and cause the content of the element under it to wrap around it as if
it were a float [[CSS3-EXCLUSIONS]].
</div>

<p class=note>Note that a slot can have overflowing content even if it
is part of a <span>chain</span>: it can have content that is too wide
but cannot be broken.

<h2>Breaking content between slots in a chain</h2>

<p>The 'break-before', 'break-after' and 'break-inside' properties
have values that control breaking of content between slots in a chain
(in addition to the values that control breaks between pages and
columns, defined in [[!CSS3PAGE]] and [[!CSS3COL]]):

<table class=propdef-extra>
    <tr>
      <td><em>Name:</em>
      <td>'break-inside'
    <tr>
      <td><em>New value:</em>
      <td>avoid-slot
    <tr>
      <td><em>Percentages:</em>
      <td>N/A
    <tr>
      <td><em>Computed&nbsp;value:</em>
      <td>specified value
</table>

<table class=propdef-extra>
    <tr>
      <td><em>Name:</em>
      <td>'break-before', 'break-after'
    <tr>
      <td><em>New value:</em>
      <td>slot | avoid-slot
    <tr>
      <td><em>Percentages:</em>
      <td>N/A
    <tr>
      <td><em>Computed&nbsp;value:</em>
      <td>specified value
</table>

<p>The new values are:

<dl>
<dt>avoid-slot <dd>Avoid a break inside (before, after) the generated
box.

<dt>slot <dd>Always force a break before (after) the generated box.
</dl>

<h2 id=cr-exit-criteria>CR exit criteria</h2>

<p>For this specification to be advanced to Proposed Recommendation,
there must be at least two independent, interoperable implementations
of each feature. Each feature may be implemented by a different set of
products, there is no requirement that all features be implemented by
a single product. For the purposes of this criterion, we define the
following terms:

<dl>
  <dt>independent <dd>each implementation must be developed by a
  different party and cannot share, reuse, or derive from code
  used by another qualifying implementation. Sections of code that
  have no bearing on the implementation of this specification are
  exempt from this requirement.

  <dt>interoperable <dd>passing the respective test case(s) in the
  official CSS test suite, or, if the implementation is not a Web
  browser, an equivalent test. Every relevant test in the test
  suite should have an equivalent test created if such a user
  agent (UA) is to be used to claim interoperability. In addition
  if such a UA is to be used to claim interoperability, then there
  must one or more additional UAs which can also pass those
  equivalent tests in the same way for the purpose of
  interoperability. The equivalent tests must be made publicly
  available for the purposes of peer review.

  <dt>implementation <dd>a user agent which:

  <ol class=inline>
    <li>implements the specification.

    <li>is available to the general public. The implementation may
    be a shipping product or other publicly available version
    (i.e., beta version, preview release, or “nightly build”). 
    Non-shipping product releases must have implemented the
    feature(s) for a period of at least one month in order to
    demonstrate stability.

    <li>is not experimental (i.e., a version specifically designed
    to pass the test suite and is not intended for normal usage
    going forward).
  </ol>
</dl>

<p>The specification will remain Candidate Recommendation for at least
six months.

<p>A <a href="/Style/CSS/Test/">test suite</a> will
be developed during the Candidate Recommendation phase of this
specification.

<h2 id=history>History</h2>

<h3>Developing a model of declaring, using, styling and resizing grids</h3>

<p><em>(This section is not normative.)</em>

<p class=mtb>The following types of use cases were considered for
template-based layout.

<ol>
<li><p>Standard Web pages.

<li><p>Grids and other table-like layouts. This includes grid layouts,
frame layouts and table-like subdivision of a rectangular area.

<li><p>A layout structure with “flex”ing information. The
flexing is represented by constraints that specify how the cells are
to relate to one another: which cells are to be allowed to grow or
shrink and how much. There may also be a priority ordering, which
determines, based on the size of the allowed display window, which
cells shrink, which grow and under which conditions.

<li><p>Layout structures with absolutely positioned (fixed-size)
elements; for example a block of text into which several illustrations
intrude at fixed positions within the block. This is like a float with
respect to tightly wrapping the text around the intrusion, but the
position of the intrusion is determined by the layout structure, not
the content flowed into that structure.

<p>An example of this is a multicolumn layout with one or more
“absolutely positioned floats” that intrude on the columns
(see <a href="#intrusion">figure</a>).

<div class=figure id=intrusion>
  <p><img src="cutout.svg" alt="An image that partially overlaps two
columns makes the text wrap around it on both sides."
  longdesc="cutout.desc">

  <p class=caption>An image (or a “pull quote”) is placed centered
  on the page and intrudes on two areas.
</div>

<li><p>Multiple, disconnected, fixed-size areas on a page that are
chained together, each one receiving the content that doesn't fit in
the previous slot. In combination with page breaks, this may give a
layout as often seen in newspapers: the first few lines of each story
on the first page, the rest of the story in other areas on subsequent
pages. (It will probably need a way to conditionally insert “continued
on page&nbsp;7” or similar text.)
</ol>

<p>For comparing proposals for template-based layouts, the working
group identified four important aspects of each proposal:

<ol>
<li><p>the physical layout structures &ndash; the way of structuring
the “cells” (slots) into which content is flowed. This
includes a way to identify the various layout containers.

<li><p>the binding mechanism &ndash; the way to specify that a given
element (and its descendants) are to be placed in a given layout cell.

<li><p>the property distribution mechanism &ndash; the way to put
properties onto the layout structure and the cells within it.

<li><p>the flexing mechanism &ndash; the way to describe how the
layout structure should adapt itself to the higher level container
(window) in which it is placed. This includes statements about which
cells should grow and when they should grow.
</ol>

<p>In this specification, these aspects are as follows:

<ol>
<li><p>A character matrix is used to show the layout structure and the
cells are named by the character used to show where they are
positioned.

<li><p>The binding of content to cells is handled by the 'position'
property which identifies a cell to which the content is bound.

<li><p>The shape, size and flexibility of the layout are specified
with the character matrix. Some properties (background, border and
vertical alignment) are attached to individual slots.

<li><p>There is limited “flexing” information. The choice is between
fixed size, a fraction of the available size or the content's
intrinsic size. (The latter is further subject to min/max sizes
specified on that content.) It is not possible to say, e.g., that some
column can only become wider if all other columns are at their maximum
size.
</ol>



<h3>Syntax, features and levels</h3>

<p><em>(This section is not normative.)</em>

<p>The following is a partial list of design decisions and some
arguments for and against each choice:



<h4>Named vs numbered slots</h4>

<p>Named slots are very easy to understand and use. Everybody who sees
a template immediately understands what it means and what the effect
of 'flow: a' is (assuming 'flow' is the name of the property that
positions elements). It may be useful to refer to slots by (x,y)
coordinates, too, e.g., for style sheets that are generated by
programs. (The program could then contain slightly shorter code like
<code>colnr++</code> to advance a column, instead of
<code>template[rownr][++colnr]]</code>.)

<p>Also, if grids are <a href="#auto-add" >automatically extended with
extra rows and columns (see below)</a> based on content, then those
extra rows and columns cannot have names and must (probably, see
below) be referred to by number.



<h4>Single letter names vs identifiers</h4>

<p>The set of single letters is finite. And even if Unicode has many
symbols, typing them may not be easy. Letters also do not permit to
give a hint as to a slot's function (“heading,” “footer,”
“advertisement”&hellip;).

<p>On the other hand, any Unicode character can be typed as an escape,
so if you really run out of letters on the keyboard, you can always
make a template like this:

<pre>DIV {grid: "\1001\1002\1003"
           "\1001\1004\1005\1006"}
DIV H1 {flow: \1001}</pre>

<p>And in practice it is hard to come up with meaningful identifiers
anyway, beyond article1, article2, etc. So single letters avoid that
hassle. And if you always have single letters, you don't need spaces
between them either, which makes big templates easier to read.

<p>CSS doesn't yet have a type corresponding to single letter. There
is a “nmstart” macro in the grammar, but it is probably not exactly
what we want here. E.g., U+0300 (“combining grave accent”) is a valid
first character for an identifier, but may not be desirable as a slot
in a template. We probably want a definition based on the principle
that it is a single letter if it <em>looks</em> like a single
letter. This may correspond to the notion of <em>character
cluster.</em> To be investigated.



<h4>Extend 'display' or add a grid property</h4>

<p>Grids can be defined on elements such as table cells, blocks,
inline blocks or list items, but not on elements such as tables or,
inline elements. That can be expressed in the syntax by adding the
grid to the 'display' property: ''display: inline-block "abc" "abd"''
is valid, but ''display: inline "abc" abd"'' would not be. Or it can
be expressed by an implicit dependency between properties: ''display:
inline-block; grid: "abc" "abd"'' has a grid, but ''display: inline;
grid: "abc" abd"'' ignores the grid. (In this case it is actually the
computed value of 'display' that applies, so, e.g., if the element
floats, it would be a block and thus have a grid.)

<p>The Multicol specification uses the latter model: 'columns' is a
separate property and only applies if the element is a <em>block
container.</em> Given that precedent, it seems reasonable to do the
same here.



<h4>Combining columns and grids</h4>

<p>Style rules can specify both a grid and columns for the same
element:

<pre>DIV {columns: 20em; grid: "aabccc"}</pre>

<p>The specification could say that grids don't apply to column
elements, or vice versa, or it could say that the columns apply to
contents of the DIV, after it has been flowed into the <em>default
slot.</em> This seems the most useful. It is consistent with other
elements that flow into a slots: they, too, can have columns.



<h4>Shorthand vs single property</h4>

<p>It is convenient to specify the grid as the value of a single
property. It puts the column and row sizes immediately next to the
rows and columns they apply to. The typical column widths can either
be omitted or are short values like '*' and '1em', and they fit easily
in one line.

<p>But if a grid have very many columns, or their sizes are complex
(with many ''minmax()'' and ''calc()'' values, e.g.), it may be more
readable to separate the slot names from the column sizes.

<p>Also, separable properties for row and column sizes makes is easier
to specify a transition/animation on them,, because you don't have to
repeat the slot names (which cannot animate).



<h4>The number of rows and columns</h4>

<p>If the grid can also be specified with individual properties: Does
the template (if not 'none') determine the number of columns
or the maximum of the template and the list of
sizes? E.g.:

<table>
<thead>
<tr>
<th>Specified values
<th>Meaning if the template prevails
<th>Meaning if the maximum value is used
<tbody>
<tr>
<td>
<pre>grid-template: "a b c";
grid-columns: * * * * *</pre>
<td>
<pre>grid-template: "a b c";
grid-columns: * * *</pre>
<td>
<pre>grid-template: "a b c . .";
grid-columns: * * * *</pre>
</table>

<p>The former is consistent with the model for 'background-image' and
'background-size'. However, unlike for backgrounds, where a size
without an image makes no sense, in this case a size without a slot
name can make sense: it can represent empty space ('.') of the given
size.

<p>What is more likely: that people consciously specify empty rows and
columns without putting dots in the template (to save typing or to
avoid typing too many dots), or that people mistakenly add a size too
many?



<h4 id=need-fr>'*' vs 'fr'</h4>

<p>It is very common for the columns of a grid to have all the same
width. That is because the slots in a grid, although of different
widths themselves, typically are designed to be multiples of some
fundamental measure. And thus equal columns is the default in the
current syntax. And if it needs to be specified explicitly which
columns have the same width (e.g., because there are also a few
columns in the grid with a specific width) then the symbol for it is
short: '*'. This is ideal for slots whose widths are small multiples
of the fundamental measure. E.g., the widths of slots a, b and c in
the following grid relate to each other as 1:3:2:

<pre>grid: "a b b b c c"
     "a . . . cc"</pre>

<p>(The implicit widths in this case could be made explicit with the
rule 'grid-columns: * * * * * *'.)

<p>However, if the ratios of the slots are ratios of larger numbers,
the notation may become long. E.g., to make slots a and b with ratio
10:11, you would have to make 21 columns:

<pre>grid: "aaaaaaaaaabbbbbbbbbbb"</pre>

<p>It needs to be investigated if such long notations are
frequent. (They don't seem to occur in printed magazines, at least for
the main content. No study has yet been made of advertisements.) And
even if they are infrequent, if there are some ratios that would be
impractical to write in this way.

<p>Assuming another notation is needed, it could be made by prefixing
a number (e.g., '7* 10*') or, to make the notation look more like a
dimension, by creating a special unit 'fr' ('e.g., '3.5fr 5fr', which
is the same as 7 + 10 stars).

<p>If 'fr' is added, it could either be in addition to '*' or instead
of '*'. In the former case, '*' = '1fr'.

<p>Unless it is shown that the notation with only '*' is not practical
in real cases, it seems better to neither introduce numbers ('7*') nor
units ('3.5fr'). It would give too many different ways to write the
same grid, causing authors and readers of style sheets to have to
think longer about each grid. (E.g., 'grid: "abbbcc"' could then also
be written as 'grid: "abc" 1* 3* 2*' or 'grid: "abbbc" 0.5fr 0.5fr
0.5fr 0.5fr 1fr', etc.)



<h4 id=auto-add>Automatically add rows and columns</h4>

<p>The main purpose of grids is to improve on absolute positioning for
displaying elements in a different visual order. As such, you
typically know how many positions you need in advance, the grid just
allows you to align them to each other, which absolute positioning
couldn't do.

<p>If you don't need to change the visual order, then table layout can
often align the elements sufficiently.

<p>However, if table layout isn't possible (there are not enough
elements in the source to create the necessary table rows, the control
over the size of table cells is too limited, or you want a
column-major table), it may be useful to use a grid in a similar
manner to a table: the number of rows and columns is not specified in
the style, but depends on the number of elements that are put in the
grid.

<p>E.g., you could transpose a table like this with three columns and
an unknown number or rows

<pre>
&lt;TABLE>
 &lt;TR>&lt;TD>A1 &lt;TD>A2 &lt;TD>A3
 &lt;TR>&lt;TD>B1 &lt;TD>B2 &lt;TD>B3
 ...
 &lt;TR>&lt;TD>K1 &lt;TD>K2 &lt;TD>K3
 ...
&lt;/TABLE>
</pre>

<p>into a tabular display with three rows and
an unknown number of columns somewhat like this

<pre>
A1 B1... K1...
A2 B2... K2...
A3 B3... K3...
</pre>

<p>with style rules like this:

<pre>
TABLE {grid-columns: fit-content; grid-rows: fit-content}
TR:first-child {grid-position: 1 / 1}
TR {grid-position: next / 1}
TD:first-child {grid-position: same / same}
TD {grid-position: same / next}
</pre>

<p>This uses keywords instead of numbers, as described in <a
href="#next-same">“Automatic placement of elements”</a> below.

<p>What is the size of the added rows and columns? The example above
assumes the size of the single, specified grid cell is simply
repeated. There could also be a marker in the list of sizes to
indicate which set of sizes is repeated. Or there could be a separate
property with the list of sizes that is repeated for all added rows
and columns.

<p>It would probably be difficult to specify that any number of
columns of size A can be added, but that the last column must have
size B&hellip;



<h4>Rectangular slots vs non-rectangular slots</h4>

<p>Non-rectangular slots, such as

<pre>grid: "a a a"
      "a a ."
      "a . ."</pre>

<p>are probably something for level 4. Or maybe the Exclusions module
can be used instead.



<h4 id=chained>Chained slots</h4>

<p>Many layouts found in magazines can be handled with multi-columns
[[CSS3COL]] (possibly extended with ideas in GCPM [[CSS3GCPM]]) or with
multi-column elements inside a grid, but some more complicated designs
appear to require chained slots (and some would be easier to specify
that way than with columns).

<pre>
grid: "A A E"
      "A A E"
      "B B E"
      "C D E;
chains: B C D E
</pre>

<p>Also, when grids are applied to pages (see <a href="#page-grid"
>“Page grids”</a> below), it is essential that slots are connected to
slots on the next or some subsequent page, so that the overflow can
find a place.

<p>But this could be a feature for level 4.



<h4 id=page-grid>Page grids</h4>

<p>Typically in magazines, each page has a slightly different layout
of slots, although they are all based on the same set of columns,
usually between 3 and 6. It is thus not possible to specify the grid
on a the BODY element, because it looks different on each page.

<p>Applying grids to '@page' is fairly straightforward, except for a
few issues:

<ul>
<li>We need named paged (''@page news {&hellip;}'', or is numbered
enough?), a way for an element to say it needs to start on a specific
kind of page ('break-before: page(news)'), and, if paged are indeed
named and not numbered, a way to say which style follows which
(''@page news-odd {next: news-even}'').

<li>What happens to footnotes [[CSS3GCPM]]? Each slot probably has its own
footnote area.

<li>How are slots on different pages connected? Probably by having the
same name.
</ul>

<p>This is probably for level 4.



<h4>Style the slots (pseudo-elements)</h4>

<p>Slots can have properties of their own: background, overflow,
writing-mode, direction, box-shadow, margin, border, padding. What
else?

<p>For 'vertical-align', see <a href="#vert-align" >“Vertical
alignment inside slots”</a> below.

<p>'z-Index' seems useful, because then you can give a slot negative
margins and have it partially overlap some other slot.

<p>'Wrap-flow' (from <a href="http://www.w3.org/TR/css3-exclusions/"
>CSS Exclusions and Shapes</a>) could be useful for slots with
negative margins, too.

<p>'Content' might be useful.



<h4>Style the contents of slots (region-based styling)</h4>

<p>By means of a new pseudo-element, style could be applied to only
the part of an element that is inside a certain slot (similar to how
''::first-line'' applies style only to the part of an element in the
first line of a paragraph):

<pre>P::fragment(a) {font-size: large}</pre>

<p>This looks like a level 4 feature.



<h4>Orient the grid with writing mode vs orient the slots</h4>

<p>A grid can contain vertical text, but the grid itself probably
doesn't need to be rotated or flipped. Indeed, it would be confusing
if it did. In other words, the following element has vertical text in
the top right slot and an image in the bottom right slot:

<pre>
&lt;DIV STYLE="grid: "a*" "ab"; writing-mode: vertical-rl">
 Some text here...
 &lt;IMG STYLE="flow: b"...>
 ...
&lt;/DIV>
</pre>

<p>Slots can have a writing mode, however (by default the one
“inherited” from the grid element).



<h4>Indicating the default slot ('*' vs '@')</h4>

<p>The symbol '*' seems a good choice, as the concept of default is
somewhat similar to the concept of wildcard. The '*' is also used to
set the size of rows and columns, but the context is probably enough
to avoid confusion.



<h4 id=abspos>Flowing vs absolutely positioning content in a grid</h4>

<p>The most flexible model for positioning content in a grid is to
consider the slot as a flow, which can then contain multiple
elements. This is the same concept as a table cell: the cell also is a
separate flow that can contain several elements as well as anonymous
content. (But in this case we can say explicitly which elements are in
which flow, with the 'flow' property.)

<p>An element inside a slot thus has its own size: if you set a
background on it, it doesn't necessarily cover the whole slot. For
that, you can set a background on the slot itself.

<p>But, if there is only one element in a slot, you may want to force
its height to be the same as the slot.

<p>Also, you may want to use the grid as a coordinate system for
absolutely positioned elements, which then overlap with the contents
of the grid (above or below it, depending on 'z-index').

<p>There are two ideas for how to do this absolute positioning. One
idea is to define a special kind of unit, 'gr', which is only defined
for elements that have a <em>grid ancestor,</em> and which can be used
on the 'top', 'right', 'bottom' and 'left', properties of absolutely
positioned elements. ''left: 2.25gr'' means the position is in the
third column, one quarter of the way towards the fourth column.

<p>Another way is to define a new property 'grid-position' (shorthand
for 'grid-column' and 'grid-row'), which, if set, overrides 'top',
'left', etc. and which takes as numbers or names of slots (up to four
of them, to set the four sides).

<p>Yet another way is to extend 'top', 'left', etc., with unitless
values (meaning the n'th grid column or row) and letters (meaning the
appropriate edge of the slot of that name).



<h4>Use the pseudo-class to create additional slots</h4>

<p>If you want a flow that overlaps with the content of the grid
(i.e., absolutely positioned on top of the grid), but
there is no element in the document that you can position, you could
create a pseudo-element:

<pre>DIV::slot(z) {position: absolute; grid-position: 2 / 2}</pre>

<p>Because this pseudo-element has a 'position' property with a value
of 'absolute', it creates an absolutely positioned flow at the given
position, assuming that the DIV is a <em>grid element,</em> otherwise
nothing happens. (It is some kind of error if the name 'z' already
appears as a slot in the grid template.)

<p>Then you can flow other elements into this slot:

<pre>.note {flow: z}</pre>

<p>Are there use cases for this? It is pretty difficult to understand
that the ''::slot'' here <em>creates</em> a pseudo-element, rather
then <em>selects</em> an existing one. If indeed needed, this feature
could be in level 4.



<h4>Names for edges</h4>

<p>If you position elements absolutely with 'top', 'left', etc. or
'grid-position' (see <a href="#abspos" >“Flowing vs absolutely
positioning content in a grid”</a> above), you can use numbers to
refer to the edges of the columns and rows: '1' is the left edge of
the first column, '2' is its right edge, '3' is the left edge of the
third column, etc. You can also use names of slots. Depending on the
context, one of the four edges of the slot gives the position: 'right:
a' means the right edge of the element is positioned at the right edge
of slot a.

<p>But maybe you have no named slots and you still want to use some
symbolic name instead of a number (as a kind of indirection, or for
documentation purposes). Would it be possible to assign names to the
edges of the columns and rows?

<p>The following could make the name ''a-line'' an alias for the
number 2 (the left edge of the second column) and ''b-line'' an alias
for the number 4:

<pre>grid-columns: * a-line * * b-line * *</pre>

<p>(This could also use strings instead of identifiers, for even more
flexible names.)

<p>This turns out to be very difficult to explain, partly because of
the syntax, partly because of the indirection, which comes on top of
the inherent indirection that CSS already requires (the style rules
are in a style sheet, not on the elements they apply to) and the
indirection of specifying a position indirectly by referring to an
abstract grid.

<p>Are there use cases? And can they not be handled by a macro
processor? It seems this feature does not need to be in CSS.



<h4>Position from the right and bottom</h4>

<p>If elements are absolutely positioned relative to a grid (with
'top', 'left' or 'grid-position', see <a href="#abspos" >“Flowing vs
absolutely positioning content in a grid”</a> above), and especially
if the grid can automatically grow (see <a href="#auto-add"
>“Automatically add rows and columns”</a>) it might be useful to
position elements relative to the last row or column, even if you
don't know what number that row or column has. That could be done with
negative numbers:

<pre>right: -1</pre>



<h4>Syntax features to shorten long grid specifications</h4>

<p>Grids are typically very regular (see also <a href="#need-fr">'*'
vs 'fr'</a> above). E.g., if you choose to indicate the margins in the
template rather then use the 'margin' property, you often end up with
a grid similar to this:

<pre>grid-template: "a.b.c.d.e.f";
grid-columns: * 1em * 1em * 1em * 1em * 1em *</pre>

<p>Even for the columns of broadsheet newspapers, that still fits on
one line, but if it gets even longer, there may be a need for
abbreviations, e.g.:

<pre>grid-columns: * repeat(1em *, 5)</pre>

<p>or

<pre>grid-columns: * (1em *)[5]</pre>

<p>This makes the syntax much harder to learn and read, though. So it
needs some good use cases. This could be postponed to level 4.



<h4>''fit-content'' vs ''auto'' vs&hellip;</h4>

<p>Column sizes can have an exact size or a minimum and maximum size,
by means of ''minmax()''. A common case is probably
''minmax(min-content, max-content)''. (Is that really true?) Should
that common case have its own keyword? If so, should that keyword be
''fit-content''?

<p>''fit-content'' in the Box Module is defined as something else, viz.,
min(max(available width, ''min-content''), ''max-content'')).



<h4 id=vert-align>Vertical alignment inside slots</h4>

<p>The content of a slot could be vertically aligned with
'vertical-align', exactly like the content in table cells. (Despite
the name, it would be horizontal alignment if the slot's writing mode
was vertical.)

<p>There could also be a property that applies exclusively to grids
('grid-slot-align'?), just like Flexbox proposes an alignment property
that applies exclusively to flex items ('flex-item-align'). But why
should users learn a new property when 'vertical-align' fits so well?

<p>Looking beyond tables, flex boxes and grids, there is also a need
for vertical alignment of content in normal blocks (when those blocks
have a height that does not depend on their contents). There might be
room for a new property there. E.g.: ''block-align: top | bottom |
middle | baseline'', where ''baseline'' simply means ''top''
everywhere outside grids and tables. (A separate question is if it
would override 'vertical-align' in tables). It might even have a
percentage value. (That makes it animatable, and, if there is a
scrollbar or similar mechanism, it sets the position of that
scrollbar.)

<p>Given how little progress has been made on the general feature for
all blocks, it seems wise to just use 'vertical-align'. If a general
mechanism is developed too late to change the grid template module,
then whatever solution applies to table cells can apply here, too.



<h4>Horizontal alignment inside slots</h4>

<p>Elements can be centered in, or aligned to a side of, their parent
with ''auto'' margins. But this doesn't always work: for many
combinations of 'width' and 'direction', the auto margins are
ignored. There may thus be a new property ('block-align: center') or
value ('margin: any') in the future for correct alignment and
centering.

<p>Or should there be an alignment property that only applies to grid
slots? 'grid-slot-align'? Defining nothing and deferring to the
future, general solution seems better.



<h4>Auto margins on slots</h4>

<p>Do ''auto'' margins on slots (e.g., ''::slot(a) {margin: auto}'')
do anything? Or are they simply 0?



<h4>Page floats</h4>

<p>[[CSS3GCPM]] defines “page floats” (which are slightly misnamed,
because they cause floats to float not just to the top or bottom of a
page, but also to the top or bottom of a column in certain
contexts). What do they do in slots? It seems most useful to treat the
slot similar to a column, e.g., ''top'' means the top of the slot, not
of the page. Similarly, if slots are <a href="#chained">chained,</a>
then the float modifiers select the next slot, not the next page.



<h4>Break-* properties</h4>

<p>The 'break-before', 'break-after' and 'break-inside' properties in
the draft of February 2012 (see [[CSS3-BREAK]]) have keywords
''region'' and 'avoid-region''. Should they be called ''slot'' and
''avoid-slot'' instead?



<h4 id=next-same>Automatic placement of elements</h4>

<p>There may be cases where elements are to be placed based on where
the previous elements was placed, which isn't always expressible with
a clever selector. En example is placing DD elements in the same slot
as the preceding DT element. (Note that there may be more than one DD
associated with a single DT, so a selector such as ''DT + DD'' doesn't
work. The selector ''DT ~ DD'' doesn't work either, because it selects
DDs that belong to the next DT, too.).

<p>A keyword may help: 'flow: same'.

<p>In some cases, elements may need to be placed in the next column or
row after the previous element. If there are cases where rows or
columns need to be <a href="#auto-add">added automatically based on
content,</a> those are probably also the cases where element are to
be placed in the “next” row or column w.r.t. to the preceding element.

<p>E.g., with a keyword: 'flow: next-row'.

<p>(The same may apply if elements are positioned instead of flowed:
'grid-position: same' or 'grid-position: next-row'.)



<h2 id=changes>Changes</h2>

<p>Summary of changes since 
<a href="/TR/2011/WD-css3-layout-20111129/" >29 November 2011 draft:</a>

<ul>
<li>The 'fr' unit is renamed back to 'gr' (it is now defined in
[[!CSS3VAL]]).

<li>Added a <a href="#accessibility">note about accessibility.</a>
</ul>

<h2 class="no-num" id="acknowledgments">Acknowledgments</h2>

<p>The first ideas for describing a template in CSS date from 1996 and
are described in <a href="/TR/NOTE-layout"><cite>Frame-based layout
via Style Sheets</cite></a> by Bert Bos, Dave Raggett and Håkon Wium
Lie. The idea was revived in 2005 on the request of W3C's Device
Independence Working Group and benefited especially from discussions
with Rhys Lewis and Rotan Hanrahan from that group.

<p>This specification was further influenced by ideas about form
layout by <a
href="https://lists.w3.org/Archives/Member/w3c-css-wg/2002JulSep/0077.html">
Dave Raggett [member-only link]</a> and an early write-up of the
features of <a href="http://www.mozilla.org/projects/xul/xul.html">
XUL</a> by <a
href="https://lists.w3.org/Archives/Member/w3c-css-wg/2002JanMar/0432.html">
Ian Hickson [member-only link].</a>

<p><a href="http://transcendingcss.com/support/">Andy
Clarke,</a> <a href="http://sushiandrobots.com/about">Jina
Bolton</a> and <a href="http://lawver.net/">Kevin Lawver</a> provided
use cases, examples and requirements. The analysis in
the <a href="#history">History</a> section is a slightly shortened
version of work by Steve Zilles.

<p>César Acebal built the first <a
href="http://transcendingcss.com/support/almcss.zip"> prototype.</a>
Andrew Fedoniouk built <a
href="http://lists.w3.org/Archives/Public/www-style/2009Mar/0278.html">
the second.</a> A <a
href="http://lists.w3.org/Archives/Public/www-style/2009Apr/0383.html">
third prototype</a> was made by Alexis Deveria.

<h2 class="no-num" id="references">References</h2>

<p id="normative-references">Normative references:
<!--begin-normative-->

<p>[Here will be inserted the file “normative.inc”]
<!--end-normative-->

<p id="other-references">Other references:
<!--begin-informative-->

<p>[Here will be inserted the file “informative.inc”]
<!--end-informative-->

<h2 class="no-num" id="index">Index</h2>
<!--index-->

<!--
<h2 class="no-num" id="property-index">Property index</h2>
< ! - - properties - - >
-->

<!-- Keep this comment at the end of the file
Local variables:
mode: sgml
sgml-declaration:"~/SGML/HTML4.decl"
sgml-default-doctype-name:"html"
sgml-minimize-attributes:t
sgml-nofill-elements:("pre" "style" "br")
sgml-live-element-indicator:t
sgml-omittag:nil
sgml-shorttag:nil
sgml-namecase-general:t
sgml-general-insert-case:lower
sgml-always-quote-attributes:t
sgml-indent-step:nil
sgml-indent-data:t
sgml-parent-document:nil
sgml-exposed-tags:nil
sgml-local-catalogs:nil
sgml-local-ecat-files:nil
End:
-->
</body>
</html>
