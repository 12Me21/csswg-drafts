<!DOCTYPE html>
<html lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<title>CSS Flexible Box Layout Module</title>
	<link rel="stylesheet" type="text/css" href="http://dev.w3.org/csswg/default.css">
	<link rel="stylesheet" type="text/css" href="http://www.w3.org/StyleSheets/TR/W3C-ED">
	<style>
	code.one-line { white-space: pre; }
	.code-and-figure {
		display: table;
		margin: 0 auto;
		border-spacing: 1em;
	}
	.code-and-figure > div {
		display: table-cell;
		vertical-align: middle;
	}
	</style>
</head><body>

<div class="head">
	<!--logo-->

	<h1 id="head-box-flexible">CSS Flexible Box Layout Module</h1>
	<h2 class="no-num no-toc" id="w3c-working">[LONGSTATUS], [DATE]</h2>

	<dl>
		<dt>This version:
		<!--<dd><a href="[VERSION]">[VERSION]</a>-->
		<dd><a href="http://dev.w3.org/csswg/[SHORTNAME]/">http://dev.w3.org/csswg/[SHORTNAME]/</a>

		<dt>Latest version:
		<!--<dd><a href="[LATEST]">[LATEST]</a>-->
		<dd><a href="http://www.w3.org/TR/css3-flexbox/">http://www.w3.org/TR/css3-flexbox/</a>

		<dt>Editor's Draft:
		<dd><a href="http://dev.w3.org/csswg/css3-flexbox/">http://dev.w3.org/csswg/css3-flexbox/</a>

		<dt>Previous versions:
		<dd><a href="http://www.w3.org/TR/2011/WD-css3-flexbox-20111129/">http://www.w3.org/TR/2011/WD-css3-flexbox-20111129/</a>
		<dd><a href="http://www.w3.org/TR/2011/WD-css3-flexbox-20110322/">http://www.w3.org/TR/2011/WD-css3-flexbox-20110322/</a>
		<dd><a href="http://www.w3.org/TR/2009/WD-css3-flexbox-20090723/">http://www.w3.org/TR/2009/WD-css3-flexbox-20090723/</a>

		<dt>Issues List:</dt>
		<dd><p class=issue>Will be a bugzilla URL once I get a component added.</p>

		<dt>Discussion:</dt>
		<dd><a href="http://lists.w3.org/Archives/Public/www-style/">www-style@w3.org</a> with subject line "<code>[css3-flexbox] …message topic…</code>"

		<dt>Editors:
		<dd><a href="http://www.xanthir.com/contact">Tab Atkins Jr.</a>, Google Inc.</dd>
		<dd>Alex Mogilevsky, Microsoft Corporation, <a href="mailto:alexmog@microsoft.com">alexmog@microsoft.com</a>
		<dd>L. David Baron, Mozilla Corporation, <a href="mailto:dbaron@dbaron.org">dbaron@dbaron.org</a>

		<dt>Authors and former editors:
		<dd>Neil Deakin, Mozilla Corporation, <a href="mailto:enndeakin@gmail.com">enndeakin@gmail.com</a>
		<dd>Ian Hickson, formerly of Opera Software, <a href="mailto:ian@hixie.ch">ian@hixie.ch</a>
		<dd>David Hyatt, formerly of Netscape Corporation, <a href="mailto:hyatt@apple.com">hyatt@apple.com</a>
	</dl>
	<!--copyright-->

	<hr title="Separator for header">
</div>

<h2 class="no-num no-toc" id="abstract">
Abstract</h2>

	<p>The specification describes a CSS box model optimized for user interface design. In the flexbox layout model, the children of a flexbox can be laid out in any direction, and can "flex" their sizes, either growing to fill unused space or shrinking to avoid overflowing the parent.  Both horizontal and vertical alignment of the children can be easily manipulated. Nesting of these boxes (horizontal inside vertical, or vertical inside horizontal) can be used to build layouts in two dimensions.</p>

<h2 class="no-num no-toc" id="status">Status of this document</h2>
<!--status-->

<h2 class="no-num no-toc" id="table">Table of contents</h2>
<!--toc-->

<p class=issue>Add "Canonical Order" fields to all the propdef tables, per <a href="http://wiki.csswg.org/spec/format-update">http://wiki.csswg.org/spec/format-update</a>.</p>


<h2 id="intro">
Introduction</h2>

	<p><em>This section is not normative.</em>

	<p>CSS 2.1 defined four layout modes &mdash; algorithms which determine the size and position of boxes based on their relationships with their sibling and ancestor boxes: block layout, designed for laying out documents; inline layout, designed for laying out text; table layout, designed for laying out information in a tabular format; and positioned layout, designed for very explicit positioning without much regard for other elements in the document. This module introduces a new layout mode, flexbox layout, which is designed for laying out more complex applications and webpages.</p>

	<p>Flexbox layout is superficially similar to block layout.  It lacks many of the more complex text or document-formatting properties that can be used in block layout, such as 'float' and 'columns', but in return it gains more simple and powerful tools for aligning its contents in ways that webapps and complex web pages often need.  </p>

    <p>The contents of a flexbox can be laid out in any direction (left, right, down, or even up!), can have their order swapped around dynamically (i.e., display order is independent of source order), and can "flex" their sizes and positions to respond to the available space.  If a flexbox is <i>multi-line</i>, the flexbox items flow in two dimensions, wrapping into separate lines in a fashion similar to how text is wrapped into multiple lines.</p>

	<div class="example">
		<p>For example, the following HTML snippet uses flexbox to create a toolbar with icons.  The flexbox is horizontal, and the children's widths don't fill the flexbox's width, so the additional space is distributed around and between the children.  As the flexbox grows (perhaps because the user is viewing the page on a wider screen), the children spread out evenly and automatically:</p>

		<pre>
&lt;ul>
  &lt;li>&lt;button>&lt;img src='new.svg' alt="New">&lt;/button>&lt;/li>
  &lt;li>&lt;button>&lt;img src='upload.svg' alt="Upload">&lt;/button>&lt;/li>
  &lt;li>&lt;button>&lt;img src='save.svg' alt="Save">&lt;/button>&lt;/li>
  &lt;li>&lt;button>&lt;img src='trash.svg' alt="trash">&lt;/button>&lt;/li>
&lt;/ul>
&lt;style>
ul { display: flexbox; flex-pack: distribute; }
/* Irrelevant styling for this example removed. */
&lt;/style></pre>

		<div class='figure'>
			<img src="images/toolbar-example.svg" width=400 height=140>
			<p class='caption'>Example rendering of the above code snippet, at two different flexbox widths.</p>
		</div>
	</div>

<h3 id="placement">
Module interactions</h3>

	<p>This module extends the definition of the 'display' property.  It also defines a new type of primitive value, the <a href="#flex-function">flex() notation</a>, which is accepted by the 'width' and 'height' properties.

<h3 id="values">
Values</h3>

	<p>This specification follows the <a href="http://www.w3.org/TR/CSS21/about.html#property-defs">CSS property definition conventions</a> from [[!CSS21]]. Value types not defined in this specification are defined in CSS Level 2 Revision 1 [[!CSS21]]. Other CSS modules may expand the definitions of these value types: for example [[CSS3COLOR]], when combined with this module, expands the definition of the &lt;color&gt; value type as used in this specification.</p>

	<p>In addition to the property-specific values listed in their definitions, all properties defined in this specification also accept the <a href="http://www.w3.org/TR/CSS21/cascade.html#value-def-inherit">''inherit''</a> keyword as their property value. For readability it has not been repeated explicitly.

<h2 id='box-model'>
The Flexbox Box Model</h2>

	<p>An element with ''display:flexbox'' or ''display:inline-flexbox'' is a <dfn>flexbox</dfn>.  Children of a flexbox are called <dfn title="flexbox item|flexbox items|flexbox item's" id="flexbox-item">flexbox items</dfn> and are laid out using the flexbox box model.</p>

	<p>Unlike block layout, which is normally biased towards laying things out vertically, and inline layout, which is normally biased toward laying things out horizontally, the flexbox layout algorithm is agnostic as to the direction the flexbox happens to be laid out in.  To make it easier to talk about flexbox layout in a general way, we will define several direction-agnostic terms here to make the rest of the spec easier to read and understand.</p>

	<div class='figure'>
		<img src='images/flex-direction-terms.svg' width=510 height=300>
		<p class='caption'>An illustration of the various directions and sizing terms used in this specification, respectively for ''row'' and ''column'' flexboxes.</p>
	</div>

	<p>The <dfn>main axis</dfn> of a flexbox is the axis on which <i>flexbox items</i> are laid out along.  The <i>flexbox items</i> are ordered such that they start on the <dfn>main-start</dfn> side of the flexbox, and go toward the <dfn>main-end</dfn> side.  A <i>flexbox item's</i> width or height, whichever is in the <i>main axis</i>, is the item's <dfn>main size</dfn>.  The <i>flexbox item's</i> <dfn>main size property</dfn> is either the 'width' or 'height' property, whichever is in the <i>main axis</i>.</p>

	<p>The axis perpendicular to the <i>main axis</i> is called the <dfn>cross axis</dfn>, and similarly has <dfn>cross-start</dfn> and <dfn>cross-end</dfn> directions and sides defined.  The width or height of a <i>flexbox item</i>, whichever is in the <i>cross axis</i>, is the item's <dfn>cross size</dfn>, and similarly the <dfn>cross size property</dfn> is whichever of 'width' or 'height' that is in the <i>cross axis</i>.</p>

	<p>The contents of a flexbox can be easily and powerfully manipulated with a handful of properties.  Most significantly, <i>flexbox items</i> can "flex" their <i>main size</i> by using the ''flex()'' function in the 'width' or 'height' property.  This "flexing" allows the items to get bigger or smaller based on the available space in the page.  If there is leftover space in the flexbox after all of the <i>flexbox items</i> have finished flexing, the items can be aligned, centered, or distributed with the 'flex-pack' property.  <i>Flexbox items</i> can also be completely rearranged within the flexbox with the 'flex-order' property.</p>

	<p>In the <i>cross axis</i>, <i>flexbox items</i> can either "flex" to fill the available space or be aligned within the space with the 'flex-align' property.  If a flexbox is <i>multi-line</i>, new lines are added in the <i>cross-end</i> direction, and can similarly be aligned, centered, or distributed within the flexbox with the 'flex-line-pack' property.</p>


<h3 id='display-flexbox'>
New values for 'display' property</h3>

	<table class="propdef">
		<tr>
			<th>Name:
			<td>display
		<tr>
			<th><a href="http://dev.w3.org/csswg/css-module/#values">New value</a>:
			<td>flexbox | inline-flexbox
	</table>

	<p>You can declare that an element is a flexbox, and thus should use flexbox layout for its contents, by setting the 'display' property on the element to the value 'flexbox' or 'inline-flexbox'.</p>

	<p>The ''flexbox'' value makes the flexbox a block-level element.  The ''inline-flexbox'' value makes the flexbox an inline-level element.  When it is necessary to distinguish them, this specification will refer to the former kind of flexbox as a <dfn id="block-flexbox" title="block flexbox|block flexboxes">block flexbox</dfn> and the latter type as an <dfn id="inline-flexbox" title="inline flexbox|inline flexboxes">inline flexbox</dfn>.</p>

	<p>Flexboxes use a new layout algorithm, and so some properties that were designed with the assumption of block layout don't make sense in a flexbox context.  In particular:</p>

	<ul>
		<li>all of the 'column-*' properties in the Multicol module have no effect on a flexbox.</li>

		<li>'float' and 'clear' have no effect on a flexbox item.  Using 'float' on an element still causes that element's 'display' property to compute to ''block'', as normal, because that occurs before flexbox items are determined (the algorithm for wrapping children of a flexbox into <i>flexbox items</i> needs the computed value of 'display').</li>

		<li>'vertical-align' has no effect on the alignment of a flexbox item in the flexbox</li>
	</ul>

	<p>If an element's specified value for 'display' is ''inline-flexbox'' and the element is floated or absolutely positioned, the computed value of 'display' must be ''flexbox''.</p>

	<p>A flexbox establishes a new <dfn>flexbox formatting context</dfn> for its contents.  This is similar to a block formatting context root: floats do not intrude into the flexbox, and the flexbox's margins do not collapse with the margins of its contents.  Additionally, each of the <i>flexbox items</i> establish a new formatting context for its contents.</p>


<h3 id='flex-items'>
Flexbox Items</h3>

	<p class='issue'>Add a ''display:flexbox-item'' value, so I can do flexbox-fixup (wrapping an anonymous flexbox around children that have declared themselves to be items).</p>

	<p>Flexbox layout algorithm operates on <i>flexbox items</i>, which are boxes that satisfy at least one of the following criteria:</p>

	<ol>
		<li>Immediate block-level children of flexbox</li>

		<li>Atomic inline-level children of flexbox</li>

		<li>Contiguous run of non-replaced inline children, wrapped into an anonymous box</li>
	</ol>

	<p>Some values of 'display' trigger "fixup" to ensure a sensible tree structure.  For example, a lone ''table-cell'' box is fixed up by generating ''table'', ''table-row-group'', and ''table-row'' boxes around it.  This fixup must occur <em>before</em> a flexbox's contents are checked to see if it's necessary to generate anonymous flexbox items.</p>

	<p class='note'>In the future, other kinds of fixup such as ''display:run-in'' or ''display:ruby'' should also run before flexbox fixup.</p>

	<div class="example">
		<p>Examples of flexbox items:</p>
		<pre>
&lt;div style="display:flexbox">

    &lt;!-- flexbox item: block-level child -->
    &lt;div id="item1">block&lt;/div>

    &lt;!-- not a flexbox item, because it's out-of-flow -->
    &lt;div id="not-an-item1.5" style="position: absolute;">block&lt;/div>
    
    &lt;!-- flexbox item: block-level child -->
    &lt;div id="item2" style="display:table">table&lt;/div>
    
    &lt;!-- flexbox item: anonymous table wrapped around table-cell -->
    &lt;div id="item3" style="display:table-cell">table-cell&lt;/div> 

    &lt;!-- flexbox item: anonymous block around inline content -->
    anonymous item 4

    &lt;!-- flexbox item: block-level child -->
    &lt;div id="item5">block&lt;/div>

    &lt;!-- flexbox item: anonymous block around inline content -->
    anonymous item 6.1
    &lt;span id="item6.1">
        text 6.2
        &lt;div id="not-an-item6.3">block&lt;/div>
        text 6.4
    &lt;/span>

    &lt;!-- flexbox item: block-level replaced element -->
    &lt;iframe id="item7"></iframe>

    &lt;!-- flexbox item: inline-level replaced element -->
    &lt;img id="item7" style="display:inline">

    &lt;!-- flexbox item: inline-level replaced element -->
    &lt;button id="item8">button&lt;/button>

    &lt;!-- flexbox item: inline-table -->
    &lt;div id="item9" style="display:inline-table">table&lt;/div>

    &lt;!-- flexbox item: floated inline, which changes to a block -->
    &lt;span id="item10" style="float: left;">span&lt;/span>
&lt;/div></pre>

		<p>Notice that block element "not-an-item6.3" is not a separate flexbox item, because it is contained inside an inline element which is being wrapped into an anonymous flex item.  Similarly, the block element "not-an-item1.5" is not a flexbox item, because it's absolutely positioned and thus out of flow.</p>
	</div>

<h4 id='abspos-flexbox-items'>
Positioning Absolutely Positioned Flexbox Items</h4>

	<p>Absolutely positioned children of a flexbox are not <i>flexbox items</i>, but they leave behind "placeholders" in their normal position in the box tree.  These placeholders are anonymous inline boxes with a width and height of ''0px'', and they interact normally with the flexbox layout algorithm.  In particular, they'll trigger the creation an anonymous flexbox item wrapper boxes, or join neighboring inline elements in <em>their</em> anonymous flexbox item wrapper boxes.</p>

	<p>The "static position" of an absolutely positioned child of a flexbox (the position when the 'top'/'right'/'bottom'/'left' properties are ''auto''), then, is the final position of their corresponding placeholder, after flexbox layout has been performed.</p>

	<p class='note'>Note: In most cases, this means that absolutely positioned items will have no effect on flexbox layout, even if they force the generation of an anonymous flexbox item wrapper, because those wrapper items will also collapse to zero size and have no effect.  The only exception is when the flexbox has ''flex-pack:justify'', in which case the anonymous flexbox item will cause there to be two packing spaces where there would otherwise be only one, which will appear as a double-size space between two "real" items.</p>

<h2 id='ordering-orientation'>
Ordering and Orientation</h2>

	<p>The first level of flexbox functionality is the ability to lay out a flexbox's contents in any direction and in any order.  This allows an author to trivially achieve effects that would previously have required complex or fragile methods, such as using the 'float' property to lay out a horizontal navigation bar (which then requires further effort with the 'clear' property or others to make the elements interact nicely with the rest of the page).  This functionality is exposed through the 'flex-flow' and 'flex-order' properties.</p>

<h3 id='flex-direction'>
Flexbox Flow Direction: the 'flex-direction' property</h3>

	<table class=propdef>
		<tr>
			<th>Name:</th>
			<td><dfn>flex-direction</dfn>
		<tr>
			<th><a href="http://dev.w3.org/csswg/css-module/#values">Value</a>:
			<td>row | row-reverse | column | column-reverse
		<tr>
			<th>Initial:
			<td>row
		<tr>
			<th>Applies To:
			<td>flexboxes
		<tr>
			<th>Inherited:
			<td>no
		<tr>
			<th>Computed Value:
			<td>specified value
		<tr>
			<th>Media:
			<td>visual
		<tr>
			<th>Animatable:
			<td>no
	</table>

	<p>The 'flex-direction' property specifies how <i>flexbox items</i> are placed in the flexbox, by setting the direction of the flexbox's <i>main axis</i>.  This affects the direction that flexbox items are laid out in, and the meaning of the 'flex-pack' property.</p>

	<dl>
		<dt><dfn id='flex-flow-row'>row</dfn></dt>
		<dd>The flexbox's <i>main axis</i> has the same orientation as the inline axis of the current writing mode (the direction that text is laid out in).  The <i>main-start</i> and <i>main-end</i> directions are equivalent to the "start" and "end" directions, respectively, of the current writing mode.</dd>

		<dt><dfn id='flex-flow-row-reverse'>row-reverse</dfn></dt>
		<dd>Same as <i>row</i>, except the <i>main-start</i> and <i>main-end</i> directions are swapped.</dd>

		<dt><dfn id='flex-flow-column'>column</dfn></dt>
		<dd>The flexbox's <i>main axis</i> has the same orientation as the block axis of the current writing mode (the direction that blocks are laid out in).  The <i>main-start</i> and <i>main-end</i> directions are equivalent to the "before" and "after" directions, respectively, of the current writing mode.</dd>

		<dt><dfn id='flex-flow-column-reverse'>column-reverse</dfn></dt>
		<dd>Same as <i>column</i>, except the <i>main-start</i> and <i>main-end</i> directions are swapped.</dd>
	</dl>

<h3 id='flex-wrap'>
Flexbox Wrapping: the 'flex-wrap' property</h3>

	<table class=propdef>
		<tr>
			<th>Name:</th>
			<td><dfn>flex-wrap</dfn>
		<tr>
			<th><a href="http://dev.w3.org/csswg/css-module/#values">Value</a>:
			<td>none | wrap | wrap-reverse
		<tr>
			<th>Initial:
			<td>none
		<tr>
			<th>Applies To:
			<td>flexboxes
		<tr>
			<th>Inherited:
			<td>no
		<tr>
			<th>Computed Value:
			<td>specified value
		<tr>
			<th>Media:
			<td>visual
		<tr>
			<th>Animatable:
			<td>no
	</table>

	<p>The 'flex-wrap' property controls whether the flexbox is <i>single-line</i> or <i>multi-line</i>, and the direction of the <i>cross axis</i>, which affects the direction new lines are stacked in and the meaning of the 'flex-align', 'flex-item-align', and 'flex-line-pack' properties.</p>

	<dl>
		<dt><dfn id='flex-flow-none'>none</dfn></dt>
		<dd>The flexbox is <i>single-line</i>.  The <i>cross-start</i> direction is equivalent to either the "start" or "before" direction of the current writing mode, whichever is in the <i>cross-axis</i>, and the <i>cross-end</i> direction is the opposite direction of <i>cross-start</i>.
			<p class='issue'>For consistency with 'white-space', we should use ''nowrap''.  For consistency with 'text-wrap', we should use ''none''.  ''none'' is the less dumb of these.  Can we switch both this and 'text-wrap' to ''no-wrap''?</p>
		</dd>

		<dt><dfn id='flex-flow-wrap'>wrap</dfn></dt>
		<dd>The flexbox is <i>multi-line</i>.  The <i>cross-start</i> direction is equivalent to either the "start" or "before" direction of the current writing mode, whichever is in the <i>cross-axis</i>, and the <i>cross-end</i> direction is the opposite direction of <i>cross-start</i>.</dd>

		<dt><dfn id='flex-flow-wrap-reverse'>wrap-reverse</dfn></dt>
		<dd>Same as <i>wrap</i>, except the <i>cross-start</i> and <i>cross-end</i> directions are swapped.</dd>
	</dl>

<h3 id='flex-flow'>
Flex Direction and Wrap: the 'flex-flow' shorthand</h3>

	<table class=propdef>
		<tr>
			<th>Name:</th>
			<td><dfn>flex-flow</dfn>
		<tr>
			<th><a href="http://dev.w3.org/csswg/css-module/#values">Value</a>:
			<td>&lt;&apos;flex-direction&apos;> || &lt;&apos;flex-wrap&apos;>
		<tr>
			<th>Initial:
			<td>see individual properties
		<tr>
			<th>Applies To:
			<td>flexboxes
		<tr>
			<th>Inherited:
			<td>see individual properties
		<tr>
			<th>Computed Value:
			<td>see individual properties
		<tr>
			<th>Media:
			<td>visual
		<tr>
			<th>Animatable:
			<td>no
	</table>

	<p>The 'flex-flow' property is a shorthand for setting the 'flex-direction' and 'flex-wrap' properties together.</p>

	<div class="example">
		<p>Some examples of valid flows:</p>

		<table style="margin: 0 auto; vertical-align: middle; border-spacing: 2em 1em;">
			<tr>
				<td><pre>
div { flex-flow: row; }
/* Initial value. Main axis is 
   inline, no wrap. */</pre>
				<td><img src='images/flex-flow1.svg' width=240 height=80>
			<tr>
				<td><pre>
div { flex-flow: column wrap; }
/* Main axis is block-direction and lines
   wrap in the inline direction.  For an 
   English page, the main axis is top-to-bottom
   and lines wrap to the right. */</pre>
				<td><img src='images/flex-flow2.svg' width=170 height=200>
			<tr>
				<td><pre>
div { writing-mode: tb-rl;
      flex-flow: column wrap-reverse; }
/* Main axis is block direction (right to 
   left). New lines wrap upwards. */</pre>
				<td><img src='images/flex-flow3.svg' width=200 height=170>
		</table>
	</div>


<h3 id='flex-order'>
Display Order: the 'flex-order' property</h3>

	<p><i>Flexbox items</i> are, by default, displayed and laid out in the same order as they appear in the source document.  The 'flex-order' property may be used to change this ordering.</p>

	<table class=propdef>
		<tr>
			<th>Name:
			<td><dfn>flex-order</dfn>
		<tr>
			<th><a href="http://dev.w3.org/csswg/css-module/#values">Value</a>:
			<td>&lt;number>
		<tr>
			<th>Initial:
			<td>0
		<tr>
			<th>Applies to:
			<td><i>flexbox items</i></td>
		<tr>
			<th>Inherited:
			<td>no
		<tr>
			<th>Computed value:
			<td>specified value
		<tr>
			<th>Media:
			<td>visual
		<tr>
			<th>Animatable:
			<td>yes
	</table>

	<p>The 'flex-order' property assigns <i>flexbox items</i> to ordinal groups.</p>

	<p>Ordinal groups control the order in which <i>flexbox items</i> appear.  A flexbox will lay out its content starting from the lowest numbered ordinal group and going up.  Items with the same ordinal group are laid out in the order they appear in the source document.  'flex-order' has no effect on stacking/layering; elements must still be drawn over/under each other based on document order, 'z-index', and other relevant means.</p>

	<div class='example'>
		<p>The following figure shows a simple tabbed interface, where the tab for the active pane is always in front:</p>

		<div class='figure'><img src="images/flex-order-example.png"></div>

		<p>This could be implemented with the following CSS (showing only the flexbox-relevant code):</p>

		<pre>
.tabs {
	display: flexbox;
}
.tabs > .current {
	flex-order: -1; /* Lower than the default of 0 */
}</pre>

		<p>You can also see a <a href="flex-order-example.html">working example</a> in some modern browsers (modern WebKit, Firefox, or any browser that supports the Flexbox spec).</p>
	</div>

	<div class='example'>
		<p>Many web pages have a similar shape in the markup, with a header on top, a footer on bottom, and then a content area and one or two additional columns in the middle.  Generally, it's desirable that the content come first in the page's source code, before the additional columns.  However, this makes many common designs, such as simply having the additional columns on the left and the content area on the right, difficult to achieve.  This has been addressed in many ways over the years, often going by the name "Holy Grail Layout" when there are two additional columns.  'flex-order' makes this trivial.  For example, take the following sketch of a page's code and desired layout:</p>

		<div class='code-and-figure'>
			<div><pre>
&lt;!DOCTYPE html>
&lt;header>...&lt;/header>
&lt;div id='main'>
   &lt;article>...&lt;/article>
   &lt;nav>...&lt;/nav>
   &lt;aside>...&lt;/aside>
&lt;/div>
&lt;footer>...&lt;/footer></pre></div>
			<div><img src="images/flex-order-page.svg" width=400 height=360></div>
		</div>

		<p>This layout can be easily achieved with Flexbox:</p>

		<pre>
#main { display: flexbox; }
#main > article { width: flex(1); flex-order: 2; }
#main > nav     { width: 200px;   flex-order: 1; }
#main > aside   { width: 200px;   flex-order: 3; }</pre>
		
		<p>As an added bonus, the columns will all be equal-height by default, and the main content will be as wide as necessary to fill the screen.  Additionally, this can then be combined with media queries to switch to an all-vertical layout on narrow screens:</p>

		<pre>
@media all and (max-width: 600px) {
	/* Too narrow to support three columns */
	#main { flex-flow: column; }
	#main > article, #main > nav, #main > aside {
		/* Return them to document order */
		flex-order: 0; width: auto;
	}
}</pre>

		<p><small>(Further use of multiline flexboxes to achieve even more intelligent wrapping left as an exercise for the reader.)</small></p>
	</div>


<h2 id='flexibility'>
Flexibility: the ''flex()'' notation</h2>

	<p>The defining aspect of flexbox layout is the ability to make the <i>flexbox items</i> "flex", altering their width or height to fill the available space.  This is done by using a ''&lt;flex>'' value in the element's 'width' or 'height' property.  A flexbox distributes free space to its items proportional to their positive flexibility, or shrinks them to prevent overflow proportional to their negative flexibility.</p>

	<p>The ''flex()'' notation is used to specify the parameters of a <dfn title="flexible length|flexible lengths|flexible length's">flexible length</dfn>: the <dfn id="positive-flexibility" title="positive flexibility">positive</dfn> and <dfn>negative flexibility</dfn>, and the <dfn>preferred size</dfn>.  The syntax of the ''flex()'' notation is:</p>

	<pre class=prod><dfn>&lt;flex></dfn> = flex( [ &lt;pos-flex> &lt;neg-flex>? ]? &amp;&amp; &lt;preferred-size>? )</pre>

	<p><code>&lt;pos-flex></code> and <code>&lt;neg-flex></code> are non-negative <code>&lt;numbers>s</code>, while <code>&lt;preferred-size></code> is any value (other than another ''&lt;flex>'') that would be valid in the 'width' or 'height' property in which the notation is used.  If the <code>&lt;preferred-size></code> is ''0'', it <strong>must</strong> be specified with a unit (like ''0px'') to avoid ambiguity; unitless zero will either be interpreted as as one of the flexibilities, or is a syntax error.</p>

	<p>The <code>&lt;pos-flex></code> component sets the length's <i>positive flexibility</i>; if omitted, the <i>positive flexibility</i> defaults to ''1''.  The <code>&lt;neg-flex></code> component sets the length's <i>negative flexibility</i>; if omitted, it defaults to ''0''.  The <code>&lt;preferred-size></code> component sets the length's <i>preferred size</i>; if omitted, it defaults to ''0px''.</p>

	<p>If the ''flex()'' notation is specified on an element that is not a <i>flexbox item</i>, it computes to the <i>preferred size</i>.  If the ''flex()'' notation is used on a <i>flexbox item's</i> <i>cross size property</i>, it computes to the <i>preferred size</i>.  Otherwise, it computes to itself, and is resolved to a length at used-value time by the flexbox layout algorithm.</p>

	<p>A ''&lt;flex>'' value is transitionable, by transitioning the <i>preferred size</i>, <i>positive flexibility</i>, and <i>negative flexibility</i> independently.  ''&lt;flex>'' can also transition to and from a &lt;length>, by treating the length as if it were a flexible length with a positive and negative flexibility of zero and a preferred size of the length.</p>

	<p class='issue'>Transitioning to/from a &lt;length> (or to/from a &lt;flex> with 0 flexibility) doesn't work well if it's the only flexible item in the flexbox.  Rather than smoothly transitioning, it suddenly jumps in size when the flexibility becomes non-zero.  Can we fix this, perhaps with a value that represents a percentage of the free space or something?</p>

	<div class='example'>
		<p>The ''flex()'' notation allows elements to respond directly to the available space, in ways that are difficult or impossible in normal CSS.  One common example is a page with one segment intended to stay on screen, and another section which may be long but which shouldn't scroll the page, like a chat room:</p>

		<pre>
&lt;!DOCTYPE html>
&lt;body>
  &lt;header>Channel: #csswg  Topic: CSS IS AWE    SOME&lt;/header>
  &lt;article id='messages'>
  	&lt;p>&lt;b>Tab Atkins:&lt;/b> 
  	  I think the layout algorithm is done.&lt;/p>
  	&lt;p>&lt;b>Fantasai:&lt;/b> 
  	  SUBMIT BEFORE ZOD.&lt;/p>
  	...
  &lt;/article>
  &lt;form>
  	&lt;input name='message'>
  	&lt;button type='submit'>Send&lt;/button>
  &lt;/form>
 &lt;/body>
 &lt;style>
 body { display:flexbox; flex-flow: column; }
 #messages { height: flex(1); }
 &lt;/style></pre>

		<p class='issue'>Illustrate this example.</p>
	</div> 

<h2 id='alignment'>
Alignment</h2>

	<p>After a flexbox's contents have finished their flexing, they can be aligned in both the <i>main axis</i> with 'flex-pack' and the <i>cross axis</i> with 'flex-align' and 'flex-item-align'.  These properties make many common types of alignment trivial, including some things that were very difficult in CSS 2.1, like horizontal and vertical centering.</p>


<h3 id='flex-pack'>
Main Axis Alignment: the 'flex-pack' property</h3>

	<table class=propdef>
		<tr>
			<th>Name:
			<td><dfn>flex-pack</dfn>
		<tr>
			<th><a href="http://dev.w3.org/csswg/css-module/#values">Value</a>:
			<td>start | end | center | justify | distribute
		<tr>
			<th>Initial:
			<td>start
		<tr>
			<th>Applies to:
			<td>flexboxes
		<tr>
			<th>Inherited:
			<td>no
		<tr>
			<th>Computed Value:
			<td>specified value
		<tr>
			<th>Media:
			<td>visual
		<tr>
			<th>Animatable:
			<td>no
	</table>

	<p>The 'flex-pack' property aligns <i>flexbox items</i> in the <i>main axis</i> of the current line of the flexbox.  This is done <em title=''>after</em> any flexible lengths have been resolved.  Typically it helps distribute extra free space leftover when either all the <i>flexbox items</i> on a line are inflexible, or are flexible but have reach their maximum size, but it also exerts some control over the alignment of items when they overflow the line.</p>

	<dl>
		<dt><dfn id='flex-pack-start'>start</dfn></dt>
		<dd><i>Flexbox items</i> are packed toward the start of the line.  The <i>main-start</i> margin edge of the first <i>flexbox item</i> on the line is placed flush with the <i>main-start</i> edge of the line, and each subsequent <i>flexbox item</i> is placed flush with the preceding item.</dd>

		<dt><dfn id='flex-pack-end'>end</dfn></dt>
		<dd><i>Flexbox items</i> are packed toward the end of the line.  The <i>main-end</i> margin edge of the last <i>flexbox item</i> is placed flush with the <i>main-end</i> edge of the line, and each preceding <i>flexbox item</i> is placed flush with the subsequent item.</dd>

		<dt><dfn id='flex-pack-center'>center</dfn></dt>
		<dd><i>Flexbox items</i> are packed toward the center of the line.  The <i>flexbox items</i> on the line are placed flush with each other and aligned in the center of the line, with equal amounts of empty space between the <i>main-start</i> edge of the line and the first item on the line and between the <i>main-end</i> edge of the line and the last item on the line.  (If the leftover free-space is negative, the <i>flexbox items</i> will overflow equally in both directions.)</dd>

		<dt><dfn id='flex-pack-justify'>justify</dfn></dt>
		<dd><i>Flexbox items</i> are evenly distributed in the line.  If the leftover free-space is negative or there is only a single <i>flexbox item</i> on the line, this value is identical to ''start''.  Otherwise, the <i>main-start</i> margin edge of the first <i>flexbox item</i> on the line is placed flush with the <i>main-start</i> edge of the line, the <i>main-end</i> margin edge of the last <i>flexbox item</i> on the line is placed flush with the <i>main-end</i> edge of the line, and the remaining <i>flexbox items</i> on the line are distributed so that the empty space between any two adjacent items is the same.</dd>

		<dt><dfn id='flex-pack-distribute'>distribute</dfn></dt>
		<dd><i>Flexbox items</i> are evenly distributed in the line, with half-size spaces on either end.  If the leftover free-space is negative or there is only a single <i>flexbox item</i> on the line, this value is identical to ''center''.  Otherwise, the <i>flexbox items</i> on the line are distributed such that the empty space between any two adjacent <i>flexbox items</i> on the line is the same, and the empty space before the first and after the last <i>flexbox items</i> on the line are half the size of the other empty spaces.</dd>
	</dl>

	<div class="figure">
		<img src="images/flex-pack.svg" width=504 height=270>
		<p class='caption'>An illustration of the five 'flex-pack' keywords and their effects on a flexbox with three colored items.</p>
	</div>


<h3 id='flex-align'>
Cross Axis Alignment: the 'flex-align' and 'flex-item-align' properties</h3>

	<table class=propdef>
		<tr>
			<th>Name:
			<td><dfn>flex-align</dfn>
		<tr>
			<th><a href="http://dev.w3.org/csswg/css-module/#values">Value</a>:
			<td>start | end | center | baseline | stretch
		<tr>
			<th>Initial:
			<td>stretch
		<tr>
			<th>Applies to:
			<td>flexboxes
		<tr>
			<th>Inherited:
			<td>no
		<tr>
			<th>Computed Value:
			<td>specified value
		<tr>
			<th>Media:
			<td>visual
		<tr>
			<th>Animatable:
			<td>no
	</table>

	<table class=propdef>
		<tr>
			<th>Name:
			<td><dfn>flex-item-align</dfn>
		<tr>
			<th><a href="http://dev.w3.org/csswg/css-module/#values">Value</a>:
			<td>auto | start | end | center | baseline | stretch
		<tr>
			<th>Initial:
			<td>auto
		<tr>
			<th>Applies to:
			<td><i>flexbox items</i>
		<tr>
			<th>Inherited:
			<td>no
		<tr>
			<th>Computed Value:
			<td>''auto'' computes to parent's 'flex-align'; otherwise as specified
		<tr>
			<th>Media:
			<td>visual
		<tr>
			<th>Animatable:
			<td>no
	</table>

	<p><i>Flexbox items</i> can be aligned in the <i>cross axis</i> of the current line of the flexbox, similar to 'flex-pack' but in the perpendicular direction.  'flex-align' sets the default alignment for all of the flexbox's <i title="flexbox items">items</i>, including anonymous <i>flexbox items</i>.  'flex-item-align' allows this default alignment to be overridden for individual <i>flexbox items</i> (for anonymous flexbox items, 'flex-item-align' always matches the value of 'flex-align' on their associated flexbox).</p>

	<p>A value of <dfn id="flex-item-align-auto">''auto''</dfn> for 'flex-item-align' computes to the value of 'flex-align' on the <i>flexbox item's</i> flexbox.  The alignments are defined as:</p>

	<dl>
		<dt><dfn id="flex-align-start">start</dfn></dt>
		<dd>The <i>cross-start</i> margin edge of the <i>flexbox item</i> is placed flush with the <i>cross-start</i> edge of the line.</dd>

		<dt><dfn id="flex-align-end">end</dfn></dt>
		<dd>The <i>cross-end</i> margin edge of the <i>flexbox item</i> is placed flush with the <i>cross-end</i> edge of the line.</dd>

		<dt><dfn id="flex-align-center">center</dfn></dt>
		<dd>The <i>flexbox item's</i> margin box is centered in the <i>cross axis</i> within the line.  (If the <i>cross size</i> of the flexbox is less than than that of the <i>flexbox item</i>, it will overflow equally in both directions.)</dd>

		<dt><dfn id="flex-align-baseline">baseline</dfn></dt>
		<dd>
			<p>If the <i>flexbox item's</i> inline axis is the same as the <i>cross axis</i>, this value is identical to ''start''.</p>

			<p>Otherwise, all <i>flexbox items</i> on the line with an alignment of ''baseline'' that don't run afoul of the previous paragraph are aligned such that their baselines align, and the item with the largest distance between its baseline and its <i>cross-start</i> margin edge is placed flush against the <i>cross-start</i> edge of the line.</p>
		</dd>
			  
		<dt><dfn id="flex-align-stretch">stretch</dfn></dt>
		<dd>
			<p>If the <i>cross size property</i> of the <i>flexbox item</i> is ''auto'', it resolves to the length necessary to make the <i>cross size</i> of the item's margin box the same size as the line, while still respecting 'min/max-width/height' constraints as normal.</p>

			<p>The <i>cross-start</i> margin edge of the <i>flexbox item</i> is placed flush with the <i>cross-start</i> edge of the line.</p>
		</dd>
	</dl>

	<div class='figure'>
		<img src="images/flex-align.svg" width=508 height=377>
		<p class='caption'>An illustration of the five 'flex-align' keywords and their effects on a flexbox with four colored items.</p>
	</div>

	<div class=example>   
		<p>By using a vertical flexbox and 'flex-align', we can achieve behavior very close to HTML's <code>&lt;center></code> element:</p>
		
		<div class='code-and-figure'>
			<div><pre>
&lt;div>
  &lt;p>foo foo foo foo&lt;/p>
  &lt;p>bar bar&lt;br>bar bar&lt;/p>
  &lt;p>foo foo foo foo foo foo foo
     foo foo foo foo foo&lt;/p>
&lt;/div>
&lt;style>
  div {
    display: flexbox;
    flex-flow: column;
    flex-align: center;
    width: 200px;
  }
&lt;/style></pre></div>
			<div><p><img alt="" src="images/basic-vertical-flexbox.png"></p></div>
		</div>
	</div>


<h2 id='multi-line'>
Multi-line Flexbox</h2>

	<p>A flexbox can be either <i>single-line</i> or <i>multi-line</i>, depending on the 'flex-wrap' property.  A <dfn>single-line</dfn> flexbox lays out all of its children in a single line, even if that would cause the flexbox to overflow its bounds.  A <dfn>multi-line</dfn> flexbox breaks its <i>flexbox items</i> across multiple lines to avoid overflowing, similar to how text is broken onto a new line when it gets too wide to fit on the existing line.  Every line contains at least one <i>flexbox item</i>, unless the flexbox itself is completely empty.</p>

	<p>When additional lines are created, they are stacked in the flexbox in the <i>cross axis</i>.  Each line is completely independent; flexible lengths and the 'flex-pack' and 'flex-align' properties only consider the items on a single line at a time.  The <i>main size</i> of a line is the same as the <i>main size</i> of the flexbox's content box.  The <i>cross size</i> of a line depends on whether the flexbox is <i>single-line</i> or <i>multi-line</i>: the <i>cross size</i> of the sole line in a <i>single-line</i> flexbox is the same as the <i>cross size</i> of the flexbox's content box, while the <i>cross size</i> of a line in a <i>multi-line</i> flexbox is the minimum size necessary to contain the <i>flexbox items</i> on the line, after aligning them with 'flex-align'.  The lines themselves are then aligned within a flexbox with the 'flex-line-pack' property.</p>

	<div class=example>
		<p>This example shows four buttons that do not fit horizontally.</p>

		<pre>&lt;style>
#div1 {
	display: flexbox;
	flex-flow: row wrap;
	width: 300px;
}
button {
	width: flex(80px 1);
}
&lt;style>

&lt;div id="div1">
	&lt;button id="button1">Elephant&lt;/button>
	&lt;button id="button2">Tiger&lt;/button>
	&lt;button id="button3">Antelope&lt;/button>
	&lt;button id="button4">Wildebeest&lt;/button>
&lt;/div></pre>

		<p>The buttons are first set to their preferred widths, in this case 80 pixels. This will allow the first three buttons to fit in 240 pixels with 60 pixels left over of remaining space. Because the 'flex-flow' property specifies a multi-line flexbox (due to the ''wrap'' keyword appearing in its value), the flexbox will create an additional line to contain the last button.</p>

		<p>Flexibility is applied to each element, separately for each line. The first line has 60 pixels of remaining space and all of the buttons have the same flexibility, so each of the three buttons on that line will receive 20 pixels of extra width, ending up 100px wide. The remaining button is on a line of its own and will stretch to the entire width of the line, or 300 pixels.</p>

		<div style="width:300px; border:medium solid green; overflow: hidden;">
			<button style="width:100px; float: left;">Elephant</button>
			<button style="width:100px; float: left;">Tiger</button>
			<button style="width:100px; float: left;">Antelope</button>
			<button style="width:300px; float: left;">Wildebeest</button>
		</div>

		<p>If the box was resized, the buttons may rearrange onto different lines as necessary.</p>
		
		<p>If the style rules in the example above were changed to the following:</p>

		<pre>
#div1 {
	display: flexbox;
	flex-flow: row wrap;
	flex-pack: center;
	width: 300px;
}
button {
	width: flex(80px 1);
	max-width: 90px;
}</pre>

		<p>Similar to the previous example, the first three buttons will fit on the first line, and the last button will wrap onto a new line.  However, when the buttons attempt to flex they can only grow to 90px each, due to their 'max-width' property.  This leaves 30px of free space on the first line and 210px of free space on the second line.  Because 'flex-pack' is set to ''center'', the buttons will be centered on each line, with the free space split equally on either side.</p>

		<div style="width:300px; border:medium solid green; text-align:center;">
			<button style="width:90px; float: left; margin-left: 15px;">Elephant</button>
			<button style="width:90px; float: left;">Tiger</button>
			<button style="width:90px; float: left;">Antelope</button>
			<button style="width:90px">Wildebeest</button>
		</div>
	</div>


<h3 id='flex-line-pack'>
'flex-line-pack' property</h3>

	<table class=propdef>
		<tr>
			<th>Name:
			<td><dfn>flex-line-pack</dfn>
		<tr>
			<th><a href="http://dev.w3.org/csswg/css-module/#values">Value</a>:
			<td>start | end | center | justify | distribute | stretch
		<tr>
			<th>Initial:
			<td>start
		<tr>
			<th>Applies to:
			<td><i>multi-line</i> flexboxes
		<tr>
			<th>Inherited:
			<td>no
		<tr>
			<th>Computed Value:
			<td>specified value
		<tr>
			<th>Media:
			<td>visual
		<tr>
			<th>Animatable:
			<td>no
	</table>

	<p>The 'flex-line-pack' property aligns a flexbox's lines within the flexbox when there is extra space in the <i>cross axis</i>, similar to how 'flex-pack' aligns individual items within the <i>main axis</i>:</p>

	<dl>
		<dt><dfn id='flex-line-pack-start'>start</dfn></dt>
		<dd>Lines are packed toward the start of the flexbox.  The <i>cross-start</i> edge of the first line in the flexbox is placed flush with the <i>cross-start</i> edge of the flexbox, and each subsequent line is placed flush with the preceding line.</dd>

		<dt><dfn id='flex-line-pack-end'>end</dfn></dt>
		<dd>Lines are packed toward the end of the flexbox.  The <i>cross-end</i> edge of the last line is placed flush with the <i>cross-end</i> edge of the flexbox, and each preceding line is placed flush with the subsequent line.</dd>

		<dt><dfn id='flex-line-pack-center'>center</dfn></dt>
		<dd>Lines are packed toward the center of the flexbox.  The lines in the flexbox are placed flush with each other and aligned in the center of the flexbox, with equal amounts of empty space between the <i>cross-start</i> content edge of the flexbox and the first line in the flexbox and between the <i>cross-end</i> content edge of the flexbox and the last line in the flexbox.  (If the leftover free-space is negative, the lines will overflow equally in both directions.)</dd>

		<dt><dfn id='flex-line-pack-justify'>justify</dfn></dt>
		<dd>Lines are evenly distributed in the flexbox.  If the leftover free-space is negative or there is only a single line in the flexbox, this value is identical to ''start''.  Otherwise, the <i>cross-start</i> edge of the first line in the flexbox is placed flush with the <i>cross-start</i> content edge of the flexbox, the <i>cross-end</i> edge of the last line in the flexbox is placed flush with the <i>cross-end</i> content edge of the flexbox, and the remaining lines in the flexbox are distributed so that the empty space between any two adjacent lines is the same.</dd>

		<dt><dfn id='flex-line-pack-distribute'>distribute</dfn></dt>
		<dd>Lines are evenly distributed in the flexbox, with half-size spaces on either end.  If the leftover free-space is negative or there is only a single line in the flexbox, this value is identical to ''center''.  Otherwise, the lines in the flexbox are distributed such that the empty space between any two adjacent lines is the same, and the empty space before the first and after the last lines in the flexbox are half the size of the other empty spaces.</dd>

		<dt><dfn id='flex-line-pack-stretch'>stretch</dfn></dt>
		<dd>Lines stretch to take up the remaining space.  If the leftover free-space is negative, this value is identical to ''start''.  Otherwise, the free-space is split equally between all of the lines, increasing their cross size.
	</dl>

	<p class='note'>Note: Only <i>multi-line</i> flexboxes ever have free space in the <i>cross axis</i> for lines to be aligned in, because in a <i>single-line</i> flexbox the sole line automatically stretches to fill the space.</p>

	<p class="issue">TODO: examples</p>


<h2 id='layout-algorithm'>
Flexbox Layout Algorithm</h2>

	<p>This section contains normative algorithms detailing the exact layout behavior of a flexbox and its contents.  The algorithms here were designed to optimize readability and theoretical simplicity, and may not necessarily be the most efficient.  Implementations may use whatever actual algorithms they wish, but must produce the same results as the algorithms described here.</p>

	<div class=note>
		<p>This note will outline the general structure of the layout algorithm, before I go into the ugly details below, to aid in reading the relatively-long and complex algorithm.</p>

		<ol>
			<li value=0>Generate anonymous flexbox items as necessary.</li>

			<li>Reorder flexbox items according to 'flex-order'.</li>

			<li>Find the hypothetical main size of every flexbox item.</li>

			<li>Linebreak the flexbox, if it's multi-line.</li>

			<li>Based on the hypothetical sizes of the items, find the real main size of the flexbox.</li>

			<li>Resolve any flexible lengths.  All items now have a real main size.</li>

			<li>Update layout for the items based on their real main sizes, and determine their hypothetical cross size.</li>

			<li>Find the real cross size of the flexbox and its lines.</li>

			<li>Align the lines, per 'flex-line-pack'.</li>

			<li>Align in the cross axis, per 'flex-align'.</li>

			<li>Update layout for the items based on their real cross sizes.</li>

			<li>Align in the main axis, per 'flex-pack'.</li>
		</ol>
	</div>

	<p>This section is mainly intended for implementors.  Authors writing web pages should generally be served well by the individual property descriptions, and do not need to read this section unless they have a deep-seated urge to understand arcane details of CSS layout.</p>

	<p>To lay out a flexbox and its contents, follow these steps:</p>

	<ol>
		<li value=0>Generate anonymous flexbox items around runs of continguous inline content in the flexbox, as described in the <a href="#flex-items">Flexbox Items</a> section.</li>

		<li>Re-order the flexbox items according to their 'flex-order'.  The items with the lowest (most negative) 'flex-order' values are first in the ordering.  If multiple items share a 'flex-order' value, they're ordered by document order.  This affects the order in which the flexbox items generate boxes in the box-tree, and how the rest of this algorithm deals with the items.</li>

		<li>
			<p>Layout the flexbox items using the shrink-to-fit algorithm.  If the main size of a flexbox item is flexible, treat it as the preferred size of that flexible length.  <strong>Do not apply min/max-width/height constraints to the preferred size of flexible lengths - those constraints are handled elsewhere in this algorithm, and doing so will produce incorrect results.</strong></p>

			<p>Each flexbox item now has a hypothetical main size.</p>
		</li>

		<li>
			<p>If the flexbox is single-line, collect all the flexbox items into a single flexbox line.</p>

			<p>If the flexbox is multi-line, group the flexbox items into multiple lines:</p>

			<ol>
				<li>
					<p>Determine the maximum line length, based on the main size of the flexbox:</p>

					<dt>
						<dt>size doesn't rely on its contents</dt>
						<dd>The maximum line length is main size of the flexbox's content box, constrained by the min and max main size constraints of the flexbox.</dd>

						<dt>''min-content''</dt>
						<dd>The maximum line length is the flexbox's minimum main size.</dd>

						<dt>''max-content''</dt>
						<dd>The maximum line length is infinity, constrained by the min and max main size constraints of the flexbox.</dd>

						<dt>''fit-content''</dt>
						<dd>The maximum line length is the greater of the flexbox's min size constraint and the smaller of the flexbox's max size constraint and the available space.</dd>
					</dt>
				</li>

				<li>Collect as many consecutive flexbox items as possible, starting from the first item, while keeping the sum of their main size smaller than the flexbox's available space.  If a flexbox item is sized with a flexible length, then for the purpose of this step, clamp the item's size between its minimum and maximum main sizes.  The items so collected form a single flexbox line.</li>

				<li>Repeat the previous step, starting each time from the first flexbox item not yet collected into a flexbox line, until all flexbox items have been collected into flexbox lines.</li>
			</ol>

			<p class='issue'>Define "size doesn't rely on its contents". This should be any &lt;length>, a &lt;percentage> that can be resolved, or ''fill-available''.</p>
		</li>

		<li>Find the actual main size of the flexbox.  If the flexbox's main size doesn't rely on its contents, it's actual main size is calculated per the appropriate rules.  Otherwise, its main size is the length of its longest line, calculated by summing the main sizes of the margin boxes of each flexbox item in the line, constrained by the flexbox's min and max main size constraints.</li>

		<li>For each flexbox line, <i>resolve the flexible lengths</i> of the items contained within it.  All flexbox items now have a final main size.  Update each item's hypothetical cross size based on this main size.</li>

		<li>For each flexbox line, align the flexbox items per 'flex-pack'.  The leftover free-space for each line is calculated by subtracting the sum of the main sizes of the flexbox items on the line from the main size of the flexbox's content box.</li>

		<li>Calculate the cross size of each flexbox line.  For each flexbox line:
			
			<ol>
				<li>If the flexbox is single-line and has a definite cross size, the single flexbox line's cross size is the cross size of the flexbox's content box.  End this step of the algorithm.</li>

				<li>Collect all the flexbox items with a 'flex-item-align' of ''start'', ''end'', ''center'', or ''stretch'', or a value of ''baseline'' and a cross axis parallel to their inline axis, and find the maximum of the cross sizes of their margin boxes.</li>

				<li>Collect all the flexbox items with a 'flex-item-align' of ''baseline'' and a cross axis perpendicular to their inline axis.  Find the maximum of the distances from their baseline to the cross-start edge of their margin box, and the maximum of the distances from their baseline to the cross-end edge of their margin box.  Sum these two values.</li>

				<li>The cross size of the flexbox line is the larger of the numbers found in the previous two steps.</li>
			</ol>

			<p>If the flexbox doesn't have a definite cross size, the cross size of its content box is the sum of the cross sizes of all of its lines.</p>
		</li>

		<li>Determine the final cross size of each flexbox item.  For each flexbox item, if it has ''flex-item-align:stretch'', its final cross size is the cross size of its flexbox line.  For all other flexbox items, its final cross size is its hypothetical cross size.</li>

		<li>For each flexbox line, align the flexbox items per 'flex-align'.</li>

		<li>Align the flexbox lines per 'flex-item-align'.  The leftover free-space is calculated by subtracting the sum of the flexbox line's cross sizes from the cross size of the flexbox's content box.</li>
	</ol>

	<p>To <dfn>resolve the flexible lengths</dfn> of the items within a flexbox line:</p>

	<div class='issue'>
		<p>Alex suggests that the following should work more simply:</p>
		<ol>
			<li>distribute space
			<li>fix max violations
			<li>distribute space
			<li>fix min violations. items with violation lose flexibility.
			<li>repeat until there are no more violations
		</ol>
		<p>I need to think on this and ensure it won't give suboptimal results in some cases.</p>
	</div>

	<ol>
		<li>If this is the first time this step is reached in the current invocation of this algorithm, <i>distribute the free space</i> in the flexbox line, then <i>fix max size violations</i>, then <i>fix min size violations</i>.</li>

		<li>If the current set of items violating a min size constraint is different from the set in the previous iteration, remove the marks denoting any element as being in violation of a max size constraint, <i>distribute the free space</i>, then <i>fix max size violations</i>.</li>

		<li>If the current set of items violating a max size constraint is different from the set in the previous iteration, remove the marks denoting any element as being in violation of a min size constraint, <i>distribute the free space</i>, then <i>fix min size violations</i>.</li>

		<li>If either of the previous two steps changed the set of items violating their constraints, restart this algorithm.

		<li>Otherwise, the used value of the main size property of every flexible item is the item's preferred size.</li>
	</ol>

	<p class='issue'>I'm pretty sure the previous algorithm is guaranteed to terminate.  I'm not absolutely certain, though.  Help?  (It's clear that in practice, it will almost always terminate in one or two iterations.)</p>

	<p>To <dfn>distribute the free space</dfn> in a flexbox line:</p>

	<ol>
		<li>If the preferred size of a flexible length was changed from a previous invocation of this algorithm, reset it to its specified value.</li>

		<li>Find the available free space.  Sum the main sizes of the margin boxes of every flexbox item in the line, treating flexible lengths as their preferred size, and then subtract that from the main size of the flexbox's content box.  This value is the available free space.  It may be zero, positive, or negative.</li>

		<li>
			<dt>If the available free space is zero:</dt>
			<dd>Do nothing.</dd>

			<dt>If the available free space is positive:</dt>
			<dd>Calculate the total flexibility by summing the positive flexibility of every flexible length in the line.  For each flexible length, increment its preferred size by a fraction of the available free space equal to its positive flexibility divided by the total flexibility.</dd>

			<dt>If the available free space is negative:</dt>
			<dd>Calculate the total flexibility by summing the negative flexibility of every flexible length in the line.  For each flexible length, increment its preferred size by a fraction of the available free space equal to its negative flexibility divided by the total flexibility. <span class='note'>Note: due to the signs involved, incrementing will decrease the preferred size.)</span></dd>
		</li>
	</ol>

	<p>To <dfn title="fix max size violations|fix min size violations">fix size constraint violations</dfn> in a flexbox line:</p>

	<ol>
		<li>If none of the items on the line violate their min or max size constraints (as appropriate), exit this algorithm.</li>

		<li>Otherwise, for every item in violation of a min or max size constraint (as appropriate), mark them as being in violation of that constraint.  While an item is so marked, treat it as if it were inflexible, with its main size property set to its min or max size constraint, as appropriate.</li>

		<li><i>Distribute the free space</i>, then restart this algorithm.</li>
	</ol>


<h2 id="pagination">
Page breaks in flexbox</h2>

	<p class="issue">TODO: define how flexbox should break on pages, columns, etc. This may or may not be normative until there is more than one implementation.</p>

	<p>Very roughly:</p>

	<ul>
		<li>Flexboxes can beak across pages between items, between rows of items (in multi-line mode) and inside items, as long as 'break-' property allow that. All 'break-' properties are supported on flexbox, on flexbox items and inside flexbox items.</li>

		<li>Breaking behavior of a single-line vertical flexbox should be identical to a block in normal flow where children have same sizes and positions (e.g. explicitly set to match computed values in flexbox), same content and same breaking properties. <span class="issue">This is good goal or guidance, but not necessarily good normative definition. Get specific.</span> </li>

		<li>Breaking behavior of a horizontal single-line flexbox should be similar (not necessarily identical) to that of a single-row table with same sizing.</li>

		<li>In horizontal flexbox, a forced break within an items causes subsequent content of that item to go to next container, but it doesn't affect sibling items or their content.</li>

		<li>In horizontal multi-line flexbox, values of 'break-before' and 'break-after' for each line are computed from combinatoin of properties on children that fit in that line (or would have fit, given available width and infinite height)</li>
	</ul>

	<p class="issue">TODO: define breaking of vertical multi-line flexbox</p>

	<p class="issue">TODO: add more detail: how breaking affect sizing (for broken boxes and boxes after the break) and alignment</p>


<h2 id="conformance">
Conformance</h2>

<h3 id="conventions">
Document conventions</h3>

  <p>Conformance requirements are expressed with a combination of
  descriptive assertions and RFC 2119 terminology. The key words “MUST”,
  “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”,
  “RECOMMENDED”, “MAY”, and “OPTIONAL” in the normative parts of this
  document are to be interpreted as described in RFC 2119.
  However, for readability, these words do not appear in all uppercase
  letters in this specification.
  
  <p>All of the text of this specification is normative except sections
  explicitly marked as non-normative, examples, and notes. [[!RFC2119]]</p>
  
  <p>Examples in this specification are introduced with the words “for example”
  or are set apart from the normative text with <code>class="example"</code>,
  like this:
  
  <div class="example">
    <p>This is an example of an informative example.</p>
  </div>
  
  <p>Informative notes begin with the word “Note” and are set apart from the
  normative text with <code>class="note"</code>, like this:
  
  <p class="note">Note, this is an informative note.</p>

<h3 id="conformance-classes">
Conformance classes</h3>

  <p>Conformance to CSS Flexbox Layout Module
  is defined for three conformance classes:
  <dl>
    <dt><dfn title="style sheet!!as conformance class">style sheet</dfn>
      <dd>A <a href="http://www.w3.org/TR/CSS21/conform.html#style-sheet">CSS
      style sheet</a>.
    <dt><dfn>renderer</dfn></dt>
      <dd>A <a href="http://www.w3.org/TR/CSS21/conform.html#user-agent">UA</a>
      that interprets the semantics of a style sheet and renders
      documents that use them.
    <dt><dfn id="authoring-tool">authoring tool</dfn></dt>
      <dd>A <a href="http://www.w3.org/TR/CSS21/conform.html#user-agent">UA</a>
      that writes a style sheet.
  </dl>
  
  <p>A style sheet is conformant to CSS Flexbox Layout Module
  if all of its statements that use syntax defined in this module are valid
  according to the generic CSS grammar and the individual grammars of each
  feature defined in this module.
  
  <p>A renderer is conformant to CSS Flexbox Layout Module
  if, in addition to interpreting the style sheet as defined by the
  appropriate specifications, it supports all the features defined
  by CSS Flexbox Layout Module by parsing them correctly
  and rendering the document accordingly. However, the inability of a
  UA to correctly render a document due to limitations of the device
  does not make the UA non-conformant. (For example, a UA is not
  required to render color on a monochrome monitor.)
  
  <p>An authoring tool is conformant to CSS Flexbox Layout Module
  if it writes style sheets that are syntactically correct according to the
  generic CSS grammar and the individual grammars of each feature in
  this module, and meet all other conformance requirements of style sheets
  as described in this module.

<h3 id="partial">
Partial implementations</h3>

  <p>So that authors can exploit the forward-compatible parsing rules to
  assign fallback values, CSS renderers <strong>must</strong>
  treat as invalid (and <a href="http://www.w3.org/TR/CSS21/conform.html#ignore">ignore
  as appropriate</a>) any at-rules, properties, property values, keywords,
  and other syntactic constructs for which they have no usable level of
  support. In particular, user agents <strong>must not</strong> selectively
  ignore unsupported component values and honor supported values in a single
  multi-value property declaration: if any value is considered invalid
  (as unsupported values must be), CSS requires that the entire declaration
  be ignored.</p>
  
<h3 id="experimental">
Experimental implementations</h3>

  <p>To avoid clashes with future CSS features, the CSS2.1 specification
  reserves a <a href="http://www.w3.org/TR/CSS21/syndata.html#vendor-keywords">prefixed
  syntax</a> for proprietary and experimental extensions to CSS.
  
  <p>Prior to a specification reaching the Candidate Recommendation stage
  in the W3C process, all implementations of a CSS feature are considered
  experimental. The CSS Working Group recommends that implementations
  use a vendor-prefixed syntax for such features, including those in
  W3C Working Drafts. This avoids incompatibilities with future changes
  in the draft.
  </p>
 
<h3 id="testing">
Non-experimental implementations</h3>

  <p>Once a specification reaches the Candidate Recommendation stage,
  non-experimental implementations are possible, and implementors should
  release an unprefixed implementation of any CR-level feature they
  can demonstrate to be correctly implemented according to spec.
  
  <p>To establish and maintain the interoperability of CSS across
  implementations, the CSS Working Group requests that non-experimental
  CSS renderers submit an implementation report (and, if necessary, the
  testcases used for that implementation report) to the W3C before
  releasing an unprefixed implementation of any CSS features. Testcases
  submitted to W3C are subject to review and correction by the CSS
  Working Group.
  
  <p>Further information on submitting testcases and implementation reports
  can be found from on the CSS Working Group's website at
  <a href="http://www.w3.org/Style/CSS/Test/">http://www.w3.org/Style/CSS/Test/</a>.
  Questions should be directed to the
  <a href="http://lists.w3.org/Archives/Public/public-css-testsuite">public-css-testsuite@w3.org</a>
  mailing list.

<h3 id="cr-exit-criteria">
CR exit criteria</h3>

  <p class=issue>[Change or remove the following CR exit criteria if
  the spec is not a module, but, e.g., a Note or a profile. This text was <a
  href="http://www.w3.org/Style/CSS/Tracker/actions/44"> decided on 2008-06-04.</a>]</p>

  <p>
  For this specification to be advanced to Proposed Recommendation,
  there must be at least two independent, interoperable implementations
  of each feature. Each feature may be implemented by a different set of
  products, there is no requirement that all features be implemented by
  a single product. For the purposes of this criterion, we define the
  following terms:
  
  <dl>
    <dt>independent <dd>each implementation must be developed by a
    different party and cannot share, reuse, or derive from code
    used by another qualifying implementation. Sections of code that
    have no bearing on the implementation of this specification are
    exempt from this requirement.
  
    <dt>interoperable <dd>passing the respective test case(s) in the
    official CSS test suite, or, if the implementation is not a Web
    browser, an equivalent test. Every relevant test in the test
    suite should have an equivalent test created if such a user
    agent (UA) is to be used to claim interoperability. In addition
    if such a UA is to be used to claim interoperability, then there
    must one or more additional UAs which can also pass those
    equivalent tests in the same way for the purpose of
    interoperability. The equivalent tests must be made publicly
    available for the purposes of peer review.
  
    <dt>implementation <dd>a user agent which:
  
    <ol class=inline>
      <li>implements the specification.
  
      <li>is available to the general public. The implementation may
      be a shipping product or other publicly available version
      (i.e., beta version, preview release, or “nightly build”). 
      Non-shipping product releases must have implemented the
      feature(s) for a period of at least one month in order to
      demonstrate stability.
  
      <li>is not experimental (i.e., a version specifically designed
      to pass the test suite and is not intended for normal usage
      going forward).
    </ol>
  </dl>
  
  <p>The specification will remain Candidate Recommendation for at least
  six months.


<hr title="Separator from footer">

<h2 class="no-num" id="acknowledgments">Acknowledgments</h2>

	<p>[This section will contain further acknowledgments.]</p>

	<p>Thanks for feedback from James Elmore and Shinichiro Hamaji.</p>

<h2 class="no-num" id="references">References</h2>

<h3 class="no-num" id="normative">Normative references</h3>
<!--normative-->

<h3 class="no-num" id="informative">Other references</h3>
<!--informative-->

<h2 id="property" class="no-num">Property index</h2>
<!--properties-->

<h2 class="no-num" id="index">Index</h2>
<!--index-->

</body></html>
<!-- Keep this comment at the end of the file
Local variables:
mode: sgml
sgml-declaration:"~/SGML/HTML4.decl"
sgml-default-doctype-name:"html"
sgml-minimize-attributes:t
sgml-nofill-elements:("pre" "style" "br")
sgml-live-element-indicator:t
sgml-omittag:nil
sgml-shorttag:nil
sgml-namecase-general:t
sgml-general-insert-case:lower
sgml-always-quote-attributes:t
sgml-indent-step:nil
sgml-indent-data:t
sgml-parent-document:nil
sgml-exposed-tags:nil
sgml-local-catalogs:nil
sgml-local-ecat-files:nil
End:
-->