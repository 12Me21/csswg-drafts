<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN">

<html>
 <head>
  <title>CSS Flexible Box Layout Module</title>
  <link href="../default.css" rel=stylesheet type="text/css">

  <style type="text/css">
	p { margin: .5em 0; }
	dd > p { text-indent: 0; }
	a > b { font-weight: normal; color: #800; }
</style>
  <link href="http://www.w3.org/StyleSheets/TR/W3C-ED" rel=stylesheet
  type="text/css">
  <!-- TODO: change before build -->

 <body>
  <div class=head> <!--begin-logo-->
   <p><a href="http://www.w3.org/"><img alt=W3C height=48
    src="http://www.w3.org/Icons/w3c_home" width=72></a> <!--end-logo-->

   <h1 id=head-box-flexible>CSS Flexible Box Layout Module</h1>

   <h2 class="no-num no-toc" id=w3c-working>Editor's Draft, 15 June 2011</h2>

   <dl>
    <dt>This version:

    <dd><!-- <a href="http://www.w3.org/TR/2011/WD-css3-flexbox-20110615/">http://www.w3.org/TR/2011/WD-css3-flexbox-20110615/</a></dd> -->
     <a
     href="http://dev.w3.org/csswg/css3-flexbox/">http://dev.w3.org/csswg/css3-flexbox/</a>
     

    <dt>Latest version:

    <dd><a
     href="http://www.w3.org/TR/css3-flexbox/">http://www.w3.org/TR/css3-flexbox/</a>
     

    <dt>Previous version:

    <dd><a
     href="http://www.w3.org/TR/2009/WD-css3-flexbox-20090723/">http://www.w3.org/TR/2009/WD-css3-flexbox-20090723/</a>
     

    <dt>Editors:

    <dd>Tab Atkins Jr. <a
     href="mailto:jackalmage@gmail.com">jackalmage@gmail.com</a>

    <dd>Alex Mogilevsky <a
     href="mailto:alexmog@microsoft.com">alexmog@microsoft.com</a>

    <dd>L. David Baron, Mozilla Corporation, <a
     href="mailto:dbaron@dbaron.org">dbaron@dbaron.org</a>

    <dt>Authors and former editors:

    <dd>Neil Deakin, Mozilla Corporation, <a
     href="mailto:enndeakin@gmail.com">enndeakin@gmail.com</a>

    <dd>Ian Hickson, formerly of Opera Software, <a
     href="mailto:ian@hixie.ch">ian@hixie.ch</a>

    <dd>David Hyatt, Apple, <a
     href="mailto:hyatt@apple.com">hyatt@apple.com</a>
   </dl>
   <!--begin-copyright-->
   <p class=copyright><a
    href="http://www.w3.org/Consortium/Legal/ipr-notice#Copyright"
    rel=license>Copyright</a> &copy; 2011 <a
    href="http://www.w3.org/"><acronym title="World Wide Web
    Consortium">W3C</acronym></a><sup>&reg;</sup> (<a
    href="http://www.csail.mit.edu/"><acronym title="Massachusetts Institute
    of Technology">MIT</acronym></a>, <a href="http://www.ercim.eu/"><acronym
    title="European Research Consortium for Informatics and
    Mathematics">ERCIM</acronym></a>, <a
    href="http://www.keio.ac.jp/">Keio</a>), All Rights Reserved. W3C <a
    href="http://www.w3.org/Consortium/Legal/ipr-notice#Legal_Disclaimer">liability</a>,
    <a
    href="http://www.w3.org/Consortium/Legal/ipr-notice#W3C_Trademarks">trademark</a>
    and <a
    href="http://www.w3.org/Consortium/Legal/copyright-documents">document
    use</a> rules apply.</p>
   <!--end-copyright-->
   <hr title="Separator for header">
  </div>

  <h2 class="no-num no-toc" id=abstract>Abstract</h2>

  <p>The draft describes a CSS box model optimized for interface design. It
   provides an additional layout system alongside the ones already in CSS. <a
   href="#CSS21" rel=biblioentry>[CSS21]<!--{{!CSS21}}--></a> In this new box
   model, the children of a box are laid out either horizontally or
   vertically, and unused space can be assigned to a particular child or
   distributed among the children by assignment of "flex" to the children
   that should expand. Nesting of these boxes (horizontal inside vertical, or
   vertical inside horizontal) can be used to build layouts in two
   dimensions. This model is based on the box model in the XUL user-interface
   language used for the user interface of many Mozilla-based applications
   (such as Firefox).

  <h2 class="no-num no-toc" id=status>Status of this document</h2>
  <!--begin-status-->

  <p>This is a public copy of the editors' draft. It is provided for
   discussion only and may change at any moment. Its publication here does
   not imply endorsement of its contents by W3C. Don't cite this document
   other than as work in progress.

  <p>The (<a
   href="http://lists.w3.org/Archives/Public/www-style/">archived</a>) public
   mailing list <a
   href="mailto:www-style@w3.org?Subject=%5Bcss3-flexbox%5D%20PUT%20SUBJECT%20HERE">
   www-style@w3.org</a> (see <a
   href="http://www.w3.org/Mail/Request">instructions</a>) is preferred for
   discussion of this specification. When sending e-mail, please put the text
   &#8220;css3-flexbox&#8221; in the subject, preferably like this:
   &#8220;[<!---->css3-flexbox<!---->] <em>&hellip;summary of
   comment&hellip;</em>&#8221;

  <p>This document was produced by the <a href="/Style/CSS/members">CSS
   Working Group</a> (part of the <a href="/Style/">Style Activity</a>).

  <p>This document was produced by a group operating under the <a
   href="/Consortium/Patent-Policy-20040205/">5 February 2004 W3C Patent
   Policy</a>. W3C maintains a <a href="/2004/01/pp-impl/32061/status"
   rel=disclosure>public list of any patent disclosures</a> made in
   connection with the deliverables of the group; that page also includes
   instructions for disclosing a patent. An individual who has actual
   knowledge of a patent which the individual believes contains <a
   href="/Consortium/Patent-Policy-20040205/#def-essential">Essential
   Claim(s)</a> must disclose the information in accordance with <a
   href="/Consortium/Patent-Policy-20040205/#sec-Disclosure">section 6 of the
   W3C Patent Policy</a>.</p>
  <!--end-status-->

  <h2 class="no-num no-toc" id=table>Table of contents</h2>
  <!--begin-toc-->

  <ul class=toc>
   <li><a href="#overview"><span class=secno>1. </span> Overview</a>

   <li><a href="#display-flexbox"><span class=secno>2. </span> New values for
    &lsquo;<code class=property>display</code>&rsquo; property</a>

   <li><a href="#flex-direction"><span class=secno>3. </span> Flexbox
    Direction: the &lsquo;<code class=property>flex-direction</code>&rsquo;
    property</a>

   <li><a href="#flex-order"><span class=secno>4. </span> Display Order: the
    &lsquo;<code class=property>flex-order</code>&rsquo; property</a>

   <li><a href="#flexibility"><span class=secno>5. </span> Flexibility</a>
    <ul class=toc>
     <li><a href="#resolving-flexible-lengths"><span class=secno>5.1. </span>
      Resolving Flexible Lengths</a>

     <li><a href="#fraction-unit"><span class=secno>5.2. </span> The
      &lsquo;<code class=css>fr</code>&rsquo; unit</a>

     <li><a href="#flex-function"><span class=secno>5.3. </span> The
      &lsquo;<code class=css>flex()</code>&rsquo; function</a>
    </ul>

   <li><a href="#flex-pack"><span class=secno>6. </span> The &lsquo;<code
    class=property>flex-pack</code>&rsquo; property</a>

   <li><a href="#flex-align"><span class=secno>7. </span> The &lsquo;<code
    class=property>flex-align</code>&rsquo; property</a>

   <li><a href="#free-space-algorithm"><span class=secno>8. </span> Free
    Space Calculation and Distribution</a>
    <ul class=toc>
     <li><a href="#initial-computation"><span class=secno>8.1. </span>
      Initial Computation</a>

     <li><a href="#first-distribution-round"><span class=secno>8.2. </span>
      First Distribution Round</a>

     <li><a href="#second-distribution-round"><span class=secno>8.3. </span>
      Second Distribution Round</a>

     <li><a href="#intermediate-computation"><span class=secno>8.4. </span>
      Intermediate Computation</a>

     <li><a href="#third-distribution-round"><span class=secno>8.5. </span>
      Third Distribution Round</a>

     <li><a href="#free-space-allocation-algorithm"><span class=secno>8.6.
      </span> Free Space Allocation Algorithm</a>
    </ul>

   <li><a href="#layout-interface"><span class=secno>9. </span> Interface
    With Other Layout Algorithms</a>

   <li class=no-num><a href="#acknowledgments">Acknowledgments</a>

   <li class=no-num><a href="#references">References</a>
    <ul class=toc>
     <li class=no-num><a href="#normative">Normative references</a>
    </ul>

   <li class=no-num><a href="#index">Index</a>

   <li class=no-num><a href="#property">Property index</a>
  </ul>
  <!--end-toc-->
  <!-- ====================================================================== -->

  <h2 id=overview><span class=secno>1. </span> Overview</h2>

  <p>CSS 2.1 defined four layout modes, algorithms which determine the size
   and position of boxes based on their relationships with their sibling and
   ancestor boxes: block layout, designed for laying out documents and simple
   applications, inline layout, designed for laying out text, table layout,
   designed for laying out information in a tabular format, and positioned
   layout, designed for very explicit positioning without much regard for
   other elements in the document. This module introduces a new layout mode,
   flexbox layout, which is designed for laying out more complex applications
   and webpages.

  <p>Flexbox layout is superficially similar to block layout. It lacks many
   of the more complex text or document-formatting properties that can be
   used in block layout, such as &lsquo;<code
   class=property>float</code>&rsquo; and &lsquo;<code
   class=property>columns</code>&rsquo;, but in return it gains more simple
   and powerful tools for aligning its contents in ways that webapps and
   complex web pages often need. The contents of a flexbox can be laid out in
   any direction, can have their order swapped around dynamically, and can
   "flex" their sizes and positions to respond to the available space.

  <p>Similar to other layout modes such as table layout, a flexbox acts like
   a block when placed into other layout modes. Inline flexboxes can also be
   declared, which act like inline-blocks.

  <p>Block-level and atomic inline-level children of the flexbox are referred
   to as <dfn id=flexbox-item>flexbox item</dfn>s in this specification.
   Inline children are wrapped in anonymous blocks, and these anonymous
   blocks are also <a href="#flexbox-item"><i>flexbox item</i></a>s.

  <div class=example>
   <p>For example:</p>

   <pre class=html>
&lt;p style="width: 400px; display: flexbox;">
	&lt;button style="width: 200px;">Child 1&lt;/button>
	&lt;button style="width: 100px;">Child 2&lt;/button>
&lt;/p>
		</pre>

   <p>In this example, the first button is 200 pixels wide and the second
    button is 100 pixels wide. As the flexbox is 400 pixels wide, there is
    extra space left over which is placed after the two buttons but inside
    the flexbox. The placement of this extra space may be modified using the
    various flex properties described in the next sections. Neither the
    height of the buttons nor the height of the flexbox are specified, so the
    height is computed intrinsically from the content. In this case, the
    buttons will be the height needed to display the label and button border,
    and the flexbox will also be this height plus any margins around the
    buttons.</p>
  </div>
  <!-- ====================================================================== -->

  <h2 id=display-flexbox><span class=secno>2. </span> New values for
   &lsquo;<code class=property>display</code>&rsquo; property</h2>

  <table class=propdef>
   <tbody>
    <tr>
     <th>Name:

     <td>display

    <tr>
     <th>New value:

     <td>flexbox | inline-flexbox
  </table>

  <p class=issue>ISSUE: The proliferation of "inline-*" display values is
   untenable and restrictive. Table cells should be able to use the flexbox
   layout mode for their contents, for example, rather than being forced to
   use block layout. It's expected that this will be fixed by splitting the
   &lsquo;<code class=property>display</code>&rsquo; property into
   subproperties controlling how the element formats its contents
   (&lsquo;<code class=property>display-inside</code>&rsquo;) and how it
   reacts to its surroundings (&lsquo;<code
   class=property>display-outside</code>&rsquo;). Once that occurs, this
   section will instead describe a single new &lsquo;<code
   class=property>display-inside</code>&rsquo; value that triggers flexbox
   layout.

  <p>You can declare that an element is a flexbox, and thus should use
   flexbox layout, by setting the &lsquo;<code
   class=property>display</code>&rsquo; property on the element to the value
   &lsquo;<code class=css>flexbox</code>&rsquo;.

  <p>The special behaviors of a flexbox, such as flexing and reordering
   children, only apply to <a href="#flexbox-item"><i>flexbox item</i></a>s.
   All block-level or atomic inline-level children of the flexbox are <a
   href="#flexbox-item"><i>flexbox item</i></a>s. Contiguous runs of
   non-replaced inline children are wrapped in an anonymous block-level box,
   which is itself a <a href="#flexbox-item"><i>flexbox item</i></a>.

  <p class=note>Note that out-of-flow elements like absolutely positioned
   elements leave behind a &lsquo;<code
   class=property>placeholder</code>&rsquo; inline element in their original
   position in the document <span class=issue>(ISSUE: This will be defined in
   Positioned Layout.)</span> Floats are also out-of-flow, but children of
   flexboxes can't float. <span class=issue>(ISSUE: Should this restriction
   exist, or should I just wrap floats in the anonymous boxes like other
   inlines?)</span> It is recommended that authors avoid creating inline
   flexbox children, as the anonymous block that is generated can't be
   targetted and controlled by the various flexbox properties.

  <div class=issue>
   <p>ISSUE: Need to reword how flexbox items are determined. The algorithm
    clearly operates on the box tree, as it creates anonymous boxes, but it
    needs to operate kinda on elements. In particular, an inline child
    element that contains a block should be wrapped in a single flexbox item,
    rather than wrapping the pre-block and post-block parts in separate
    anonymous blocks and then the block inside being a flexbot item on its
    own.</p>

   <p>Whatever wording is used here should be shared with the table-fixup
    algorithm, because it's essentially the identical problem. Perhaps we can
    have it operate on the element-tree and create anonymous pseudo-elements,
    similar to how ::outside would work? Pseudoelements don't interfere with
    normal selectors, so this would let us insert wrappers that work
    correctly without screwing up the way selectors work.</p>
  </div>

  <p>A flexbox item creates a new BFC. The margins of a flexbox item do not
   collapse with any other margin. Flexboxes "shrinkwrap" their contents by
   default (when their &lsquo;<code class=property>width</code>&rsquo; or
   &lsquo;<code class=property>height</code>&rsquo; properties are
   &lsquo;<code class=css>auto</code>&rsquo;), similar to tables or floats.

  <p>Setting &lsquo;<code class=css>display:flexbox</code>&rsquo; on an
   element forces it to use a new layout algorithm, and so some properties
   that were designed with the assumption of block layout don't make sense in
   a flexbox context. In particular:

  <ul>
   <li>all of the &lsquo;<code class=css>column-*</code>&rsquo; properties in
    the Multicol module compute to their initial values on a flexbox
    (&lsquo;<code class=property>break-before</code>&rsquo;, &lsquo;<code
    class=property>break-inside</code>&rsquo;, and &lsquo;<code
    class=property>break-after</code>&rsquo; are still valid on a flexbox).

   <li>&lsquo;<code class=property>float</code>&rsquo; and &lsquo;<code
    class=property>clear</code>&rsquo; compute to their initial values on a
    flexbox item

   <li>&lsquo;<code class=property>vertical-align</code>&rsquo; has no effect
    on a flexbox item

   <li class=issue>[Others?]
  </ul>
  <!-- ====================================================================== -->

  <h2 id=flex-direction><span class=secno>3. </span> Flexbox Direction: the
   &lsquo;<a href="#flex-direction0"><code
   class=property>flex-direction</code></a>&rsquo; property</h2>

  <table class=propdef>
   <tbody>
    <tr>
     <th>Name:

     <td><dfn id=flex-direction0>flex-direction</dfn>

    <tr>
     <th>Values:

     <td>lr | rl | tb | bt | inline | inline-reverse | block | block-reverse

    <tr>
     <th>Initial:

     <td>inline

    <tr>
     <th>Applies To:

     <td>flexboxes

    <tr>
     <th>Inherited:

     <td>no

    <tr>
     <th>Computed Value:

     <td>lr | rl | tb | bt (See text)

    <tr>
     <th>Media:

     <td>visual
  </table>

  <p>The &lsquo;<code class=property>flexbox-direction</code>&rsquo; property
   specifies how <a href="#flexbox-item"><i>flexbox item</i></a>s are placed
   in the flexbox. A value of &lsquo;<code class=css>lr</code>&rsquo; means
   that the first flexbox item is placed against the left edge of the
   flexbox, with later children placed immediately to the right of the
   preceding flexbox item. A value of &lsquo;<code class=css>rl</code>&rsquo;
   is the same, but with the initial flexbox item placed against the right
   edge of the flexbox and later children placed to the left. Both of these
   values mean that the flexbox is a <dfn id=horizontal-flexbox>horizontal
   flexbox</dfn>. A value of &lsquo;<code class=css>tb</code>&rsquo; means
   that the first flexbox child is placed against the top edge of the
   flexbox, with later children placed immediately below it, while
   &lsquo;<code class=css>bt</code>&rsquo; means the first child is placed
   against the bottom edge of the flexbox, with later children placed
   immediately above it. Both of these values mean that the flexbox is a <dfn
   id=vertical-flexbox>vertical flexbox</dfn>.

  <p>A value of &lsquo;<code class=css>inline</code>&rsquo; computes to one
   of &lsquo;<code class=css>lr</code>&rsquo;, &lsquo;<code
   class=css>rl</code>&rsquo;, &lsquo;<code class=css>tb</code>&rsquo;, or
   &lsquo;<code class=css>bt</code>&rsquo;, depending on the direction and
   block-flow of the flexbox: if the start side of the flexbox is the left
   side, &lsquo;<code class=css>inline</code>&rsquo; must compute to
   &lsquo;<code class=css>lr</code>&rsquo;; similarly, if the start side of
   the flexbox is the right, top, or bottom side, &lsquo;<code
   class=css>inline</code>&rsquo; must compute to &lsquo;<code
   class=css>rl</code>&rsquo;, &lsquo;<code class=css>tb</code>&rsquo;, or
   &lsquo;<code class=css>bt</code>&rsquo; respectively. &lsquo;<code
   class=css>inline-reverse</code>&rsquo;, &lsquo;<code
   class=css>block</code>&rsquo;, and &lsquo;<code
   class=css>block-reverse</code>&rsquo; determine their computed value
   identically to &lsquo;<code class=css>inline</code>&rsquo;, but use the
   location of the end side, before side, and after side of the flexbox,
   respectively.

  <div class=example>
   <p>A vertical flexbox can be used to emulate the functionality of HTML's
    &lsquo;<code class=css>&lt;center></code>&rsquo; element:</p>

   <pre>
&lt;div>
	&lt;span>foo foo foo foo&lt;/span>
	&lt;span>bar bar&lt;br>bar bar&lt;/span>
	&lt;span>foo foo foo foo foo foo foo foo foo foo foo foo&lt;/span>
&lt;/div>
&lt;style>
	div {
		display: flexbox;
		flex-direction: tb;
		width: 200px;
	}
	span {
		margin: 0 auto;
	}
&lt;/style>
		</pre>

   <p><img alt="" src="images/basic-vertical-flexbox.png"></p>
  </div>

  <p>In the rest of this specification, the direction in which new <a
   href="#flexbox-item"><i>flexbox item</i></a>s are laid out will be
   referred to as the <dfn id=measure-direction>measure direction</dfn> (if a
   precise direction is required) or the <dfn id=measure-axis>measure
   axis</dfn> (if only the axis orientiation is required).

  <p>The axis perpendicular to the &lsquo;<a href="#measure-axis"><code
   class=css>measure axis</code></a>&rsquo; will be refered to as the <dfn
   id=length-axis>length axis</dfn>, with the <dfn id=length-direction>length
   direction</dfn> being either a line extending from the &lsquo;<code
   class=css>before</code>&rsquo; side of the flexbox to the &lsquo;<code
   class=css>after</code>&rsquo; side, or from the &lsquo;<a
   href="#flex-pack-start"><code class=css>start</code></a>&rsquo; side of
   the flexbox to the &lsquo;<a href="#flex-pack-end"><code
   class=css>end</code></a>&rsquo; side, whichever would produce a direction
   parallel to the &lsquo;<a href="#length-axis"><code class=css>length
   axis</code></a>&rsquo;.

  <p>Similarly, the <dfn id=inner-measure>inner measure</dfn> is the width of
   the flexbox item in a horizontal flexbox, or the height in a vertical
   flexbox. The <dfn id=inner-length>inner length</dfn> is the height of the
   flexbox item in a horizontal flexbox, or the width in a vertical flexbox.</p>
  <!-- ====================================================================== -->

  <h2 id=flex-order><span class=secno>4. </span> Display Order: the &lsquo;<a
   href="#flex-order0"><code class=property>flex-order</code></a>&rsquo;
   property</h2>

  <p><a href="#flexbox-item"><i>flexbox item</i></a>s are, by default,
   displayed and laid out in the same order as they appear in the source
   document. The &lsquo;<a href="#flex-order0"><code
   class=property>flex-order</code></a>&rsquo; property may be used to change
   this ordering.

  <table class=propdef>
   <tbody>
    <tr>
     <th>Name:

     <td><dfn id=flex-order0>flex-order</dfn>

    <tr>
     <th>Value:

     <td>&lt;integer>

    <tr>
     <th>Initial:

     <td>1

    <tr>
     <th>Applies to:

     <td><a href="#flexbox-item"><i>flexbox item</i></a>s

    <tr>
     <th>Inherited:

     <td>no

    <tr>
     <th>Computed value:

     <td>specified value

    <tr>
     <th>Media:

     <td>visual
  </table>

  <p class=issue>Maybe name this &lsquo;<code
   class=property>flex-index</code>&rsquo; instead, to be consistent with
   &lsquo;<code class=property>z-index</code>&rsquo;.

  <p><a href="#flexbox-item"><i>flexbox item</i></a>s may be assigned to
   ordinal groups using the &lsquo;<a href="#flex-order0"><code
   class=property>flex-order</code></a>&rsquo; property. This property is an
   integer with an initial value of 1.

  <p>Ordinal groups control the order in which <a
   href="#flexbox-item"><i>flexbox item</i></a>s appear. A flexbox will lay
   out its children starting from the lowest numbered ordinal group and going
   up. Elements with the same ordinal group are laid out in the order they
   appear in the source document.

  <div class=example>
   <p>This example shows how ordinal groups might be used.</p>

   <pre><code>
	div { display: flexbox; }
	#span1 { flex-order: 2; }
	#span3 { flex-order: 2; }
	#span4 { flex-order: 1; }

	&lt;div>
		&lt;span id="span1">span1&lt;/span>
		&lt;span id="span2">span2&lt;/span>
		&lt;span id="span3">span3&lt;/span>
		&lt;span id="span4">span4&lt;/span>
	&lt;/div></code></pre>

   <p>The first ordinal group, 1, contains span2 and span4. As span2 does not
    specify an ordinal group, it will default to 1. The elements will be
    displayed in document order, so span2 will be displayed before span4. The
    second ordinal group, 2, contains the remaining two spans. The resulting
    display order will be:</p>

   <pre><code>span2 span4 span1 span3</code></pre>
  </div>
  <!-- ====================================================================== -->

  <h2 id=flexibility><span class=secno>5. </span> Flexibility</h2>

  <p>The defining aspect of flexbox layout is the ability to make various
   lengths of the <a href="#flexbox-item"><i>flexbox item</i></a>s flexible.
   The &lsquo;<code class=property>width</code>&rsquo;, &lsquo;<code
   class=property>height</code>&rsquo;, &lsquo;<code
   class=property>padding</code>&rsquo;, and &lsquo;<code
   class=property>margin</code>&rsquo; properties of a <a
   href="#flexbox-item"><i>flexbox item</i></a> can all be made flexible.
   Paddings and margins are made flexible by setting their value to
   &lsquo;<code class=css>auto</code>&rsquo;, while the width and height of a
   box can be controlled more precisely with the &lsquo;<code
   class=css>fr</code>&rsquo; unit or the &lsquo;<code
   class=css>flex()</code>&rsquo; function, both defined below.

  <div class=example>
   <p class=issue>TODO: Examples!</p>
  </div>

  <h3 id=resolving-flexible-lengths><span class=secno>5.1. </span> Resolving
   Flexible Lengths</h3>

  <p>CSS resolves a <i>flexible length</i> into a definite length by first
   collecting all the lengths, flexible or inflexible, that will share some
   space. For example, for a horizontal flexbox, the lengths of the left and
   right margins, left and right borders, left and right paddings, and widths
   of all <a href="#flexbox-item"><i>flexbox item</i></a>s share the width of
   the flexbox itself. Conversely, each <a href="#flexbox-item"><i>flexbox
   item</i></a>&lsquo;<code class=css>s vertical margins, borders, padding,
   and height individually share the height of the flexbox.</code>

  <div class=figure>
   <p class="caption issue">TODO: Diagram showing the relevant lengths in
    each axis.</p>
  </div>

  <p>CSS then sums the <dfn id=preflex-size>preflex size</dfn> of the lengths
   in each set. The <a href="#preflex-size"><i>preflex size</i></a> of an
   inflexible length is just the length itself. The <a
   href="#preflex-size"><i>preflex size</i></a> of a flexible length is its
   <i>preferred size</i>. If the sum of all the <a href="#preflex-size"><i
   title="preflex size">preflex sizes</i></a> is less than the available
   width/height of the flexbox, then the difference is split up among all the
   <i title="flexible length">flexible lengths</i> with <dfn
   id=positive-flexibility>positive flexibility</dfn>, with the space divvied
   up proportionally to the flexibility of each length. If the sum is greater
   than the available width/height, then all the <i title="flexible
   length">flexible lengths</i> with <dfn id=negative-flexibility>negative
   flexibility</dfn> shrink in proportion to their flexibility to try and
   make the sum equal the available width/height.

  <p>The &rsquo;flex-pack' and &lsquo;<a href="#flex-align0"><code
   class=property>flex-align</code></a>&rsquo; properties offer more complex
   control over free-space distribution. The precise details of how free
   space is determined and assigned to flexible lengths is detailed in a
   later chapter.

  <h3 id=fraction-unit><span class=secno>5.2. </span> The &lsquo;<code
   class=css>fr</code>&rsquo; unit</h3>

  <p>The &lsquo;<code class=css>fr</code>&rsquo; unit, defined in the Values
   and Units spec <a href="#CSS3VAL"
   rel=biblioentry>[CSS3VAL]<!--{{!CSS3VAL}}--></a>, can be used to specify a
   flexible length. When the &lsquo;<code class=css>fr</code>&rsquo; unit is
   used, the <i>preferred size</i> of the length is &lsquo;<code
   class=css>0</code>&rsquo;, the <a href="#positive-flexibility"><i>positive
   flexibility</i></a> is equal to the numeric part of the value, and the <a
   href="#negative-flexibility"><i>negative flexibility</i></a> is
   &lsquo;<code class=css>0</code>&rsquo;.

  <h3 id=flex-function><span class=secno>5.3. </span> The &lsquo;<code
   class=css>flex()</code>&rsquo; function</h3>

  <p>The &lsquo;<code class=css>flex()</code>&rsquo; function is used to
   specify the parameters of a <i>flexible length</i>: the <a
   href="#positive-flexibility"><i title="positive
   flexibility">positive</i></a> and <a
   href="#negative-flexibility"><i>negative flexibility</i></a>, and the
   <i>preferred size</i>. The syntax of the &lsquo;<code
   class=css>flex()</code>&rsquo; function is roughly (see following prose
   for a precise description):

  <pre
   class=prod>flex( [ <a href="#positive-flexibility"><i title="positive flexibility">&lt;pos-flex></i></a> || <!--
	--><a href="#negative-flexibility"><i title="negative flexibility">&lt;neg-flex></i></a> || <!--
	--><i title="preferred size">&lt;preferred-size></i> ] )</pre>

  <dl>
   <dt>If the &lsquo;<code class=css>flex()</code>&rsquo; function contains a
    single value:

   <dd>
    <ul>
     <li>If the value is a non-negative number, the <a
      href="#positive-flexibility"><i>positive flexibility</i></a> is set to
      that value, the <a href="#negative-flexibility"><i>negative
      flexibility</i></a> is set to &lsquo;<code class=css>0</code>&rsquo;,
      and the <i>preferred size</i> is set to &lsquo;<code
      class=css>auto</code>&rsquo;.

     <li>Otherwise, if the value is a &lt;length>, a &lt;percentage>, or a
      valid keyword for &lsquo;<code class=property>width</code>&rsquo; or
      &lsquo;<code class=property>height</code>&rsquo;, the <i>preferred
      size</i> is set to that value, the <a
      href="#positive-flexibility"><i>positive flexibility</i></a> is set to
      1, and the <a href="#negative-flexibility"><i>negative
      flexibility</i></a> is set to &lsquo;<code class=css>0</code>&rsquo;.

     <li>Otherwise, the &lsquo;<code class=css>flex()</code>&rsquo; function
      is invalid.
    </ul>

   <dt>If the &lsquo;<code class=css>flex()</code>&rsquo; function contains
    two values:

   <dd>
    <ul>
     <li>If both values are non-negative numbers, the <a
      href="#positive-flexibility"><i>positive flexibility</i></a> is set to
      the first value, the <a href="#negative-flexibility"><i>negative
      flexibility</i></a> is set to the second value, and the <i>preferred
      size</i> is set to &lsquo;<code class=css>auto</code>&rsquo;.

     <li>Otherwise, if one value is a non-negative number and the other is a
      &lt;length>, a &lt;percentage>, or a valid keyword for &lsquo;<code
      class=property>width</code>&rsquo; or &lsquo;<code
      class=property>height</code>&rsquo;, the <a
      href="#positive-flexibility"><i>positive flexibility</i></a> is set to
      the number, the <a href="#negative-flexibility"><i>negative
      flexibility</i></a> is set to &lsquo;<code class=css>0</code>&rsquo;,
      and the <i>preferred size</i> is set to the &lt;length> or
      &lt;percentage>.

     <li>Otherwise, the &lsquo;<code class=css>flex()</code>&rsquo; function
      is invalid.
    </ul>

   <dt>If the &lsquo;<code class=css>flex()</code>&rsquo; function contains
    three values:

   <dd>
    <ul>
     <li>If the first two values are non-negative numbers and the third value
      is &lsquo;<code class=css>0</code>&rsquo;, the <a
      href="#positive-flexibility"><i>positive flexibility</i></a> is set to
      the first value, the <a href="#negative-flexibility"><i>negative
      flexibility</i></a> is set to the second value, and the <i>preferred
      size</i> is set to &lsquo;<code class=css>0px</code>&rsquo;.

     <li>Otherwise, If two of the values are non-negative numbers, and the
      other is a &lt;length> (with a unit suffix), a &lt;percentage>, or a
      valid keyword for &lsquo;<code class=property>width</code>&rsquo; or
      &lsquo;<code class=property>height</code>&rsquo;, the <a
      href="#positive-flexibility"><i>positive flexibility</i></a> is set to
      the first number, the <a href="#negative-flexibility"><i>negative
      flexibility</i></a> is set to the second number, and the <i>preferred
      size</i> is set to the other value.

     <li>Otherwise, the &lsquo;<code class=css>flex()</code>&rsquo; function
      is invalid.
    </ul>
  </dl>

  <p class=note>Note that, while &lsquo;<code class=css>0</code>&rsquo;
   &lt;length>s are normally allowed to be specified without a unit suffix,
   the definition of the &lsquo;<code class=css>flex()</code>&rsquo; function
   implicitly disallows this. Allowing a unitless &lsquo;<code
   class=css>0</code>&rsquo; length would cause ambiguity in some cases; even
   in the unambiguous cases, the flexible length could instead be written
   using the &lsquo;<code class=css>fr</code>&rsquo; unit, which is shorter
   and simpler.</p>
  <!-- ====================================================================== -->

  <h2 id=flex-pack><span class=secno>6. </span> The &lsquo;<a
   href="#flex-pack0"><code class=property>flex-pack</code></a>&rsquo;
   property</h2>

  <table class=propdef>
   <tbody>
    <tr>
     <th>Name:

     <td><dfn id=flex-pack0>flex-pack</dfn>

    <tr>
     <th>Value:

     <td>start | end | center | justify

    <tr>
     <th>Initial:

     <td>start

    <tr>
     <th>Applies to:

     <td>flexboxes

    <tr>
     <th>Inherited:

     <td>no

    <tr>
     <th>Computed Value:

     <td>specified value

    <tr>
     <th>Media:

     <td>visual
  </table>

  <p>Between and around the margins of <a href="#flexbox-item"><i>flexbox
   item</i></a>s there are additional flexible lengths, called <dfn
   id=packing-space>packing space</dfn>. Packing space can absorb leftover
   free space in a flexbox if there aren't any other <i>flexible length</i>s,
   or if all the <i>flexible length</i>s have reached their maximum size. The
   &lsquo;<a href="#flex-pack0"><code
   class=property>flex-pack</code></a>&rsquo; property defines the
   flexibility of these packing spaces:

  <dl>
   <dt><dfn id=flex-pack-start>start</dfn>

   <dd><a href="#flexbox-item"><i>flexbox item</i></a>s are packed toward the
    start of the flexbox. The last packing space (between the margin of the
    last flexbox item and the edge of the flexbox) must absorb all leftover
    free space; all other packing spaces must have a length of &lsquo;<code
    class=css>0</code>&rsquo;.

   <dt><dfn id=flex-pack-end>end</dfn>

   <dd><a href="#flexbox-item"><i>flexbox item</i></a>s are packed toward the
    end of the flexbox. The first packing space (between the edge of the
    flexbox and the margin of the first flexbox item ) must absorb all
    leftover free space; all other packing spaces must have a length of
    &lsquo;<code class=css>0</code>&rsquo;.

   <dt><dfn id=flex-pack-center>center</dfn>

   <dd><a href="#flexbox-item"><i>flexbox item</i></a>s are packed toward the
    center of the flexbox. The first and last packing spaces must equally
    split all leftover free space; all other packing spaces must have a
    length of &lsquo;<code class=css>0</code>&rsquo;.

   <dt><dfn id=flex-pack-justify>justify</dfn>

   <dd><a href="#flexbox-item"><i>flexbox item</i></a>s are evenly
    distributed through the flexbox. The first and last packing spaces must
    have a length of &lsquo;<code class=css>0</code>&rsquo;; all other
    packing spaces must equally split all leftover free space.
  </dl>

  <div class=figure>
   <p class=caption><span class=issue>TODO: Provide a diagram showing packing
    spaces.</span></p>
  </div>

  <div class=example>
   <p class=issue>TODO: Examples showing the four values.</p>
  </div>
  <!-- ====================================================================== -->
  <!-- Aborted new introduction to flexboxes
<p>A flexbox has two axes, which are treated differently by the space distribute algorithm:  the <i>measure axis</i>, which is the axis along which the flexbox grows as you add more children, and the <i>length axis</i>, which is the perpendicular axis.</p>

<img alt="In a horizontal flexbox, the measure axis is horizontal, while the length axis is vertical.">

<p>The measure axis is more interesting, as there are more places where things can potentially flex.  As such, there are more controls for specifying how to distribute free space in this axis: the 'width' or 'height' property starts things off, modified by the 'flex' property; the 'margin' property gives individual control over spacing between <i>flexbox item</i>s; and the 'flex-pack' property gives a more flexbox-global level of control over the between-children spacing.</p>

<p>In general terms, determining where to allocate free space in the measure axis starts by determining just how much free space there is.  All the non-flexible lengths, and the preferred sizes of all the flexible widths or heights, are subtracted from the total width or height of the flexbox.  If a positive length is left over, this is split up among all the flexible lengths according to their flexibility.  Flexible margins automatically have a flexibility of 1, while widths or heights have their flexibility specified by the 'flex-grow' property.</p>

<div class=example>
	<p>Three boxes, all with a preferred size of 0, will end up with sizes exactly proportional to their flex-grow values.</p>
	<img alt="">
</div>
<div class=example>
	<p>If the three boxes have different preferred sizes, then they'll split the free space proportionately, but their final sizes won't be exactly proportional.</p>
	<img alt="">
</div>
<div class=example>
	<p>Margins can also participate in flex calculations.  They have a preferred size of 0, and a flexibility of 1.</p>
	<img alt="">
</div>

<p>If none of the lengths are flexible, or if all the flexible widths or height have reached their maximum size (if 'max-width' or 'max-height' properties are in effect), then any leftover space is distributed according to the 'flex-pack' property between the margins of the <i>flexbox item</i>s.</p>

<div class=example>
	<p>If the flexbox is small enough, then the flexible child can absorb all the space...</p>
	<img>
	<p>...but if it gets large enough, there'll be extra space left over for 'flex-pack' to distribute.</p>
	<img>
</div>

<p>If the original calculation of how much free space was left gave a negative length (that is, if the preferred sizes of all the <i>flexbox item</i>s sum to a larger length than the width or height of the flexbox), then flexible margins get set to 0, 'flex-pack' has no effect, and <i>flexbox item</i>s with a non-zero 'flex-shrink' value split the responsibility for shrinking between themselves proportionally.  Just like when they grow, their size starts from the preferred size, then combines that with the proportional share of (negative) space.</p>

<div class=example>
	<p>When the children are too wide, the shrinkable elements reduce their size to fit...</p>
	<img>
	<p>...but if they all reach their minimum size, they just overflow.</p>
</div>

[write the length axis section]
-->
  <!-- ====================================================================== -->

  <h2 id=flex-align><span class=secno>7. </span> The &lsquo;<a
   href="#flex-align0"><code class=property>flex-align</code></a>&rsquo;
   property</h2>

  <table class=propdef>
   <tbody>
    <tr>
     <th>Name:

     <td><dfn id=flex-align0>flex-align</dfn>

    <tr>
     <th>Value:

     <td>auto | baseline

    <tr>
     <th>Initial:

     <td>auto

    <tr>
     <th>Applies to:

     <td>flexboxes

    <tr>
     <th>Inherited:

     <td>no

    <tr>
     <th>Computed Value:

     <td>specified value

    <tr>
     <th>Media:

     <td>visual
  </table>

  <p>By default, laying out <a href="#flexbox-item"><i>flexbox item</i></a>s
   in the <a href="#length-axis"><i>length axis</i></a> is a simple matter of
   determining free space and then splitting it between any <i>flexible
   length</i>s in that axis. This is not always sufficient, however; in
   particular, it is often useful to align <a href="#flexbox-item"><i>flexbox
   item</i></a>s by their baseline. The &lsquo;<a href="#flex-align0"><code
   class=property>flex-align</code></a>&rsquo; property changes the way free
   space is allocated in the <a href="#length-axis"><i>length axis</i></a>.

  <dl>
   <dt>auto

   <dd>Allocate free space in the <a href="#length-axis"><i>length
    axis</i></a> as normal, by distributing it proportionally between
    <i>flexible length</i>s in that axis.

   <dt>baseline

   <dd>
    <p>Align all <a href="#flexbox-item"><i>flexbox item</i></a>s so that
     their baselines line up, then distribute free space above and below the
     content.</p>

    <p>This only has an effect on <a href="#flexbox-item"><i>flexbox
     item</i></a>s with a horizontal baseline in a horizontal flexbox, or <a
     href="#flexbox-item"><i>flexbox item</i></a>s with a vertical baseline
     in a vertical flexbox. Otherwise, alignment for that flexbox item
     proceeds as if &lsquo;<code class=css>flex-align:auto</code>&rsquo; had
     been specified.</p>
  </dl>

  <p>The precise effects that &lsquo;<a href="#flex-align0"><code
   class=property>flex-align</code></a>&rsquo; has on alignment and free
   space distribution are detailed in a later chapter.</p>
  <!-- ====================================================================== -->

  <h2 id=free-space-algorithm><span class=secno>8. </span> Free Space
   Calculation and Distribution</h2>

  <p>The following algorithms detail precisely how to determine the
   dimensions and positions of a flexbox and its contents, and how to resolve
   flexible lengths used on <a href="#flexbox-item"><i>flexbox item</i></a>s
   into definite lengths.

  <p>The algorithm described here is designed to be clear, but not
   necessarily efficient. Implementations may use different algorithms, but
   they must generate the same results as this algorithm.

  <p>This section defines several terms to clarify the operation of the
   algorithms described within:

  <dl>
   <dt><dfn id=relevant-length>relevant length</dfn>

   <dd>The width, height, margin, border, or padding of a flexbox item. Also,
    the <a href="#packing-space"><i>packing space</i></a>s of a flexbox.

   <dt><dfn id=flex-tuple>flex tuple</dfn>

   <dd>A 5-tuple of information about a flexible length, containing a minimum
    size, a maximum size, a preferred size, a positive flexibility, and a
    negative flexibility.

   <dt><dfn id=total-free-space>total free space</dfn>

   <dd>The inner width or height of the flexbox (depending on the
    distribution round), which will be used to calculate the sizes of the <a
    href="#flexbox-item"><i>flexbox item</i></a>s.

   <dt><dfn id=available-free-space>available free space</dfn>

   <dd>The <a href="#total-free-space"><i>total free space</i></a> minus the
    sum of the preferred sizes of all the relevant lengths, which is used to
    resolve <a href="#flex-tuple"><i>flex tuple</i></a>s into inflexible
    lengths.
  </dl>

  <h3 id=initial-computation><span class=secno>8.1. </span> Initial
   Computation</h3>

  <p>This step computes necessary information required to run the free-space
   distribution algorithms.

  <ol>
   <li>Determine the measure of the flexbox. Flexboxes are sized like
    shrinkwrapped blocks (if &lsquo;<code
    class=css>display:flexbox</code>&rsquo; is used) or inline-blocks (if
    &lsquo;<code class=css>display:inline-flexbox</code>&rsquo; is used). A
    horizontal flexbox's measure is its width, while a vertical flexbox's
    measure is its height. <span class=issue>ISSUE: Do I need to explicitly
    define the sizing algorithm? I think I should be able to rely on the
    generic multi-directional block sizing algorithm, perhaps with a
    specification of the inputs, like what size to use for flexible
    lengths.</span>

   <li>
    <p>Resolve all <a href="#relevant-length"><i>relevant length</i></a>s on
     the flexbox and its <a href="#flexbox-item"><i>flexbox item</i></a>s
     into <dfn id=flex-tuples>flex tuples</dfn> of [preferred size, minimum
     size, maximum size, positive flex, negative flex].</p>

    <dl>
     <dt>For margins and padding:

     <dd>
      <p>Set the minimum size to 0 and the maximum size to infinity.</p>

      <p>If the length is inflexible, set the preferred size to the length
       itself and both positive and negative flexibility to 0.</p>

      <p>Otherwise, if the length was specified with the &lsquo;<code
       class=css>flex()</code>&rsquo; function, set the positive flexibility,
       negative flexibility, and preferred size to the values specified in
       the function.</p>

      <p>If the length is a margin with the value &lsquo;<code
       class=css>auto</code>&rsquo;, set the preferred size to 0, the
       positive flexibility to 1, and the negative flexibility to 0.</p>

     <dt>For borders:

     <dd>
      <p>Borders are always inflexible. Set the minimum size to 0, the
       maximum size to infinity, the preferred size to the border-width, and
       the positive and negative flexibility to 0.</p>

     <dt>For width and height:

     <dd>
      <p>Set the minimum size to the value of the &lsquo;<code
       class=property>min-width</code>&rsquo; or &lsquo;<code
       class=property>min-height</code>&rsquo;, as appropriate. Set the
       maximum size to the value of the &lsquo;<code
       class=property>max-width</code>&rsquo; or &lsquo;<code
       class=property>max-height</code>&rsquo; property, as appropriate,
       unless the value is &lsquo;<code class=css>none</code>&rsquo;, in
       which case set the maximum size to infinity.</p>

      <p>If the length is inflexible, set the preferred size to the length
       itself and both positive and negative flexibility to 0.</p>

      <p>Otherwise, if the length was specified with the &lsquo;<code
       class=css>flex()</code>&rsquo; function, set the positive and negative
       flexibility to the values specified in the function. If the preferred
       size argument specified in the function is a &lt;length>, set the
       preferred size to that length. If the argment is a &lt;percentage>,
       resolve it relative to the width or height of the flexbox, as
       appropriate, and set the preferred size to the resultant length. If
       the argument is &lsquo;<code class=css>auto</code>&rsquo;, set the
       preferred size to the item's intrinsic dimension in the appropriate
       axis.</p>

      <p>Otherwise, if the length was &lsquo;<code
       class=css>auto</code>&rsquo;, set the preferred size to the item's
       intrinsic dimension in the appropriate axis, the positive flexibility
       to 1, and the negative flexibility to 0.</p>

      <p>If the preferred size is now less than the minimum size, set it
       equal to the minimum size. If the preferred size is now greater than
       the maximum size, set it equal to the maximum size.</p>

     <dt>For <a href="#packing-space"><i>packing space</i></a>s:

     <dd>
      <p>If the flexbox's &lsquo;<a href="#flex-pack0"><code
       class=property>flex-pack</code></a>&rsquo; is <i
       title=flex-pack-start>start</i>, the last <a
       href="#packing-space"><i>packing space</i></a> (between the final <a
       href="#flexbox-item"><i>flexbox item</i></a>, after reordering by
       &lsquo;<a href="#flex-order0"><code
       class=property>flex-order</code></a>&rsquo;, and the end of the
       flexbox) has a minimum size of 0, a maximum size of infinity, a
       preferred size of 0, a positive flexibility of 1, and a negative
       flexibility of 0. All other <a href="#packing-space"><i>packing
       space</i></a>s have minimum size, maximum size, preferred size,
       positive flexibility, and negative flexibility of 0.</p>

      <p>If the flexbox's &lsquo;<a href="#flex-pack0"><code
       class=property>flex-pack</code></a>&rsquo; is <i
       title=flex-pack-end>end</i>, the first <a
       href="#packing-space"><i>packing space</i></a> (between the first <a
       href="#flexbox-item"><i>flexbox item</i></a>, after reordering by
       &lsquo;<a href="#flex-order0"><code
       class=property>flex-order</code></a>&rsquo;, and the start of the
       flexbox) has a minimum size of 0, a maximum size of infinity, a
       preferred size of 0, a positive flexibility of 1, and a negative
       flexibility of 0. All other <a href="#packing-space"><i>packing
       space</i></a>s have minimum size, maximum size, preferred size,
       positive flexibility, and negative flexibility of 0.</p>

      <p>If the flexbox's &lsquo;<a href="#flex-pack0"><code
       class=property>flex-pack</code></a>&rsquo; is <i
       title=flex-pack-center>center</i>, the first and last <a
       href="#packing-space"><i>packing space</i></a>s (as defined above)
       have a minimum size of 0, a maximum size of infinity, a preferred size
       of 0, a positive flexibility of 1, and a negative flexibility of 0.
       All other <a href="#packing-space"><i>packing space</i></a>s have
       minimum size, maximum size, preferred size, positive flexibility, and
       negative flexibility of 0.</p>

      <p>If the flexbox's &lsquo;<a href="#flex-pack0"><code
       class=property>flex-pack</code></a>&rsquo; is <i
       title=flex-pack-justify>justify</i>, the first and last <a
       href="#packing-space"><i>packing space</i></a>s (as defined above)
       have a minimum size, maximum size, preferred size, positive
       flexibility, and negative flexibility of 0. All other <a
       href="#packing-space"><i>packing space</i></a>s have a minimum size of
       0, a maximum size of infinity, a preferred size of 0, a positive
       flexibility of 1, and a negative flexibility of 0.</p>
    </dl>
  </ol>

  <h3 id=first-distribution-round><span class=secno>8.2. </span> First
   Distribution Round</h3>

  <p>This step distributes free space to the flexible lengths of the flexbox
   in the <a href="#measure-axis"><i>measure axis</i></a>.

  <p>Collect the set of <a href="#flex-tuple"><i>flex tuple</i></a>s that can
   participate in this step:

  <ol>
   <li>If the flexbox is horizontal, collect the widths of every <a
    href="#flexbox-item"><i>flexbox item</i></a>. If the flexbox is vertical,
    instead collect the heights of every <a href="#flexbox-item"><i>flexbox
    item</i></a>.

   <li>Collect the margins of every <a href="#flexbox-item"><i>flexbox
    item</i></a> that are in the flexbox's measure axis.

   <li>Collect the borders of every <a href="#flexbox-item"><i>flexbox
    item</i></a> that are in the flexbox's measure axis, if the <a
    href="#flexbox-item"><i>flexbox item</i></a> has a &lsquo;<code
    class=property>box-sizing</code>&rsquo; value of &lsquo;<code
    class=css>content-box</code>&rsquo; or &lsquo;<code
    class=css>padding-box</code>&rsquo;.

   <li>Collect the paddings of every <a href="#flexbox-item"><i>flexbox
    item</i></a> that are in the flexbox's measure axis, if the <a
    href="#flexbox-item"><i>flexbox item</i></a> has a &lsquo;<code
    class=property>box-sizing</code>&rsquo; value of &lsquo;<code
    class=css>content-box</code>&rsquo;.
  </ol>

  <p>Invoke the <i>free space allocation algorithm</i> with the set of <a
   href="#flex-tuple"><i>flex tuple</i></a>s collected above, and an <a
   href="#available-free-space"><i>available free space</i></a> equal to the
   flexbox's inner measure.

  <h3 id=second-distribution-round><span class=secno>8.3. </span> Second
   Distribution Round</h3>

  <p>This step distributes any leftover available space to the <a
   href="#packing-space"><i>packing space</i></a>, so that the flexbox items
   are arranged within the flexbox as desired.

  <p>Collect the same set of <a href="#flex-tuple"><i>flex tuple</i></a>s as
   in the first distribution round (now inflexible lengths), and additionally
   collect the flexbox's <a href="#packing-space"><i>packing space</i></a>s.

  <p>Invoke the <i>free space allocation algorithm</i> with the set of <a
   href="#flex-tuple"><i>flex tuple</i></a>s collected above, and an <a
   href="#available-free-space"><i>available free space</i></a> equal to the
   flexbox's inner measure.

  <h3 id=intermediate-computation><span class=secno>8.4. </span> Intermediate
   Computation</h3>

  <p>Determine the length of the flexbox, given the sizes that have already
   been determined.

  <h3 id=third-distribution-round><span class=secno>8.5. </span> Third
   Distribution Round</h3>

  <p>This step distributes free space to the flexible lengths of each flexbox
   item in the <a href="#length-axis"><i>length axis</i></a>. <strong>It is
   run for each <a href="#flexbox-item"><i>flexbox item</i></a>
   independently.</strong>

  <p class=issue>ISSUE: This step doesn't yet take &lsquo;<a
   href="#flex-align0"><code class=property>flex-align</code></a>&rsquo; into
   account. I need to decide whether to always default to stretching or
   shrinking when doing baseline-alignment, or coming up with some heuristic
   for it. Perhaps specify the behavior in the &lsquo;<a
   href="#flex-align0"><code class=property>flex-align</code></a>&rsquo;
   values instead? Once this decision is made, the behavior is relatively
   simple - either adjust margin (if shrunk) or padding (if stretched)

  <p>Collect the set of <a href="#flex-tuple"><i>flex tuple</i></a>s from the
   current <a href="#flexbox-item"><i>flexbox item</i></a> that can
   participate in this step:

  <ol>
   <li>If the flexbox is horizontal, collect the height of the <a
    href="#flexbox-item"><i>flexbox item</i></a>. If the flexbox is vertical,
    instead collect the width of the <a href="#flexbox-item"><i>flexbox
    item</i></a>.

   <li>Collect the margins of the <a href="#flexbox-item"><i>flexbox
    item</i></a> that are in the flexbox's length axis.

   <li>Collect the borders of the <a href="#flexbox-item"><i>flexbox
    item</i></a> that are in the flexbox's length axis, if the <a
    href="#flexbox-item"><i>flexbox item</i></a> has a &lsquo;<code
    class=property>box-sizing</code>&rsquo; value of &lsquo;<code
    class=css>content-box</code>&rsquo; or &lsquo;<code
    class=css>padding-box</code>&rsquo;.

   <li>Collect the padding lengths of the <a href="#flexbox-item"><i>flexbox
    item</i></a> that are in the flexbox's length axis, if the <a
    href="#flexbox-item"><i>flexbox item</i></a> has a &lsquo;<code
    class=property>box-sizing</code>&rsquo; value of &lsquo;<code
    class=css>content-box</code>&rsquo;.
  </ol>

  <p>Invoke the <i>free space allocation algorithm</i> with the set of <a
   href="#flex-tuple"><i>flex tuple</i></a>s collected above, and an <a
   href="#available-free-space"><i>available free space</i></a> equal to the
   flexbox's inner length.

  <h3 id=free-space-allocation-algorithm><span class=secno>8.6. </span> Free
   Space Allocation Algorithm</h3>

  <p>This section describes the algorithm used to allocate free space to a
   set of flexible lengths. The inputs to this algorithm are a set of <a
   href="#flex-tuple"><i>flex tuple</i></a>s and a length representing the <a
   href="#total-free-space"><i>total free space</i></a>. The output is a set
   of inflexible lengths.

  <p>Calculate the <a href="#available-free-space"><i>available free
   space</i></a> by summing the preferred size of all the <a
   href="#flex-tuple"><i>flex tuple</i></a>s and subtracting that value from
   the <a href="#total-free-space"><i>total free space</i></a>.

  <p>If the <a href="#available-free-space"><i>available free space</i></a>
   is 0, transform all the <a href="#flex-tuple"><i>flex tuple</i></a>s into
   inflexible lengths equal to their preferred size and return them.

  <p>If the <a href="#available-free-space"><i>available free space</i></a>
   is a positive length, it will be distributed between all the <a
   href="#flex-tuple"><i>flex tuple</i></a>s with positive flexibility:

  <ol>
   <li>Sum the <a href="#positive-flexibility"><i>positive
    flexibility</i></a> of all the <a href="#flex-tuple"><i>flex
    tuple</i></a>s. This is the <i>total flexibility</i>.

   <li>If the <i>total flexibility</i> is 0, transform all the <a
    href="#flex-tuple"><i>flex tuple</i></a>s into inflexible lengths equal
    to their preferred size and return them.

   <li>
    <p>For each <a href="#flex-tuple"><i>flex tuple</i></a> with non-zero <a
     href="#positive-flexibility"><i>positive flexibility</i></a>, set its
     preferred size to:</p>

    <pre><code>[preferred size] + ( [available free space] * [positive flexibility] / [total flexibility] )</code></pre>

   <li>If any <a href="#flex-tuple"><i>flex tuple</i></a>s now have a
    preferred size greater than their maximum size, set their preferred size
    to their maximum size, set their positive flexibility to 0, and restart
    this algorithm.

   <li>Transform all the <a href="#flex-tuple"><i>flex tuple</i></a>s into
    inflexible lengths equal to their preferred size, and return them.
  </ol>

  <p>If the <a href="#available-free-space"><i>available free space</i></a>
   is a negative length, all the <a href="#flex-tuple"><i>flex tuple</i></a>s
   with negative flexibility will shrink to attemp to fit the set of <a
   href="#flex-tuple"><i>flex tuple</i></a>s into the available space:

  <ol>
   <li>Sum the <a href="#negative-flexibility"><i>negative
    flexibility</i></a> of all the <a href="#flex-tuple"><i>flex
    tuple</i></a>s. This is the <i>total flexibility</i>.

   <li>If the <i>total flexibility</i> is 0, transform all the <a
    href="#flex-tuple"><i>flex tuple</i></a>s into inflexible lengths equal
    to their preferred size and return them.

   <li>
    <p>For each <a href="#flex-tuple"><i>flex tuple</i></a> with non-zero <a
     href="#negative-flexibility"><i>negative flexibility</i></a>, set its
     preferred size to:</p>

    <pre><code>[preferred size] + ( [available free space] * [negative flexibility] / [total flexibility] )</code></pre>

    <p class=note>Note that the <a href="#available-free-space"><i>available
     free space</i></a> is a negative length here, so the sum will result in
     a smaller length.</p>

   <li>If any <a href="#flex-tuple"><i>flex tuple</i></a>s now have a
    preferred size lesser than their minimum size, set their preferred size
    to their minimum size, set their negative flexibility to 0, and restart
    this algorithm.

   <li>Transform all the <a href="#flex-tuple"><i>flex tuple</i></a>s into
    inflexible lengths equal to their preferred size, and return them.
  </ol>
  <!-- ====================================================================== -->

  <h2 id=layout-interface><span class=secno>9. </span> Interface With Other
   Layout Algorithms</h2>

  <div class=issue>
   <p>This section seems necessary, but not the precise way it's written. I
    need to identify precisely what data needs to be exposed both by the
    containing measure model (for the flexbox to use) and by the flexbox (for
    the containing measure model to use), and then write that up. Then the
    other measure models we produce can re-use the same template.</p>

   <p>Need to define:</p>

   <ul>
    <li>The min/max/fit-content widths and heights of flexboxes in block
     contents

    <li>Other stuff?
   </ul>
  </div>

  <p> <!--
  <p>
   A box placed in a block is considered a block level element and will be positioned
   and sized according to the rules for CSS 2.1 (section 10.3 for widths). Specifically,
   the following equation applies for calculating the width:
  </p>
  <blockquote>
  <p>'margin-left' + 'border-left-width' + 'padding-left' + 'width' + 'padding-right' + 'border-right-width' + 'margin-right' + scrollbar width (if any) = width of containing block
  </p>
  </blockquote>
  <p>All children of 'box' elements are block-level. If inline-level elements are nested
     inside boxes, they get wrapped in an anonymous block which then takes part in the
     box layout.

  </p><p>
     If the width of a child of a flexible box is computed as 'auto', then the used value
     is the shrink-to-fit width. This calculation is done similarly to how the width of
     a floating element is determined. Otherwise if the width has a computed value,
     then that value is used as the width.
  </p><p>

     In a horizontally oriented box, the flexibility is then applied which may increase
     or decrease the used width. In a vertically oriented box, the position and size
     of the child may be adjusted by the value of the container's
     <span class="property">'box-align'</span> property.
  </p><p>

     The <span class="property">'min-width'</span>, <span class="property">'min-height'</span>,
     <span class="property">'max-width'</span>, and <span class="property">'max-height'</span>
     CSS properties act the same on boxes as on blocks.
  </p><p>

     The height of a child of a flexible box is determined in the same manner as specified
     in the CSS specification. The used height may further be adjusted by the container's
     <span class="property">'box-align'</span> property in a horizontally
     oriented box, or the flexibility in a vertically oriented box.
  </p><p>

     Note that it is possible for a horizontally oriented box that the height of a
     flexible child containing an inline descendant will change when the flexibility is
     applied. Similarly, in a vertically oriented box, the height of a child may change
     based on the <span class="property">'box-align'</span> property of the
     box.
  </p>
	-->
   

  <hr title="Separator from footer">

  <h2 class=no-num id=acknowledgments>Acknowledgments</h2>

  <p>[This section will contain further acknowledgments.]

  <p>Thanks for feedback from James Elmore and Shinichiro Hamaji.

  <h2 class=no-num id=references>References</h2>

  <h3 class=no-num id=normative>Normative references</h3>
  <!--begin-normative-->
  <!-- Sorted by label -->

  <dl class=bibliography>
   <dt style="display: none"><!-- keeps the doc valid if the DL is empty -->
    <!---->

   <dt id=CSS21>[CSS21]

   <dd>Bert Bos; et al. <a
    href="http://www.w3.org/TR/2011/REC-CSS2-20110607"><cite>Cascading Style
    Sheets Level 2 Revision 1 (CSS&#160;2.1) Specification.</cite></a> 7 June
    2011. W3C Recommendation. URL: <a
    href="http://www.w3.org/TR/2011/REC-CSS2-20110607">http://www.w3.org/TR/2011/REC-CSS2-20110607</a>
    </dd>
   <!---->

   <dt id=CSS3VAL>[CSS3VAL]

   <dd>H&#229;kon Wium Lie; Chris Lilley. <a
    href="http://www.w3.org/TR/2006/WD-css3-values-20060919"><cite>CSS3
    Values and Units.</cite></a> 19 September 2006. W3C Working Draft. (Work
    in progress.) URL: <a
    href="http://www.w3.org/TR/2006/WD-css3-values-20060919">http://www.w3.org/TR/2006/WD-css3-values-20060919</a>
    </dd>
   <!---->
  </dl>
  <!--end-normative-->

  <h2 class=no-num id=index>Index</h2>
  <!--begin-index-->

  <ul class=indexlist>
   <li>available free space, <a href="#available-free-space" title="available
    free space"><strong>8.</strong></a>

   <li>center, <a href="#flex-pack-center"
    title=center><strong>6.</strong></a>

   <li>end, <a href="#flex-pack-end" title=end><strong>6.</strong></a>

   <li>flex-align, <a href="#flex-align0"
    title=flex-align><strong>7.</strong></a>

   <li>flexbox item, <a href="#flexbox-item" title="flexbox
    item"><strong>1.</strong></a>

   <li>flex-direction, <a href="#flex-direction0"
    title=flex-direction><strong>3.</strong></a>

   <li>flex-order, <a href="#flex-order0"
    title=flex-order><strong>4.</strong></a>

   <li>flex-pack, <a href="#flex-pack0"
    title=flex-pack><strong>6.</strong></a>

   <li>flex tuple, <a href="#flex-tuple" title="flex
    tuple"><strong>8.</strong></a>

   <li>flex tuples, <a href="#flex-tuples" title="flex
    tuples"><strong>8.1.</strong></a>

   <li>horizontal flexbox, <a href="#horizontal-flexbox" title="horizontal
    flexbox"><strong>3.</strong></a>

   <li>inner length, <a href="#inner-length" title="inner
    length"><strong>3.</strong></a>

   <li>inner measure, <a href="#inner-measure" title="inner
    measure"><strong>3.</strong></a>

   <li>justify, <a href="#flex-pack-justify"
    title=justify><strong>6.</strong></a>

   <li>length axis, <a href="#length-axis" title="length
    axis"><strong>3.</strong></a>

   <li>length direction, <a href="#length-direction" title="length
    direction"><strong>3.</strong></a>

   <li>measure axis, <a href="#measure-axis" title="measure
    axis"><strong>3.</strong></a>

   <li>measure direction, <a href="#measure-direction" title="measure
    direction"><strong>3.</strong></a>

   <li>negative flexibility, <a href="#negative-flexibility" title="negative
    flexibility"><strong>5.1.</strong></a>

   <li>packing space, <a href="#packing-space" title="packing
    space"><strong>6.</strong></a>

   <li>positive flexibility, <a href="#positive-flexibility" title="positive
    flexibility"><strong>5.1.</strong></a>

   <li>preflex size, <a href="#preflex-size" title="preflex
    size"><strong>5.1.</strong></a>

   <li>relevant length, <a href="#relevant-length" title="relevant
    length"><strong>8.</strong></a>

   <li>start, <a href="#flex-pack-start" title=start><strong>6.</strong></a>

   <li>total free space, <a href="#total-free-space" title="total free
    space"><strong>8.</strong></a>

   <li>vertical flexbox, <a href="#vertical-flexbox" title="vertical
    flexbox"><strong>3.</strong></a>
  </ul>
  <!--end-index-->

  <h2 class=no-num id=property>Property index</h2>
  <!--begin-properties-->

  <table class=proptable>
   <thead>
    <tr>
     <th>Property

     <th>Values

     <th>Initial

     <th>Applies&nbsp;to

     <th>Inh.

     <th>Percentages

     <th>Media

   <tbody>
    <tr>
     <td><span class=property>display</span>

     <td>flexbox | inline-flexbox

    <tr>
     <td><a class=property href="#flex-align0">flex-align</a>

     <td>auto | baseline

     <td>auto

     <td>flexboxes

     <td>no

     <td>specified value

     <td>visual

    <tr>
     <td><a class=property href="#flex-direction0">flex-direction</a>

     <td>lr | rl | tb | bt | inline | inline-reverse | block | block-reverse

     <td>inline

     <td>flexboxes

     <td>no

     <td>lr | rl | tb | bt (See text)

     <td>visual

    <tr>
     <td><a class=property href="#flex-order0">flex-order</a>

     <td>&lt;integer>

     <td>1

     <td>flexbox items

     <td>no

     <td>specified value

     <td>visual

    <tr>
     <td><a class=property href="#flex-pack0">flex-pack</a>

     <td>start | end | center | justify

     <td>start

     <td>flexboxes

     <td>no

     <td>specified value

     <td>visual
  </table>
  <!--end-properties-->
  <!-- Keep this comment at the end of the file
    Local variables:
    mode: sgml
    sgml-declaration:"~/SGML/HTML4.decl"
    sgml-default-doctype-name:"html"
    sgml-minimize-attributes:t
    sgml-nofill-elements:("pre" "style" "br")
    sgml-live-element-indicator:t
    End:
    -->
