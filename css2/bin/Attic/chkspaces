#!/usr/local/bin/perl
# Check for lack of space before a start tag and
# after and end tag.
# Ian Jacobs
# $Id: chkspaces,v 1.2 1998-01-19 23:52:22 ijacobs Exp $

$PROGNAME = substr($0, rindex($0, "/") + 1);

# copy file in memory
sub readfile {
    $buf = "";
    if (!open(INPUT, $_[0])) {
	print STDERR "$PROGNAME Error: Cannot open file: $_[0]\n";
	return;
    }
    while (<INPUT>) {
	$buf .= $_;
    }
    close(INPUT);
}

# read reference database
$pattern1 = "(<\\/[^>]+>\\w+)";
$pattern2 = "(\\w(?:<(\\w+)\\s*[^>]*>)+)";

foreach $file (@ARGV) {
    print STDOUT "Checking $file\n";
    if (readfile($file)) {
	$_ = $buf;
	while (/$pattern1/sio) {
	    $continue = $';
	    print STDERR "\t$1\n";
	    $_ = $continue;
	}
	while (/$pattern2/sio) {
	    $continue = $';
	    $match = $1;
	    $elem = $2;
	    if ( $2 =~ /br|th|td|sup|sub/i ) {
		print STDERR "\t$match (Possibly harmless for $elem)\n";
	    } else {
		print STDERR "\t$match\n";
	    }
	    $_ = $continue;
	}
    }
}

