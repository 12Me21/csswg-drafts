<!doctype html>
<html lang="en-US">
 <head>
  <meta charset=utf-8>
  <title>CSS Object Model (CSSOM)</title>
  <link rel=stylesheet href=../default.css>
  <link rel="stylesheet" href="https://www.w3.org/StyleSheets/TR/W3C-[STATUS]">
 </head>
 <body class="draft">
 
<div class="head">
 <!--logo-->


 <h1>CSS Object Model (CSSOM)</h1>


 <h2 class="no-num no-toc" id="w3c-doctype">[LONGSTATUS] [DATE: 3 August 2002]</h2>

 <dl>

  <dt>This Version:</dt>
  <dd class=dontpublish><a href="http://dev.w3.org/csswg/cssom/">http://dev.w3.org/csswg/cssom/</a></dd>
  <dd class=publish><a href="[VERSION]">[VERSION]</a></dd>

  <dt class=dontpublish>Participate:</dt>
  <dd class=dontpublish><a href="mailto:www-style@w3.org?subject=%5Bcssom%5D%20">www-style@w3.org</a>
  (<a href="http://lists.w3.org/Archives/Public/www-style/">archives</a>)</dd>
  <dd class=dontpublish><a href="https://www.w3.org/Bugs/Public/enter_bug.cgi?product=CSS&amp;component=CSSOM">File a bug</a>
  (<a href="https://www.w3.org/Bugs/Public/buglist.cgi?component=CSSOM&amp;product=CSS&amp;resolution=---">open bugs</a>)
  <script async="" src="https://w3c-test.org/resources.whatwg.org/file-bug.js"></script></dd>
  <dd class=dontpublish><a href="irc://irc.w3.org:6665/css">IRC: #css on W3C</a></dd>

  <dt class=publish>Latest Version:</dt>
  <dd class=publish><a href="[LATEST]">[LATEST]</a></dd>

  <dt class=publish>Latest Editor's draft:</dt>
  <dd class=publish><a href="http://dev.w3.org/csswg/cssom/">http://dev.w3.org/csswg/cssom/</a></dd>

  <dt class=dontpublish>Previous Version:</dt>
  <dd class=dontpublish><a href="http://www.w3.org/TR/2011/WD-cssom-20110712/">http://www.w3.org/TR/2011/WD-cssom-20110712/</a></dd>
  <dd class=dontpublish><a href="http://www.w3.org/TR/2000/REC-DOM-Level-2-Style-20001113/">http://www.w3.org/TR/2000/REC-DOM-Level-2-Style-20001113/</a></dd>

  <dt>Editors:</dt>
  <dd>Simon Pieters
  (<a href="http://www.opera.com/">Opera Software ASA</a>)
  &lt;<a href="mailto:simponp@opera.com">simonp@opera.com</a>&gt;</dd>
  <dd><a href="http://www.w3.org/wiki/User:Gadams">Glenn Adams</a>
  (<a href="http://www.cox.com/">Cox Communications, Inc.</a>)
  &lt;<a href="mailto:glenn.adams@cox.com">glenn.adams@cox.com</a>&gt;</dd>

  <dt>Previous Editor:</dt>
  <dd><a href="http://annevankesteren.nl/">Anne van Kesteren</a>
  (<a href="http://www.opera.com/">Opera Software ASA</a>)
  &lt;<a href="mailto:annevk@annevk.nl">annevk@annevk.nl</a>&gt;</dd>
 </dl>

 <!--copyright-->

</div>

<hr class="top">


<h2 class="no-num no-toc">Abstract</h2>

<p>CSSOM defines APIs (including generic parsing and serialization rules)
for Media Queries, Selectors, and of course CSS itself.</p>


<h2 class="no-num no-toc" id="sotd">Status of This Document</h2>

<p>This is a public copy of the editors' draft. It is provided for discussion only and may change at any moment.
Its publication here does not imply endorsement of its contents by W3C or by the CSS Working Group. Don't cite
this document other than as work in progress.</p>

<p class="note">Implementers should note well that this specification is an ongoing effort to sort out
what has been widely implemented and deployed from <span data-anolis-ref class=informative>DOM2STYLE</span> as well as common extensions thereto, some details
of which are currently interoperable and others which are not currently interoperable. As this specification moves
forward, it is hoped that these differences will be resolved and an unambiguous and adequate consensus-based
specification will emerge.</p>

<p><em>This section describes the status of this document at the time of
its publication. Other documents may supersede this document. A list of
current W3C publications and the latest revision of this technical report
can be found in the
<a href="http://www.w3.org/TR/">W3C technical reports index at http://www.w3.org/TR/.</a></em>

<p class="dontpublish">This is the [DATE: 3 August 2002] [LONGSTATUS] of CSSOM. Please send comments to
<a href="mailto:www-style@w3.org?subject=%5Bcssom%5D%20">www-style@w3.org</a>
(<a href="http://lists.w3.org/Archives/Public/www-style/">archived</a>)
with <samp>[cssom]</samp> at the start of the subject line.

<p class="publish">This is the [DATE] First Public Working Draft of CSSOM, produced by the
<a href="http://www.w3.org/Style/CSS/members">CSS Working Group</a> (part
of the <a href="http://www.w3.org/Style/">Style Activity</a>).
<!--XXX remove "First Public" after initial publication -->

<p>This document was produced by a group operating under the
<a href="http://www.w3.org/Consortium/Patent-Policy-20040205/">5 February 2004 W3C Patent Policy</a>.
W3C maintains a
<a href="http://www.w3.org/2004/01/pp-impl/32061/status" rel=disclosure>public list of any patent disclosures</a>
made in connection with the deliverables of the group; that page also
includes instructions for disclosing a patent. An individual who has
actual knowledge of a patent which the individual believes contains
<a href="http://www.w3.org/Consortium/Patent-Policy-20040205/#def-essential">Essential Claim(s)</a>
must disclose the information in accordance with
<a href="http://www.w3.org/Consortium/Patent-Policy-20040205/#sec-Disclosure">section 6 of the W3C Patent Policy</a>.</p>


<h2 class="no-num no-toc" id="toc">Table of Contents</h2>

<!--toc-->


<h2>Introduction</h2>

<p>This document formally specifies the core features of the CSS Object Model (CSSOM). Other documents in the CSSOM family of specifications
as well as other CSS related specifications define extensions to these core features.</p>

<p>The core features of the CSSOM are oriented towards providing basic capabilities to author-defined scripts to permit access to
and manipulation of style related state information and processes.</p>

<p>The features defined below are fundamentally based on prior specifications of the W3C DOM Working Group, primarily
<span data-anolis-ref class=informative>DOM2STYLE</span>. The purposes of the present document are (1) to improve on that prior work by providing
more technical specificity (so as to improve testability and interoperability), (2) to deprecate or remove certain less-widely implemented
features no longer considered to be essential in this context, and (3) to newly specify certain extensions that have been
or expected to be widely implemented.</p>

<p>A full list of the changes to API signatures can be found in <a href="#changes-from-dom-2-style"><cite>Changes from DOM-2 Style</cite></a>.</p>


<h2>Conformance</h2>

<p>All diagrams, examples, and notes in this specification are
non-normative, as are all sections explicitly marked non-normative.
Everything else in this specification is normative.

<p>The key words "MUST", "MUST NOT", "REQUIRED", <!--"SHALL", "SHALL
NOT",--> "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and
"OPTIONAL" in the normative parts of this document are to be
interpreted as described in RFC2119. For readability, these words do
not appear in all uppercase letters in this specification.
<span data-anolis-ref>RFC2119</span>

<p>Requirements phrased in the imperative as part of algorithms
(such as "strip any leading space characters" or "return false and
terminate these steps") are to be interpreted with the meaning of the
key word ("must", "should", "may", etc) used in introducing the
algorithm.

<p>Conformance requirements phrased as algorithms or specific steps
may be implemented in any manner, so long as the end result is
equivalent. (In particular, the algorithms defined in this
specification are intended to be easy to follow, and not intended to
be performant.)

<p id="hardwareLimitations">User agents may impose
implementation-specific limits on otherwise unconstrained inputs,
e.g. to prevent denial of service attacks, to guard against running
out of memory, or to work around platform-specific limitations. <!--fingerprint-->

<p>When a method or an attribute is said to call another method or attribute, the user agent must invoke its internal API for that attribute or method so that
e.g. the author can't change the behavior by overriding attributes or methods with custom properties or functions in ECMAScript.

<p>Unless otherwise stated, string comparisons are done in a
<span data-anolis-spec=dom>case-sensitive</span> manner.


<h2>Terminology</h2>

<p>This specification employs certain terminology from the following documents:
<cite>DOM</cite>,
<cite>HTML</cite>,
<cite>CSS Syntax</cite>,
<cite>URL</cite>,
<cite>Fetch</cite>,
<cite>Associating Style Sheets with XML documents</cite>
and
<cite>XML</cite>.
<span data-anolis-ref>DOM</span>
<span data-anolis-ref>HTML</span>
<span data-anolis-ref>CSSSYNTAX</span>
<span data-anolis-ref>URL</span>
<span data-anolis-ref>FETCH</span>
<span data-anolis-ref>XMLSS</span>
<span data-anolis-ref>XML</span>

<p>When this specification talks about object
<code title><var>A</var></code> where <code title><var>A</var></code> is actually an interface, it generally means an object implementing interface
<code title><var>A</var></code>.</p>

<p>The terms <dfn>whitespace</dfn> and <dfn>ignored</dfn> are defined in CSS. <span data-anolis-ref>CSS</span>

<p>The terms <dfn>cascaded value</dfn>, <dfn>computed value</dfn> and <dfn>used value</dfn> are defined in CSS Cascade and Inheritance.
<span data-anolis-ref>CSSCASCADE</span>

<p>The terms <dfn>simple selector</dfn>, <dfn>sequence of simple selectors</dfn>, <dfn>universal selector</dfn> and <dfn>group of selectors</dfn> are defined in
Selectors. <span data-anolis-ref>SELECTORS</span>

<p>The terms <dfn>namespace prefix</dfn> and <dfn>default namespace</dfn> are defined in CSS Namespaces Module. <span data-anolis-ref>CSSNAMESPACES</span>

<p>The term <dfn>list of CSS page selectors</dfn> refers to the comma-separated list of page selectors, as defined in CSS Paged Media Module.
<span data-anolis-ref>CSSPAGE</span>

<p>The terms <dfn>set</dfn> and <dfn>clear</dfn> to refer to the true and
false values of binary flags or variables, respectively. These terms are also used as verbs in which case they refer to
mutating some value to make it true or false, respectively.</p>

<p>The term <dfn>supported styling language</dfn> refers to CSS.

<p class=note>If another styling language becomes supported in user agents, this specification is expected to be updated as necessary.

<p>The term <dfn>supported CSS property</dfn> refers to a CSS property that the user agent implements, and that is defined to be a case-insensitive property in
the CSS specification. A <span>supported CSS property</span> must be in its lowercase form for the purpose of comparisons this specification.

<p class=note>CSS properties that are case-sensitive such as CSS Variables are author-defined and are represented with dedicated interfaces, and do not
participate in the base CSSOM API. <span data-anolis-ref class=informative>CSSVARIABLES</span>

<p>The terms <dfn>::before pseudo-element</dfn> and <dfn>::after pseudo-element</dfn> refer to the :before and :after pseudo-elements in CSS, except in this
specification the pseudo-elements are assumed to exist for all elements even if no box is generated for them. <span data-anolis-ref>CSS</span>

<h3>Common Serializing Idioms</h3>

<p>To <dfn>escape a character</dfn> means to create a string of
"<code title>\</code>" (U+005C), followed by the character.</p>

<p>To <dfn>escape a character as code point</dfn> means to create a
string of "<code title>\</code>" (U+005C), followed by the Unicode code point as
the smallest possible number of hexadecimal digits in the range 0-9 a-f
(U+0030 to U+0039 and U+0061 to U+0066) to represent the code point in
base 16, followed by a single SPACE (U+0020).</p>

<p>To <dfn>serialize an identifier</dfn> means to create a string represented
by the concatenation of, for each character of the identifier:</p>

<ul>
 <li>If the character is NULL (U+0000), then <span data-anolis-spec=dom title=concept-throw>throw</span> an
 <code data-anolis-spec=dom>InvalidCharacterError</code> exception and terminate these steps.</li>
 <li>If the character is in the range [\1-\1f] (U+0001 to U+001F) or
 [\7f-\9f] (U+007F to U+009F), then the character
 <span title="escape a character as code point">escaped as code point</span>.</li>
 <li>If the character is the first character and is in the range [0-9]
 (U+0030 to U+0039), then the character
 <span title="escape a character as code point">escaped as code point</span>.</li>
 <li>If the character is the second character and is in the range [0-9]
 (U+0030 to U+0039) and the first character is a "<code title>-</code>"
 (U+002D), then the character
 <span title="escape a character as code point">escaped as code point</span>.</li>
 <li>If the character is the second character and is "<code title>-</code>"
 (U+002D) and the first character is "<code title>-</code>" as well, then the
 <span title="escape a character">escaped</span> character.</li>
 <li>If the character is not handled by one of the above rules and is
 greater than or equal to U+0080, is "<code title>-</code>" (U+002D) or
 "<code title>_</code>" (U+005F), or is in one of the ranges [0-9] (U+0030 to
 U+0039), [A-Z] (U+0041 to U+005A), or [a-z] (U+0061 to U+007A), then the character
 itself.</li>
 <li>Otherwise, the <span title="escape a character">escaped</span>
 character.</li>
</ul>

<p>To <dfn>serialize a string</dfn> means to create a string represented
by '"' (U+0022), followed by the result of applying the rules
below to each character of the given string, followed by
'"' (U+0022):</p>

<ul>
 <li>If the character is NULL (U+0000), then <span data-anolis-spec=dom title=concept-throw>throw</span> an
 <code data-anolis-spec=dom>InvalidCharacterError</code> exception and terminate these steps.</li>
 <li>If the character is in the range [\1-\1f] (U+0001 to U+001F) or [\7f-\9f] (U+007F to
 U+009F), the character <span title="escape a character as code point">escaped as code point</span>.</li>
 <li>If the character is '"' (U+0022) or "<code title>\</code>"
 (U+005C), the <span title="escape a character">escaped</span> character.</li>
 <li>Otherwise, the character itself.</li>
</ul>

<p class="note">"<code title>'</code>" (U+0027) is not escaped because strings
are always serialized with '"' (U+0022).</p>

<p>To <dfn>serialize a URL</dfn> means to create a string represented by
"<code title>url(</code>", followed by the
<span title="serialize a string">string escaped</span> value of the given
string, followed by "<code title>)</code>".</p>

<p>To <dfn>serialize a comma-separated list</dfn> concatenate all items of
the list in list order while separating them by "<code title>, </code>", i.e.,
COMMA (U+002C) followed by a single SPACE (U+0020).</p>

<p>To <dfn>serialize a whitespace-separated list</dfn> concatenate all
items of the list in list order while separating them by "<code title> </code>", i.e.,
a single SPACE (U+0020).</p>

<p class="note">When serializing a list according to the above rules,
extraneous whitespace is not inserted prior to the first item or subsequent to
the last item. Unless otherwise specified, an empty list is serialized as the
empty string.</p>


<h2>Media Queries</h2>

<p>Media queries are defined by the Media Queries specification. This
section defines various concepts around media queries, including their API
and serialization form.</p>

<!-- XXX ref -->


<h3>Parsing Media Queries</h3>

<p>To
<dfn>parse a media query list</dfn> for a
given string <var>s</var> into a media query list is defined in
the Media Queries specification. Return the list of one or more media
queries that the algorithm defined there gives.</p> <!-- XXX ref -->

<p class="note">A media query that ends up being "ignored" will turn
into "<code title>not all</code>".</p>

<p>To
<dfn>parse a media query</dfn> for a given string
<var>s</var> means to follow the
<span>parse a media query list</span> steps and return null if more
than one media query is returned or a media query if a
single media query is returned.</p>

<p class="note">Again, a media query that ends up being "ignored" will
turn into "<code title>not all</code>".</p>


<h3>Serializing Media Queries</h3>

<p>To
<dfn>serialize a media query list</dfn>
run these steps:</p>

<ol>
 <li><p>If the media query list is empty return the empty string and
 terminate these steps.</p></li>

 <li><p><span title="serialize a media query">Serialize</span> each media query in the list of media queries, in the same order as they appear in the list of
 media queries, and then <span title="serialize a comma-separated list">serialize</span> the list.</p></li>
</ol>

<p>To
<dfn>serialize a media query</dfn> let
<var>s</var> be the empty string, run the steps below, and
finally return <var>s</var>:</p>

<ol>
 <li><p>If the media query is negated append "<code title>not</code>", followed
 by a single SPACE (U+0020), to <var>s</var>.</p></li>

 <li><p>Let <var>type</var> be the media type of the media query,
 <span title="serialize an identifier">escaped</span> and
 <span data-anolis-spec=dom>converted to ASCII lowercase</span>.</p></li>

 <li><p>If the media query does not contain media features append
 <var>type</var>, to <var>s</var>,
 then return <var>s</var> and terminate this algorithm.</p></li>

 <li><p>If <var>type</var> is not "<code title>all</code>" or if the
 media query is negated append <var>type</var>, followed by a
 single SPACE (U+0020), followed by "<code title>and</code>", followed by a single SPACE
 (U+0020), to <var>s</var>.</p></li>

 <li><p>Sort the media features in lexicographical order.</p></li>

 <li>
  <p>Then, for each media feature:</p>

  <ol>
   <li><p>Append a "<code title>(</code>" (U+0028), followed by the media feature
   name, <span data-anolis-spec=dom>converted to ASCII lowercase</span>,
   to <var>s</var>.</p></li>

   <li><p>If a value is given append a "<code title>:</code>" (U+003A), followed
   by a single SPACE (U+0020), followed by the
   <span title="serialize a media feature value">serialized media feature value</span>,
   to <var>s</var>.</p></li>

   <li><p>Append a "<code title>)</code>" (U+0029) to
   <var>s</var>.</p></li>

   <li><p>If this is not the last media feature append a single SPACE (U+0020),
   followed by "<code title>and</code>", followed by a single SPACE (U+0020), to
   <var>s</var>.</p></li>
  </ol>
 </li>
</ol>

<div class="example">
 <p>Here are some examples of input (first column) and output (second
 column):</p>

 <table class="complex data">
  <thead>
   <tr><th>Input<th>Output
  <tbody>
   <tr>
    <td><pre>not screen and (min-WIDTH:5px) AND (max-width:40px)</pre>
    <td><pre>not screen and (max-width: 40px) and (min-width: 5px)</pre>
   <tr>
    <td><pre>all and (color) and (color)</pre>
    <td><pre>(color)</pre>
 </table>
</div>



<h4>Serializing Media Feature Values</h4>

<p class="issue">This should probably be done in terms of mapping it to
serializing CSS values as media features are defined in terms of CSS
values after all.</p>

<p>To <dfn>serialize a media feature value</dfn>
named <var>v</var> locate <var>v</var> in the first
column of the table below and use the serialization format described in
the second column:</p>

<table class="complex data">
 <thead>
  <tr>
   <th>Media Feature
   <th>Serialization
 <tbody>
  <tr>
   <td>'width'
   <td>...
  <tr>
   <td>'height'
   <td>...
  <tr>
   <td>'device-width'
   <td>...
  <tr>
   <td>'device-height'
   <td>...
  <tr>
   <td>'orientation'
   <td>
    <p>If the value is 'portrait': "<code title>portrait</code>".</p>
    <p>If the value is 'landscape': "<code title>landscape</code>".</p>
  <tr>
   <td>'aspect-ratio'
   <td>...
  <tr>
   <td>'device-aspect-ratio'
   <td>...
  <tr>
   <td>'color'
   <td>...
  <tr>
   <td>'color-index'
   <td>...
  <tr>
   <td>'monochrome'
   <td>...
  <tr>
   <td>'resolution'
   <td>...
  <tr>
   <td>'scan'
   <td>
    <p>If the value is 'progressive': "<code title>progressive</code>".</p>
    <p>If the value is 'interlace': "<code title>interlace</code>".</p>
  <tr>
   <td>'grid'
   <td>...
</table>

<p>Other specifications can extend this table and vendor-prefixed media
features can have custom serialization formats as well.</p>


<h3>Comparing Media Queries</h3>

<p>To
<dfn>compare media queries</dfn>
<var>m1</var> and <var>m2</var> means to
<span title="serialize a media query">serialize</span> them both and
return true if they are a
<span data-anolis-spec=dom>case-sensitive</span> match and false if they
are not.</p>


<h3>The <code title>MediaList</code> Interface</h3>

<!--
//
// All members defined since DOM-2 Style. The only differences are:
//
//   1. addition of stringifier qualifier on mediaText
//   2. addition of getter qualifier on item
//   3. removal of raises(DOMException) from {append,delete}Medium
//
-->

<p>An object that implements the <code>MediaList</code> interface has an associated <dfn>collection of media queries</dfn>.</p>

<pre class=idl>interface <dfn>MediaList</dfn> {
  [TreatNullAs=EmptyString] stringifier attribute DOMString <span title=dom-MediaList-mediaText>mediaText</span>;
  readonly attribute unsigned long <span title=dom-MediaList-length>length</span>;
  getter DOMString <span title=dom-MediaList-item>item</span>(unsigned long index);
  void <span title=dom-MediaList-appendMedium>appendMedium</span>(DOMString medium);
  void <span title=dom-MediaList-deleteMedium>deleteMedium</span>(DOMString medium);
};</pre>

<p>The object's <span data-anolis-spec=webidl>supported property indices</span> are the numbers in the range zero to one less than the number of media queries
in the <span>collection of media queries</span> represented by the collection. If there are no such media queries, then there are no
<span data-anolis-spec=webidl>supported property indices</span>.

<p>To <dfn>create a <code>MediaList</code> object</dfn> with a string <var>text</var>, run the following steps:
<ol>
 <li><p>Create a new <code>MediaList</code> object.</p></li>
 <li><p>Set its <code title='dom-MediaList-mediaText'>mediaText</code> attribute to <var>text</var>.</p></li>
 <li><p>Return the newly created <code>MediaList</code> object.</p></li>
</ol>

<p>The <dfn title=dom-MediaList-mediaText><code>mediaText</code></dfn> attribute, on getting, must return a
<span title='serialize a media query list'>serialization</span> of the <span>collection of media queries</span>.</p>
<p>Setting the <code title=dom-MediaList-mediaText>mediaText</code> attribute must run these steps:
<ol>
 <li><p>Empty the <span>collection of media queries</span>.</p></li>
 <li><p>If the given value is the empty string terminate these steps.</p></li>
 <li><p>Append all the media queries as a result of <span title='parse a media query list'>parsing</span> the given
 value to the <span>collection of media queries</span>.</p></li>
</ol>

<p>The <dfn title=dom-MediaList-item><code>item(<var>index</var>)</code></dfn> method must return the media query in the <span>collection of media
queries</span> given by <var>index</var>, or null, if <var>index</var> is greater than or equal to the number of media queries in the
<span>collection of media queries</span>.</p>

<p>The <dfn title=dom-MediaList-length><code>length</code></dfn> attribute must return the number of media queries in the <span>collection of media
queries</span>.</p>

<p>The <dfn title=dom-MediaList-appendMedium><code>appendMedium(<var>medium</var>)</code></dfn> method must run these steps:</p>
<ol>
 <li><p>Let <var>m</var> be the result of <span title='parse a media query'>parsing</span> the given value.</p></li>
 <li><p>If <var>m</var> is null terminate these steps.</p></li>
 <li><p>If <span title='compare media queries'>comparing</span> <var>m</var> with any of the media queries in the
 <span>collection of media queries</span> returns true terminate these steps.</p></li>
 <li><p>Append <var>m</var> to the <span>collection of media queries</span>.</p></li>
</ol>

<p>The <dfn title=dom-MediaList-deleteMedium><code>deleteMedium(<var>medium</var>)</code></dfn> method must run these steps:</p>
<ol>
 <li><p>Let <var>m</var> be the result of <span title='parse a media query'>parsing</span> the given value.</p></li>
 <li><p>If <var>m</var> is null terminate these steps.</p></li>
 <li><p>Remove any media query from the <span>collection of media queries</span> for which
 <span title='compare media queries'>comparing</span> the media query with <var>m</var> returns true.</p></li>
</ol>

<h2>Selectors</h2>

<p>Selectors are defined in the Selectors specification. This section
mainly defines how to serialize them.</p> <!-- XXX ref -->

<!-- XXX ref universal selector etc? some are in <span> some not -->


<h3>Parsing Selectors</h3>

<p>To
<dfn>parse a group of selectors</dfn>
means to parse the value using the <code title>selectors_group</code>
production defined in the Selectors specification and return either a
group of selectors if parsing did not fail or null if parsing did
fail.</p> <!-- XXX ref -->


<h3>Serializing Selectors</h3>
<!-- http://dump.testsuite.org/2009/cssom/serializing-selectors.htm -->

<p>To
<dfn>serialize a group of selectors</dfn>
<span title="serialize a selector">serialize</span> each selector in the
group of selectors and then
<span title="serialize a comma-separated list">serialize</span> the
group.</p>

<p>To <dfn>serialize a selector</dfn> let
<var>s</var> be the empty string, run the steps below for each
part of the chain of the selector, and finally return
<var>s</var>:</p>

<ol>
 <li><p>If there is only one <span>simple selector</span> in the
 <span>sequence of simple selectors</span> which is a
 <span>universal selector</span>, append the result of
 <span title="serialize a simple selector">serializing</span> the
 <span>universal selector</span> to <var>s</var>.</p></li>

 <li><p>Otherwise, for each <span>simple selector</span> in the
 <span>sequence of simple selectors</span> that is not a
 universal selector of which the
 <span>namespace prefix</span> maps to a namespace that is not the
 <span>default namespace</span>
 <span title="serialize a simple selector">serialize</span> the
 <span>simple selector</span> and append the result to
 <var>s</var>.</p></li>

 <li><p>If this is not the last part of the chain of the selector append a
 single SPACE (U+0020), followed by the combinator
 "<code title>></code>",
 "<code title>+</code>", or
 "<code title>~</code>"
 as appropriate, followed by another single SPACE (U+0020) if the combinator was
 not whitespace, to <var>s</var>.</p></li>

 <li><p>If this is the last part of the chain of the selector and there is
 a pseudo-element, append "<code title>::</code>" followed by the name of the
 pseudo-element, to <var>s</var>.</p></li>
</ol>


<p>To
<dfn>serialize a simple selector</dfn>
let <var>s</var> be the empty string, run the steps below, and
finally return <var>s</var>:</p>

<dl class="switch">
 <dt>type selector</dt>
 <dt>universal selector</dt>
 <dd>
  <ol>
   <li><p>If the <span>namespace prefix</span> maps to a namespace that is
   not the <span>default namespace</span> and is not the
   null namespace (not in a namespace) append the
   <span title="serialize an identifier">escaped</span>
   <span>namespace prefix</span>, followed by a "<code title>|</code>" (U+007C)
   to <var>s</var>.</p></li>

   <li><p>If the <span>namespace prefix</span> maps to a namespace that is
   the null namespace (not in a namespace) append
   "<code title>|</code>" (U+007C) to <var>s</var>.</p></li>
   <!-- This includes |* -->

   <li><p>If this is a type selector append the
   <span title="serialize an identifier">escaped</span> element name to
   <var>s</var>.</p></li>

   <li><p>If this is a universal selector append "<code title>*</code>" (U+002A)
   to <var>s</var>.</p></li>
  </ol>
 </dd>

 <dt>attribute selector</dt>
 <dd>
  <ol>
   <li><p>Append "<code title>[</code>" (U+005B) to
   <var>s</var>.</p></li>

   <li><p>If the <span>namespace prefix</span> maps to a namespace that is
   not the null namespace (not in a namespace) append the
   <span title="serialize an identifier">escaped</span>
   <span>namespace prefix</span>, followed by a "<code title>|</code>" (U+007C)
   to <var>s</var>.</p></li>

   <li><p>Append the <span title="serialize an identifier">escaped</span>
   attribute name to <var>s</var>.</p></li>

   <li><p>If there is an attribute value specified, append
   "<code title>=</code>",
   "<code title>~=</code>",
   "<code title>|=</code>",
   "<code title>^=</code>",
   "<code title>$=</code>", or
   "<code title>*=</code>"
   as appropriate (depending on the type of attribute selector), followed
   by the <span title="serialize a string">string escaped</span>
   attribute value, to <var>s</var>.</p></li>

   <li><p>Append "<code title>]</code>" (U+005D) to
   <var>s</var>.</p></li>
  </ol>
 </dd>

 <dt>class selector</dt>
 <dd><p>Append a "<code title>.</code>" (U+002E), followed by the
 <span title="serialize an identifier">escaped</span> class name to
 <var>s</var>.</p></dd>

 <dt>ID selector</dt>
 <dd><p>Append a "<code title>#</code>" (U+0023), followed by the
 <span title="serialize an identifier">escaped</span> ID to
 <var>s</var>.</p></dd>

 <dt>pseudo-class</dt>
 <dd>
  <p>If the pseudo-class does not accept arguments append
  "<code title>:</code>" (U+003A), followed by the name of the pseudo-class, to
  <var>s</var>.</p>

  <p>Otherwise, append "<code title>:</code>" (U+003A), followed by the name of
  the pseudo-class, followed by "<code title>(</code>" (U+0028), followed by the
  value of the pseudo-class argument determined as per below, followed by
  "<code title>)</code>" (U+0029), to <var>s</var>.</p>

  <dl class="switch">
   <dt><code title>:lang()</code></dt>
   <dd><p>The <span title="serialize an identifier">escaped</span>
   value.</p></dd>

   <dt><code title>:nth-child()</code></dt>
   <dt><code title>:nth-last-child()</code></dt>
   <dt><code title>:nth-of-type()</code></dt>
   <dt><code title>:nth-last-of-type()</code></dt>
   <dd><p>The result of serializing the value using the rules for <span data-anolis-spec=csssyntax>serializing &lt;an+b></span>.
   
   <dt><code title>:not()</code></dt>
   <dd><p>The result of serializing the value using the rules for
   <span title="serialize a group of selectors">serializing a group of selectors</span>.</p></dd>
  </dl>
 </dd>
</dl>


<h2>CSS</h2>


<h3>CSS Style Sheets</h3>

<p>A <dfn>CSS style sheet</dfn> is an abstract concept that
represents a style sheet as defined by the CSS specification. In the CSSOM a
<span>CSS style sheet</span> is represented as a <code>CSSStyleSheet</code> object. A
<span>CSS style sheet</span> has a number of associated state items:</p>

<dl>
 <dt><dfn title=concept-css-style-sheet-type>type</dfn></dt>
 <dd><p>The literal string "<code title>text/css</code>".</p></dd>

 <dt><dfn title=concept-css-style-sheet-location>location</dfn></dt>
 <dd><p>Specified when created. The <span data-anolis-spec=url title=concept-absolute-url>absolute URL</span> of the first request of the
 <span>CSS style sheet</span> or null if the <span>CSS style sheet</span> was
 embedded. Does not change during the lifetime of the <span>CSS style sheet</span>.</p></dd>

 <dt><dfn title=concept-css-style-sheet-parent-css-style-sheet>parent CSS style sheet</dfn></dt>
 <dd><p>Specified when created. The <span>CSS style sheet</span> that is the parent of the
 <span>CSS style sheet</span> or null if there is no associated parent.</p></dd>

 <dt><dfn title=concept-css-style-sheet-owner-node>owner node</dfn></dt>
 <dd><p>Specified when created. The DOM node associated with the <span>CSS style sheet</span> or
 null if there is no associated DOM node.</p></dd>

 <dt><dfn title=concept-css-style-sheet-owner-css-rule>owner CSS rule</dfn></dt>
 <dd><p>Specified when created. The <span>CSS rule</span> in the <span title=concept-css-style-sheet-parent-css-style-sheet>parent CSS style sheet</span>
 that caused the inclusion of the <span>CSS style sheet</span> or null if
 there is no associated rule.</p></dd>

 <dt><dfn title=concept-css-style-sheet-media>media</dfn></dt>
 <dd>
  <p>Specified when created. The <code>MediaList</code> object associated with the
  <span>CSS style sheet</span>.</p>

  <p>If this property is specified to a string, the <span title=concept-css-style-sheet-media>media</span> must be set to the return value of invoking
  <span>create a <code>MediaList</code> object</span> steps for that string.</p>
  
  <p>If this property is specified to an attribute of the <span title=concept-css-style-sheet-owner-node>owner node</span>, the
  <span title=concept-css-style-sheet-media>media</span> must be set to the return value of invoking <span>create a <code>MediaList</code> object</span> steps
  for the value of that attribute. Whenever the attribute is set, changed or removed, the <span title=concept-css-style-sheet-media>media</span>'s
  <code title=dom-MediaList-mediaText>mediaText</code> attribute must be set to the new value of the attribute, or to null if the attribute is absent.
  
  <p class=note>Changing the <span title=concept-css-style-sheet-media>media</span>'s <code title=dom-MediaList-mediaText>mediaText</code> attribute does not
  change the corresponding attribute on the <span title=concept-css-style-sheet-owner-node>owner node</span>.
 </dd>

 <dt><dfn title=concept-css-style-sheet-title>title</dfn></dt>
 <dd>
  <p>Specified when created. The title of the <span>CSS style sheet</span>, which can be the empty string.</p>

  <div class="example">
   <p>In the following, the <span title=concept-css-style-sheet-title>title</span> is non-empty
   for the first style sheet, but is empty for the second and third style sheets.</p>
   <pre>&lt;style title="papaya whip">
  body { background: #ffefd5; }
&lt;/style></pre>
     <pre>&lt;style title="">
  body { background: orange; }
&lt;/style></pre>
     <pre>&lt;style>
  body { background: brown; }
&lt;/style></pre>
  </div>
  
  <p>If this property is specified to an attribute of the <span title=concept-css-style-sheet-owner-node>owner node</span>, the
  <span title=concept-css-style-sheet-title>title</span> must be set to the value of that attribute. Whenever the attribute is set, changed or removed, the
  <span title=concept-css-style-sheet-title>title</span> must be set to the new value of the attribute, or to the empty string if the attribute is absent.
  
 </dd>

 <dt><dfn title=concept-css-style-sheet-alternate-flag>alternate flag</dfn></dt>
 <dd>
  <p>Specified when created. Either set or clear. Clear by default.</p>

  <div class="example">
   <p>The following <span title="CSS style sheet">CSS style sheets</span> have
   their <span title=concept-css-style-sheet-alternate-flag>alternate flag</span> set:</p>

   <pre>&lt;?xml-stylesheet alternate="yes" title="x" href="data:text/css,&hellip;"?></pre>

   <pre>&lt;link rel="alternate stylesheet" title="x" href="data:text/css,&hellip;"></pre>
  </div>
 </dd>

 <dt><dfn title=concept-css-style-sheet-disabled-flag>disabled flag</dfn></dt>
 <dd>
  <p>Either set or clear. Clear by default.</p>

  <p class="note">Even when clear it does not necessarily mean that the
  <span>CSS style sheet</span> is actually used for rendering.</p>
 </dd>


 <dt><dfn title=concept-css-style-sheet-css-rules>CSS rules</dfn></dt>
 <dd><p>The <span title="CSS rule">CSS rules</span> associated with the
 <span>CSS style sheet</span>.</p></dd>
 
 <dt><dfn title=concept-css-style-sheet-origin-clean-flag>origin-clean flag</dfn>
 <dd><p>Specified when created. Either set or clear. If it is set, the API allows reading and modifying of the <span title=concept-css-style-sheet-css-rules>CSS
 rules</span>.
</dl>


<h4>The <code title>StyleSheet</code> Interface</h4>

<!--
//
// All members defined since DOM-2 Style. Only difference
// is addition of [PutForwards=mediaText], which is presently
// not defined in CSSOM draft.
//
-->

<p>The <code>StyleSheet</code> interface represents an abstract, base style sheet.</p>

<pre class=idl>interface <dfn>StyleSheet</dfn> {
  readonly attribute DOMString <span title=dom-StyleSheet-type>type</span>;
  readonly attribute DOMString? <span title=dom-StyleSheet-href>href</span>;
  readonly attribute (<span data-anolis-spec=dom>Element</span> or <span data-anolis-spec=dom>ProcessingInstruction</span>)? <!--
  --><span title=dom-StyleSheet-ownerNode>ownerNode</span>;
  readonly attribute <span>StyleSheet</span>? <span title=dom-StyleSheet-parentStyleSheet>parentStyleSheet</span>;
  readonly attribute DOMString? <span title=dom-StyleSheet-title>title</span>;
  [SameObject, PutForwards=<span title=dom-MediaList-mediaText>mediaText</span>] readonly attribute <span>MediaList</span> <!--
  --><span title=dom-StyleSheet-media>media</span>;
  attribute boolean <span title=dom-StyleSheet-disabled>disabled</span>;
};</pre>

<p>The <dfn title=dom-StyleSheet-type><code>type</code></dfn> attribute must return the <span title=concept-css-style-sheet-type>type</span>.</p>

<p>The <dfn title=dom-StyleSheet-href><code>href</code></dfn> attribute must return the <span title=concept-css-style-sheet-location>location</span>.</p>

<p>The <dfn title=dom-StyleSheet-ownerNode><code>ownerNode</code></dfn> attribute must return the <span title=concept-css-style-sheet-owner-node>owner
node</span>.</p>

<p>The <dfn title=dom-StyleSheet-parentStyleSheet><code>parentStyleSheet</code></dfn> attribute must return the
<span title=concept-css-style-sheet-parent-css-style-sheet>parent CSS style sheet</span>.</p>

<p>The <dfn title=dom-StyleSheet-title><code>title</code></dfn> attribute must return the <span title=concept-css-style-sheet-title>title</span> or null if
<span title=concept-css-style-sheet-title>title</span> is the empty string.</p>

<p>The <dfn title=dom-StyleSheet-media><code>media</code></dfn> attribute must return the <span title=concept-css-style-sheet-media>media</span>.</p>

<p>The <dfn title=dom-StyleSheet-disabled><code>disabled</code></dfn> attribute, on getting, must return true if the
<span title=concept-css-style-sheet-disabled-flag>disabled flag</span>
is set, or false otherwise. On setting, the <code title=dom-StyleSheet-disabled>disabled</code> attribute must set the
<span title=concept-css-style-sheet-disabled-flag>disabled flag</span> if the new value is true, or unset the
<span title=concept-css-style-sheet-disabled-flag>disabled flag</span> otherwise.</p>


<h4>The <code title>CSSStyleSheet</code> Interface</h4>

<!--
//
// All members defined since DOM-2 Style. The only differences are:
//
//   1. removal of raises(DOMException) on {insert,delete}Rule operations.
//
-->

<p>The <code>CSSStyleSheet</code> interface represents a <span>CSS style sheet</span>.</p>
<pre class=idl>interface <dfn>CSSStyleSheet</dfn> : <span>StyleSheet</span> {
  readonly attribute <span>CSSRule</span>? <span title=dom-CSSStyleSheet-ownerRule>ownerRule</span>;
  [SameObject] readonly attribute <span>CSSRuleList</span> <span title=dom-CSSStyleSheet-cssRules>cssRules</span>;
  unsigned long <span title=dom-CSSStyleSheet-insertRule>insertRule</span>(DOMString rule, unsigned long index);
  void <span title=dom-CSSStyleSheet-deleteRule>deleteRule</span>(unsigned long index);
};</pre>

<p>The <dfn title=dom-CSSStyleSheet-ownerRule><code>ownerRule</code></dfn> attribute must return the <span title=concept-css-style-sheet-owner-css-rule>owner
CSS rule</span>. If a value other than null is ever returned, then that same value must always be returned on each get access.</p>

<p>The <dfn title=dom-CSSStyleSheet-cssRules><code>cssRules</code></dfn> attribute must follow these steps:

<ol>
 <li><p>If the <span title=concept-css-style-sheet-origin-clean-flag>origin-clean flag</span> is clear,
 <span title=concept-throw data-anolis-spec=dom>throw</span> a <code data-anolis-spec=dom>SecurityError</code> exception.
 <li><p>Return a read-only, live <code>CSSRuleList</code> object representing
 the <span title=concept-css-style-sheet-css-rules>CSS rules</span>.</p>
 <p class='note'>Even though the returned <code>CSSRuleList</code> object is read-only (from the perspective of
 client-authored script), it can nevertheless change over time due to its liveness status. For example, invoking
 the <code title=dom-CSSStyleSheet-insertRule>insertRule()</code> or <code title=dom-CSSStyleSheet-deleteRule>deleteRule()</code> methods can result in
 mutations reflected in the returned object.</p>
</ol>

<p>The <dfn title=dom-CSSStyleSheet-insertRule><code>insertRule(<var>rule</var>, <var>index</var>)</code></dfn> method must run the following steps:

<ol>
 <li><p>If the <span title=concept-css-style-sheet-origin-clean-flag>origin-clean flag</span> is clear,
 <span title=concept-throw data-anolis-spec=dom>throw</span> a <code data-anolis-spec=dom>SecurityError</code> exception.
 <li><p>Return the result of invoking <span>insert a CSS rule</span> <var>rule</var> in the <span title=concept-css-style-sheet-css-rules>CSS rules</span>
 at <var>index</var>.
</ol>

<p>The <dfn title=dom-CSSStyleSheet-deleteRule><code>deleteRule(<var>index</var>)</code></dfn> method must run the following steps:

<ol>
 <li><p>If the <span title=concept-css-style-sheet-origin-clean-flag>origin-clean flag</span> is clear,
 <span title=concept-throw data-anolis-spec=dom>throw</span> a <code data-anolis-spec=dom>SecurityError</code> exception.
 <li><p><span>Remove a CSS rule</span> in the <span title=concept-css-style-sheet-css-rules>CSS rules</span> at <var>index</var>.
</ol>

<h3>CSS Style Sheet Collections</h3>

<p>Below various new concepts are defined that are associated with each
<code data-anolis-spec=dom>Document</code> object.</p>

<p>Each <code data-anolis-spec=dom>Document</code> has an associated list of zero or more
<span title="CSS style sheet">CSS style sheets</span>, named the
<dfn>document CSS style sheets</dfn>. This is
an ordered list that contains all
<span title="CSS style sheet">CSS style sheets</span> associated with the
<code data-anolis-spec=dom>Document</code>, in
<span data-anolis-spec=dom title=concept-tree-order>tree order</span>, with
<span title="CSS style sheet">CSS style sheets</span> created from HTTP
<code title>Link</code> headers first, if any, in header
order.</p>

<p>To <dfn>create a CSS style sheet</dfn>, run these
steps:</p>

<ol>
 <li><p>Create a new <span>CSS style sheet</span> object and set its
 properties as specified.</p></li>

 <li>
  <p>Then run the <span>add a CSS style sheet</span> steps for the newly created <span>CSS style sheet</span>.
 
  <p class=warning>If the <span title=concept-css-style-sheet-origin-clean-flag>origin-clean flag</span> is unset, this can expose information from the user's
  intranet.
</ol>

<p>To <dfn>add a CSS style sheet</dfn>, run these
steps:</p>

<ol>
 <li><p>Add the <span>CSS style sheet</span> to the list of
 <span>document CSS style sheets</span> at the appropriate location. The
 remainder of these steps deal with the
 <span title=concept-css-style-sheet-disabled-flag>disabled flag</span>.</p></li>

 <li><p>If the <span title=concept-css-style-sheet-disabled-flag>disabled flag</span> is set, terminate
 these steps.</p></li>

 <li><p>If the <span title=concept-css-style-sheet-title>title</span> is not the empty string, the
 <span title=concept-css-style-sheet-alternate-flag>alternate flag</span> is clear, and
 <span>preferred CSS style sheet set name</span> is the empty string
 <span>change the preferred CSS style sheet set name</span> to the
 <span title=concept-css-style-sheet-title>title</span>.</p></li>

 <li>
  <p>If any of the following is true clear the
  <span title=concept-css-style-sheet-disabled-flag>disabled flag</span> and terminate these steps:

  <ul>
   <li><p>The <span title=concept-css-style-sheet-title>title</span> is the empty string.</p></li>
   <li><p>The <span>last CSS style sheet set name</span> is null and the
   <span title=concept-css-style-sheet-title>title</span> is a
   <span data-anolis-spec=dom>case-sensitive</span> match
   for the <span>preferred CSS style sheet set name</span>.</p></li>
   <li><p>The <span title=concept-css-style-sheet-title>title</span> is a
   <span data-anolis-spec=dom>case-sensitive</span> match for the
   <span>last CSS style sheet set name</span>.</p></li>
  </ul>
 </li>

 <li><p>Set the <span title=concept-css-style-sheet-disabled-flag>disabled flag</span>.</li>
</ol>

<p>To <dfn>remove a CSS style sheet</dfn>, run these steps:</p>

<ol>
 <li><p>Remove the <span>CSS style sheet</span> from the list of <span>document CSS style sheets</span>.
 
 <li><p>Set the <span>CSS style sheet</span>'s <span title=concept-css-style-sheet-parent-css-style-sheet>parent CSS style sheet</span>,
 <span title=concept-css-style-sheet-owner-node>owner node</span> and <span title=concept-css-style-sheet-owner-css-rule>owner CSS rule</span> to null.
 
 <!-- "associated CSS style sheet" is defined in terms of owner node, so we don't need to set it to null explicitly -->
 
 <!-- XXX does anything need to happen wrt alternate style sheets? what if the last style sheet with the preferred style sheet set name is removed? -->
</ol>

<p>A <dfn>persistent CSS style sheet</dfn> is a
<span>CSS style sheet</span> from the <span>document CSS style sheets</span>
whose <span title=concept-css-style-sheet-title>title</span> is the empty string and whose
<span title=concept-css-style-sheet-alternate-flag>alternate flag</span> is clear.</p>

<p>A <dfn>CSS style sheet set</dfn> is an ordered
collection of one or more <span title="CSS style sheet">CSS style sheets</span>
from the <span>document CSS style sheets</span> which have an identical
<span title=concept-css-style-sheet-title>title</span> that is not the empty string.</p>

<p>A <dfn>CSS style sheet set name</dfn> is the
<span title=concept-css-style-sheet-title>title</span> the <span>CSS style sheet set</span> has in
common.</p>

<p>An <dfn>enabled CSS style sheet set</dfn> is a
<span>CSS style sheet set</span> of which each <span>CSS style sheet</span> has
its <span title=concept-css-style-sheet-disabled-flag>disabled flag</span> clear.</p>

<p>To <dfn>enable a CSS style sheet set</dfn>
with name <var>name</var>, run these steps:</p>

<ol>
 <li><p>If <var>name</var> is the empty string, set the
 <span title=concept-css-style-sheet-disabled-flag>disabled flag</span> for each <span>CSS style sheet</span>
 that is in a <span>CSS style sheet set</span> and terminate these steps.</li>

 <li><p>Clear the <span title=concept-css-style-sheet-disabled-flag>disabled flag</span> for each
 <span>CSS style sheet</span> in a <span>CSS style sheet set</span> whose
 <span>CSS style sheet set name</span> is a
 <span data-anolis-spec=dom>case-sensitive</span> match for
 <var>name</var> and set it for all other
 <span title="CSS style sheet">CSS style sheets</span> in a
 <span>CSS style sheet set</span>.</p></li>
</ol>

<p>To <dfn>select a CSS style sheet set</dfn>
with name <var>name</var>, run these steps:</p>

<ol>
 <li><p><span>enable a CSS style sheet set</span> with name
 <var>name</var>.</p></li>

 <li><p>Set <span>last CSS style sheet set name</span> to
 <var>name</var>.</p></li>
</ol>

<p>A <dfn>last CSS style sheet set name</dfn>
is a concept to determine what <span>CSS style sheet set</span> was last
<span title="select a CSS style sheet set">selected</span>. Initially its
value is null.</p>

<p>A
<dfn>preferred CSS style sheet set name</dfn>
is a concept to determine which
<span title="CSS style sheet">CSS style sheets</span> need to have their
<span title=concept-css-style-sheet-disabled-flag>disabled flag</span> clear. Initially its value
is the empty string.

<p>To
<dfn>change the preferred CSS style sheet set name</dfn>
with name <var>name</var>, run these steps:</p>

<ol>
 <li><p>Let <var>current</var> be the <span>preferred CSS style sheet set name</span>.</p></li>

 <li><p>Set <span>preferred CSS style sheet set name</span> to
 <var>name</var>.</p></li>

 <li><p>If <var>name</var> is not a
 <span data-anolis-spec=dom>case-sensitive</span> match for
 <var>current</var> and
 <span>last CSS style sheet set name</span> is null
 <span>enable a CSS style sheet set</span> with name
 <var>name</var>.</p></li>
</ol>

<!-- XXX ought to define "applied"

thoughts:
  depends on disabled flag, alternate flag, media queries, sheesh
 -->


<h4>The HTTP <code title>Default-Style</code> Header</h4>

<p>The HTTP <code title="http-default-style">Default-Style</code> header
can be used to set the <span>preferred CSS style sheet set name</span>
influencing which <span>CSS style sheet set</span> is (initially) the
<span>enabled CSS style sheet set</span>.</p>

<p>For each HTTP <code title="http-default-style">Default-Style</code>
header, in header order, the user agent must
<span>change the preferred CSS style sheet set name</span> with name being the
value of the header.</p>


<h4>The <code title>StyleSheetList</code> Interface</h4>

<p>The <code>StyleSheetList</code> interface represents an ordered collection of <span title="CSS style sheet">CSS style sheets</span>.</p>

<pre class=idl>[ArrayClass]
interface <dfn>StyleSheetList</dfn> {
  getter <span>StyleSheet</span>? <span title=dom-StyleSheetList-item>item</span>(unsigned long index);
  readonly attribute unsigned long <span title=dom-StyleSheetList-length>length</span>;
};</pre>

<p>The object's <span data-anolis-spec=webidl>supported property indices</span> are the numbers in the range zero to one less than the number of
<span title="CSS style sheet">CSS style sheets</span> represented by the collection. If there are no such <span title="CSS style sheet">CSS style sheets</span>,
then there are no <span data-anolis-spec=webidl>supported property indices</span>.

<p>The <dfn title=dom-StyleSheetList-item><code>item(<var>index</var>)</code></dfn> method must return the <var>index</var>th <span>CSS style
sheet</span> in the collection. If there is no <var>index</var>th object in the collection, then the method must return null.

<p>The <dfn title=dom-StyleSheetList-length><code>length</code></dfn> attribute must return the number of <span title="CSS style sheet">CSS style sheets</span>
represented by the collection.

<h4>Extensions to the <code title>Document</code> Interface</h4>

<!--
//
// Significant changes since DOM-2 Style:
//
//   1. move styleSheets from separate interface (DocumentStyle) to Document
//   2. addition of selectedStyleSheetSet, lastStyleSheetSet, preferredStyleSheetSet, styleSheetSets, and enableStyleSheetsForSet members
//
// N.B. HTML4 Section 14.3 "External Style Sheets" introduces the concept of a "group [of] alternate style sheets ... under a single style [sheet set] name",
// but does not actually use the term "style sheet set". See http://www.w3.org/TR/html401/present/styles.html#h-14.3 for details.
//
// N.B. According to HTML4 Section 14.3, a "persistent style sheet ... must apply in addition to any alternate style sheet".
//
// N.B. HTML4 Section 14.3 distinguishes the three categories of style sheets as follows:
//
//   * persistent - @rel='stylesheet', @title is missing (or empty string?)
//   * preferred  - @rel='stylesheet', @title is present (and non-empty?)
//   * alternate  - @rel='alternate stylesheet', @title is present (and non-empty?)
//
// Also, HTML5 effectively defines:
//
//   * ignored    - @rel='alternate stylesheet', @title is missing (or is empty string?) - in this case, LinkStyle.style must evaluate to null
//
// N.B. HTML4 Section 4.3 allows author to specify the default preferred style sheet [set]... [presumably in the case that there are multiple preferred style
// sheet sets]:
//
//   * in content - <META http-equiv="Default-Style" content="compact">
//   * in http - e.g., using response header - "Default-Style: compact"
//   * if multiple of the above forms are present, then the LAST one [seen or parsed] takes precedence; HOWEVER, if two or more LINK elements specify preferred
//     style [sheet sets], the FIRST one present in the document takes precedence;
//   * preferred style sheets specified using the above (META or HTTP header equivalent) take precedence over those specified with LINK
//
// N.B. CSSOM Draft presently employs the term "Style Sheet Collection"
//
// Spec Issues:
//
//   1. need to specify which style sheets are included in styleSheets, and in which order:
//
//      * from Link HTTP header reference
//      * from <?xml-stylesheet ...?>
//      * from LINK element, @rel='stylesheet'|'alternate stylesheet'
//      * from STYLE element
//
//   2. for purpose of comparing two titled (named) style sheets, is title (name) compared on case-sensitive or case-insensitive basis
//
//   3. CSSOM 6.2 appears to imply that one can create a CSSStyleSheet (or StyleSheet) object and add it to a Document. However, that is not the case; rather
//      it is necessary to create an HTMLLinkElement or HTMLStyleElement element to indirectly create an empty StyleSheet, then this element can be added to the
//      Document.
//
-->

<pre class=idl>partial interface <span data-anolis-spec=dom>Document</span> {
  [SameObject] readonly attribute <span>StyleSheetList</span> <span title=dom-Document-styleSheets>styleSheets</span>;<!-- DOM-2 - defined on DocumentStyle
  interface -->
  attribute DOMString? <span title=dom-Document-selectedStyleSheetSet>selectedStyleSheetSet</span>;<!-- new -->
  readonly attribute DOMString? <span title=dom-Document-lastStyleSheetSet>lastStyleSheetSet</span>;<!-- new -->
  readonly attribute DOMString? <span title=dom-Document-preferredStyleSheetSet>preferredStyleSheetSet</span>;<!-- new -->
  readonly attribute DOMString[] <span title=dom-Document-styleSheetSets>styleSheetSets</span>;<!-- new -->
  void <span title=dom-Document-enableStyleSheetsForSet>enableStyleSheetsForSet</span>(DOMString? name);<!-- new -->
};</pre>

<p>The <dfn title=dom-Document-styleSheets><code>styleSheets</code></dfn> attribute must return a <code>StyleSheetList</code> collection representing
the <span>document CSS style sheets</span>.</p>
<p class='note'>Because of historical IDL limitations the <code title=dom-Document-styleSheets>styleSheets</code> attribute
used to be on a separate interface, <code title>DocumentStyle</code>.</p>

<p>The <dfn title=dom-Document-selectedStyleSheetSet><code>selectedStyleSheetSet</code></dfn> attribute, on getting, must run these steps:</p>
<ol>
 <li><p>If there is a single <span>enabled CSS style sheet set</span> and no
 other <span>document CSS style sheets</span> with a
 <span title=concept-css-style-sheet-title>title</span> that is not the empty string have the
 <span title=concept-css-style-sheet-disabled-flag>disabled flag</span> unset, return the
 <span>CSS style sheet set name</span> of the
 <span>enabled CSS style sheet set</span> and terminate these steps.</li>
 
 <li><p>Otherwise, if <span title="CSS style sheet">CSS style sheets</span> from
 different <span title='CSS style sheet set'>CSS style sheet sets</span> have
 their <span title=concept-css-style-sheet-disabled-flag>disabled flag</span> unset, return
 null and terminate these steps.</li>
 
 <li>
  <p>Otherwise, return the empty string.</p>
 
  <p class='note'>At this point either all
  <span title="CSS style sheet">CSS style sheets</span> with a
  <span title=concept-css-style-sheet-title>title</span> that is not the empty string have the
  <span title=concept-css-style-sheet-disabled-flag>disabled flag</span> set, or there are no such
  <span title="CSS style sheet">CSS style sheets</span>.</p>
 </li>
</ol>

<p>On setting the
<code title='dom-Document-selectedStyleSheetSet'>selectedStyleSheetSet</code>
attribute these steps must be run:</p>

<ol>
 <li><p>If the value is null terminate this set of steps.</p></li>
 <li><p>Otherwise, <span>select a CSS style sheet set</span> with the name being the
 value passed.</p></li>
</ol>

<p>From the DOM's perspective, all views have the same
<code title='dom-Document-selectedStyleSheetSet'>selectedStyleSheetSet</code>.
If a user agent supports multiple views with different selected
alternative style sheets, then this attribute (and the
<code>StyleSheet</code> interface's
<code title='dom-StyleSheet-disabled'>disabled</code> attribute)
must return and set the value for the default
view.</p>

<p>The <dfn title=dom-Document-lastStyleSheetSet><code>lastStyleSheetSet</code></dfn> attribute must return the <span>last CSS style sheet set name</span>.</p>
<p class='note'>This attribute is initially null.</p>

<p>The <dfn title=dom-Document-preferredStyleSheetSet><code>preferredStyleSheetSet</code></dfn> attribute must return the <span>preferred CSS style sheet set
name</span>.</p>
<p class='note'>Unlike <code title='dom-Document-lastStyleSheetSet'>lastStyleSheetSet</code>,
this attribute is initially the empty string.</p>

<p>The <dfn title=dom-Document-styleSheetSets><code>styleSheetSets</code></dfn> attribute must return a read only array of the
<span title='CSS style sheet set name'>CSS style sheet set names</span> of the <span title='CSS style sheet set'>CSS style sheet sets</span>, in order of the
<span>document CSS style sheets</span>. The array is live; if the <span>document CSS style sheets</span> change, the array must be updated as appropriate.</p>

<p>The <dfn title=dom-Document-enableStyleSheetsForSet><code>enableStyleSheetsForSet(<var>name</var>)</code></dfn> method must, when invoked, run these
steps:</p>
<ol>
 <li><p>If <var>name</var> is null terminate these steps.</p></li>
 <li><p><span>enable a CSS style sheet set</span> with name <var>name</var>.</p></li>
</ol>
<p class='note'><span title='CSS style sheet'>CSS style sheets</span> with a
<span title=concept-css-style-sheet-title>title</span> that is the empty string are never affected by this method.
This method does not change the values of the
<code title='dom-Document-lastStyleSheetSet'>lastStyleSheetSet</code> or
<code title='dom-Document-preferredStyleSheetSet'>preferredStyleSheetSet</code> attributes.</p>


<h4>Interaction with the User Interface</h4>

<p>The user interface of Web browsers that support style sheets
should list the style sheet titles given in the
<code title="dom-Document-styleSheetSets">styleSheetSets</code> list,
showing the
<code title="dom-Document-selectedStyleSheetSet">selectedStyleSheetSet</code>
as the selected style sheet set, leaving none selected if it is
null or the empty string, and selecting an extra option
"Basic Page Style" (or similar) if it is the empty string and the
<code title="dom-Document-preferredStyleSheetSet">preferredStyleSheetSet</code>
is the empty string as well.</p>

<p>Selecting a style sheet from this list should
use the <span>select a CSS style sheet set</span> set of steps. This
(by definition) affects the
<code title="dom-Document-lastStyleSheetSet">lastStyleSheetSet</code>
attribute.</p>

<h5>Persisting the selected CSS style sheet set</h5>

<p>If a user agent persist the <span title="select a CSS style sheet set">selected</span> <span>CSS style sheet set</span>, it should use
the value of the
<code title="dom-Document-selectedStyleSheetSet">selectedStyleSheetSet</code>
attribute, or if that is null, the
<code title="dom-Document-lastStyleSheetSet">lastStyleSheetSet</code>
attribute, when leaving the page (or at some other time) to determine the
set name to store. If that is null then the <span>CSS style sheet set</span> should not be
persisted.</p>

<p>When re-setting the <span>CSS style sheet set</span> to the persisted value (which can
happen at any time, typically at the first time the <span title="CSS style sheet">CSS style sheets</span> are
needed for styling the document, after the <code title>&lt;head&gt;</code> of
the document has been parsed, after any scripts that are not dependent on
computed style have executed), the <span>CSS style sheet set</span>
should be set by using the
<span>select a CSS style sheet set</span> set of steps as if the user had
selected the <span>CSS style sheet set</span> manually.</p>

<p class="note">This specification does not give any suggestions on
how user agents are to decide to persist the <span>CSS style sheet set</span> or whether or
how to persist the <span title="select a CSS style sheet set">selected</span> <span>CSS style sheet set</span> across pages.</p>

<!-- XXX this UI section suggests we may want to introduce a few more
     idioms -->


<h4>Examples</h4>

<div class="example">
 <p>Thus, in the following HTML snippet:</p>

 <pre>&lt;link rel="alternate stylesheet" title="foo" href="a"&gt;
&lt;link rel="alternate stylesheet" title="bar" href="b"&gt;
&lt;script&gt;
  document.selectedStyleSheetSet = 'foo';
  document.styleSheets[1].disabled = false;
&lt;/script&gt;
&lt;link rel="alternate stylesheet" title="foo" href="c"&gt;
&lt;link rel="alternate stylesheet" title="bar" href="d"&gt;</pre>

 <p>...the style sheets that end up enabled are style sheets "a", "b",
 and "c", the
 <code title="dom-Document-selectedStyleSheetSet">selectedStyleSheetSet</code>
 attribute would return null,
 <code title="dom-Document-lastStyleSheetSet">lastStyleSheetSet</code>
 would return "foo", and
 <code title="dom-Document-preferredStyleSheetSet">preferredStyleSheetSet</code>
 would return the empty string.</p>

 <p>Similarly, in the following HTML snippet:</p>

 <pre>&lt;link rel="alternate stylesheet" title="foo" href="a"&gt;
&lt;link rel="alternate stylesheet" title="bar" href="b"&gt;
&lt;script&gt;
  var before = document.preferredStyleSheetSet;
  document.styleSheets[1].disabled = false;
&lt;/script&gt;
&lt;link rel="stylesheet" title="foo" href="c"&gt;
&lt;link rel="alternate stylesheet" title="bar" href="d"&gt;
&lt;script&gt;
  var after = document.preferredStyleSheetSet;
&lt;/script&gt;</pre>

 <p>...the "before" variable will be equal to the empty string, the
 "after" variable will be equal to "foo", and style sheets "a" and "c"
 will be enabled. This is the case even though the first script block
 sets style sheet "b" to be enabled, because upon parsing the
 following <code title>&lt;link&gt;</code> element, the
 <code title="dom-Document-preferredStyleSheetSet">preferredStyleSheetSet</code>
 is set and the
 <code title="dom-Document-enableStyleSheetsForSet">enableStyleSheetsForSet()</code>
 method is called (since
 <code title="dom-Document-selectedStyleSheetSet">selectedStyleSheetSet</code>
 was never set
 explicitly, leaving
 <code title="dom-Document-lastStyleSheetSet">lastStyleSheetSet</code> at
 null throughout), which changes which style sheets are enabled and which
 are not.</p>
</div>


<h3>Style Sheet Association</h3>

<p>This section defines the interface an
<span title=concept-css-style-sheet-owner-node>owner node</span> of a <span>CSS style sheet</span> has to
implement and defines the requirements for
<span data-anolis-spec=xmlss title="xml-stylesheet processing instruction">xml-stylesheet processing instructions</span>
and HTTP <code title>Link</code> headers when the link
relation type is an
<span data-anolis-spec=dom>ASCII case-insensitive</span> match for
"<code title>stylesheet</code>" since nobody else was interested in
defining this.</p>

<p class=note>The editor is in good hope that HTML and SVG will define the
appropriate processing in their respective specifications, in terms of
this specification, in due course.</p>


<h4>Fetching CSS style sheets</h4>

<p>To <dfn>fetch a CSS style sheet</dfn> with parsed URL <var>parsed URL</var>, referrer <var>referrer</var>, document
<var>document</var>, optionally a set of parameters <var>parameters</var> (used as input to creating a
<span data-anolis-spec=fetch title=concept-request>request</span>), follow these steps:

<ol>
 <li><p>Let <var>origin</var> be <var>document</var>'s <span data-anolis-spec=html>origin</span>.

 <li><p>Let <var>request</var> be a new <span data-anolis-spec=fetch title=concept-request>request</span>, with the
 <span data-anolis-spec=fetch title=concept-request-url>url</span> <var>parsed URL</var>,
 <span data-anolis-spec=fetch title=concept-request-origin>origin</span> <var>origin</var>,
 <span data-anolis-spec=fetch title=concept-request-referrer>referrer</span> <var>referrer</var>, and if specified the set of parameters <var>parameters</var>.

 <li><p>Let <var>response</var> be the result of <span data-anolis-spec=fetch title=concept-fetch>fetching</span> <var>request</var>.</p></li>

 <li><p>Wait until <var>response</var> is available.
 
 <li><p>If <var>response</var> is a <span data-anolis-spec=fetch title=concept-network-error>network error</span>, return an error.
 
 <li><p>If <var>document</var> is in <span data-anolis-spec=dom title=concept-document-quirks>quirks mode</span>, <var>response</var> is
 <span data-anolis-spec=fetch>CORS-same-origin</span> and the <span data-anolis-spec=html>Content-Type metadata</span> of <var>response</var> is not a
 <span>supported styling language</span> change the <span data-anolis-spec=html>Content-Type metadata</span> of <var>response</var> to
 <code title>text/css</code>.

 <li><p>If <var>response</var> is not in a <span>supported styling language</span> return an error.</p></li>

 <li><p>Return <var>response</var>.
</ol>

<h4>The <code title>LinkStyle</code> Interface</h4>

<p>The <dfn>associated CSS style sheet</dfn> of a node is the <span>CSS style sheet</span> in the list of
<span>document CSS style sheets</span> of which the <span title=concept-css-style-sheet-owner-node>owner node</span> implements the <code>LinkStyle</code>
interface.</p>

<pre class=idl>[NoInterfaceObject]
interface <dfn>LinkStyle</dfn> {
  readonly attribute <span>StyleSheet</span>? <span title=dom-LinkStyle-sheet>sheet</span>;
};</pre>

<p>The <dfn title=dom-LinkStyle-sheet><code>sheet</code></dfn> attribute must return the <span>associated CSS style sheet</span> for the node or null
if there is no <span>associated CSS style sheet</span>.</p>
  
<div class="example">
 <p>In the following fragment, the first <code title>style</code>
 element has a <code title=dom-LinkStyle-sheet>sheet</code> attribute that returns a
 <code>StyleSheet</code> object representing the style sheet, but for
 the second <code title>style</code> element, the <code title=dom-LinkStyle-sheet>sheet</code> attribute returns null,
 assuming the user agent supports CSS (<code title>text/css</code>), but does
 not support the (hypothetical) ExampleSheets (<code title>text/example-sheets</code>).</p>

 <pre>&lt;style type="text/css"&gt;
  body { background:lime }
&lt;/style&gt;</pre>
   <pre>&lt;style type="text/example-sheets"&gt;
  $(body).background := lime
&lt;/style&gt;</pre>
</div>

<p class="note">Whether or not the node refers to a style sheet is defined
by the specification that defines the semantics of said node.</p>


<h4>Requirements on specifications</h4>

<p>Specifications introducing new ways of associating style sheets through
the DOM should define which nodes implement the
<code>LinkStyle</code> interface. When doing so, they
must also define when a <span>CSS style sheet</span> is
<span title="create a CSS style sheet">created</span>.</p>





<h4>Requirements on User Agents Implementing the xml-stylesheet processing instruction</h4>

<!-- XXX load/error events -->

<pre class="idl"><span data-anolis-spec=dom>ProcessingInstruction</span> implements <span>LinkStyle</span>;</pre>

<p>The <dfn>prolog</dfn> refers to <span data-anolis-spec=dom title=concept-node>nodes</span> that are children of the
<span data-anolis-spec=dom title=concept-document>document</span> and are not <span data-anolis-spec=dom title=concept-tree-following>following</span> the
<code data-anolis-spec=dom>Element</code> child of the <span data-anolis-spec=dom title=concept-document>document</span>, if any.

<p>When a <code data-anolis-spec=dom>ProcessingInstruction</code> <span data-anolis-spec=dom title=concept-node>node</span> <var>node</var> is inserted to a
document, removed from a document, becomes part of the <span>prolog</span>, is no longer part of the <span>prolog</span>, or has its
<span data-anolis-spec=dom title=concept-cd-data>data</span> changed, these steps must be run:

<ol>
 <li><p>If an instance of this algorithm is currently running for <var>node</var>, abort that instance, and stop the associated
 <span data-anolis-spec=fetch title=concept-fetch>fetching</span> if applicable.

 <li><p>If <var>node</var> has an <span>associated CSS style sheet</span>, <span title="remove a CSS style sheet">remove</span> it.
 
 <li><p>If <var>node</var> is not an <span data-anolis-spec=xmlss>xml-stylesheet processing instruction</span>, terminate these steps.
 
 <li><p>If <var>node</var> is part of the <span data-anolis-spec=xml>document type declaration</span>, terminate these steps.
 
 <li><p>If <var>node</var> does not have an <code title>href</code> <span data-anolis-spec=xmlss>pseudo-attribute</span>, terminate these steps.

 <li><p>Let <var>title</var> be the value of the
 <code title>title</code> <span data-anolis-spec=xmlss>pseudo-attribute</span> or the empty string if the
 <code title>title</code> <span data-anolis-spec=xmlss>pseudo-attribute</span> is not specified.</p></li>

 <li><p>If there is an <code title>alternate</code> <span data-anolis-spec=xmlss>pseudo-attribute</span>
 whose value is a <span data-anolis-spec=dom>case-sensitive</span> match
 for "<code title>yes</code>" and <var>title</var> is the
 empty string terminate these steps.</p></li>

 <li><p>If there is a <code title>type</code> <span data-anolis-spec=xmlss>pseudo-attribute</span> whose
 value is not a <span>supported styling language</span> the user agent
 may terminate these steps.</p></li>

 <li><p>Let <var>input URL</var> be the value specified by the
 <code title>href</code> <span data-anolis-spec=xmlss>pseudo-attribute</span>.
 
 <li><p>Let <var>document</var> be <var>node</var>'s <span data-anolis-spec=dom title=concept-node-document>node document</span>
 
 <li><p>Let <var>base URL</var> be <var>document</var>'s <span data-anolis-spec=html>document base URL</span>.
 
 <li><p>Let <var>referrer</var> be <var>document</var>'s <span data-anolis-spec=html title="the document's address">address</span>.

 <li><p>Let <var>parsed URL</var> be the return value of invoking the <span data-anolis-spec=url title=concept-url-parser>URL parser</span> with the
 string <var>input URL</var> and the base URL <var>base URL</var>.
 
 <li><p>If <var>parsed URL</var> is failure, terminate these steps.

 <li><p>Let <var>response</var> be the result of <span title="fetch a CSS style sheet">fetching a CSS style sheet</span> with parsed URL <var>parsed URL</var>,
 referrer <var>referrer</var> and document <var>document</var>.
 
 <li><p>If <var>response</var> is an error, terminate these steps.

 <li>
  <p><span>Create a CSS style sheet</span> with the following properties:</p>

  <dl>
   <dt><span title=concept-css-style-sheet-location>location</span></dt>
   <dd><p>The result of invoking the <span data-anolis-spec=url title=concept-url-serializer>URL serializer</span> with <var>parsed URL</var>.</p></dd>

   <dt><span title=concept-css-style-sheet-parent-css-style-sheet>parent CSS style sheet</span></dt>
   <dd><p>null.</p></dd>

   <dt><span title=concept-css-style-sheet-owner-node>owner node</span></dt>
   <dd><p><var>node</var>.</p></dd>

   <dt><span title=concept-css-style-sheet-owner-css-rule>owner CSS rule</span></dt>
   <dd><p>null.</p></dd>

   <dt><span title=concept-css-style-sheet-media>media</span></dt>
   <dd><p>The value of the <code title>media</code> <span data-anolis-spec=xmlss>pseudo-attribute</span>
   if any, or the empty string otherwise.</p></dd>

   <dt><span title=concept-css-style-sheet-title>title</span></dt>
   <dd><p><var>title</var>.</p></dd>

   <dt><span title=concept-css-style-sheet-alternate-flag>alternate flag</span></dt>
   <dd><p>Set if the <code title>alternate</code> <span data-anolis-spec=xmlss>pseudo-attribute</span>
   value is a <span data-anolis-spec=dom>case-sensitive</span> match for
   "<code title>yes</code>", or clear otherwise.
   
   <dt><span title=concept-css-style-sheet-origin-clean-flag>origin-clean flag</span>
   <dd><p>Set if <var>response</var> is <span data-anolis-spec=fetch>CORS-same-origin</span>, or clear otherwise.
  </dl>
 </li>
</ol>


<h4>Requirements on User Agents Implementing the HTTP
<code title>Link</code> Header</h4>

<!-- XXX ref, one day -->

<!-- XXX deal with media param -->

<p class=atrisk>For each HTTP <code title>Link</code> header of which one
of the link relation types is an
<span data-anolis-spec=dom>ASCII case-insensitive</span> match
for "<code title>stylesheet</code>" these steps
must be run:</p>

<ol>
 <li><p>Let <var>title</var> be the value of the first of all the
 <code title>title</code> parameters.
 If there are no such parameters it is the empty string.</p></li>

 <li><p>If one of the (other) link relation types is an
 <span data-anolis-spec=dom>ASCII case-insensitive</span> match for
 "<code title>alternate</code>" and <var>title</var> is the
 empty string terminate these steps.</p></li>

 <li><p>Let <var>input URL</var> be the value specified. <span class=issue title>Be more specific</span>
 
 <li><p>Let <var>base URL</var> be the document's <span data-anolis-spec=html>document base URL</span>. <span class=issue title>Is there a document at this
 point?</span>
 
 <li><p>Let <var>referrer</var> be the document's <span data-anolis-spec=html title="the document's address">address</span>.
 
 <li><p>Let <var>origin</var> be the document's <span data-anolis-spec=html>origin</span>.
 
 <li><p>Let <var>parsed URL</var> be the return value of invoking the <span data-anolis-spec=url title=concept-url-parser>URL parser</span> with the
 string <var>input URL</var> and the base URL <var>base URL</var>.
 
 <li><p>If <var>parsed URL</var> is failure, terminate these steps.

 <li><p>Let <var>response</var> be the result of <span title="fetch a CSS style sheet">fetching a CSS style sheet</span> with parsed URL <var>parsed URL</var>,
 referrer <var>referrer</var> and document being the document. <span class=issue title>What if the HTML parser hasn't decided on quirks/non-quirks yet?</span>

 <li>
  <p><span>Create a CSS style sheet</span> with the following properties:</p>

  <dl>
   <dt><span title=concept-css-style-sheet-location>location</span></dt>
   <dd><p>The result of invoking the <span data-anolis-spec=url title=concept-url-serializer>URL serializer</span> with <var>parsed URL</var>.</p></dd>

   <dt><span title=concept-css-style-sheet-owner-node>owner node</span></dt>
   <dd><p>null.</p></dd>

   <dt><span title=concept-css-style-sheet-parent-css-style-sheet>parent CSS style sheet</span></dt>
   <dd><p>null.</p></dd>

   <dt><span title=concept-css-style-sheet-owner-css-rule>owner CSS rule</span></dt>
   <dd><p>null.</p></dd>

   <dt><span title=concept-css-style-sheet-media>media</span></dt>
   <dd><p>The value of the first <code title>media</code> parameter.</p></dd>
   <!-- XXX register media parameter? bah -->

   <dt><span title=concept-css-style-sheet-title>title</span></dt>
   <dd><p><var>title</var>.</p></dd>

   <dt><span title=concept-css-style-sheet-alternate-flag>alternate flag</span></dt>
   <dd><p>Set if one of the specified link relation type for this HTTP
   <code title>Link</code> header is an
   <span data-anolis-spec=dom>ASCII case-insensitive</span> match for
   "<code title>alternate</code>", or false otherwise.
   
   <dt><span title=concept-css-style-sheet-origin-clean-flag>origin-clean flag</span>
   <dd><p>Set if <var>response</var> is <span data-anolis-spec=fetch>CORS-same-origin</span>, or clear otherwise.
  </dl>
 </li>
</ol>


<h3>CSS Rules</h3>

<p>A <dfn>CSS rule</dfn> is an abstract concept that
denotes a rule as defined by the CSS specification. A
<span>CSS rule</span> is represented as an object that implements a subclass of
the <code>CSSRule</code> interface, and which has the following
associated state items:</p>

<dl>
<dt><dfn title=concept-css-rule-type>type</dfn></dt>
<dd><p>A non-negative integer associated with a particular type of rule.
This item is initialized when a rule is created and cannot change.</p></dd>

<dt><dfn title=concept-css-rule-text>text</dfn></dt>
<dd><p>A text representation of the rule suitable for direct use in a style sheet.
This item is initialized when a rule is created and can be changed.</p></dd>

<dt><dfn title=concept-css-rule-parent-css-rule>parent CSS rule</dfn></dt>
<dd><p>A reference to an enclosing <span>CSS rule</span> or null.
If the rule has an enclosing rule when it is created, then this item is initialized to the enclosing rule; otherwise it is null. It can be changed to
null.</p></dd>

<dt><dfn title=concept-css-rule-parent-css-style-sheet>parent CSS style sheet</dfn></dt>
<dd><p>A reference to a parent <span>CSS style sheet</span> or null.
This item is initialized to reference an associated style sheet when the rule is created. It can be changed to null.</p></dd>

<dt><dfn title=concept-css-rule-child-css-rules>child CSS rules</dfn>
<dd><p>A list of child <span title="CSS rule">CSS rules</span>. The list can be mutated.
</dl>

<p>In addition to the above state, each <span>CSS rule</span> may be associated
with other state in accordance with its <span title=concept-css-rule-type>type</span>.</p>

<p>To <dfn>parse a CSS rule</dfn> from a string <var>string</var>, invoke <span data-anolis-spec=csssyntax>parse a rule</span> with <var>string</var> and return
the value returned.</p>

<p>To <dfn>serialize a CSS rule</dfn>, perform one of the following in accordance with the <span>CSS rule</span>'s
<span title="concept-css-rule-type">type</span>:</p>

<dl class="switch">
 <dt><code>CSSStyleRule</code></dt>
 <dd>
  <p>The result of concatenating the following:</p>
  <ol>
   <li>The result of performing <span>serialize a group of selectors</span> on the rule's associated selectors.</li>
   <li>The string "<code title> { </code>", i.e., a single SPACE (U+0020), followed by LEFT CURLY BRACKET (U+007B),
   followed by a single SPACE (U+0020).</li>
   <li>The result of performing <span>serialize a CSS declaration block</span> on the rule's associated declarations.</li>
   <li>If the rule is associated with one or more declarations, the string "<code title> </code>", i.e., a single SPACE (U+0020).</li>
   <li>The string "<code title>}</code>", RIGHT CURLY BRACKET (U+007D).
  </ol>
 </dd>

 <dt><code>CSSCharsetRule</code></dt>
 <dd>
  <p>The result of concatenating the following:</p>
  <ol>
   <li>The string "<code title>@charset</code>" followed by a single SPACE (U+0020).</li>
   <li>The result of performing <span>serialize a string</span> on the rule's character encoding.</li>
   <li>The string "<code title>;</code>", i.e., SEMICOLON (U+003B).
  </ol>
  <div class="example">
  <pre>@charset "UTF-8";</pre>
  </div>
 </dd>

 <dt><code>CSSImportRule</code></dt>
 <dd>
  <p>The result of concatenating the following:</p>
  <ol>
   <li>The string "<code title>@import</code>" followed by a single SPACE (U+0020).</li>
   <li>The result of performing <span>serialize a URL</span> on the rule's location.</li>
   <li>If the rule's associated media list is not empty, a single SPACE (U+0020) followed by the
   result of performing <span>serialize a media query list</span> on the media list.
   <li>The string "<code title>;</code>", i.e., SEMICOLON (U+003B).
  </ol>
  <div class="example">
  <pre>@import url("import.css");</pre>
  <pre>@import url("print.css") print;</pre>
  </div>
 </dd>

 <dt><code>CSSMediaRule</code></dt>
 <dd><p class="issue">...</p></dd>

 <dt><code title>CSSFontFaceRule</code></dt>
 <dd><p class="issue">...</p></dd>

 <dt><code>CSSPageRule</code></dt>
 <dd><p class="issue">...</p></dd>

 <dt><code>CSSNamespaceRule</code></dt>
 <dd><p>The literal string "<code title>@namespace</code>", followed by a single SPACE
 (U+0020), followed by the
 <span title="serialize an identifier">identifier escaped</span> value of the
 <code title="dom-CSSNamespaceRule-prefix">prefix</code> attribute (if
 any), followed by a single SPACE (U+0020) if there is a prefix, followed by the
 <span title="serialize a URL">URL escaped</span> value of the
 <code title="dom-CSSNamespaceRule-namespaceURI">namespaceURI</code>
 attribute, followed the character "<code title>;</code>" (U+003B).</p></dd>
</dl>

<p>To <dfn>insert a CSS rule</dfn> <var>rule</var> in a CSS rule list <var>list</var> at index <var>index</var>, follow these steps:</p>
<ol>
 <li><p>Set <var>new rule</var> to the results of performing <span>parse a CSS rule</span>
 on argument <var>rule</var>.
 <li><p>If <var>new rule</var> is a syntax error, <span data-anolis-spec='dom' title='concept-throw'>throw</span>
 a <code data-anolis-spec='dom'>SyntaxError</code> exception.</p></li>
 <li><p>If <var>new rule</var> is an <code title>@charset</code> at-rule, <span data-anolis-spec='dom' title='concept-throw'>throw</span> a
 <code data-anolis-spec='dom'>SyntaxError</code> exception.
 <li><p>Set <var>length</var> to the number of items in <var>list</var>.</p></li>
 <li><p>If <var>index</var> is greater than <var>length</var>, then <span data-anolis-spec='dom' title='concept-throw'>throw</span>
 an <code data-anolis-spec='dom'>IndexSizeError</code> exception.</p></li>
 <li><p>If <var>new rule</var> cannot be inserted into <var>list</var> at the zero-index position <var>index</var> due to constraints
 specified by CSS, then <span data-anolis-spec='dom' title='concept-throw'>throw</span>
 a <code data-anolis-spec='dom'>HierarchyRequestError</code> exception. <span data-anolis-ref>CSS</span></p>
 <p class='note'>For example, a CSS style sheet cannot contain an <code title>@import</code> at-rule after a style rule.</p></li>
 <li><p>If <var>new rule</var> is an <code title>@namespace</code> at-rule, and <var>list</var> contains anything other than
 <code title>@charset</code> at-rules, <code title>@import</code> at-rules, and <code title>@namespace</code> at-rules,
 <span data-anolis-spec='dom' title='concept-throw'>throw</span> an <code data-anolis-spec=dom>InvalidStateError</code> exception.
 <li><p>Insert <var>new rule</var> into <var>list</var> at the zero-indexed position <var>index</var>.<p></li>
 <li><p>Return <var>index</var>.
</ol>

<p>To <dfn>remove a CSS rule</dfn> from a CSS rule list <var>list</var> at index <var>index</var>, follow these steps:</p>
<ol>
 <li><p>Set <var>length</var> to the number of items in <var>list</var>.</p></li>
 <li><p>If <var>index</var> is greater than or equal to <var>length</var>, then <span data-anolis-spec='dom' title='concept-throw'>throw</span>
 an <code data-anolis-spec='dom'>IndexSizeError</code> exception.</p></li>
 <li><p>Set <var>old rule</var> to the <var>index</var>th item in <var>list</var>.</p></li>
 <li><p>If <var>old rule</var> is an <code title>@namespace</code> at-rule, and <var>list</var> contains anything other than
 <code title>@charset</code> at-rules, <code title>@import</code> at-rules, and <code title>@namespace</code> at-rules,
 <span data-anolis-spec='dom' title='concept-throw'>throw</span> an <code data-anolis-spec=dom>InvalidStateError</code> exception.
 <li><p>Remove rule <var>old rule</var> from <var>list</var> at the zero-indexed position <var>index</var>.<p></li>
 <li><p>Set <var>old rule</var>'s <span title=concept-css-rule-parent-css-rule>parent CSS rule</span> and
 <span title=concept-css-rule-parent-css-style-sheet>parent CSS style sheet</span> to null.
</ol>


<h4>The <code title>CSSRuleList</code> Interface</h4>

<p>The <code>CSSRuleList</code> interface represents an ordered collection of CSS style rules.</p>

<pre class=idl>[ArrayClass]
interface <dfn>CSSRuleList</dfn> {
  getter <span>CSSRule</span>? <span title=dom-CSSRuleList-item>item</span>(unsigned long index);
  readonly attribute unsigned long <span title=dom-CSSRuleList-length>length</span>;
};</pre>

<p>The object's <span data-anolis-spec=webidl>supported property indices</span> are the numbers in the range zero to one less than the number of
<code>CSSRule</code> objects represented by the collection. If there are no such <code>CSSRule</code> objects, then there are no
<span data-anolis-spec=webidl>supported property indices</span>.

<p>The <dfn title=dom-CSSRuleList-item><code>item(<var>index</var>)</code></dfn> method must return the <var>index</var>th <code>CSSRule</code>
object in the collection. If there is no <var>index</var>th object in the collection, then the method must return null.

<p>The <dfn title=dom-CSSRuleList-length><code>length</code></dfn> attribute must return the number of <code>CSSRule</code> objects represented by the
collection.

<h4>The <code title>CSSRule</code> Interface</h4>

<!--
//
// All members defined since DOM-2 Style. The only differences are:
//
//   1. removal of UNKNOWN_RULE = 0 constant
//   2. addition of NAMESPACE_RULE = 10 constant
//   3. removal of commented raises(DOMException) on setting cssText
//
-->

<p>The <code>CSSRule</code> interface represents an abstract, base CSS style rule. Each
distinct CSS style rule type is represented by a distinct interface that
inherits from this interface.</p>
  
<pre class=idl>interface <dfn>CSSRule</dfn> {
  const unsigned short <span title=dom-CSSRule-STYLE_RULE>STYLE_RULE</span> = 1;
  const unsigned short <span title=dom-CSSRule-CHARSET_RULE>CHARSET_RULE</span> = 2;
  const unsigned short <span title=dom-CSSRule-IMPORT_RULE>IMPORT_RULE</span> = 3;
  const unsigned short <span title=dom-CSSRule-MEDIA_RULE>MEDIA_RULE</span> = 4;
  const unsigned short <span title=dom-CSSRule-FONT_FACE_RULE>FONT_FACE_RULE</span> = 5;
  const unsigned short <span title=dom-CSSRule-PAGE_RULE>PAGE_RULE</span> = 6;
  const unsigned short <span title=dom-CSSRule-MARGIN_RULE>MARGIN_RULE</span> = 9;
  const unsigned short <span title=dom-CSSRule-NAMESPACE_RULE>NAMESPACE_RULE</span> = 10;
  readonly attribute unsigned short <span title=dom-CSSRule-type>type</span>;
  attribute DOMString <span title=dom-CSSRule-cssText>cssText</span>;
  readonly attribute <span>CSSRule</span>? <span title=dom-CSSRule-parentRule>parentRule</span>;
  readonly attribute <span>CSSStyleSheet</span>? <span title=dom-CSSRule-parentStyleSheet>parentStyleSheet</span>;
};</pre>

<p>The <dfn title=dom-CSSRule-type><code>type</code></dfn> attribute must return the CSS rule type, as follows:

<dl class=switch>
 <dt>If the object is a <code>CSSStyleRule</code>
 <dd><p>Return <dfn title=dom-CSSRule-STYLE_RULE><code>STYLE_RULE</code></dfn> (numeric value 1).
 <dt>If the object is a <code>CSSCharsetRule</code>
 <dd><p>Return <dfn title=dom-CSSRule-CHARSET_RULE><code>CHARSET_RULE</code></dfn> (numberic value 2).
 <dt>If the object is a <code>CSSImportRule</code>
 <dd><p>Return <dfn title=dom-CSSRule-IMPORT_RULE><code>IMPORT_RULE</code></dfn> (numberic value 3).
 <dt>If the object is a <code>CSSMediaRule</code>
 <dd><p>Return <dfn title=dom-CSSRule-MEDIA_RULE><code>MEDIA_RULE</code></dfn> (numeric value 4).
 <dt>If the object is a <code title>CSSFontFaceRule</code>
 <dd><p>Return <dfn title=dom-CSSRule-FONT_FACE_RULE><code>FONT_FACE_RULE</code></dfn> (numeric value 5).
 <dt>If the object is a <code>CSSPageRule</code>
 <dd><p>Return <dfn title=dom-CSSRule-PAGE_RULE><code>PAGE_RULE</code></dfn> (numeric value 6).
 <dt>If the object is a <code>CSSNamespaceRule</code>
 <dd><p>Return <dfn title=dom-CSSRule-MARGIN_RULE><code>MARGIN_RULE</code></dfn> (numeric value 9).
 <dt>If the object is a <code>CSSMarginRule</code>
 <dd><p>Return <dfn title=dom-CSSRule-NAMESPACE_RULE><code>NAMESPACE_RULE</code></dfn> (numeric value 10).
 <dt>Otherwise
 <dd><p>Return a value defined on the <a href='http://wiki.csswg.org/spec/cssom-constants'>CSSOM Constants</a> wiki page.
</dl>

<p class=note>The value 0, formerly known as <code title>UNKNOWN_RULE</code>, is made
obsolete by this specification. This value will not be re-allocated in the future and will remain reserved.</p>

<p>The <dfn title=dom-CSSRule-cssText><code>cssText</code></dfn> attribute must return a <span title='serialize a CSS rule'>serialization</span> of the
<span>CSS rule</span>.</p>
<p>On setting the <code title=dom-CSSRule-cssText>cssText</code> attribute these steps must be run:</p>
<ol>
 <li><p>Let <var>new rule</var> be the returned value of <span title='parse a CSS rule'>parsing</span> the value.</p></li>
 <li><p>If <var>new rule</var> is a syntax error, terminate this algorithm.</p></li>
 <li><p>If the <span title=concept-css-rule-type>type</span> of <var>new rule</var> does not match the <span title=concept-css-rule-type>type</span> of
 the current object
 <span data-anolis-spec=dom title=concept-throw>throw</span> an
 <code data-anolis-spec=dom>InvalidModificationError</code> exception.</li>
 <li><p>Replace the current object with <var>new rule</var>.</p></li>
</ol>

<p>The <dfn title=dom-CSSRule-parentRule><code>parentRule</code></dfn> attribute must return the <span title=concept-css-rule-parent-css-rule>parent CSS
rule</span>.</p>
<p class='note'>For example, <code title>@media</code> can enclose a rule, in which case <code title=dom-CSSRule-parentRule>parentRule</code> would
be non-null; in cases where there is no enclosing rule, <code title=dom-CSSRule-parentRule>parentRule</code> will be null.</p>

<p>The <dfn title=dom-CSSRule-parentStyleSheet><code>parentStyleSheet</code></dfn> attribute must return the
<span title=concept-css-rule-parent-css-style-sheet>parent CSS style sheet</span>.</p>
<p class='note'>The only circumstance where null is returned when a rule has been <span title="remove a CSS rule">removed</span>.</p>
<p class='note'>Removing a <code data-anolis-spec=dom>Node</code> that implements the <code>LinkStyle</code> interface from a
<code data-anolis-spec=dom>Document</code> instance does not (by itself) cause the <code>CSSStyleSheet</code> referenced by a <code>CSSRule</code> to be
unreachable.</p>


<h4>The <code title>CSSStyleRule</code> Interface</h4>

<!--
//
// All members defined since DOM-2 Style. The only differences are:
//
//   1. removal of commented raises(DOMException) on setting selectorText
//
-->

<p>The <code>CSSStyleRule</code> interface represents a style rule.</p>

<p class=note>CSS 2.1 calls style rule <a href="http://www.w3.org/TR/CSS21/syndata.html#rule-sets">rule sets</a>.</p>

<pre class=idl>interface <dfn>CSSStyleRule</dfn> : <span>CSSRule</span> {
  attribute DOMString <span title=dom-CSSStyleRule-selectorText>selectorText</span>;
  [SameObject, PutForwards=<span title=dom-CSSStyleDeclaration-cssText>cssText</span>] readonly attribute <span>CSSStyleDeclaration</span> <!--
  --><span title=dom-CSSStyleRule-style>style</span>;
};</pre>

<p>The <dfn title=dom-CSSStyleRule-selectorText><code>selectorText</code></dfn> attribute, on getting, must return the result of
<span title='serialize a group of selectors'>serializing</span> the associated <span>group of selectors</span>.</p>
<p>On setting the <code title=dom-CSSStyleRule-selectorText>selectorText</code> attribute these steps must be run:</p>
<ol>
 <li><p>Run the <span>parse a group of selectors</span> algorithm on the given value.</p></li>
 <li><p>If the algorithm returns a non-null value replace the associated <span>group of selectors</span> with the returned value.</p></li>
 <li><p>Otherwise, if the algorithm returns a null value, do nothing.</p></li>
</ol>

<p>The <dfn title=dom-CSSStyleRule-style><code>style</code></dfn> attribute must return a <code>CSSStyleDeclaration</code> object for the style rule, with the
<span title=concept-css-declaration-block-declarations>declarations</span> being the declared declarations in the rule, in
<span title=concept-declarations-specified-order>specified order</span>.</p>

<p>The <dfn title=concept-declarations-specified-order>specified order</dfn> for declarations is the same as specified, but with shorthand properties
expanded into their longhand properties, in canonical order. If a property is specified more than once (after shorthand expansion), only the
one with greatest cascading order must be represented, at the same relative position as it was specified. <span data-anolis-ref>CSSCASCADE</span>

<h4>The <code title>CSSCharsetRule</code> Interface</h4>

<p>The <code>CSSCharsetRule</code> interface represents an <code title>@charset</code> at-rule.</p>

<pre class=idl>interface <dfn>CSSCharsetRule</dfn> : <span>CSSRule</span> {
  attribute DOMString <span title=dom-CSSCharsetRule-encoding>encoding</span>;
};</pre>

<p>The <dfn title=dom-CSSCharsetRule-encoding><code>encoding</code></dfn> attribute must return the encoding information specified by the
<code title>@charset</code> at-rule.</p>


<h4>The <code title>CSSImportRule</code> Interface</h4>

<p>The <code>CSSImportRule</code> interface represents an <code title>@import</code> at-rule.</p>

<pre class=idl>interface <dfn>CSSImportRule</dfn> : <span>CSSRule</span> {
  readonly attribute DOMString <span title=dom-CSSImportRule-href>href</span>;
  [SameObject, PutForwards=<span title=dom-MediaList-mediaText>mediaText</span>] readonly attribute <span>MediaList</span> <!--
  --><span title=dom-CSSImportRule-media>media</span>;
  [SameObject] readonly attribute <span>CSSStyleSheet</span> <span title=dom-CSSImportRule-styleSheet>styleSheet</span>;
};</pre>

<p>The <dfn title=dom-CSSImportRule-href><code>href</code></dfn> attribute must return the <span data-anolis-spec=url title=concept-url>URL</span> specified by
the <code title>@import</code> at-rule.</p>
<p class='note'>To get the resolved <span data-anolis-spec=url title=concept-url>URL</span> use the <code title='dom-StyleSheet-href'>href</code>
attribute of the associated <span>CSS style sheet</span>.</p>

<p>The <dfn title=dom-CSSImportRule-media><code>media</code></dfn> attribute must return the value of the <code title='dom-StyleSheet-media'>media</code>
attribute of the associated <span>CSS style sheet</span>.</p>

<p>The <dfn title=dom-CSSImportRule-styleSheet><code>styleSheet</code></dfn> attribute must return the associated <span>CSS style sheet</span>.</p>
<p class='note'>If loading of the style sheet fails its <span title=concept-css-style-sheet-css-rules>CSS rules</span>
list is simply empty, i.e., an <code title>@import</code> at-rule always has an associated <span>CSS style sheet</span>.</p>


<h4>The <code title>CSSGroupingRule</code> Interface</h4>

<p>The <code>CSSGroupingRule</code> interface represents an at-rule that contains other rules nested inside itself.

<pre class=idl>interface <dfn>CSSGroupingRule</dfn> : <span>CSSRule</span> {
  [SameObject] readonly attribute <span>CSSRuleList</span> <span title=dom-CSSGroupingRule-cssRules>cssRules</span>;
  unsigned long <span title=dom-CSSGroupingRule-insertRule>insertRule</span>(DOMString rule, unsigned long index);
  void <span title=dom-CSSGroupingRule-deleteRule>deleteRule</span>(unsigned long index);
};</pre>

<p>The <dfn title=dom-CSSGroupingRule-cssRules><code>cssRules</code></dfn> attribute must return a <code>CSSRuleList</code> object for the
<span title=concept-css-rule-child-css-rules>child CSS rules</span>.</p>

<p>The <dfn title=dom-CSSGroupingRule-insertRule><code>insertRule(<var>rule</var>, <var>index</var>)</code></dfn> method must return the result of
invoking <span>insert a CSS rule</span> <var>rule</var> into the <span title=concept-css-rule-child-css-rules>child CSS rules</span> at
<var>index</var>.</p>

<p>The <dfn title=dom-CSSGroupingRule-deleteRule><code>deleteRule(<var>index</var>)</code></dfn> method must <span>remove a CSS rule</span> from the
<span title=concept-css-rule-child-css-rules>child CSS rules</span> at <var>index</var>.</p>


<h4>The <code title>CSSMediaRule</code> Interface</h4>

<p>The <code>CSSMediaRule</code> interface represents an <code title>@media</code> at-rule.</p>

<pre class=idl>interface <dfn>CSSMediaRule</dfn> : <span>CSSGroupingRule</span> {
  [SameObject, PutForwards=<span title=dom-MediaList-mediaText>mediaText</span>] readonly attribute <span>MediaList</span> <!--
  --><span title=dom-CSSMediaRule-media>media</span>;
};</pre>

<p>The <dfn title=dom-CSSMediaRule-media><code>media</code></dfn> attribute must return a <code>MediaList</code> object for the list of media queries specified
with the <code title>@media</code> at-rule.</p>


<h4>The <code title>CSSPageRule</code> Interface</h4>
 
<p>The <code>CSSPageRule</code> interface represents an <code title>@page</code> at-rule.</p>
<p class="issue">Need to define the rules for
<dfn>parse a list of CSS page selectors</dfn> and
<dfn>serialize a list of CSS page selectors</dfn>.</p>

<pre class=idl>interface <dfn>CSSPageRule</dfn> : <span>CSSGroupingRule</span> {
           attribute DOMString <span title=dom-CSSPageRule-selectorText>selectorText</span>;
  [SameObject, PutForwards=<span title=dom-CSSStyleDeclaration-cssText>cssText</span>] readonly attribute <span>CSSStyleDeclaration</span> <!--
  --><span title=dom-CSSPageRule-style>style</span>;
};</pre>

<p>The <dfn title=dom-CSSPageRule-selectorText><code>selectorText</code></dfn> attribute, on getting, must return the result of
<span title='serialize a list of CSS page selectors'>serializing</span> the associated <span>list of CSS page selectors</span>.</p>
<p>On setting the <code title=dom-CSSPageRule-selectorText>selectorText</code> attribute  these steps must be run:</p>
<ol>
 <li><p>Run the <span>parse a list of CSS page selectors</span> algorithm on the given value.</p></li>
 <li><p>If the algorithm returns a non-null value replace the associated <span>list of CSS page selectors</span> with the returned value.</p></li>
 <li><p>Otherwise, if the algorithm returns a null value, do nothing.</p></li>
</ol>

<p>The <dfn title=dom-CSSPageRule-style><code>style</code></dfn> attribute must return a <code>CSSStyleDeclaration</code> object for the
<code title>@page</code> at-rule, with the <span title=concept-css-declaration-block-declarations>declarations</span> being the declared declarations in the
rule, in <span title=concept-declarations-specified-order>specified order</span>.</p>


<h4>The <code title>CSSMarginRule</code> Interface</h4>

<p>The <code title>CSSMarginRule</code> interface represents a margin at-rule (e.g. <code title>@top-left</code>) in an <code title>@page</code> at-rule.
<span data-anolis-ref>CSSPAGE</span>

<pre class=idl>interface <dfn>CSSMarginRule</dfn> : <span>CSSRule</span> {
  readonly attribute DOMString <span title=dom-CSSMarginRule-name>name</span>;
  [SameObject, PutForwards=<span title=dom-CSSStyleDeclaration-cssText>cssText</span>] readonly attribute <span>CSSStyleDeclaration</span> <!--
  --><span title=dom-CSSMarginRule-style>style</span>;
};</pre>

<p>The <dfn title=dom-CSSMarginRule-name><code>name</code></dfn> attribute must return the name of the margin at-rule. The <code title>@</code> character is not
included in the name. <span data-anolis-ref>CSSSYNTAX</span>

<p>The <dfn title=dom-CSSMarginRule-style><code>style</code></dfn> attribute must return a <code>CSSStyleDeclaration</code> object for the
margin at-rule, with the <span title=concept-css-declaration-block-declarations>declarations</span> being the declared declarations in the rule, in
<span title=concept-declarations-specified-order>specified order</span>.</p>


<h4>The <code title>CSSNamespaceRule</code> Interface</h4>

<p>The <code>CSSNamespaceRule</code> interface represents an <code title>@namespace</code> at-rule.</p>

<pre class=idl>interface <dfn>CSSNamespaceRule</dfn> : <span>CSSRule</span> {
  [TreatNullAs=EmptyString] attribute DOMString <span title=dom-CSSNamespaceRule-namespaceURI>namespaceURI</span>;
  [TreatNullAs=EmptyString] attribute DOMString <span title=dom-CSSNamespaceRule-prefix>prefix</span>;
};</pre>

<p>The <dfn title=dom-CSSNamespaceRule-namespaceURI><code>namespaceURI</code></dfn> attribute, on getting, must return the namespace of the
<code title>@namespace</code> at-rule.

<p>On setting, the <code title=dom-CSSNamespaceRule-namespaceURI>namespaceURI</code> attribute must run the following steps:</p>

<ol>
 <li><p>Let <var>parent</var> be the <span title=concept-css-rule-parent-css-style-sheet>parent CSS style sheet</span>.
 <li><p>Let <var>list</var> be the <span title=concept-css-style-sheet-css-rules>CSS rules</span> of <var>parent</var>, or
 null if <var>parent</var> is null.
 <li><p>If <var>list</var> is not null and contains anything other than
 <code title>@charset</code> at-rules, <code title>@import</code> at-rules, and <code title>@namespace</code> at-rules,
 <span data-anolis-spec='dom' title='concept-throw'>throw</span> an <code data-anolis-spec=dom>InvalidStateError</code> exception.
 <li><p>Set the namespace of the <code title>@namespace</code> at-rule to the given value.
</ol>

<p>The <dfn title=dom-CSSNamespaceRule-prefix><code>prefix</code></dfn> attribute must return the prefix of the <code title>@namespace</code> at-rule or the
empty string if there is no prefix.

<p>On setting, the <code title=dom-CSSNamespaceRule-prefix>prefix</code> attribute must run the following steps:</p>

<ol>
 <li><p>Let <var>parent</var> be the <span title=concept-css-rule-parent-css-style-sheet>parent CSS style sheet</span>.
 <li><p>Let <var>list</var> be the <span title=concept-css-style-sheet-css-rules>CSS rules</span> of <var>parent</var>, or
 null if <var>parent</var> is null.
 <li><p>If <var>list</var> is not null and contains anything other than
 <code title>@charset</code> at-rules, <code title>@import</code> at-rules, and <code title>@namespace</code> at-rules,
 <span data-anolis-spec='dom' title='concept-throw'>throw</span> an <code data-anolis-spec=dom>InvalidStateError</code> exception.
 <li><p>Set the prefix of the <code title>@namespace</code> at-rule to the given value.
</ol>


<h3>CSS Declaration Blocks</h3>

<p>A <dfn>CSS declaration block</dfn> is an ordered collection of CSS
properties with their associated values, also named CSS declarations. In
the DOM a <span>CSS declaration block</span> is a
<code>CSSStyleDeclaration</code> object. A
<span>CSS declaration block</span> has two associated properties:</p>

<dl>
 <dt><dfn title=concept-css-declaration-block-readonly-flag>readonly flag</dfn></dt>
 <dd><p>Clear if the object can be manipulated. Set if it can not be
 manipulated. Unless otherwise stated it is clear.</p></dd>

 <dt><dfn title=concept-css-declaration-block-declarations>declarations</dfn></dt>
 <dd><p>The CSS declarations associated with the object.</p></dd>
</dl>

<p>To <dfn>parse a CSS declaration block</dfn> from a string <var>string</var>, invoke <span data-anolis-spec=csssyntax>parse a list of declarations</span> with
<var>string</var> and return the value returned.</p>

<p>To <dfn>serialize a CSS declaration</dfn> with property name <var>property</var>, value <var>value</var> and optionally an <i>important</i> flag set, follow
these steps:

<ol>
 <li><p>Let <var>s</var> be the empty string.
 <li><p>Append <var>property</var> to <var>s</var>.
 <li><p>Append "<code title>: </code>" (U+003A U+0020) to <var>s</var>.
 <li><p>Append <var>value</var> to <var>s</var>.
 <li><p>If the <i>important</i> flag is set, append "<code title> !important</code>" (U+0020 U+0021 U+0069 U+006D U+0070 U+006F U+0072 U+0074 U+0061 U+006E
 U+0074) to <var>s</var>.
 <li><p>Append "<code title>;</code>" (U+003B) to <var>s</var>.
 <li><p>Return <var>s</var>.
</ol>

<p>To <dfn>serialize a CSS declaration block</dfn> <var>declaration block</var> means to run the steps below:</p>

<ol>
 <li><p>Let <var>list</var> be an empty array.
 <li><p>Let <var>already serialized</var> be an empty array.
 <li><p><i>Declaration loop</i>: For each declaration <var>declaration</var> in <var>declaration block</var>'s
 <span title=concept-css-declaration-block-declarations>declarations</span>, follow these substeps:
  <ol>
   <li><p>Let <var>property</var> be <var>declaration</var>'s property name.
   <li><p>If <var>property</var> is in <var>already serialized</var>, continue with the steps labeled <i>declaration loop</i>.
   <li><p>If <var>property</var> maps to one or more shorthand properties, let <var>shorthands</var> be an array of those shorthand properties, in 
   <span title=concept-shorthands-preferred-order>preferred order</span>, and follow these substeps:
    <ol>
     <li><p>Let <var>longhands</var> an array consisting of all declarations in <var>declaration block</var>'s
     <span title=concept-css-declaration-block-declarations>declarations</span> that that are not in <var>already serialized</var> and have a property name that
     maps to one of the shorthand properties in <var>shorthands</var>.
     <li><p><i>Shorthand loop</i>: For each <var>shorthand</var> in <var>shorthands</var>, follow these substeps:
      <ol>
       <li><p>If all properties that map to <var>shorthand</var> are not present in <var>longhands</var>, continue with the steps labeled <i>shorthand loop</i>.
       <li><p>Let <var>current longhands</var> be an empty array.
       <li><p>Append all declarations in <var>longhands</var> have a property name that maps to <var>shorthand</var> to <var>current longhands</var>.
       <li><p>If there is one or more declarations in <var>current longhands</var> have their <i>important</i> set and one or more with it unset, continue with
       the steps labeled <i>shorthand loop</i>.
       <li><p>Let <var>value</var> be the result of invoking <span>serialize a CSS value</span> of <var>current longhands</var>.
       <li><p>If <var>value</var> is the empty string, continue with the steps labeled <i>shorthand loop</i>.
       <li><p>Let <var>serialized declaration</var> be the result of invoking <span>serialize a CSS declaration</span> with property name
       <var>shorthand</var>, value <var>value</var>, and the <i>important</i> flag set if the declarations in <var>current longhands</var> have their
       <i>important</i> flag set.
       <li><p>Append <var>serialized declaration</var> to <var>list</var>.
       <li><p>Append the property names of all items of <var>current longhands</var> to <var>already serialized</var>.
       <li><p>Remove the items present in <var>current longhands</var> from <var>longhands</var>.
      </ol>
    </ol>
   <li><p>If <var>property</var> is in <var>already serialized</var>, continue with the steps labeled <i>declaration loop</i>.
   <li><p>Let <var>value</var> be the result of invoking <span>serialize a CSS value</span> of <var>declaration</var>.
   <li><p>Let <var>serialized declaration</var> be the result of invoking <span>serialize a CSS declaration</span> with property name <var>property</var>, value
   <var>value</var>, and the <i>important</i> flag set if <var>declaration</var> has its <i>important</i> flag set.
   <li><p>Append <var>serialized declaration</var> to <var>list</var>.
   <li><p>Append <var>property</var> to <var>already serialized</var>.
  </ol>
 <li><p>Return <var>list</var> joined with "<code title> </code>" (U+0020).
</ol>

<p class="note">The serialization of an empty CSS declaration block is the empty string.</p>

<p class="note">The serialization of a non-empty CSS declaration block does not include any surrounding whitespace, i.e., no whitepsace appears
before the first property name and no whitespace appears after the final semicolon delimiter that follows the last property value.</p>

<p>The <dfn title=concept-shorthands-preferred-order>preferred order</dfn> of a list of shorthand properties <var>shorthands</var> is as follows:

<ol>
 <li><p>Order <var>shorthands</var> lexicographically.
 <li><p>Move all items in <var>shorthands</var> that begin with "<code title>-</code>" (U+002D) last in the list, retaining their relative order.
 <li><p>Move all items in <var>shorthands</var> that begin with "<code title>-</code>" (U+002D) but do not begin with "<code title>-webkit-</code>" last in the
 list, retaining their relative order.
 <li><p>Order <var>shorthands</var> by the number of longhand properties that map to it, with the greatest number first.
</ol>

<h4>The <code title>CSSStyleDeclaration</code> Interface</h4>

<p>The <code>CSSStyleDeclaration</code> interface represents a <span>CSS declaration block</span>, including its underlying state, where this
underlying state depends upon the source of the <code>CSSStyleDeclaration</Code> instance.</p>

<!--
//
// All members defined since DOM-2 Style. The only differences are:
//
//   1. removal of commented raises(DOMException) on setting cssText
//   2. removal of raises(DOMException) on {set,remove}Property
//   3. removal of getPropertyCSSValue() method
//
-->

<pre class=idl>interface <dfn>CSSStyleDeclaration</dfn> {
  attribute DOMString <span title=dom-CSSStyleDeclaration-cssText>cssText</span>;
  readonly attribute unsigned long <span title=dom-CSSStyleDeclaration-length>length</span>;
  getter DOMString <span title=dom-CSSStyleDeclaration-item>item</span>(unsigned long index);
  DOMString <span title=dom-CSSStyleDeclaration-getPropertyValue>getPropertyValue</span>(DOMString property);
  DOMString <span title=dom-CSSStyleDeclaration-getPropertyPriority>getPropertyPriority</span>(DOMString property);
  void <span title=dom-CSSStyleDeclaration-setProperty>setProperty</span>(DOMString property, [TreatNullAs=EmptyString] DOMString value, <!--
  -->[TreatNullAs=EmptyString] optional DOMString priority);
  DOMString <span title=dom-CSSStyleDeclaration-removeProperty>removeProperty</span>(DOMString property);
  readonly attribute <span>CSSRule</span>? <span title=dom-CSSStyleDeclaration-length>parentRule</span>;
           attribute DOMString <span title=dom-CSSStyleDeclaration-cssFloat>cssFloat</span>;<!-- setProperty's value arg has [TreatNullAs=EmptyString] -->
};</pre>

<p>The object's <span data-anolis-spec=webidl>supported property indices</span> are the numbers in the range zero to one less than the number of declarations in
the <span title=concept-css-declaration-block-declarations>declarations</span>. If there are no such declarations, then there are no
<span data-anolis-spec=webidl>supported property indices</span>.

<p>The <dfn title=dom-CSSStyleDeclaration-cssText><code>cssText</code></dfn> attribute must return the result of
<span title='serialize a CSS declaration block'>serializing</span> the <span title=concept-css-declaration-block-declarations>declarations</span>.</p>
<p>Setting the <code title=dom-CSSStyleDeclaration-cssText>cssText</code> attribute must run these steps:
<ol>
 <li><p>If the <span title=concept-css-declaration-block-readonly-flag>readonly flag</span> is set, <span data-anolis-spec=dom title=concept-throw>throw</span>
 a <code data-anolis-spec=dom>NoModificationAllowedError</code> exception and terminate these steps.</li>
 <li><p>Empty the <span title=concept-css-declaration-block-declarations>declarations</span>.</li>
 <li><p><span title='Parse a CSS declaration block'>Parse</span> the given value and, if the return value is not the empty list, insert the items in the list
 into the <span title=concept-css-declaration-block-declarations>declarations</span>, in <span title=concept-declarations-specified-order>specified
 order</span>.</p></li>
</ol>

<p>The <dfn title=dom-CSSStyleDeclaration-length><code>length</code></dfn> attribute must return the number of declarations in the
<span title=concept-css-declaration-block-declarations>declarations</span>.</p>

<p>The <dfn title=dom-CSSStyleDeclaration-item><code>item(<var>index</var>)</code></dfn> method must return the name of the property at position
<var>index</var>.</p>

<p>The <dfn title=dom-CSSStyleDeclaration-getPropertyValue><code>getPropertyValue(<var>property</var>)</code></dfn> method must run these steps:</p>
<ol>
 <li><p>Let <var>property</var> be <var>property</var> <span data-anolis-spec=dom>converted to ASCII lowercase</span>.
 <li><p>If <var>property</var> is a shorthand property, then follow these substeps:
  <ol>
   <li><p>Let <var>list</var> be a new empty array.
   <li><p>For each longhand property <var>longhand</var> that <var>property</var> maps to, in canonical order, follow these substeps:
    <ol>
     <li><p>If <var>longhand</var> is a <span data-anolis-spec=dom>case-sensitive</span> match for a property of a declaration in the
     <span title=concept-css-declaration-block-declarations>declarations</span>, let <var>declaration</var> be that declaration, or null otherwise.
     <li><p>If <var>declaration</var> is null, return the empty string and terminate these steps.
     <li><p>Append the <var>declaration</var> to <var>list</var>.
    </ol>
   <li><p>Return the <span title='serialize a CSS value'>serialization</span> of <var>list</var> and terminate these steps.
  </ol>
 <li><p>If <var>property</var> is a <span data-anolis-spec=dom>case-sensitive</span>
 match for a property of a declaration in the
 <span title=concept-css-declaration-block-declarations>declarations</span>, return the result of invoking
 <span>serialize a CSS value</span> of that declaration and terminate these steps.
 <li><p>Return the empty string.
</ol>

<p>The <dfn title=dom-CSSStyleDeclaration-getPropertyPriority><code>getPropertyPriority(<var>property</var>)</code></dfn> method must run these steps:
<ol>
 <li><p>Let <var>property</var> be <var>property</var> <span data-anolis-spec=dom>converted to ASCII lowercase</span>.
 <li><p>If <var>property</var> is a shorthand property, follow these substeps:
  <ol>
   <li><p>Let <var>list</var> be a new array.
   <li><p>For each longhand property <var>longhand</var> that <var>property</var> maps to, append the result of invoking
   <code title=dom-CSSStyleDeclaration-getPropertyPriority>getPropertyPriority()</code> with <var>longhand</var> as argument to <var>list</var>.
   <li><p>If all items in <var>list</var> are the string "<code title>important</code>", return the string "<code title>important</code>" and terminate these
   steps.
  </ol>
 <li><p>Otherwise, follow these substeps:
  <ol>
   <li><p>If <var>property</var> is a
   <span data-anolis-spec=dom>case-sensitive</span> match for a property of a
   declaration in the <span title=concept-css-declaration-block-declarations>declarations</span> that has the
   <i>important</i> flag set, return
   the string "<code title>important</code>".</p>
  </ol>
 <li><p>Return the empty string.
</ol>
<div class='example'><p>E.g. for <code title>background-color:lime !IMPORTANT</code> the return
value would be "<code title>important</code>".</div>

<p>The <dfn title=dom-CSSStyleDeclaration-setProperty><code>setProperty(<var>property</var>, <var>value</var>,
<var>priority</var>)</code></dfn> method must run these steps:</p>
<ol>
 <li><p>If the <span title=concept-css-declaration-block-readonly-flag>readonly flag</span> is set, <span data-anolis-spec=dom title=concept-throw>throw</span>
 a <code data-anolis-spec=dom>NoModificationAllowedError</code> exception and terminate these steps.</li>
 <li><p>Let <var>property</var> be <var>property</var> <span data-anolis-spec=dom>converted to ASCII lowercase</span>.
 <li><p>If <var>property</var> is not a <span data-anolis-spec=dom>case-sensitive</span> match for a <span>supported CSS property</span>, terminate this
 algorithm.</p></li>
 <li><p>If <var>value</var> is the empty string, invoke <code title='dom-CSSStyleDeclaration-removeProperty'>removeProperty()</code>
 with <var>property</var> as argument and terminate this algorithm.</p></li>
 <li><p>If <var>priority</var> is not specified, let <var>priority action</var> be "leave as is". Otherwise, if <var>priority</var> is the empty string, let
 <var>priority action</var> be "unset important". Otherwise, if <var>priority</var> is an <span data-anolis-spec=dom>ASCII case-insensitive</span> match for the
 string "<code title>important</code>", set <var>priority action</var> to "set important". Otherwise, terminate this algorithm.
 <li>
  <p>Let <var>component value list</var> be the result of <span title='parse a CSS value'>parsing</span> <var>value</var>.
  <p class='note'><var>value</var> can not include "<code title>!important</code>".</p>
 </li>
 <li><p>If <var>component value list</var> is null terminate these steps.
 <li><p>If <var>property</var> is a shorthand property, then for each longhand property <var>longhand</var> that <var>property</var> maps to, in canonical
 order, <span title="set a CSS property">set the CSS property</span> <var>longhand</var> to the appropriate value(s) from <var>component value list</var>, with
 <i>priority action</i> being <var>priority action</var>, and with the list of declarations being the
 <span title=concept-css-declaration-block-declarations>declarations</span>.
 <li><p>Otherwise, <span title="set a CSS property">set the CSS property</span> <var>property</var> to <var>component value list</var>, with
 <i>priority action</i> being <var>priority action</var>, and with the list of declarations being the
 <span title=concept-css-declaration-block-declarations>declarations</span>.
</ol>

<p>To <dfn>set a CSS property</dfn> <var>property</var> to a value <var>component value list</var> and with <i>priority action</i> being either "set
important", "unset important" or "leave as is", in a list of declarations <var>declarations</var>, follow these steps:

<ol>
 <li><p>If <var>property</var> is a <span data-anolis-spec=dom>case-sensitive</span> match for a property of a declaration in
 <var>declarations</var>, let <var>declaration</var> be that declaration.
 <li><p>Otherwise, append a new declaration with the property name <var>property</var> to <var>declarations</var> and let <var>declaration</var> be that
 declaration.
 <li><p>Set <var>declaration</var>'s value to <var>component value list</var>.
 <li><p>If <i>priority action</i> is "set important", set the declaration's <i>important</i> flag.
 <li><p>Otherwise, if <i>priority action</i> is "unset important", unset the declaration's <i>important</i> flag.
</ol>

<p>The <dfn title=dom-CSSStyleDeclaration-removeProperty><code>removeProperty(<var>property</var>)</code></dfn> method must run these steps:</p>
<ol>
 <li><p>If the <span title=concept-css-declaration-block-readonly-flag>readonly flag</span> is set, <span data-anolis-spec=dom title=concept-throw>throw</span>
 a <code data-anolis-spec=dom>NoModificationAllowedError</code> exception and terminate these steps.</li>
 <li><p>Let <var>property</var> be <var>property</var> <span data-anolis-spec=dom>converted to ASCII lowercase</span>.
 <li><p>Let <var>value</var> be the return value of invoking <code title=dom-CSSStyleDeclaration-getPropertyValue>getPropertyValue()</code>
 with <var>property</var> as argument.
 <li><p>If <var>property</var> is a shorthand property, for each longhand property <var>longhand</var> that <var>property</var> maps to, invoke
 <code title=dom-CSSStyleDeclaration-removeProperty>removeProperty()</code> with <var>longhand</var> as argument.
 <li><p>Otherwise, if <var>property</var> is a <span data-anolis-spec=dom>case-sensitive</span> match for a property of a declaration in the
 <span title=concept-css-declaration-block-declarations>declarations</span>, remove the declaration.
 <li><p>Return <var>value</var>.
</ol>

<p>The <dfn title=dom-CSSStyleDeclaration-parentRule><code>parentRule</code></dfn> attribute must return the <code>CSSrule</code> object the
<code>CSSStyleDeclaration</code> is object is associated with or null if it is not associated with a <code>CSSrule</code> object.</p>

<p>The <dfn title=dom-CSSStyleDeclaration-cssFloat><code>cssFloat</code></dfn>
attribute, on getting, must return the result of invoking
<code title=dom-CSSStyleDeclaration-getPropertyValue>getPropertyValue()</code> with
<code title>float</code> as argument. On setting, the attribute must invoke
<code title=dom-CSSStyleDeclaration-setProperty>setProperty()</code> with
<code title>float</code> as first argument, as second argument the given value, and no third argument.
Any exceptions thrown must be re-thrown.

<p>For each CSS property <var>property</var> that is a <span>supported CSS property</span>,
the following partial interface applies where <var>camel-cased attribute</var>
is obtained by running the <span>CSS property to IDL attribute</span> algorithm for
<var>property</var>.</p>

<pre class="idl extract">partial interface <span>CSSStyleDeclaration</span> {
           attribute DOMString _<span title=dom-CSSStyleDeclaration-camel-cased-attribute><var>camel-cased attribute</var></span>;
};</pre>

<p>The <dfn title=dom-CSSStyleDeclaration-camel-cased-attribute><code><var>camel-cased attribute</var></code></dfn> attribute, on getting, must return the
result of invoking <code title=dom-CSSStyleDeclaration-getPropertyValue>getPropertyValue()</code> with the
argument being the result of running the <span>IDL attribute to CSS property</span>
algorithm for <var>camel-cased attribute</var>.</p>

<p>Setting the <code title=dom-CSSStyleDeclaration-camel-cased-attribute><var>camel-cased attribute</var></code> attribute must invoke
<code title=dom-CSSStyleDeclaration-setProperty>setProperty()</code> with the
first argument being the result of running the <span>IDL attribute to CSS property</span>
algorithm for <var>camel-cased attribute</var>, as second argument the given value, and no third argument. Any
exceptions thrown must be re-thrown.</p>

<div class=example><p>For example, for the 'font-size' property there would be a <code title>fontSize</code> IDL attribute.</div>

<!-- [GA] Remove spec text for so called "dashed-attribute" until consensus obtains on whether to include in spec.

<p>For each CSS property <var>property</var> that is a <span>supported CSS property</span>, except for properties that have no "<code title>-</code>" (U+002D)
in the property name, user agents must act as if there was a WebIDL <span data-anolis-spec=webidl>regular attribute</span> member as part of the
<code>CSSStyleDeclaration</code> interface with the type being <code title>DOMString</code> and the <span data-anolis-spec=webidl>identifier</span> being
<var>property</var>, and let <var>dashed attribute</var> be <var>property</var>.

<p>The <dfn title=dom-CSSStyleDeclaration-dashed-attribute><code><var>dashed attribute</var></code></dfn> attribute, on getting, must return the
result of invoking <code title=dom-CSSStyleDeclaration-getPropertyValue>getPropertyValue()</code> with the
argument being <var>dashed attribute</var>.</p>

<p>Setting the <code title=dom-CSSStyleDeclaration-dashed-attribute><var>dashed attribute</var></code> attribute must invoke
<code title=dom-CSSStyleDeclaration-setProperty>setProperty()</code> with the
first argument being <var>dashed attribute</var>, as second argument the given value, and no third argument. Any
exceptions thrown must be re-thrown.</p>

<div class=example>
 <p>For example, for the 'font-size' property there would be a <code title>font-size</code> IDL attribute. In JavaScript, the property can be accessed as
 follows, assuming <var>element</var> is an <span data-anolis-spec=html title="HTML elements">HTML element</span>:
 <pre><var>element</var>.style['font-size'];</pre>
</div>

<p class=note>WebIDL does not allow dashes in identifiers in its syntax.

<p class=issue>The <code title=dom-CSSStyleDeclaration-dashed-attribute><var>dashed attribute</var></code> attributes will be removed from the specification
if implementations remove support. User agents that currently support them are urged to experiment with removing support.

-->

<p>The <dfn>CSS property to IDL attribute</dfn> algorithm for <var>property</var> is as
follows:</p>

<ol>
 <li><p>Let <var>output</var> be the empty string.
 
 <li><p>Let <var>uppercase next</var> be unset.
 
 <li><p>For each character <var>c</var> in <var>property</var>:

  <ol>
   <li><p>If <var>c</var> is "<code title>-</code>" (U+002D), let <var>uppercase next</var> be set.
   
   <li><p>Otherwise, if <var>uppercase next</var> is set, let <var>uppercase next</var> be unset and append <var>c</var>
   <span data-anolis-spec=dom>converted to ASCII uppercase</span> to <var>output</var>.
   
   <li><p>Otherwise, append <var>c</var> to <var>output</var>.
  </ol>

 <li><p>Return <var>output</var>.
</ol>

<p>The <dfn>IDL attribute to CSS property</dfn> algorithm for <var>attribute</var> is as
follows:</p>

<ol>
 <li><p>Let <var>output</var> be the empty string.
     
 <li><p>For each character <var>c</var> in <var>attribute</var>:
 
  <ol>
   <li><p>If <var>c</var> is in the range U+0041 to U+005A (ASCII uppercase), append "<code title>-</code>" (U+002D) followed by <var>c</var>
   <span data-anolis-spec=dom>converted to ASCII lowercase</span> to <var>output</var>.
           
   <li><p>Otherwise, append <var>c</var> to <var>output</var>.
  </ol>
 
 <li><p>Return <var>output</var>.
</ol>


<h3>CSS Values</h3>


<h4>Parsing CSS Values</h4>

<p>To <dfn>parse a CSS value</dfn> <var>value</var> for a given
<var>property</var> means to follow these steps:

<ol>
 <li><p>Let <var>list</var> be the value returned by invoking <span data-anolis-spec=csssyntax>parse a list of component values</span> from <var>value</var>.
 <li><p>Match <var>list</var> against the grammar for the property <var>property</var> in the CSS specification.
 <li><p>If the above step failed, return null.
 <li><p>Return <var>list</var>.
</ol>

<p class="note">"<code title>!important</code>" declarations are not
part of the property value space and will therefore cause
<span>parse a CSS value</span> to return null.</p>



<h4>Serializing CSS Values</h4>

<!-- based on http://damowmow.com/playground/canon.txt -->

<p>To <dfn>serialize a CSS value</dfn> of a declaration <var>declaration</var> or a list of longhand declarations <var>list</var>, follow
these rules:</p>

<ol>
 <li><p>If this algorithm is invoked with a list <var>list</var>, follow these substeps:
  <ol>
   <li><p>Let <var>shorthand</var> be the shorthand property that exactly maps to all the longhand properties in <var>list</var>. If there are multiple such
   shorthand properties, use the first in <span title=concept-shorthands-preferred-order>preferred order</span>.
   <li><p>If <var>shorthand</var> cannot represent the values of <var>list</var> in its grammar, return the empty string and terminate these steps.
   <li><p>Let <var>trimmed list</var> be a new empty array.
   <li><p>For each declaration <var>declaration</var> in <var>list</var>, if <var>declaration</var>'s value is not the initial value, or if
   <var>declaration</var> is a required component of the <var>shorthand</var> property, append <var>declaration</var> to <var>trimmed list</var>.
   <li><p>If <var>trimmed list</var> is empty, append the value of the first item in <var>list</var> to <var>trimmed list</var>.
   <li><p>Let <var>values</var> be a new empty array.
   <li><p>For each declaration <var>declaration</var> in <var>trimmed list</var>, invoke <span>serialize a CSS value</span> of <var>declaration</var>, and
   append the result to <var>values</var>.
   <li><p>Return the result of joining <var>values</var> as appropriate according to the grammar of <var>shorthand</var> and terminate these steps.
  </ol>
 <li><p>Let <var>values</var> be a new empty array.
 <li><p>Append the result of invoking <span>serialize a CSS component value</span> of <var>declaration</var>'s value to <var>values</var>.
 <li><p>If the grammar of the property of <var>declaration</var> is defined to be whitespace-separated, return the result of invoking <span>serialize a
 whitespace-separated list</span> of <var>values</var> and terminate these steps.
 <li><p>If the grammar of the property of <var>declaration</var> is defined to be comma-separated, return the result of invoking <span>serialize a
 comma-separated list</span> of <var>values</var>.
</ol>

<p>To
<dfn>serialize a CSS component value</dfn>
depends on the component, as follows:</p>

<dl class="switch">
 <dt>keyword</dt>
 <dd><p>The keyword
 <span data-anolis-spec=dom>converted to ASCII lowercase</span>.</p></dd>

 <dt>&lt;angle></dt>
 <dd><p>The number of degrees serialized as per &lt;number> followed by
 the literal string "<code title>deg</code>".</p></dd>

 <dt>&lt;color></dt>
 <dd>
 <p>If &lt;color&gt; is a component of a resolved or computed value, then
 return the color using the <code title>rgb()</code> or <code title>rgba()</code> functional
 notation as follows:</p>
 <ol>
 <li>If the alpha component of the color is equal to one, then return the serialization of the
 <code title>rgb()</code> functional equivalent of the opaque color.</li>
 <li>If the alpha component of the color is not equal to one, then return the serialization of the
 <code title>rgba()</code> functional equivalent of the non-opaque color.</li>
 </ol>
 <p>The serialization of the <code title>rgb()</code> functional equivalent is the concatenation of the following:</p>
 <ol>
 <li>The string "<code title>rgb(</code>".</li>
 <li>The shortest base-ten integer serialization of the color's red component.</li>
 <li>The string "<code title>, </code>".</li>
 <li>The shortest base-ten serialization of the color's green component.</li>
 <li>The string "<code title>, </code>".</li>
 <li>The shortest base-ten serialization of the color's blue component.</li>
 <li>The string "<code title>)</code>".</li>
 </ol>
 <p>The serialization of the <code title>rgba()</code> functional equivalent is the concatenation of the following:</p>
 <ol>
 <li>The string "<code title>rgba(</code>".</li>
 <li>The shortest base-ten serialization of the color's red component.</li>
 <li>The string "<code title>, </code>".</li>
 <li>The shortest base-ten serialization of the color's green component.</li>
 <li>The string "<code title>, </code>".</li>
 <li>The shortest base-ten serialization of the color's blue component.</li>
 <li>The string "<code title>, </code>".</li>
 <li>The shortest serialization of the &lt;number&gt; that denotes the color's alpha component.</li>
 <li>The string "<code title>)</code>".</li>
 </ol>

 <p>In the above rules, the string "<code title>, </code>" denotes a COMMA (U+002C) followed by a single SPACE (U+0020).</p>

 <p>If &lt;color&gt; is a component of a specified value, then
 return the color as follows:</p>
 <ol>
 <li>If the color was explicitly specified by the author, then return the original, author specified color value.</li>
 <li>Otherwise, return the value that would be returned if the color were a component of a computed value.</li>
 </ol>
 <p class="issue">Should author specified values be normalized for case? Or should original case be preserved?</p>
 </dd>
 <!--
   <dt>It is a system color</dt>

   <dd>See below (you use the representation given in the specification that
   defines the keyword).</dd>

   <dt>Alpha component is equal to 1.0</dt>

   <dd>The color is an uppercase six-digit hexadecimal value, prefixed with a
   <code title>#</code> character (U+0023 NUMBER SIGN), with the first two digits
   representing the red component, the next two digits representing the green
   component, and the last two digits representing the blue component, the
   digits being in the range 0-9 A-F (U+0030 to U+0039 and U+0041 to
   U+0046).</dd>

   <dt>Alpha component is less than 1.0</dt>

   <dd>The color is in the CSS <code title>rgba()</code> functional-notation format:
   the literal string <code title>rgba</code> (U+0072 U+0067 U+0062 U+0061) followed
   by a U+0028 LEFT PARENTHESIS, a <span>color component integer</span>
   representing the red component, a <span>color component separator</span>, a
   <span>color component integer</span> for the green component, a <span>color
   component separator</span>, a <span>color component integer</span> for the
   blue component, another <span>color component separator</span> a U+0030
   DIGIT ZERO, a U+002E FULL STOP (representing the decimal point), one or
   more digits in the range 0-9 (U+0030 to U+0039) representing the fractional
   part of the alpha value, and finally a U+0029 RIGHT PARENTHESIS.</dd>

   <dt>The keyword <code title>transparent</code> is used</dt>

   <dd>The color is <code title>rgba(0, 0, 0, 0)</code>.</dd>
 -->

 <dt>&lt;counter></dt>
 <dd>
  <p>The concatenation of:</p>
  <ol>
   <li><p>If &lt;counter> has three CSS component values the string
   "<code title>counters(</code>".</p></li>
   <li><p>If &lt;counter> has two CSS component values the string
   "<code title>counter(</code>".</p></li>
   <li><p>The result of
   <span title="serialize a comma-separated list">serializing</span> the
   <span title="serialize a CSS component value">serialized</span>
   CSS component values belonging to &lt;counter> as list while omitting
   the last CSS component value if it is 'decimal'.</p></li>
   <li><p>"<code title>)</code>" (U+0029).</p></li>
  </ol>
 </dd>

 <dt>&lt;frequency></dt>
 <dd><p>The frequency in hertz serialized as per &lt;number> followed by
 the literal string "<code title>hz</code>".</dd>

 <dt>&lt;identifier></dt>
 <dd><p>The identifier
 <span title="serialize an identifier">escaped</span>.</p></dd>

 <dt>&lt;integer></dt>
 <dd><p>A base-ten integer using digits 0-9 (U+0030 to U+0039) in the
 shortest form possible, preceded by "<code title>-</code>" (U+002D) if it is
 negative.</p></dd>

 <dt>&lt;length></dt>
 <dd>
  <p>A length of zero is represented by the literal string
  "<code title>0px</code>".</p>

  <p>Absolute lengths: the number of millimeters serialized as per
  &lt;number> followed by the literal string "<code title>mm</code>".</p>
  <p class="issue">Rumor has it absolute lengths will become relative
  lengths. Centimeters would be compatible with &lt;resolution>...</p>

  <p>Relative lengths: the &lt;number> component serialized as per
  &lt;number> followed by the unit in its canonical form as defined in its
  respective specification.</p>
 </dd>

 <dt>&lt;number></dt>
 <dd>
  <p>A base-ten number using digits 0-9 (U+0030 to U+0039) in the shortest form possible, using "<code title>.</code>" to separate decimals (if any), preceded
  by "<code title>-</code>" (U+002D) if it is negative.
  
  <p class=note>JavaScript's <code title>ToString</code> algorithm cannot be used since it can serialize numbers using an exponent, which would not round-trip
  in CSS.

 <dt>&lt;percentage></dt>
 <dd><p>The &lt;number> component serialized as per &lt;number> followed
 by the literal string "<code title>%</code>" (U+0025).</p></dd>

 <dt>&lt;resolution></dt>
 <dd><p>The resolution in dots per centimeter serialized as per
 &lt;number> followed by the literal string "<code title>dpcm</code>".</dd>

 <dt>&lt;shape></dt>
 <dd><p>The string "<code title>rect(</code>", followed by the result
 of <span title="serialize a comma-separated list">serializing</span> the
 <span title="serialize a CSS component value">serialized</span>
 CSS component values belonging to &lt;shape> as list, followed by
 "<code title>)</code>" (U+0029).</p></dd>

 <dt>&lt;string></dt>
 <dt>&lt;family-name></dt>
 <dt>&lt;specific-voice></dt>
 <dd><p>The string
 <span title="serialize a string">string escaped</span>.</p></dd>

 <dt>&lt;time></dt>
 <dd><p>The time in seconds serialized as per &lt;number> followed by
 the literal string "<code title>s</code>".</dd>

 <dt>&lt;uri></dt>
 <dd><p>The <span data-anolis-spec=url title=concept-absolute-url>absolute URL</span>
 <span title="serialize a URL">URL escaped</span>.</p></dd>
</dl>

<p>
 &lt;absolute-size>,
 &lt;border-width>,
 &lt;border-style>,
 &lt;bottom>,
 &lt;generic-family>,
 &lt;generic-voice>,
 &lt;left>,
 &lt;margin-width>,
 &lt;padding-width>,
 &lt;relative-size>,
 &lt;right>, and
 &lt;top>,
 are considered macros by this specification. They all represent instances
 of components outlined above.</p>

<p class="issue">One idea is that we can remove this section somewhere in
the CSS3/CSS4 timeline by moving the above definitions to the drafts that
define the CSS components.</p>


<h5>Examples</h5>

<p>Here are some examples of before and after results on specified values.
The before column could be what the author wrote in a style sheet, while
the after column shows what querying the DOM would return.</p>

<div class="example">
 <table class="complex data">
  <thead>
   <tr><th>Before<th>After
  <tbody>
   <tr><td><code title>background: none</code><td><code title>background: rgba(0, 0, 0, 0)</code>
   <tr><td><code title>outline: none</code><td><code title>outline: invert</code>
   <tr><td><code title>border: none</code><td><code title>border: medium</code>
   <tr><td><code title>list-style: none</code><td><code title>list-style: disc</code>
   <tr><td><code title>margin: 0 1px 1px 1px</code><td><code title>margin: 0px 1px 1px</code>
   <tr><td><code title>azimuth: behind left</code><td><code title>azimuth: 220deg</code>
   <tr><td><code title>font-family: a, 'b"', serif</code><td><code title>font-family: "a", "b\"", serif</code>
   <tr><td><code title>content: url('h)i') '\[\]'</code><td><code title>content: url("h)i") "[]"</code>
   <tr><td><code title>azimuth: leftwards</code><td><code title>azimuth: leftwards</code>
   <tr><td><code title>color: rgb(18, 52, 86)</code><td><code title>color: #123456</code>
   <tr><td><code title>color: rgba(000001, 0, 0, 1)</code><td><code title>color: #000000</code>
 </table>

 <p class="issue">Some of these need to be updated per the new rules.</p>
</div>


<h2>DOM Access to CSS Declaration Blocks</h2>


<h3>The <code>ElementCSSInlineStyle</code> Interface</h3>

<p>The <code>ElementCSSInlineStyle</code> interface provides access to inline style properties of an element.</p>

<pre class=idl>[NoInterfaceObject]
interface <dfn>ElementCSSInlineStyle</dfn> {
  [SameObject, PutForwards=<span title=dom-CSSStyleDeclaration-cssText>cssText</span>] readonly attribute <span>CSSStyleDeclaration</span> <!--
  --><span title=dom-ElementCSSInlineStyle-style>style</span>;
};</pre>

<p>The <dfn title=dom-ElementCSSInlineStyle-style><code>style</code></dfn> attribute must return a <span>CSS declaration block</span> with the
<span title=concept-css-declaration-block-declarations>declarations</span> being set to the result of <span title='Parse a CSS declaration block'>parsing</span>
the <code title>style</code> content attribute, in <span title=concept-declarations-specified-order>specified order</span>. If the
<code title>style</code> content attribute is absent, the object represents an empty list of
declarations. Mutating the <code>CSSStyleDeclaration</code> object must set the
<code title>style</code> content attribute on the element to the
<span title='serialize a CSS declaration block'>serialization</span> of the
<code>CSSStyleDeclaration</code>'s <span title=concept-css-declaration-block-declarations>declarations</span>.
The object is live; if the
<code title>style</code> content attribute is set, changed or removed, the <span title=concept-css-declaration-block-declarations>declarations</span> must be
updated as appropriate.</p>

<p>If the user agent supports HTML, the following IDL applies: <span data-anolis-ref class=informative>HTML</span>

<pre class=idl><span data-anolis-spec=html>HTMLElement</span> implements <span>ElementCSSInlineStyle</span>;</pre>

<p>If the user agent supports SVG, the following IDL applies: <span data-anolis-ref class=informative>SVG</span>

<pre class=idl>SVGElement implements <span>ElementCSSInlineStyle</span>;</pre>


<h3>Extensions to the <code title>Window</code> Interface</h3>

<pre class=idl>partial interface <span data-anolis-spec=html>Window</span> {
  [NewObject] <span>CSSStyleDeclaration</span> <!--
  --><span title=dom-Window-getComputedStyle>getComputedStyle</span>(<span data-anolis-spec=dom>Element</span> elt, optional DOMString pseudoElt);
};</pre>

<p>The <dfn title=dom-Window-getComputedStyle><code>getComputedStyle(<var>elt</var>, <var>pseudoElt</var>)</code></dfn> method must run these
steps:</p>
<ol>
 <li><p>Let <var>doc</var> be the
 <code data-anolis-spec=dom>Document</code>
 associated with the <code data-anolis-spec=html>Window</code> object on
 which the method was invoked.</p></li>
 <li><p>Let <var>obj</var> be <var>elt</var>.</p></li>
 <li><p>If <var>pseudoElt</var> is as an
 <span data-anolis-spec=dom>ASCII case-insensitive</span> match for
 either ':before' or '::before' let
 <var>obj</var> be the <span>::before pseudo-element</span> of
 <var>elt</var>.</p></li>
 <li><p>If <var>pseudoElt</var> is as an
 <span data-anolis-spec=dom>ASCII case-insensitive</span> match for
 either ':after' or '::after' let
 <var>obj</var> be the <span>::after pseudo-element</span> of
 <var>elt</var>.</p></li>
 <li>
  <p>Return a live <span>CSS declaration block</span> with the
  <span title=concept-css-declaration-block-readonly-flag>readonly flag</span> set and the
  <span title=concept-css-declaration-block-declarations>declarations</span> set to all longhand properties
  that are <span title="supported CSS property">supported CSS properties</span> with the value being the <span>resolved value</span>
  computed for <var>obj</var> using the style rules associated
  with <var>doc</var>.</p>
  <p class='note'>This means that even if <var>obj</var> is in a
  different document (e.g. one fetched via <code title>XMLHttpRequest</code>) it
  will still use the style rules associated with the document that is
  associated with the global object on which
  <code title='dom-Window-getComputedStyle'>getComputedStyle()</code> was
  invoked to compute the <span>CSS declaration block</span>.</p>
 </li>
</ol>
<p class='note'>Because of historical IDL limitations the <code title=dom-Window-getComputedStyle>getComputedStyle()</code> method used to be on
a separate interface, <code title>ViewCSS</code>.</p>

<p class=warning>The <code title=dom-Window-getComputedStyle>getComputedStyle()</code> method exposes information from <span title="CSS style sheet">CSS style
sheets</span> with the <span title=concept-css-style-sheet-origin-clean-flag>origin-clean flag</span> unset.

<h3>The <code title>GetStyleUtils</code> Interface</h3>

<p>The <dfn>associated document</dfn> of an object <var>obj</var> is <var>obj</var>'s <span data-anolis-spec=dom title=concept-node-document>node
document</span> if <var>obj</var> is an <code data-anolis-spec=dom>Element</code> object, or <var>obj</var>'s associated
<code data-anolis-spec=dom>Element</code> object's <span data-anolis-spec=dom title=concept-node-document>node document</span> if <var>obj</var> is a
<code>PseudoElement</code> object.</p>

<pre class=idl>[NoInterfaceObject]
interface <dfn>GetStyleUtils</dfn> {
  [SameObject] readonly attribute <span>CSSStyleDeclaration</span> <span title=dom-GetStyleUtils-cascadedStyle>cascadedStyle</span>;
  <!--[SameObject] readonly attribute <span>CSSStyleDeclaration</span> <span title=dom-GetStyleUtils-defaultStyle>defaultStyle</span>;
  -->[SameObject] readonly attribute <span>CSSStyleDeclaration</span> <span title=dom-GetStyleUtils-rawComputedStyle>rawComputedStyle</span>;
  [SameObject] readonly attribute <span>CSSStyleDeclaration</span> <span title=dom-GetStyleUtils-usedStyle>usedStyle</span>;
};</pre>

<p class=atrisk>The <dfn title=dom-GetStyleUtils-cascadedStyle><code>cascadedStyle</code></dfn> attribute must return a live <span>CSS declaration block</span>
with the <span title=concept-css-declaration-block-readonly-flag>readonly flag</span> set and the
<span title=concept-css-declaration-block-declarations>declarations</span> set to all longhand properties
that are <span title="supported CSS property">supported CSS properties</span> that have a <span>cascaded value</span> for the <span data-anolis-spec=dom>context
object</span>, with the value being the <span>cascaded value</span> computed for the <span data-anolis-spec=dom>context object</span> using the style rules
associated with the <span data-anolis-spec=dom>context object</span>'s <span>associated document</span>.</p>

<!--<p class=atrisk>The <dfn title=dom-GetStyleUtils-defaultStyle><code>defaultStyle</code></dfn> attribute must return a live <span>CSS declaration
block</span> with the <span title=concept-css-declaration-block-readonly-flag>readonly flag</span> set and the
<span title=concept-css-declaration-block-declarations>declarations</span> set to all longhand properties that are
<span title="supported CSS property">supported CSS properties</span> with the value being the
<span>computed value</span> computed for the <span data-anolis-spec=dom>context object</span> using the user-agent-level style rules and user-level style rules
associated with the <span data-anolis-spec=dom>context object</span>'s <span>associated document</span>, ignoring transitions, animations, author-level style
rules, author-level presentational hints and override-level style rules.</p>-->

<p class=atrisk>The <dfn title=dom-GetStyleUtils-rawComputedStyle><code>rawComputedStyle</code></dfn> attribute must return a live <span>CSS declaration
block</span> with the <span title=concept-css-declaration-block-readonly-flag>readonly flag</span> set and the
<span title=concept-css-declaration-block-declarations>declarations</span> set to all longhand properties
that are <span title="supported CSS property">supported CSS properties</span> with the value being the <span>computed value</span>
computed for the <span data-anolis-spec=dom>context object</span> using the style rules associated
with the <span data-anolis-spec=dom>context object</span>'s <span>associated document</span>.</p>

<p class=atrisk>The <dfn title=dom-GetStyleUtils-usedStyle><code>usedStyle</code></dfn> attribute must return a live <span>CSS declaration block</span> with the
<span title=concept-css-declaration-block-readonly-flag>readonly flag</span> set and the
<span title=concept-css-declaration-block-declarations>declarations</span> set to all longhand properties
that are <span title="supported CSS property">supported CSS properties</span> with the value being the <span>used value</span>
computed for the <span data-anolis-spec=dom>context object</span> using the style rules associated
with the <span data-anolis-spec=dom>context object</span>'s <span>associated document</span>.</p>

<p class=warning>The <code title=dom-GetStyleUtils-cascadedStyle>cascadedStyle</code>, <code title=dom-GetStyleUtils-rawComputedStyle>rawComputedStyle</code>
and <code title=dom-GetStyleUtils-usedStyle>usedStyle</code> methods expose information from <span title="CSS style sheet">CSS style sheets</span> with the
<span title=concept-css-style-sheet-origin-clean-flag>origin-clean flag</span> unset.


<h3>Extensions to the <code title>Element</code> Interface</h3>

<pre class=idl>partial interface <span data-anolis-spec=dom>Element</span> {
  <span>PseudoElement</span>? <span title=dom-Element-pseudo>pseudo</span>(DOMString pseudoElt);
};

<span data-anolis-spec=dom>Element</span> implements <span>GetStyleUtils</span>;</pre>

<p class=atrisk>The <dfn title=dom-Element-pseudo><code>pseudo(<var>pseudoElt</var>)</code></dfn> method, when invoked, must run the following steps:
<ol>
 <li><p>If <var>pseudoElt</var> is as an <span data-anolis-spec=dom>ASCII case-insensitive</span> match for either ':before' or
 '::before' return the <code>PseudoElement</code> representing the <span>::before pseudo-element</span> of the
 <span data-anolis-spec=dom>context object</span>.</p></li>
 <li><p>If <var>pseudoElt</var> is as an <span data-anolis-spec=dom>ASCII case-insensitive</span> match for either ':after' or
 '::after' return the <code>PseudoElement</code> representing the <span>::after pseudo-element</span> of the
 <span data-anolis-spec=dom>context object</span>.</p></li>
 <li><p>Return null.</p></li>
</ol>
<p>When invoked with an argument that returns a <code>PseudoElement</code> object representing a particular pseudo-element, the same object must be
returned as returned by an earlier call that represent the same pseudo-element.</p>



<h3>The <code title>PseudoElement</code> Interface</h3>
  
<p class=atrisk>The <code>PseudoElement</code> interface is used for representing CSS pseudo-elements. A <code>PseudoElement</code> object is associated with an
<code data-anolis-spec=dom>Element</code> object.</p>

<pre class=idl>interface <dfn>PseudoElement</dfn> {
};

<span>PseudoElement</span> implements <span>GetStyleUtils</span>;</pre>


<h2>Resolved Values</h2>

<p><code title="dom-Window-getComputedStyle">getComputedStyle()</code> was
historically defined to return the "computed value" of an element or
pseudo-element. However, the concept of "computed value" changed between
revisions of CSS while the implementation of
<code title="dom-Window-getComputedStyle">getComputedStyle()</code> had to
remain the same for compatibility with deployed scripts. To address this
issue this specification introduces the concept of a
<dfn>resolved value</dfn>.</p>

<p>The <span>resolved value</span> for a given property can be determined
as follows:</p>

<dl class="switch">
 <!--
 We want to treat shorthand properties like any other value basically.

 <dt>'background'
 <dt>'border'
 <dt>'border-collapse'
 <dt>'border-color'
 <dt>'border-spacing'
 <dt>'border-style'
 <dt>'border-top'
 <dt>'border-right'
 <dt>'border-bottom'
 <dt>'border-left'
 <dt>'border-width'
 <dt>'font'
 <dt>'list-style'
 <dt>'margin'
 <dt>'outline'
 <!- - overflow is not - ->
 <dt>'padding'
 <dt>'pause'
 <dd>
  <p>There is no <span>resolved value</span>.</p>
 </dd>
 -->

 <dt>'line-height'</dt>
 <dd><p>The <span>resolved value</span> is the <span>used value</span>.</p></dd>

 <dt>'height'</dt>
 <dt>'margin'</dt>
 <dt>'margin-bottom'</dt>
 <dt>'margin-left'</dt>
 <dt>'margin-right'</dt>
 <dt>'margin-top'</dt>
 <dt>'padding'</dt>
 <dt>'padding-bottom'</dt>
 <dt>'padding-left'</dt>
 <dt>'padding-right'</dt>
 <dt>'padding-top'</dt>
 <dt>'width'</dt>
 <dd><p>If the property applies to the element or pseudo-element and the
 <span>resolved value</span> of the 'display' property is not
 'none', the <span>resolved value</span> is the
 <span>used value</span>. Otherwise the <span>resolved value</span> is the
 <span>computed value</span>.</p></dd>

 <dt>'bottom'</dt>
 <dt>'left'</dt>
 <dt>'right'</dt>
 <dt>'top'</dt>
 <dd><p>If the property applies to a positioned element and the
 <span>resolved value</span> of the 'display' property is not
 'none', the <span>resolved value</span> is the
 <span>used value</span>. Otherwise the <span>resolved value</span> is the
 computed value.</p></dd>

 <dt>Any other property</dt>
 <dd><p>The <span>resolved value</span> is the <span>computed value</span>.</p></dd>
</dl>


<h2>IANA Considerations</h2>


<h3><dfn title="http-default-style"><code title>Default-Style</code></dfn></h3>

<p>This section describes a header field for registration in the Permanent
Message Header Field Registry.
<!--<a href="issue">[RFC3864]</a>--></p>

<dl>
 <dt>Header field name</dt>
 <dd>Default-Style</dd>
 <dt>Applicable protocol</dt>
 <dd>http</dd>
 <dt>Status</dt>
 <dd>standard</dd>
 <dt>Author/Change controller</dt>
 <dd>W3C</dd>
 <dt>Specification document(s)</dt>
 <dd>This document is the relevant specification.</dd>
 <dt>Related information</dt>
 <dd>None.</dd>
</dl>


<h2 class=no-num>References</h2>

<div id=anolis-references></div>


<h2 class="no-num">Change History</h2>

<p>This section documents the primary technical changes of CSSOM related functionality, with a focus on changes to API signatures.</p>

<h3 class="no-num">Changes From DOM-2 Style</h3>

<ul>
<li><p>Remove definition of <code title>CSSRule.UNKNOWN_RULE</code>, reserving its value (0) to prevent future reuse.</p></li>
<li><p>Remove definition of <code title>DOMImplementationCSS</code> interface.</p></li>
</ul>


<h2 class="no-num">Acknowledgments</h2>

<p>The editors would like to thank

Alexey Feldgendler,
Bj&ouml;rn H&ouml;hrmann,
Boris Zbasky,
Brian Kardell,
Christian Krebs,
Daniel Glazman,
David Baron,
<i>fantasai</i>,
Hallvord R. M. Steen,
Ian Hickson,
John Daggett,
Lachlan Hunt,
Mike Sherov,
Morten Stenshorne,
Øyvind Stenhaug,
Peter Sloetjes,
Philip Taylor,
Robert O'Callahan,
Simon Sapin,
Sjoerd Visscher,
<!--Simon Pieters,-->
Sylvain Galineau,
Tarquin Wilton-Jones, and
Zack Weinberg

for contributing to this specification.</p>

<p>Additional thanks to Ian Hickson for writing the
initial version of the alternative style sheets API and canonicalization
(now serialization) rules for CSS values.</p>

<!-- XXX NOTES

<style type=text/css;charset=utf-8> does create a StyleSheet in Firefox
and Opera, but does not create a StyleSheet in IE. I prefer IE.

<style type=TEXT/CSS> sets the style sheet type to text/css in Firefox and
TEXT/CSS in Opera and IE. I prefer Firefox.

<style> sets the style sheet location to the document location Firefox,
the empty string in IE, and null in Opera. I prefer Opera

<style media="x"> invokes .sheet.media.mediaText = "x"

<style> does not "have" a title

.cascadedStyle that returns less keywords than currentStyle, no inherit,
etc.

Markup style: http://krijnhoetmer.nl/irc-logs/whatwg/20100204#l-529
-->
 </body>
</html>

