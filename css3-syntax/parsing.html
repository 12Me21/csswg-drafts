CSS Syntax

<h2>Parsing</h2>

<h3>
Parsing CSS Documents</h3>

	<p>
		User agents must use the parsing rules described in this section to generate the CSSOM trees from text/css resources. 
		Together, these rules define what is referred to as the CSS parser.

	<p>
		This specification defines the parsing rules for CSS documents, whether they are syntactically correct or not. 
		Certain points in the parsing algorithm are said to be parse errors. 
		The error handling for parse errors is well-defined: 
		user agents must either act as described below when encountering such problems, 
		or must abort processing at the first error that they encounter for which they do not wish to apply the rules described below.

	<p>
		Conformance checkers must report at least one parse error condition to the user if one or more parse error conditions exist in the document and must not report parse error conditions if none exist in the document. 
		Conformance checkers may report more than one parse error condition if more than one parse error condition exists in the document. 
		Conformance checkers are not required to recover from parse errors.

<h3>
Overview of the Parsing Model</h3>

	<p>
		The input to the CSS parsing process consists of a stream of Unicode code points, 
		which is passed through a tokenization stage followed by a tree construction stage. 
		The output is a CSSStyleSheet object.

	<p class='note'>
		Implementations that do not support scripting do not have to actually create a CSSOM CSSStyleSheet object, 
		but the CSSOM tree in such cases is still used as the model for the rest of the specification.

<h3>
The input byte stream</h3>

	<p>
		...

<h3>
Determining the character encoding</h3>

	<p>
		...

<h3>
Preprocessing the input stream</h3>

	<p>
		The input stream consists of the characters pushed into it as the input byte stream is decoded or from the various APIs that directly manipulate the input stream.

	<p>
		One leading U+FEFF BYTE ORDER MARK character must be ignored if any are present in the input stream.

	<p class='note'>
		The requirement to strip a U+FEFF BYTE ORDER MARK character regardless of whether that character was used to determine the byte order is a willful violation of Unicode, motivated by a desire to increase the resilience of user agents in the face of na√Øve transcoders.

	<p>
		U+000D CARRIAGE RETURN (CR) characters and U+000A LINE FEED (LF) characters are treated specially. All CR characters must be converted to LF characters, and any LF characters that immediately follow a CR character must be ignored. Thus, newlines in HTML DOMs are represented by LF characters, and there are never any CR characters in the input to the tokenization stage.

	<p>
		The next input character is the first character in the input stream that has not yet been consumed or explicit ignored by the requirements in this section. Initially, the next input character is the first character in the input. The current input character is the last character to have been consumed.

	<p>
		The insertion point is the position (just before a character or just before the end of the input stream) where content inserted using document.write() is actually inserted. The insertion point is relative to the position of the character immediately after it, it is not an absolute offset into the input stream. Initially, the insertion point is undefined.

	<p>
		The "EOF" character in the tables below is a conceptual character representing the end of the input stream.

<h3>
Parse State</h3>

	<p>
		...

<h3>
Tokenization</h3>

	<p>
		...

<h4>
Definitions</h4>

	<p>
		This section defines several terms used during the tokenization phase.

	<dl>
		<dt><dfn>digit</dfn>
		<dd>
			A character between U+0030 DIGIT ZERO (0) and U+0039 DIGIT NINE (9).

		<dt><dfn>hex digit</dfn>
		<dd>
			A <i>digit</i>,
			or a character between U+0041 LATIN CAPITAL LETTER A (A) and U+0046 LATIN CAPITAL LETTER F (F), 
			or a character between U+0061 LATIN SMALL LETTER A (a) and U+0066 LATIN SMALL LETTER F (f).

		<dt><dfn>uppercase letter</dfn>
		<dd>
			A character between U+0041 LATIN CAPITAL LETTER A (A) and U+005A LATIN CAPITAL LETTER Z (Z).

		<dt><dfn>lowercase letter</dfn>
		<dd>
			A character between U+0061 LATIN SMALL LETTER A (a) and U+007A LATIN SMALL LETTER Z (z).

		<dt><dfn>letter</dfn>
		<dd>
			An <i>uppercase letter</i>
			or a <i>lowercase letter</i>.

		<dt><dfn>non-ASCII character</dfn>
		<dd>
			A character with a codepoint equal to or greater than U+00A0 NO-BREAK SPACE.

		<dt><dfn>name-start character</dfn>
		<dd>
			A <i>letter</i>,
			a <i>non-ASCII character</i>,
			or U+005F LOW LINE (_).

		<dt><dfn>name character</dfn>
		<dd>
			A <i>name-start character</i>,
			A <i>digit</i>,
			or U+002D HYPHEN-MINUS (-).

		<dt><dfn>non-printable character</dfn>
		<dd>
			A character between U+0000 NULL and U+0008 BACKSPACE
			or a character between U+000E SHIFT OUT and U+001F INFORMATION SEPARATOR ONE
			or a character between U+007F DELETE and U+009F APPLICATION PROGRAM COMMAND.

		<dt><dfn>newline</dfn>
		<dd>
			U+000A LINE FEED or U+000C FORM FEED. 
			<span class='note'>
				Note that U+000D CARRIAGE RETURN is not included in this definition, 
				as it is removed from the stream during preprocessing.
			</span>

		<dt><dfn>whitespace</dfn>
		<dd>A <i>newline</i>, U+0009 CHARACTER TABULATION, or U+0020 SPACE.

	</dl>

<h4>
<dfn>Data state</dfn></h4>

	<p>
		Consume the <i>next input character</i>.

	<dl>
		<dt><i>whitespace</i>
		<dd>
			Remain in this state.

		<dt>U+0022 QUOTATION MARK (")
		<dd>
			Switch to the <i>double-quote-string state</i>.

		<dt>U+0023 NUMBER SIGN (#)
		<dd>
			Switch to the <i>hash state</i>.

		<dt>U+0027 APOSTROPHE (')
		<dd>
			Switch to the <i>single-quote-string state</i>.

		<dt>U+0028 LEFT PARENTHESIS (()
		<dd>
			Emit an open-paren token.
			Remain in this state.

		<dt>U+0029 RIGHT PARENTHESIS ())
		<dd>
			Emit a close-paren token.
			Remain in this state.

		<dt>U+002B PLUS SIGN (+)
		<dd>
			If the <i>next input character</i> is
			a <i>digit</i>,
			or the <i title="next input character">next 2 input characters</i> are
			U+002D HYPHEN-MINUS (-)
			followed by a <i>digit</i>,
			switch to the <i>number state</i>.
			Set the "starts with plus" flag on the next number or dimension token you emit.

			<p>
				Otherwise,
				emit a delim token
				with its value set to U+002B PLUS SIGN (+).
				Remain in this state</i>.

		<dt>U+002D HYPHEN-MINUS (-)
		<dd>
			If the <i title="next input character">next 2 input characters</i> are
			U+002D HYPHEN-MINUS
			U+003E GREATER-THAN SIGN
			(->),
			consume them,
			emit a CDC token,
			and remain in this state.

			<p>
				Otherwise,
				if the <i>next input character</i> is
				a <i>digit</i>,
				switch to the <i>number state</i>.
				Reconsume the <i>current input character</i>.

			<p>
				Otherwise,
				if the <i title="next input character">next 2 input characters</i> are
				U+002E FULL STOP (.)
				followed by <i>a digit</i>,
				switch to the <i>number state</i>.
				Reconsume the <i>current input character</i>.

			<p>
				Otherwise,
				if the <i>next input character</i> is
				a <i>name-start character</i>,
				switch to the <i>identifier state</i>.
				Reconsume the <i>current input character</i>.

			<p>
				Otherwise,
				emit a delim token
				with its value set to U+002D HYPHEN-MINUS (-).
				Remain in this state.

		<dt>U+002E FULL STOP (.)
		<dd>
			If the <i>next input character</i> is a digit,
			switch to the <i>number state</i>.
			Reconsume the <i>current input character</i>.

			<p>
				Otherwise,
				emit a delim token
				with its value set to U+002E FULL STOP (.).
				Remain in this state.

		<dt>U+002F SOLIDUS (/)
		<dd>
			If the <i>next input character</i> is U+002A ASTERISK (*),
			consume it
			and switch to the <i>comment state</i>.

			<p>
				Otherwise,
				emit a delim token
				with its value set to U+002F SOLIDUS (/).
				Remain in this state.

		<dt>U+003A COLON (:)
		<dd>
			Emit a colon token.
			Remain in this state.

		<dt>U+003B SEMICOLON (;)
		<dd>
			Emit a semicolon token.
			Remain in this state.

		<dt>U+003C LESS-THAN SIGN (&lt;)
		<dd>
			If the <i title="next input character">next 3 input characters</i> are
			U+0021 EXCLAMATION MARK
			U+002D HYPHEN-MINUS
			U+002D HYPHEN-MINUS
			(!--),
			consume them
			and emit a cdo token.
			Remain in this state.

			<p>
				Otherwise,
				emit a delim token
				with its value set to U+003C LESS-THAN SIGN (&lt;).
				Remain in this state.

		<dt>U+0040 COMMERCIAL AT (@)
		<dd>
			Switch to the <i>at-keyword-start state</i>.

		<dt>U+005B LEFT SQUARE BRACKET ([)
		<dd>
			Emit an open-bracket token.
			Remain in this state.

		<dt>U+005C REVERSE SOLIDUS (\)
		<dd>
			If the <i>next input character</i> is 
			a <i>newline</i>
			or EOF,
			this is a <i>parse error</i>.
			Emit a delim token
			with its value set to U+005C REVERSE SOLIDUS (\).
			Remain in this state.

			<p>
				Otherwise, switch to the <i>identifier state</i>.
				Reconsume the <i>current input character</i>.

		<dt>U+005D RIGHT SQUARE BRACKET (])
		<dd>
			Emit a close-bracket token.
			Remain in this state.

		<dt>U+007B LEFT CURLY BRACKET ({)
		<dd>
			Emit an open-brace token.
			Remain in this state.

		<dt>U+007C VERTICAL LINE (|)
		<dd>
			If the <i>next input character</i> is
			U+003D EQUALS SIGN (=),
			emit a dash-match token.
			Remain in this state.

			<p>
				Otherwise,
				emit a delim token
				with its value set to U+007C VERTICAL LINE (|).
				Remain in this state.

		<dt>U+007D RIGHT CURLY BRACKET (})
		<dd>
			Emit a close-brace token.
			Remain in this state.

		<dt>U+007E TILDE (~)
		<dd>
			If the <i>next input character</i> is
			U+003D EQUALS SIGN (=),
			emit an includes-match token.
			Remain in this state.

			<p>
				Otherwise,
				emit a delim token
				with its value set to U+007E TILDE (~).
				Remain in this state.

		<dt><i>digit</i>
		<dd>
			Switch to the <i>number state</i>.
			Reconsume the <i>current input character</i>.

		<dt>U+0055 LATIN CAPITAL LETTER U (U)
		<dt>U+0075 LATIN SMALL LETTER U (u)
		<dd>
			If the <i title="next input character">next 2 input character</i> are
			U+002B PLUS SIGN (+)
			followed by a <i>hex digit</i>,
			consume the <i>next input character</i>.
			<span class='note'>Note: don't consume both of them.</span>
			Switch to the <i>unicode-range state</i>.

			<p>
				Otherwise,
				if the <i title="next input character">next 3 input characters</i> are
				U+0052 LATIN CAPITAL LETTER R (R) or U+0072 LATIN SMALL LETTER R (r)
				followed by U+004C LATIN CAPITAL LETTER L (L) or U+006C LATIN SMALL LETTER L (l)
				followed by U+0028 LEFT PARENTHESIS ((),
				consume them.
				Switch to the <i>url state</i>.

			<p>Otherwise,
				switch to the <i>identifier state</i>.
				Reconsume the <i>current input character</i>.

		<dt><i>name-start character</i>
		<dd>
			Switch to the <i>identifier state</i>.
			Reconsume the <i>current input character</i>.

		<dt>EOF
		<dd>
			Emit an end-of-file token.

		<dt>anything else
		<dd>
			Emit a delim token
			with its value set to the <i>current input character</i>.
			Remain in this state.
	</dl>

<h4>
<dfn>Double-quote-string state</dfn></h4>

	<p>
		If a string token has not yet been created since entering this state,
		create a string token
		with its value initially set to the empty string.

	<p>
		Consume the <i>next input character</i>.

	<dl>
		<dt>U+0022 QUOTATION MARK (")
		<dd>
			Emit the string token.
			Return to the <i>data state</i>.

		<dt>EOF
		<dd>
			This is a <i>parse error</i>.
			Emit the string token.
			Switch to the <i>data state</i>.
			Reconsume the <i>current input character</i>.

		<dt><i>newline</i>
		<dd>
			This is a <i>parse error</i>.
			Emit the string token.
			Switch to the <i>data state</i>.

		<dt>U+005C REVERSE SOLIDUS (\)
		<dd>
			If the <i>next input character</i>
			is an EOF,
			this is a <i>parse error</i>.
			Append a U+005C REVERSE SOLIDUS (\)
			to the string token's value
			and emit the string token,
			then switch to the <i>data state</i>.

			<p>
				Otherwise,
				if the <i>next input character</i> is
				a <i>newline</i>,
				consume it.
				Remain in this state.

			<p>
				Otherwise,
				consume the <i>next input character</i>
				and append it to the string token's value.
				Remain in this state.

		<dt>anything else
		<dd>
			Append the <i>current input character</i>
			to the string token's value.
			Remain in this state.
	</dl>

<h4>
<dfn>Single-quote-string state</dfn></h4>

	<p>
		If a string token has not yet been created since entering this state,
		create a string token
		with its value initially set to the empty string.

	<p>
		Consume the <i>next input character</i>.

	<dl>
		<dt>U+0027 APOSTROPHE (')
		<dd>
			Emit the string token.
			Return to the <i>data state</i>.

		<dt>EOF
		<dd>
			This is a <i>parse error</i>.
			Emit the string token.
			Switch to the <i>data state</i>.
			Reconsume the <i>current input character</i>.

		<dt><i>newline</i>
		<dd>
			This is a <i>parse error</i>.
			Emit the string token.
			Switch to the <i>data state</i>.

		<dt>U+005C REVERSE SOLIDUS (\)
		<dd>
			If the <i>next input character</i>
			is an EOF,
			this is a <i>parse error</i>.
			Append a U+005C REVERSE SOLIDUS (\)
			to the string token's value
			and emit the string token,
			then switch to the <i>data state</i>.

			<p>
				Otherwise,
				if the <i>next input character</i> is
				a <i>newline</i>,
				consume it.
				Remain in this state.

			<p>
				Otherwise,
				consume the <i>next input character</i>
				and append it to the string token's value.
				Remain in this state.

		<dt>anything else
		<dd>
			Append the <i>current input character</i>
			to the string token's value.
			Remain in this state.
	</dl>

<h4>
<dfn>Hash state</dfn></h4>

	<p>
		Consume the <i>next input character</i>.

	<dl>
		<dt><i>name character</i>
		<dd>
			Create a hash token
			with its value set to the <i>current input character</i>.
			Switch to the <i>hash-rest state</i>.

		<dt>U+005C REVERSE SOLIDUS (\)
		<dd>
			If the <i>next input character</i> is
			a <i>newline</i> or EOF,
			emit a delim token
			with its value set to U+0023 NUMBER SIGN (#).
			Switch to the <i>data state</i>.
			Reconsume the <i>current input character</i>.

			<p>
				Otherwise, 
				create a hash token
				with its value set to the returned character.
				Switch to the <i>hash-rest state</i>.

		<dt>anything else
		<dd>
			Emit a delim token 
			with its value set to U+0023 NUMBER SIGN (#).
			Switch to the <i>data state</i>.
			Reconsume the <i>current input character</i>.
	</dl>

<h4>
<dfn>Hash-rest state</dfn></h4>

	<p>
		Consume the <i>next input character</i>.

	<dl>
		<dt><i>name character</i>
		<dd>
			Append the <i>current input character</i>
			to the hash token's value.
			Remain in this state.

		<dt>U+005C REVERSE SOLIDUS (\)
		<dd>
			If the <i>next input character</i> is
			a <i>newline</i> or EOF,
			emit the hash token.
			Switch to the <i>data state</i>.
			Reconsume the <i>current input character</i>.

			<p>
				Otherwise, 
				<i>consume an escaped character</i>.
				Append the returned character to the hash token's value.
				Remain in this state.

		<dt>anything else
		<dd>
			Emit the hash token.
			Switch to the <i>data state</i>.
			Reconsume the <i>current input character</i>.
	</dl>

<h4>
<dfn>Comment state</dfn></h4>

	<p>
		Consume the <i>next input character</i>.

	<dl>
		<dt>U+002A ASTERISK (*)
		<dd>
			If the <i>next input character</i> is
			U+002F SOLIDUS (/),
			consume it,
			and switch to the <i>data state</i>.

			<p>
				Otherwise,
				do nothing
				and remain in this state.

		<dt>EOF
		<dd>
			This is a <i>parse error</i>.
			Switch to the <i>data state</i>.
			Reconsume the <i>current input character</i>.

		<dt>anything else
		<dd>
			Do nothing
			and remain in this state.
	</dl>

<h4>
<dfn>At-keyword state</dfn></h4>

	<p>
		Consume the <i>next input character</i>.

	<dl>
		<dt>U+002D HYPHEN-MINUS (-)
		<dd>
			If the <i>next input character</i> is a <i>name-start character</i>,
			consume it.
			Create an at-keyword token
			with its value set to U+002D HYPHEN-MINUS
			followed by the <i>current input character</i>.
			Switch to the <i>at-keyword-rest state</i>.

			<p>
				Otherwise,
				emit a delim token
				with its value set to U+0040 COMMERCIAL AT (@).
				Switch to the <i>data state</i>.
				Reconsume the <i>current input character</i>.

		<dt><i>name-start character</i>
		<dd>
			Create an at-keyword token
			with its value set to the <i>current input character</i>.
			Switch to the <i>at-keyword-rest state</i>.

		<dt>U+005C REVERSE SOLIDUS (\)
		<dd>
			If the <i>next input character</i> is
			a <i>newline</i> or EOF,
			emit a delim token
			with its value set to U+0040 COMMERCIAL AT (@).
			Switch to the <i>data state</i>.
			Reconsume the <i>current input character</i>.

			<p>
				Otherwise, 
				<i>consume an escaped character</i>.
				Create an at-keyword token
				with its value set to the returned character.
				Switch to the <i>at-keyword-rest state</i>.

		<dt>anything else
		<dd>
			Emit a delim token
			with its value set to U+0040 COMMERCIAL AT (@).
			Switch to the <i>data state</i>.
			Reconsume the <i>current input character</i>.
	</dl>

<h4>
<dfn>At-keyword-rest state</dfn></h4>

	<p>
		Consume the <i>next input character</i>.

	<dl>
		<dt><i>name character</i>
		<dd>
			Append the <i>current input character</i>
			to the at-keyword token's value.
			Remain in this state.

		<dt>U+005C REVERSE SOLIDUS (\)
		<dd>
			If the <i>next input character</i> is
			a <i>newline</i> or EOF,
			emit the at-keyword token.
			Switch to the <i>data state</i>.
			Reconsume the <i>current input character</i>.

			<p>
				Otherwise, 
				<i>consume an escaped character</i>.
				Append the returned character to the at-keyword token's value.
				Remain in this state.

		<dt>anything else
		<dd>
			Emit the at-keyword token.
			Switch to the <i>data state</i>.
			Reconsume the <i>current input character</i>.
	</dl>

<h4>
<dfn>Identifier state</dfn></h4>

	<p>
		Consume the <i>next input character</i>.

	<dl>
		<dt>U+002D HYPHEN-MINUS (-)
		<dd>
			If the <i>next input character</i> is
			a <i>name character</i>,
			create an identifer token
			with its value initially set to U+002D HYPHEN-MINUS.
			Switch to the <i>identifier-rest state</i>.

			<p>
				Otherwise,
				switch to the <i>data state</i>.
				Reconsume the <i>current input character</i>.

		<dt><i>name-start character</i>
		<dd>
			Create an identifier token
			with its value set to the <i>current input character</i>.
			Switch to the <i>identifier-rest state</i>.

		<dt>U+005C REVERSE SOLIDUS (\)
		<dd>
			If the <i>next input character</i> is
			a <i>newline</i> or EOF,
			switch to the <i>data state</i>.
			Reconsume the <i>current input character</i>.

			<p>
				Otherwise, 
				<i>consume an escaped character</i>.
				Create an identifier token
				with its value set to the returned character.
				Switch to the <i>identifier-rest state</i>.

		<dt>anything else
		<dd>
			Switch to the <i>data state</i>.
			Reconsume the <i>current input character</i>.
	</dl>

<h4>
<dfn>Identifier-rest state</dfn></h4>

	<p>
		Consume the <i>next input character</i>.

	<dl>
		<dt><i>name character</i>
		<dd>
			Append the <i>current input character</i>
			to the identifier token's value.
			Remain in this state.

		<dt>U+005C REVERSE SOLIDUS (\)
		<dd>
			If the <i>next input character</i> is
			a <i>newline</i> or EOF,
			emit the identifier token.
			Switch to the <i>data state</i>.
			Reconsume the <i>current input character</i>.

			<p>
				Otherwise, 
				<i>consume an escaped character</i>.
				Append the returned character to the identifier token's value.
				Remain in this state.

		<dt>U+0028 LEFT PARENTHESIS (()
		<dd>
			Emit a function token
			with its value set to the identifer token's value.
			Switch to the <i>data state</i>.

		<dt>anything else
		<dd>
			Emit the identifier token.
			Switch to the <i>data state</i>.
			Reconsume the <i>current input character</i>.
	</dl>

<h4>
<dfn>Number state</dfn></h4>

	<p>
		Consume the <i>next input character</i>.

	<dl>
		<dt>U+002D HYPHEN-MINUS (-)
		<dd>
			If the <i>next input character</i> is
			a <i>digit</i>,
			consume it.
			create a temporary string token
			with its value set to U+002D HYPHEN-MINUS (-)
			followed by the <i>digit</i>.
			Switch to the <i>number-rest state</i>.

			<p>
				Otherwise,
				if the <i title="next input character">next 2 input characters</i> are
				U+002E FULL STOP
				followed by a <i>digit</i>,
				consume them.
				Create a temporary string token
				with its value set to
				U+002D HYPHEN-MINUS
				followed by U+002E FULL STOP
				followed by the <i>digit</i>.
				Switch to the <i>number fraction</i> state.

			<p>
				Otherwise,
				switch to the <i>data state</i>.
				Reconsume the <i>current input character</i>.

		<dt><i>digit</i>
		<dd>
			Create a temporary string token
			with its value set to the <i>current input character</i>.
			Switch to the <i>number-rest state</i>.

		<dt>U+002E FULL STOP (.)
		<dd>
			If the <i>next input character</i> is
			a <i>digit</i>,
			consume it.
			Create a temporary string token
			with its value set to U+002E FULL STOP (.)
			followed by the <i>digit</i>.
			Switch to the <i>number-fraction state</i>.

			<p>
				Otherwise,
				switch to the <i>data state</i>.
				Reconsume the <i>current input character</i>.

		<dt>anything else
		<dd>
			Switch to the <i>data state</i>.
			Reconsume the <i>current input character</i>.
	</dl>

<h4>
<dfn>Number-rest state</dfn></h4>

	<p>
		Consume the <i>next input character</i>.

	<dl>
		<dt><i>digit</i>
		<dd>
			Append the <i>current input character</i>
			to the string token's value.
			Remain in this state.

		<dt>U+002E FULL STOP (.)
		<dd>
			If the <i>next input character</i> is
			a <i>digit</i>,
			consume it.
			Append U+002E FULL STOP (.)
			followed by the <i>digit</i>
			to the string token's value.
			Switch to the <i>number-fraction state</i>.

			<p>
				Otherwise,
				emit a number token
				with its value set to the number
				produced by interpreting the string token's value
				as a base-10 number.
				Switch to the <i>data state</i>.
				Reconsume the <i>current input character</i>.

		<dt>U+0025 PERCENT SIGN
		<dd>
			Emit a percent token
			with its value set to the number
			produced by interpreting the string token's value
			as a base-10 number.
			Switch to the <i>data state</i>.
			Reconsume the <i>current input character</i>.

		<!--
		If we want to parse SVG-style sci notation,
		insert a clause here for e/E.
		Note - the clause will be as large as the remainer of this state.
		-->

		<dt>U+002D HYPHEN-MINUS (-)
		<dd>
			If the <i>next input character</i> is
			a <i>name-start character</i>,
			consume it.
			Create a dimension token
			with its value set to the number
			produced by interpreting the string token's value
			as a base-10 number,
			and a unit initially set to
			U+002D HYPHEN-MINUS
			followed by the <i>name-start character</i>.
			Switch to the <i>dimension state</i>.

			<p>
				Otherwise,
				if the <i title="next input character">next 2 input characters</i> are
				U+005C REVERSE SOLIDUS (\) followed by a <i>newline</i>,
				or U+005C REVERSE SOLIDUS (\) followed by EOF,
				emit a number token
				with its value set to the number
				produced by interpreting the string token's value
				as a base-10 number.
				Switch to the <i>data state</i>.
				Reconsume the <i>current input character</i>.

			<p>
				Otherwise,
				if the <i>next input character</i> is
				U+005C REVERSE SOLIDUS (\),
				consume it,
				then <i>consume an escaped character</i>.
				Create a dimension token
				with its value set to the number
				produced by interpreting the string token's value
				as a base-10 number,
				and a unit initially set to
				U+002D HYPHEN-MINUS
				followed by the returned character.
				Switch to the <i>dimension state</i>.

			<p>
				Otherwise,
				emit a number token
				with its value set to the number
				produced by interpreting the string token's value
				as a base-10 number.
				Switch to the <i>data state</i>.
				Reconsume the <i>current input character</i>.

		<dt><i>name-start character</i>
		<dd>
			Create a dimension token
			with its value set to the number
			produced by interpreting the string token's value
			as a base-10 number,
			and a unit initially set to the <i>current input character</i>.
			Switch to the <i>dimension state</i>.

		<dt>U+005C REVERSE SOLIDUS (\)
		<dd>
			If the <i>next input character</i> is
			a <i>newline</i> or EOF,
			emit a number token
			with its value set to the number
			produced by interpreting the string token's value
			as a base-10 number.
			Switch to the <i>data state</i>.
			Reconsume the <i>current input character</i>.

			<p>
				Otherwise,
				<i>consume an escaped character</i>.
				Create a dimension token
				with its value set to the number
				produced by interpreting the string token's value
				as a base-10 number,
				and a unit initially set to the returned character.
				Switch to the <i>dimension state</i>.


		<dt>anything else
		<dd>
			Emit a number token
			with its value set to the number
			produced by interpreting the string token's value
			as a base-10 number.
			Switch to the <i>data state</i>.
			Reconsume the <i>current input character</i>.
	</dl>

<h4>
<dfn>Number-fraction state</dfn></h4>

	<p>
		Consume the <i>next input character</i>.

	<dl>
		<dt><i>digit</i>
		<dd>
			Append the <i>current input character</i>
			to the string token's value.
			Remain in this state.

		<dt>U+002E FULL STOP (.)
		<dd>
			Emit a number token
			with its value set to the number
			produced by interpreting the string token's value
			as a base-10 number.
			Switch to the <i>data state</i>.
			Reconsume the <i>current input character</i>.

		<dt>U+0025 PERCENT SIGN
		<dd>
			Emit a percent token
			with its value set to the number
			produced by interpreting the string token's value
			as a base-10 number.
			Switch to the <i>data state</i>.
			Reconsume the <i>current input character</i>.

		<!--
		If we want to parse SVG-style sci notation,
		insert a clause here for e/E.
		Note - the clause will be as large as the remainer of this state.
		-->

		<dt>U+002D HYPHEN-MINUS (-)
		<dd>
			If the <i>next input character</i> is
			a <i>name-start character</i>,
			consume it.
			Create a dimension token
			with its value set to the number
			produced by interpreting the string token's value
			as a base-10 number,
			and a unit initially set to
			U+002D HYPHEN-MINUS
			followed by the <i>name-start character</i>.
			Switch to the <i>dimension state</i>.

			<p>
				Otherwise,
				if the <i title="next input character">next 2 input characters</i> are
				U+005C REVERSE SOLIDUS (\) followed by a <i>newline</i>,
				or U+005C REVERSE SOLIDUS (\) followed by EOF,
				emit a number token
				with its value set to the number
				produced by interpreting the string token's value
				as a base-10 number.
				Switch to the <i>data state</i>.
				Reconsume the <i>current input character</i>.

			<p>
				Otherwise,
				if the <i>next input character</i> is
				U+005C REVERSE SOLIDUS (\),
				consume it,
				then <i>consume an escaped character</i>.
				Create a dimension token
				with its value set to the number
				produced by interpreting the string token's value
				as a base-10 number,
				and a unit initially set to
				U+002D HYPHEN-MINUS
				followed by the returned character.
				Switch to the <i>dimension state</i>.

			<p>
				Otherwise,
				emit a number token
				with its value set to the number
				produced by interpreting the string token's value
				as a base-10 number.
				Switch to the <i>data state</i>.
				Reconsume the <i>current input character</i>.

		<dt><i>name-start character</i>
		<dd>
			Create a dimension token
			with its value set to the number
			produced by interpreting the string token's value
			as a base-10 number,
			and a unit initially set to the <i>current input character</i>.
			Switch to the <i>dimension state</i>.

		<dt>U+005C REVERSE SOLIDUS (\)
		<dd>
			If the <i>next input character</i> is
			a <i>newline</i> or EOF,
			emit a number token
			with its value set to the number
			produced by interpreting the string token's value
			as a base-10 number.
			Switch to the <i>data state</i>.
			Reconsume the <i>current input character</i>.

			<p>
				Otherwise,
				<i>consume an escaped character</i>.
				Create a dimension token
				with its value set to the number
				produced by interpreting the string token's value
				as a base-10 number,
				and a unit initially set to the returned character.
				Switch to the <i>dimension state</i>.


		<dt>anything else
		<dd>
			Emit a number token
			with its value set to the number
			produced by interpreting the string token's value
			as a base-10 number.
			Switch to the <i>data state</i>.
			Reconsume the <i>current input character</i>.
	</dl>

<h4>
<dfn>Dimension state</dfn></h4>

	<!--
		This state is currently always entered with a dimension token
		having already been created and gotten over the "first valid character" hump,
		so the dimension token is already ready to emit.

		If this ever becomes not true, make the necessary additions here
		or things will break.
	-->

	<p>
		Consume the <i>next input character</i>.

	<dl>
		<dt><i>name character</i>
		<dd>
			Append the <i>current input character</i>
			to the dimension token's unit.
			Remain in this state.

		<dt>U+005C REVERSE SOLIDUS (\)
		<dd>
			If the <i>next input character</i> is
			a <i>newline</i> or EOF,
			emit the dimension token.
			Switch to the <i>data state</i>.
			Reconsume the <i>current input character</i>.

			<p>
				Otherwise,
				<i>consume an escaped character</i>.
				Append the returned character
				to the dimension token's unit.

		<dt>anything else
		<dd>
			Emit the dimension token.
			Switch to the <i>data state</i>.
			Reconsume the <i>current input character</i>.
	</dl>

<h4>
<dfn>URL state</dfn></h4>

	<p>
		Consume the <i>next input character</i>.

	<dl>
		<dt>U+0022 QUOTATION MARK (")
		<dd>
			Switch to the <i>url-double-quote state</i>.

		<dt>U+0027 APOSTROPHE (')
		<dd>
			Switch to the <i>url-single-quote state</i>.

		<dt>U+0029 RIGHT PARENTHESIS ())
		<dd>
			Emit a url token
			with its value set to the empty string.
			Switch to the <i>data state</i>.

		<dt><i>whitespace</i>
		<dd>
			Remain in this state.

		<dt>anything else
		<dd>
			Switch to the <i>url-unquoted state</i>.
			Reconsume the <i>current input character</i>.
	</dl>

<h4>
<dfn>URL-double-quote state</dfn></h4>

	<p>
		If a url token has not yet been created since entering this state,
		create a url token
		with its value initially set to the empty string.

	<p>
		Consume the <i>next input character</i>.

	<dl>
		<dt>U+0022 QUOTATION MARK (")
		<dd>
			Switch to the <i>url-end state</i>.

		<dt>U+005C REVERSE SOLIDUS (\)
		<dd>
			If the <i>next input character</i> is
			EOF,
			this is a <i>parse error</i>.
			Emit a bad-url token.
			Switch to the <i>data state</i>.
			Reconsume the <i>current input character</i>.

			<p>
				Otherwise, if the <i>next input character</i> is
				a <i>newline</i>,
				consume it
				and remain in this state.

			<p>
				Otherwise,
				consume the <i>next input character</i>.
				Append the <i>current input character</i>
				to the url token's value.
				Remain in this state.

		<dt>anything else
		<dd>
			Append the <i>current input character</i>
			to the url token's value.
			Remain in this state.
	</dl>

<h4>
<dfn>URL-single-quote state</dfn></h4>

	<p>
		If a url token has not yet been created since entering this state,
		create a url token
		with its value initially set to the empty string.

	<p>
		Consume the <i>next input character</i>.

	<dl>
		<dt>U+0027 QUOTATION MARK (')
		<dd>
			Switch to the <i>url-end state</i>.

		<dt>U+005C REVERSE SOLIDUS (\)
		<dd>
			If the <i>next input character</i> is
			EOF,
			this is a <i>parse error</i>.
			Emit a bad-url token.
			Switch to the <i>data state</i>.
			Reconsume the <i>current input character</i>.

			<p>
				Otherwise, if the <i>next input character</i> is
				a <i>newline</i>,
				consume it
				and remain in this state.

			<p>
				Otherwise,
				consume the <i>next input character</i>.
				Append the <i>current input character</i>
				to the url token's value.
				Remain in this state.

		<dt>anything else
		<dd>
			Append the <i>current input character</i>
			to the url token's value.
			Remain in this state.
	</dl>

<h4>
<dfn>URL-end state</dfn></h4>

	<p>
		Consume the <i>next input character</i>.

	<dl>
		<dt><i>whitespace</i>
		<dd>
			Remain in this state.

		<dt>U+0029 RIGHT PARENTHESIS ())
		<dd>
			Emit the url token.
			Switch to the <i>data state</i>.

		<dt>anything else
		<dd>
			This is a <i>parse error</i>.
			Emit a bad-url token.
			Switch to the <i>data state</i>.
			Reconsume the <i>current input character</i>.
	</dl>

<h4>
<dfn>URL-unquoted state</dfn></h4>

	<p>
		If a url token has not yet been created since entering this state,
		create a url token
		with its value initially set to the empty string.

	<p>
		Consume the <i>next input character</i>.

	<dl>
		<dt><i>whitespace</i>
		<dd>
			Switch to the <i>url-end state</i>.

		<dt>U+0029 RIGHT PARENTHESIS ())
		<dd>
			Emit the url token.
			Switch to the <i>data state</i>.

		<dt>U+0022 QUOTATION MARK (")
		<dt>U+0027 APOSTROPHE (')
		<dt>U+0028 LEFT PARENTHESIS (()
		<dt><i>non-printing character</i>
		<dd>
			This is a <i>parse error</i>.
			Emit a bad-url token.
			Switch to the <i>data state</i>.
			Reconsume the <i>current input character</i>.

		<dt>U+005C REVERSE SOLIDUS
		<dd>
			If the <i>next input character</i>
			is a <i>newline</i> or EOF,
			this is a <i>parse error</i>.
			Emit a bad url token.
			Switch to the <i>data state</i>.

			<p>
				Otherwise, 
				<i>consume an escaped character</i>.
				Append the returned character
				to the url token's value.
				Remain in this state.

		<dt>anything else
		<dd>
			Append the <i>current input character</i>
			to the url token's value.
			Remain in this state.
	</dl>

<h4>
<dfn>Unicode-range state</dfn></h4>

	<p>
		Create a new unicode-range token
		with an empty range.

	<p>
		Consume as many <i>hex digits</i> as possible, but no more than 6.
		If less than 6 <i>hex digits were consumed</i>,
		consume as many U+003F QUESTION MARK (?) character as possible,
		but no more than enough to make the total of <i>hex digits</i> and U+003F QUESTION MARK (?) characters equal to 6.

		<p>
			If any U+003F QUESTION MARK (?) characters were consumed,
			first interpret the consumed characters as a hexadecimal number,
			with the U+003F QUESTION MARK (?) characters replaced by U+0030 DIGIT ZERO (0) characters.
			This is the <i>start of the range</i>.
			Then interpret the consumed characters as a hexadecimal number again,
			with the U+003F QUESTION MARK (?) character replaced by U+0046 LATIN CAPITAL LETTER F (F) characters.
			This is the <i>end of the range</i>.
			<i>Set the unicode-range token's range</i>, then emit it.
			Switch to the <i>data state</i>.

		<p>
			Otherwise,
			interpret the digits as a hexadecimal number.
			This is the <i>start of the range</i>.

	<p>
		Consume the <i>next input character</i>.

	<dl>
		<dt>U+002D HYPHEN-MINUS (-)
		<dd>
			If the <i>next input character</i> is a <i>hex digit</i>,
			consume as many <i>hex digits</i> as possible, but no more than 6.
			Interpret the digits as a hexadecimal number.
			This is the <i>end of the range</i>.
			<i>Set the unicode-range token's range</i>, then emit it.
			Switch to the <i>data state</i>.

			<p>
				Otherwise,
				<i>set the unicode-range token's range</i>
				and emit it.
				Switch to the <i>data state</i>.
				Reconsume the <i>current input character</i>.

		<dt>anything else
		<dd>
			<i>Set the unicode-range token's range</i>
			and emit it.
			Switch to the <i>data state</i>.
			Reconsume the <i>current input character</i>.
	</dl>

<h4>
<dfn>Consume an escaped character</dfn></h4>

	<p>
		This section describes how to <i>consume an escaped character</i>.
		It assumes that the U+005C REVERSE SOLIDUS (\) has already been consumed
		and that the next input character has already been verified
		to not be a <i>newline</i> or EOF.
		It will return a character.

	<p>
		Consume the <i>next input character</i>.

	<dl>
		<dt><i>hex digit</i>
		<dd>
			Consume as many <i>hex digits</i> as possible, but no more than 5.
			<span class='note'>Note that this means 1-6 hex digits have been consumed in total.</span>
			If the <i>next input character</i> is
			<i>whitespace</i>,
			consume it as well.
			Interpret the <i>hex digits</i> as a hexadecimal number.
			If this number is greater than 
			the current maximum allowed codepoint in Unicode (currently U+10FFFF),
			return U+FFFD REPLACEMENT CHARACTER.
			Otherwise, return the character with that codepoint.

		<dt>anything else
		<dd>
			Return the <i>current input character</i>.
	</dl>

<h4>
<dfn>Set the unicode-range token's range</dfn></h4>

	<p>
		This section describes how to set a unicode-range token's range
		so that the range it describes 
		is within the supported range of unicode characters.

	<p>
		It assumes that the <dfn>start of the range</dfn> has been defined,
		the <dfn>end of the range</dfn> might be defined,
		and both are non-negative integers.

	<p>
		If the <i>start of the range</i> is greater than
		the current maximum allowed codepoint in Unicode (currently U+10FFFF),
		the unicode-range token's range is empty.

	<p>
		If the <i>end of the range</i> is defined,
		and it is less than the <i>start of the range</i>,
		the unicode-range token's range is empty.

	<p>
		If the <i>end of the range</i> is not defined,
		the unicode-range token's range
		is the single character whose codepoint is the <i>start of the range</i>.

	<p>
		Otherwise,
		if the <i>end of the range</i> is greater than
		the current maximum allowed codepoint in Unicode,
		change it to the current maximum allowed codepoint.
		The unicode-range token's range
		is all characters between
		the character whose codepoint is the <i>start of the range</i>
		and the character whose codepoint is the <i>end of the range</i>.