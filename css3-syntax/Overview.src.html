<!DOCTYPE html>
<html lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<title>CSS Syntax Module Level 3 (CSS3 Syntax)</title>
	<link rel=contents href="#contents">
	<link rel=index href="#index">
	<link rel="stylesheet" type="text/css" href="../default.css">
	<link rel="stylesheet" type="text/css"
				href="http://www.w3.org/StyleSheets/TR/W3C-[STATUS].css">
	<link rel="stylesheet" type="text/css" href="railroad-diagrams.css">
	<style type="text/css">
		/* delete this block when you've cleared out all the .replaceme elements */
		.replaceme {
			border: solid red;
			padding: 0 0.5em;
			margin: 0 0.1em;
			background: yellow;
			color: green;
		}
		.replaceme:before {
			 content: "FIXME(";
			 color: black;
		}
		.replaceme:after {
			 content: ")";
			 color: black;
		}
	</style>
</head>

<div class="head">
<!--logo-->

<h1>CSS Syntax Module Level 3</h1>

<h2 class="no-num no-toc">[LONGSTATUS] [DATE]</h2>
<dl>
	<dt>This version:
	<dd>
		<a href="http://dev.w3.org/csswg/css3-syntax/">http://dev.w3.org/csswg/css3-syntax/</a>
<!--
	<dt>Latest version:
	<dd>
		<a href="http://www.w3.org/TR/css3-syntax/">http://www.w3.org/TR/css3-syntax/</a>
-->
	<dt>Editor's draft:
	<dd>
		<a href="http://dev.w3.org/csswg/css3-syntax/">http://dev.w3.org/csswg/css3-syntax/</a>

	<dt>Previous version:
	<dd>
		<a href="http://www.w3.org/TR/2003/WD-css3-syntax-20030813/">http://www.w3.org/TR/2003/WD-css3-syntax-20030813/</a>

	<dt>Issue Tracking:
	<dd>
		<a href="https://www.w3.org/Bugs/Public/buglist.cgi?product=CSS&component=Syntax">W3C Bugzilla</a>

	<dt>Feedback:
	<dd>
		<a href="http://lists.w3.org/Archives/Public/www-style/">www-style@w3.org</a> 
		with subject line &ldquo;<kbd>[css3-syntax] <var>&hellip; message topic &hellip;</var></kbd>&rdquo;

	<dt>Editors:
	<dd class="h-card vcard">
			<a class="p-name fn u-url url" rel="author"
				 href="http://www.xanthir.com/">Tab Atkins Jr.</a>
			(<span class="p-org org">Google, Inc.</span>),
			<span class="u-email email">jackalmage@gmail.com</span>
</dl>

<!--copyright-->

<hr title="Separator for header">
</div>

<h2 class="no-num no-toc" id="abstract">Abstract</h2>

	<p>
		<a href="http://www.w3.org/TR/CSS/">CSS</a> is a language for describing the rendering of structured documents (such as HTML and XML) on screen, on paper, in speech, etc. 
		This module describes, in general terms, the basic structure and syntax of CSS stylesheets.
		It defines, in detail, the syntax and parsing of CSS - how to turn a stream of bytes into a meaningful stylesheet. 

<h2 class="no-num no-toc" id="status">Status of this document</h2>

<!--status-->

<p>The following features are at risk: &hellip;

<h2 class="no-num no-toc" id="contents">
Table of contents</h2>

<!--toc-->

<h2 id="intro">
Introduction</h2>

	<p><em>This section is not normative.</em>

	<p><var class="replaceme">Provide background, motivation, etc.</var></p>

<h3 id="placement">
Module interactions</h3>

	<p>
		This module defines the syntax and parsing of CSS stylesheets.
		It supersedes the lexical scanner and grammar defined in CSS 2.1.

<h2 id='syntax-description'>
Description of CSS's Syntax</h2>

	<p><em>This section is not normative.</em>

	<p>
		A CSS document is a series of <i>rules</i>, 
		which apply CSS properties to elements in the source document, 
		and <i>at-rules</i>, 
		which define special processing rules or values for the CSS document.

	<p>
		A <dfn>rule</dfn> starts with a selector
		(defined by the <a href="http://www.w3.org/TR/selectors/">Selectors specification</a>),
		then has a {}-wrapped block containing a sequence of declarations.
		The selector specifies which elements the declarations will apply to.
		Each declaration has a property name, 
		followed by a colon and the property value,
		and finished with a semicolon.

	<div class='example'>
		<p>
			A typical rule might look something like this:

		<pre>
p > a { 
	color: blue;
	text-decoration: underline;
}</pre>

		<p>
			In the above rule, "<code>p > a</code>" is the selector,
			which, if the source document is HTML,
			selects any <code>&lt;a></code> elements that are children of a <code>&lt;p></code> element.

		<p>
			"<code>color: blue;</code>" is a declaration specifying that, 
			for the elements that match the selector,
			their 'color' property should have the value ''blue''.
			Similiarly, their 'text-decoration' property should have the value ''underline''.
	</div>

	<p>
		<dfn title="at-rule">At-rules</dfn> are all different, but they have a basic structure in common.
		They start with an "@" character followed by their name.
		Some <i>at-rules</i> are simple statements,
		with their name followed by more CSS values to specify their behavior,
		and finally ended by a semicolon.
		Others are blocks;
		they can have CSS values following their name, 
		but they end with a {}-wrapped block,
		similar to a <i>rule</i>.
		Even the contents of these blocks are specific to the given <i>at-rule</i>:
		sometimes they contain a sequence of declarations, like a <i>rule</i>;
		other times, they may contain additional blocks, or at-rules, or other structures altogether.

	<div class='example'>
		<p>
			Here are several examples of <i>at-rules</i> that illustrate the varied syntax they may contain.

		<pre>@import "my-styles.css";</pre>

		<p>
			The ''@import'' <i>at-rule</i> is a simple statement.
			After its name, it takes a single string or ''url()'' function to indicate the stylesheet that it should import.

		<pre>
@page :left {
	margin-left: 4cm;
	margin-right: 3cm;
}</pre>

		<p>
			The ''@page'' <i>at-rule</i> consists of an optional page selector (the ":left" pseudoclass),
			followed by a block of properties that apply to the page when printed.
			In this way, it's very similar to a normal <i>rule</i>,
			except that its properties don't apply to any "element",
			but rather the page itself.

		<pre>
@media print {
	body { font-size: 10pt }
}</pre>

		<p>
			The ''@media'' <i>at-rule</i> begins with a media type
			and a list of optional media queries.
			Its block contains entire rules,
			which are only applied when the ''@media''s conditions are fulfilled.
	</div>

	<p>
		Property names and <i>at-rule</i> names are always <b>idents</b>,
		which have to start with a letter or a hyphen followed by a letter,
		and then can contain letters, numbers, hyphens, or underscores.
		You can include any character at all,
		even ones that CSS uses in its syntax,
		by escaping it with a backslash (\) or by using a hexadecimal escape.

	<p>
		The syntax of selectors is defined in the <a href="http://www.w3.org/TR/selectors/">Selectors spec</a>.
		Similarly, the syntax of the wide variety of CSS values is defined in the <a href="http://www.w3.org/TR/css3-values/">Values &amp; Units spec</a>.
		The special syntaxes of individual <i>at-rules</i> can be found in the specs that define them.
	
<h2>
Tokenizing and Parsing CSS</h2>

	<p>
		User agents must use the parsing rules described in this section to generate the CSSOM trees from text/css resources. 
		Together, these rules define what is referred to as the CSS parser.

	<p>
		This specification defines the parsing rules for CSS documents, whether they are syntactically correct or not. 
		Certain points in the parsing algorithm are said to be parse errors. 
		The error handling for parse errors is well-defined: 
		user agents must either act as described below when encountering such problems, 
		or must abort processing at the first error that they encounter for which they do not wish to apply the rules described below.

	<p>
		Conformance checkers must report at least one parse error condition to the user if one or more parse error conditions exist in the document and must not report parse error conditions if none exist in the document. 
		Conformance checkers may report more than one parse error condition if more than one parse error condition exists in the document. 
		Conformance checkers are not required to recover from parse errors.

<h3>
Overview of the Parsing Model</h3>

	<p>
		The input to the CSS parsing process consists of a stream of Unicode code points, 
		which is passed through a tokenization stage followed by a tree construction stage. 
		The output is a CSSStyleSheet object.

	<p class='note'>
		Implementations that do not support scripting do not have to actually create a CSSOM CSSStyleSheet object, 
		but the CSSOM tree in such cases is still used as the model for the rest of the specification.

<h3>
The input byte stream</h3>

	<p>
		The stream of Unicode code points that comprises the input to the tokenization stage will be initially seen by the user agent as a stream of bytes 
		(typically coming over the network or from the local file system). 
		The bytes encode the actual characters according to a particular character encoding, 
		which the user agent must use to decode the bytes into characters.

	<p>
		To decode the stream of bytes into a stream of characters,
		UAs must follow these steps.

	<p>
		The algorithms to <a href="http://encoding.spec.whatwg.org/#concept-encoding-get"><dfn>get an encoding</dfn></a> 
		and <a href="http://encoding.spec.whatwg.org/#decode"><dfn>decode</dfn></a> 
		are defined in the <a href="http://encoding.spec.whatwg.org/">Encoding Standard</a>.

	<ol>
		<li>
			Let <var>encoding</var> be utf-8.

		<li>
			If HTTP or equivalent protocol defines an encoding (e.g. via the charset parameter of the Content-Type header), 
			<i>get an encoding</i> for the specified value.
			If that does not return failure,
			set <var>encoding</var> to the return value
			and jump to the last step of this algorithm.

		<li>
			Check the byte stream. If the first several bytes match the hex sequence

			<pre>40 63 68 61 72 73 65 74 20 22 (XX)* 22 3B</pre>
   
			then <i>get an encoding</i> for the sequence of XX bytes,
			decoded per <code>windows-1252</code>,
			and let <var>temp</var> be the return value.

			<p class='note'>
				Note: Anything ASCII-compatible will do, so using <code>windows-1252</code> is fine.

			<p class='note'>
				Note: The byte sequence above,
				when decoded as ASCII,
				is the string "<code>@charset "…";</code>",
				where the "…" is the sequence of bytes corresponding to the encoding's name.

			<p>
				If <var>temp</var> is <code>utf-16</code> or <code>utf-16be</code>, 
				set <var>temp</var> to <code>utf-8</code>.
				If <var>temp</var> is not failure,
				set <var>encoding</var> to it
 				and jump to the last step.

			<p class='note'>
				This mimics HTML <code>&lt;meta></code> behavior.

		<li>
			<i>Get an encoding</i> for the value of the <code>charset</code> attribute on the <code>&lt;link></code> element or <code>&lt;?xml-stylesheet?></code> processing instruction that caused the style sheet to be included, if any.
			If that does not return failure,
			set <var>encoding</var> to the return value
			and jump to the last step.

		<li>
			Set <var>encoding</var> to the encoding of the referring style sheet or document,
			if any.

		<li>
			<i>Decode</i> the byte stream using fallback encoding <var>encoding</var>.

			<p class='note'>
				Note: the <i>decode</i> algorithm lets the byte order mark (BOM) take precedence,
				hence the usage of the term "fallback" above.
	</ol>

	<p class='issue'>
		Anne says that steps 4/5 should be an input to this algorithm from the specs that define importing stylesheet,
		to make the algorithm as a whole cleaner.
		Perhaps abstract it into the concept of an "environment charset" or something?


<h4>
Preprocessing the input stream</h4>

	<p>
		The input stream consists of the characters pushed into it as the input byte stream is decoded.

	<p>
		Before sending the input stream to the tokenizer,
		implementations must make the following character substitutions:

	<ul>
		<li>
			Replace any U+000D CARRIAGE RETURN (CR) characters 
			or pairs of U+000D CARRIAGE RETURN (CR) followed by U+000A LINE FEED (LF) 
			by a single U+000A LINE FEED (LF) character.

		<li>
			Replace any U+0000 NULL characters with U+FFFD REPLACEMENT CHARACTER (�).
	</ul>

	<p>
		The <dfn>next input character</dfn> is the first character in the input stream that has not yet been consumed or explicitly ignored by the requirements in this section. Initially, the <i>next input character</i> is the first character in the input. The <dfn>current input character</dfn> is the last character to have been consumed.

	<p>
		The "EOF" character in the tables below is a conceptual character representing the end of the input stream.


<h3>
Tokenization</h3>

	<p>
		Implementations must act as if they used the following state machine to tokenize CSS. 
		The state machine must start in the <i>data state</i>. 
		Most states consume a single character, 
		which may have various side-effects, 
		and either switches the state machine to a new state to reconsume the same character, 
		or switches it to a new state to consume the next character, 
		or stays in the same state to consume the next character. 
		Some states have more complicated behavior and can consume several characters before switching to another state.

	<p>
		The output of the tokenization step is a series of zero or more of the following tokens:
		ident,
		function,
		at-keyword,
		hash,
		string,
		bad-string,
		url,
		bad-url,
		delim,
		number,
		percentage,
		dimension,
		unicode-range,
		whitespace,
		cdo,
		cdc,
		colon,
		semicolon,
		[,
		],
		(,
		),
		{,
		}.

	<p>
		ident, function, at-keyword, hash, string, and url tokens have a value composed of zero or more characters.
		Delim tokens have a value composed of a single character.
		Number, percentage, and dimension tokens have a representation composed of 1 or more character, a numeric value, and a type flag set to either "integer" or "number".  The type flag defaults to "integer" if not otherwise set.
		Dimension tokens additionally have a unit composed of one or more characters.
		Unicode-range tokens have a range of characters.

	<p class='issue'>
		Several types of tokens that are guaranteed to be language-defined, 
		like at-keywords, functions, or dimension units,
		are always lowercased when serialized.
		Should we eagerly lowercase them in the parser,
		or leave that to serialization to deal with?
		(I slightly lean toward letting serialization deal with it,
		so we don't mess with the capitalization of variable values.)

	<p>
		The tokenizer state machine consists of the states defined in the following subsections.

<h4 id='token-diagrams'>
Token Railroad Diagrams</h4>

	<p>
		<em>This section is non-normative.</em>

	<p>
		This section presents an informative view of the token parser,
		in the form of railroad diagrams.
		Railroad diagrams are more compact than a state-machine,
		but often easier to read than a regular expression.

	<p>
		These diagrams are <em>informative</em> and <em>incomplete</em>;
		they describe the grammar of "correct" tokens,
		but do not describe error-handling at all.
		They are provided solely to make it easier to get an intuitive grasp of the syntax of each token.

	<!--
		The "source" of these diagrams is in ./Diagrams.src.html
		The generated SVG is copied here so that JavaScript is not required
		to view the spec.
	-->

	<dl>
		<dt id="escape-diagram">escape</dt>
		<dd><svg class="railroad-diagram" width="377" height="122"><g transform="translate(.5 .5)"><path d="M 20 21 v 20 m 10 -20 v 20 m -10 -10 h 20.5"></path><path d="M40 31h10"></path><g><path d="M50 31h0"></path><path d="M78 31h0"></path><rect x="50" y="20" width="28" height="22" rx="10" ry="10"></rect><text x="64" y="35">\</text></g><path d="M78 31h10"></path><g><path d="M88 31h0"></path><path d="M336 31h0"></path><path d="M88 31h20"></path><g><path d="M108 31h18"></path><path d="M298 31h18"></path><rect x="126" y="20" width="172" height="22"></rect><text x="212" y="35">not NL or hex digit</text></g><path d="M316 31h20"></path><path d="M88 31a10 10 0 0 1 10 10v10a10 10 0 0 0 10 10"></path><g><path d="M108 61h0"></path><path d="M316 61h0"></path><path d="M108 61h10"></path><g><path d="M118 61h0"></path><path d="M230 61h0"></path><path d="M118 61h10"></path><g><path d="M128 61h0"></path><path d="M220 61h0"></path><rect x="128" y="50" width="92" height="22"></rect><text x="174" y="65">hex digit</text></g><path d="M220 61h10"></path><path d="M128 61a10 10 0 0 0 -10 10v10a10 10 0 0 0 10 10"></path><g><path d="M128 91h9.5"></path><path d="M210.5 91h9.5"></path><text x="174" y="96" class="comment">1-6 times</text></g><path d="M220 91a10 10 0 0 0 10 -10v-10a10 10 0 0 0 -10 -10"></path></g><path d="M230 61h10"></path><g><path d="M240 61h0"></path><path d="M316 61h0"></path><path d="M240 61h20"></path><g><path d="M260 61h36"></path></g><path d="M296 61h20"></path><path d="M240 61a10 10 0 0 1 10 10v0a10 10 0 0 0 10 10"></path><g><path d="M260 81h0"></path><path d="M296 81h0"></path><rect x="260" y="70" width="36" height="22"></rect><text x="278" y="85">WS</text></g><path d="M296 81a10 10 0 0 0 10 -10v0a10 10 0 0 1 10 -10"></path></g></g><path d="M316 61a10 10 0 0 0 10 -10v-10a10 10 0 0 1 10 -10"></path></g><path d="M 336 31 h 20 m -10 -10 v 20 m 10 -20 v 20"></path></g></svg></dd>

		<dt id="ident-diagram">IDENT</dt>
		<dd><svg class="railroad-diagram" width="729" height="110"><g transform="translate(.5 .5)"><path d="M 20 31 v 20 m 10 -20 v 20 m -10 -10 h 20.5"></path><g><path d="M40 41h0"></path><path d="M108 41h0"></path><path d="M40 41h20"></path><g><path d="M60 41h28"></path></g><path d="M88 41h20"></path><path d="M40 41a10 10 0 0 1 10 10v0a10 10 0 0 0 10 10"></path><g><path d="M60 61h0"></path><path d="M88 61h0"></path><rect x="60" y="50" width="28" height="22" rx="10" ry="10"></rect><text x="74" y="65">-</text></g><path d="M88 61a10 10 0 0 0 10 -10v0a10 10 0 0 1 10 -10"></path></g><g><path d="M108 41h0"></path><path d="M344 41h0"></path><path d="M108 41h20"></path><g><path d="M128 41h0"></path><path d="M324 41h0"></path><rect x="128" y="30" width="196" height="22"></rect><text x="226" y="45">a-z A-Z _ or non-ASCII</text></g><path d="M324 41h20"></path><path d="M108 41a10 10 0 0 1 10 10v10a10 10 0 0 0 10 10"></path><g><path d="M128 71h64"></path><path d="M260 71h64"></path><rect x="192" y="60" width="68" height="22"></rect><text x="226" y="75">escape</text></g><path d="M324 71a10 10 0 0 0 10 -10v-10a10 10 0 0 1 10 -10"></path></g><g><path d="M344 41h0"></path><path d="M688 41h0"></path><path d="M344 41a10 10 0 0 0 10 -10v0a10 10 0 0 1 10 -10"></path><g><path d="M364 21h304"></path></g><path d="M668 21a10 10 0 0 1 10 10v0a10 10 0 0 0 10 10"></path><path d="M344 41h20"></path><g><path d="M364 41h0"></path><path d="M668 41h0"></path><path d="M364 41h10"></path><g><path d="M374 41h0"></path><path d="M658 41h0"></path><path d="M374 41h20"></path><g><path d="M394 41h0"></path><path d="M638 41h0"></path><rect x="394" y="30" width="244" height="22"></rect><text x="516" y="45">a-z A-Z 0-9 _ - or non-ASCII</text></g><path d="M638 41h20"></path><path d="M374 41a10 10 0 0 1 10 10v10a10 10 0 0 0 10 10"></path><g><path d="M394 71h88"></path><path d="M550 71h88"></path><rect x="482" y="60" width="68" height="22"></rect><text x="516" y="75">escape</text></g><path d="M638 71a10 10 0 0 0 10 -10v-10a10 10 0 0 1 10 -10"></path></g><path d="M658 41h10"></path><path d="M374 41a10 10 0 0 0 -10 10v29a10 10 0 0 0 10 10"></path><g><path d="M374 90h284"></path></g><path d="M658 90a10 10 0 0 0 10 -10v-29a10 10 0 0 0 -10 -10"></path></g><path d="M668 41h20"></path></g><path d="M 688 41 h 20 m -10 -10 v 20 m 10 -20 v 20"></path></g></svg></dd>

		<dt id="function-diagram">FUNCTION</dt>
		<dd><svg class="railroad-diagram" width="209" height="62"><g transform="translate(.5 .5)"><path d="M 20 21 v 20 m 10 -20 v 20 m -10 -10 h 20.5"></path><path d="M40 31h10"></path><g><path d="M50 31h0"></path><path d="M110 31h0"></path><rect x="50" y="20" width="60" height="22"></rect><text x="80" y="35">IDENT</text></g><path d="M110 31h10"></path><path d="M120 31h10"></path><g><path d="M130 31h0"></path><path d="M158 31h0"></path><rect x="130" y="20" width="28" height="22" rx="10" ry="10"></rect><text x="144" y="35">(</text></g><path d="M158 31h10"></path><path d="M 168 31 h 20 m -10 -10 v 20 m 10 -20 v 20"></path></g></svg></dd>

		<dt id="at-keyword-diagram">AT-KEYWORD</dt>
		<dd><svg class="railroad-diagram" width="209" height="62"><g transform="translate(.5 .5)"><path d="M 20 21 v 20 m 10 -20 v 20 m -10 -10 h 20.5"></path><path d="M40 31h10"></path><g><path d="M50 31h0"></path><path d="M78 31h0"></path><rect x="50" y="20" width="28" height="22" rx="10" ry="10"></rect><text x="64" y="35">@</text></g><path d="M78 31h10"></path><path d="M88 31h10"></path><g><path d="M98 31h0"></path><path d="M158 31h0"></path><rect x="98" y="20" width="60" height="22"></rect><text x="128" y="35">IDENT</text></g><path d="M158 31h10"></path><path d="M 168 31 h 20 m -10 -10 v 20 m 10 -20 v 20"></path></g></svg></dd>

		<dt id="hash-diagram">HASH</dt>
		<dd><svg class="railroad-diagram" width="453" height="100"><g transform="translate(.5 .5)"><path d="M 20 21 v 20 m 10 -20 v 20 m -10 -10 h 20.5"></path><path d="M40 31h10"></path><g><path d="M50 31h0"></path><path d="M78 31h0"></path><rect x="50" y="20" width="28" height="22" rx="10" ry="10"></rect><text x="64" y="35">#</text></g><path d="M78 31h10"></path><path d="M88 31h10"></path><g><path d="M98 31h0"></path><path d="M402 31h0"></path><path d="M98 31h10"></path><g><path d="M108 31h0"></path><path d="M392 31h0"></path><path d="M108 31h20"></path><g><path d="M128 31h0"></path><path d="M372 31h0"></path><rect x="128" y="20" width="244" height="22"></rect><text x="250" y="35">a-z A-Z 0-9 _ - or non-ASCII</text></g><path d="M372 31h20"></path><path d="M108 31a10 10 0 0 1 10 10v10a10 10 0 0 0 10 10"></path><g><path d="M128 61h88"></path><path d="M284 61h88"></path><rect x="216" y="50" width="68" height="22"></rect><text x="250" y="65">escape</text></g><path d="M372 61a10 10 0 0 0 10 -10v-10a10 10 0 0 1 10 -10"></path></g><path d="M392 31h10"></path><path d="M108 31a10 10 0 0 0 -10 10v29a10 10 0 0 0 10 10"></path><g><path d="M108 80h284"></path></g><path d="M392 80a10 10 0 0 0 10 -10v-29a10 10 0 0 0 -10 -10"></path></g><path d="M402 31h10"></path><path d="M 412 31 h 20 m -10 -10 v 20 m 10 -20 v 20"></path></g></svg></dd>

		<dt id="string-diagram">STRING</dt>
		<dd><svg class="railroad-diagram" width="441" height="248"><g transform="translate(.5 .5)"><path d="M 20 31 v 20 m 10 -20 v 20 m -10 -10 h 20.5"></path><g><path d="M40 41h0"></path><path d="M400 41h0"></path><path d="M40 41h20"></path><g><path d="M60 41h0"></path><path d="M380 41h0"></path><path d="M60 41h10"></path><g><path d="M70 41h0"></path><path d="M98 41h0"></path><rect x="70" y="30" width="28" height="22" rx="10" ry="10"></rect><text x="84" y="45">"</text></g><path d="M98 41h10"></path><g><path d="M108 41h0"></path><path d="M332 41h0"></path><path d="M108 41a10 10 0 0 0 10 -10v0a10 10 0 0 1 10 -10"></path><g><path d="M128 21h184"></path></g><path d="M312 21a10 10 0 0 1 10 10v0a10 10 0 0 0 10 10"></path><path d="M108 41h20"></path><g><path d="M128 41h0"></path><path d="M312 41h0"></path><path d="M128 41h10"></path><g><path d="M138 41h0"></path><path d="M302 41h0"></path><path d="M138 41h20"></path><g><path d="M158 41h0"></path><path d="M282 41h0"></path><rect x="158" y="30" width="124" height="22"></rect><text x="220" y="45">not " \ or NL</text></g><path d="M282 41h20"></path><path d="M138 41a10 10 0 0 1 10 10v10a10 10 0 0 0 10 10"></path><g><path d="M158 71h28"></path><path d="M254 71h28"></path><rect x="186" y="60" width="68" height="22"></rect><text x="220" y="75">escape</text></g><path d="M282 71a10 10 0 0 0 10 -10v-10a10 10 0 0 1 10 -10"></path><path d="M138 41a10 10 0 0 1 10 10v40a10 10 0 0 0 10 10"></path><g><path d="M158 101h10"></path><path d="M272 101h10"></path><path d="M168 101h10"></path><g><path d="M178 101h0"></path><path d="M206 101h0"></path><rect x="178" y="90" width="28" height="22" rx="10" ry="10"></rect><text x="192" y="105">\</text></g><path d="M206 101h10"></path><path d="M216 101h10"></path><g><path d="M226 101h0"></path><path d="M262 101h0"></path><rect x="226" y="90" width="36" height="22"></rect><text x="244" y="105">NL</text></g><path d="M262 101h10"></path></g><path d="M282 101a10 10 0 0 0 10 -10v-40a10 10 0 0 1 10 -10"></path></g><path d="M302 41h10"></path><path d="M138 41a10 10 0 0 0 -10 10v59a10 10 0 0 0 10 10"></path><g><path d="M138 120h164"></path></g><path d="M302 120a10 10 0 0 0 10 -10v-59a10 10 0 0 0 -10 -10"></path></g><path d="M312 41h20"></path></g><path d="M332 41h10"></path><g><path d="M342 41h0"></path><path d="M370 41h0"></path><rect x="342" y="30" width="28" height="22" rx="10" ry="10"></rect><text x="356" y="45">"</text></g><path d="M370 41h10"></path></g><path d="M380 41h20"></path><path d="M40 41a10 10 0 0 1 10 10v88a10 10 0 0 0 10 10"></path><g><path d="M60 149h0"></path><path d="M380 149h0"></path><path d="M60 149h10"></path><g><path d="M70 149h0"></path><path d="M98 149h0"></path><rect x="70" y="138" width="28" height="22" rx="10" ry="10"></rect><text x="84" y="153">&apos;</text></g><path d="M98 149h10"></path><g><path d="M108 149h0"></path><path d="M332 149h0"></path><path d="M108 149a10 10 0 0 0 10 -10v0a10 10 0 0 1 10 -10"></path><g><path d="M128 129h184"></path></g><path d="M312 129a10 10 0 0 1 10 10v0a10 10 0 0 0 10 10"></path><path d="M108 149h20"></path><g><path d="M128 149h0"></path><path d="M312 149h0"></path><path d="M128 149h10"></path><g><path d="M138 149h0"></path><path d="M302 149h0"></path><path d="M138 149h20"></path><g><path d="M158 149h0"></path><path d="M282 149h0"></path><rect x="158" y="138" width="124" height="22"></rect><text x="220" y="153">not &apos; \ or NL</text></g><path d="M282 149h20"></path><path d="M138 149a10 10 0 0 1 10 10v10a10 10 0 0 0 10 10"></path><g><path d="M158 179h28"></path><path d="M254 179h28"></path><rect x="186" y="168" width="68" height="22"></rect><text x="220" y="183">escape</text></g><path d="M282 179a10 10 0 0 0 10 -10v-10a10 10 0 0 1 10 -10"></path><path d="M138 149a10 10 0 0 1 10 10v40a10 10 0 0 0 10 10"></path><g><path d="M158 209h10"></path><path d="M272 209h10"></path><path d="M168 209h10"></path><g><path d="M178 209h0"></path><path d="M206 209h0"></path><rect x="178" y="198" width="28" height="22" rx="10" ry="10"></rect><text x="192" y="213">\</text></g><path d="M206 209h10"></path><path d="M216 209h10"></path><g><path d="M226 209h0"></path><path d="M262 209h0"></path><rect x="226" y="198" width="36" height="22"></rect><text x="244" y="213">NL</text></g><path d="M262 209h10"></path></g><path d="M282 209a10 10 0 0 0 10 -10v-40a10 10 0 0 1 10 -10"></path></g><path d="M302 149h10"></path><path d="M138 149a10 10 0 0 0 -10 10v59a10 10 0 0 0 10 10"></path><g><path d="M138 228h164"></path></g><path d="M302 228a10 10 0 0 0 10 -10v-59a10 10 0 0 0 -10 -10"></path></g><path d="M312 149h20"></path></g><path d="M332 149h10"></path><g><path d="M342 149h0"></path><path d="M370 149h0"></path><rect x="342" y="138" width="28" height="22" rx="10" ry="10"></rect><text x="356" y="153">&apos;</text></g><path d="M370 149h10"></path></g><path d="M380 149a10 10 0 0 0 10 -10v-88a10 10 0 0 1 10 -10"></path></g><path d="M 400 41 h 20 m -10 -10 v 20 m 10 -20 v 20"></path></g></svg></dd>

		<dt id="url-diagram">URL</dt>
		<dd><svg class="railroad-diagram" width="813" height="178"><g transform="translate(.5 .5)"><path d="M 20 99 v 20 m 10 -20 v 20 m -10 -10 h 20.5"></path><path d="M40 109h10"></path><g><path d="M50 109h0"></path><path d="M150 109h0"></path><rect x="50" y="98" width="100" height="22"></rect><text x="100" y="113">IDENT(url)</text></g><path d="M150 109h10"></path><path d="M160 109h10"></path><g><path d="M170 109h0"></path><path d="M198 109h0"></path><rect x="170" y="98" width="28" height="22" rx="10" ry="10"></rect><text x="184" y="113">(</text></g><path d="M198 109h10"></path><g><path d="M208 109h0"></path><path d="M724 109h0"></path><path d="M208 109a10 10 0 0 0 10 -10v-48a10 10 0 0 1 10 -10"></path><g><path d="M228 41h88"></path><path d="M616 41h88"></path><g><path d="M316 41h0"></path><path d="M412 41h0"></path><path d="M316 41h20"></path><g><path d="M336 41h56"></path></g><path d="M392 41h20"></path><path d="M316 41a10 10 0 0 1 10 10v0a10 10 0 0 0 10 10"></path><g><path d="M336 61h0"></path><path d="M392 61h0"></path><path d="M336 61h10"></path><g><path d="M346 61h0"></path><path d="M382 61h0"></path><rect x="346" y="50" width="36" height="22"></rect><text x="364" y="65">WS</text></g><path d="M382 61h10"></path><path d="M346 61a10 10 0 0 0 -10 10v0a10 10 0 0 0 10 10"></path><g><path d="M346 81h36"></path></g><path d="M382 81a10 10 0 0 0 10 -10v0a10 10 0 0 0 -10 -10"></path></g><path d="M392 61a10 10 0 0 0 10 -10v0a10 10 0 0 1 10 -10"></path></g><g><path d="M412 41h0"></path><path d="M520 41h0"></path><path d="M412 41a10 10 0 0 0 10 -10v0a10 10 0 0 1 10 -10"></path><g><path d="M432 21h68"></path></g><path d="M500 21a10 10 0 0 1 10 10v0a10 10 0 0 0 10 10"></path><path d="M412 41h20"></path><g><path d="M432 41h0"></path><path d="M500 41h0"></path><rect x="432" y="30" width="68" height="22"></rect><text x="466" y="45">STRING</text></g><path d="M500 41h20"></path></g><g><path d="M520 41h0"></path><path d="M616 41h0"></path><path d="M520 41h20"></path><g><path d="M540 41h56"></path></g><path d="M596 41h20"></path><path d="M520 41a10 10 0 0 1 10 10v0a10 10 0 0 0 10 10"></path><g><path d="M540 61h0"></path><path d="M596 61h0"></path><path d="M540 61h10"></path><g><path d="M550 61h0"></path><path d="M586 61h0"></path><rect x="550" y="50" width="36" height="22"></rect><text x="568" y="65">WS</text></g><path d="M586 61h10"></path><path d="M550 61a10 10 0 0 0 -10 10v0a10 10 0 0 0 10 10"></path><g><path d="M550 81h36"></path></g><path d="M586 81a10 10 0 0 0 10 -10v0a10 10 0 0 0 -10 -10"></path></g><path d="M596 61a10 10 0 0 0 10 -10v0a10 10 0 0 1 10 -10"></path></g></g><path d="M704 41a10 10 0 0 1 10 10v48a10 10 0 0 0 10 10"></path><path d="M208 109h20"></path><g><path d="M228 109h0"></path><path d="M704 109h0"></path><g><path d="M228 109h0"></path><path d="M324 109h0"></path><path d="M228 109h20"></path><g><path d="M248 109h56"></path></g><path d="M304 109h20"></path><path d="M228 109a10 10 0 0 1 10 10v0a10 10 0 0 0 10 10"></path><g><path d="M248 129h0"></path><path d="M304 129h0"></path><path d="M248 129h10"></path><g><path d="M258 129h0"></path><path d="M294 129h0"></path><rect x="258" y="118" width="36" height="22"></rect><text x="276" y="133">WS</text></g><path d="M294 129h10"></path><path d="M258 129a10 10 0 0 0 -10 10v0a10 10 0 0 0 10 10"></path><g><path d="M258 149h36"></path></g><path d="M294 149a10 10 0 0 0 10 -10v0a10 10 0 0 0 -10 -10"></path></g><path d="M304 129a10 10 0 0 0 10 -10v0a10 10 0 0 1 10 -10"></path></g><path d="M324 109h10"></path><g><path d="M334 109h0"></path><path d="M598 109h0"></path><path d="M334 109h10"></path><g><path d="M344 109h0"></path><path d="M588 109h0"></path><path d="M344 109h20"></path><g><path d="M364 109h0"></path><path d="M568 109h0"></path><rect x="364" y="98" width="204" height="22"></rect><text x="466" y="113">not " &apos; ( ) \ WS or NPC</text></g><path d="M568 109h20"></path><path d="M344 109a10 10 0 0 1 10 10v10a10 10 0 0 0 10 10"></path><g><path d="M364 139h68"></path><path d="M500 139h68"></path><rect x="432" y="128" width="68" height="22"></rect><text x="466" y="143">escape</text></g><path d="M568 139a10 10 0 0 0 10 -10v-10a10 10 0 0 1 10 -10"></path></g><path d="M588 109h10"></path><path d="M344 109a10 10 0 0 0 -10 10v29a10 10 0 0 0 10 10"></path><g><path d="M344 158h244"></path></g><path d="M588 158a10 10 0 0 0 10 -10v-29a10 10 0 0 0 -10 -10"></path></g><path d="M598 109h10"></path><g><path d="M608 109h0"></path><path d="M704 109h0"></path><path d="M608 109h20"></path><g><path d="M628 109h56"></path></g><path d="M684 109h20"></path><path d="M608 109a10 10 0 0 1 10 10v0a10 10 0 0 0 10 10"></path><g><path d="M628 129h0"></path><path d="M684 129h0"></path><path d="M628 129h10"></path><g><path d="M638 129h0"></path><path d="M674 129h0"></path><rect x="638" y="118" width="36" height="22"></rect><text x="656" y="133">WS</text></g><path d="M674 129h10"></path><path d="M638 129a10 10 0 0 0 -10 10v0a10 10 0 0 0 10 10"></path><g><path d="M638 149h36"></path></g><path d="M674 149a10 10 0 0 0 10 -10v0a10 10 0 0 0 -10 -10"></path></g><path d="M684 129a10 10 0 0 0 10 -10v0a10 10 0 0 1 10 -10"></path></g></g><path d="M704 109h20"></path></g><path d="M724 109h10"></path><g><path d="M734 109h0"></path><path d="M762 109h0"></path><rect x="734" y="98" width="28" height="22" rx="10" ry="10"></rect><text x="748" y="113">)</text></g><path d="M762 109h10"></path><path d="M 772 109 h 20 m -10 -10 v 20 m 10 -20 v 20"></path></g></svg></dd>

		<dt id="number-diagram">NUMBER</dt>
		<dd><svg class="railroad-diagram" width="713" height="179"><g transform="translate(.5 .5)"><path d="M 20 50 v 20 m 10 -20 v 20 m -10 -10 h 20.5"></path><g><path d="M40 60h0"></path><path d="M108 60h0"></path><path d="M40 60a10 10 0 0 0 10 -10v0a10 10 0 0 1 10 -10"></path><g><path d="M60 40h0"></path><path d="M88 40h0"></path><rect x="60" y="29" width="28" height="22" rx="10" ry="10"></rect><text x="74" y="44">+</text></g><path d="M88 40a10 10 0 0 1 10 10v0a10 10 0 0 0 10 10"></path><path d="M40 60h20"></path><g><path d="M60 60h28"></path></g><path d="M88 60h20"></path><path d="M40 60a10 10 0 0 1 10 10v0a10 10 0 0 0 10 10"></path><g><path d="M60 80h0"></path><path d="M88 80h0"></path><rect x="60" y="69" width="28" height="22" rx="10" ry="10"></rect><text x="74" y="84">-</text></g><path d="M88 80a10 10 0 0 0 10 -10v0a10 10 0 0 1 10 -10"></path></g><g><path d="M108 60h0"></path><path d="M396 60h0"></path><path d="M108 60h20"></path><g><path d="M128 60h0"></path><path d="M376 60h0"></path><path d="M128 60h10"></path><g><path d="M138 60h0"></path><path d="M218 60h0"></path><path d="M138 60h10"></path><g><path d="M148 60h0"></path><path d="M208 60h0"></path><rect x="148" y="49" width="60" height="22"></rect><text x="178" y="64">digit</text></g><path d="M208 60h10"></path><path d="M148 60a10 10 0 0 0 -10 10v0a10 10 0 0 0 10 10"></path><g><path d="M148 80h60"></path></g><path d="M208 80a10 10 0 0 0 10 -10v0a10 10 0 0 0 -10 -10"></path></g><path d="M218 60h10"></path><path d="M228 60h10"></path><g><path d="M238 60h0"></path><path d="M266 60h0"></path><rect x="238" y="49" width="28" height="22" rx="10" ry="10"></rect><text x="252" y="64">.</text></g><path d="M266 60h10"></path><path d="M276 60h10"></path><g><path d="M286 60h0"></path><path d="M366 60h0"></path><path d="M286 60h10"></path><g><path d="M296 60h0"></path><path d="M356 60h0"></path><rect x="296" y="49" width="60" height="22"></rect><text x="326" y="64">digit</text></g><path d="M356 60h10"></path><path d="M296 60a10 10 0 0 0 -10 10v0a10 10 0 0 0 10 10"></path><g><path d="M296 80h60"></path></g><path d="M356 80a10 10 0 0 0 10 -10v0a10 10 0 0 0 -10 -10"></path></g><path d="M366 60h10"></path></g><path d="M376 60h20"></path><path d="M108 60a10 10 0 0 1 10 10v19a10 10 0 0 0 10 10"></path><g><path d="M128 99h84"></path><path d="M292 99h84"></path><path d="M212 99h10"></path><g><path d="M222 99h0"></path><path d="M282 99h0"></path><rect x="222" y="88" width="60" height="22"></rect><text x="252" y="103">digit</text></g><path d="M282 99h10"></path><path d="M222 99a10 10 0 0 0 -10 10v0a10 10 0 0 0 10 10"></path><g><path d="M222 119h60"></path></g><path d="M282 119a10 10 0 0 0 10 -10v0a10 10 0 0 0 -10 -10"></path></g><path d="M376 99a10 10 0 0 0 10 -10v-19a10 10 0 0 1 10 -10"></path><path d="M108 60a10 10 0 0 1 10 10v58a10 10 0 0 0 10 10"></path><g><path d="M128 138h50"></path><path d="M326 138h50"></path><path d="M178 138h10"></path><g><path d="M188 138h0"></path><path d="M216 138h0"></path><rect x="188" y="127" width="28" height="22" rx="10" ry="10"></rect><text x="202" y="142">.</text></g><path d="M216 138h10"></path><path d="M226 138h10"></path><g><path d="M236 138h0"></path><path d="M316 138h0"></path><path d="M236 138h10"></path><g><path d="M246 138h0"></path><path d="M306 138h0"></path><rect x="246" y="127" width="60" height="22"></rect><text x="276" y="142">digit</text></g><path d="M306 138h10"></path><path d="M246 138a10 10 0 0 0 -10 10v0a10 10 0 0 0 10 10"></path><g><path d="M246 158h60"></path></g><path d="M306 158a10 10 0 0 0 10 -10v0a10 10 0 0 0 -10 -10"></path></g><path d="M316 138h10"></path></g><path d="M376 138a10 10 0 0 0 10 -10v-58a10 10 0 0 1 10 -10"></path></g><g><path d="M396 60h0"></path><path d="M672 60h0"></path><path d="M396 60h20"></path><g><path d="M416 60h236"></path></g><path d="M652 60h20"></path><path d="M396 60a10 10 0 0 1 10 10v28a10 10 0 0 0 10 10"></path><g><path d="M416 108h0"></path><path d="M652 108h0"></path><g><path d="M416 108h0"></path><path d="M484 108h0"></path><path d="M416 108h20"></path><g><path d="M436 108h0"></path><path d="M464 108h0"></path><rect x="436" y="97" width="28" height="22" rx="10" ry="10"></rect><text x="450" y="112">e</text></g><path d="M464 108h20"></path><path d="M416 108a10 10 0 0 1 10 10v10a10 10 0 0 0 10 10"></path><g><path d="M436 138h0"></path><path d="M464 138h0"></path><rect x="436" y="127" width="28" height="22" rx="10" ry="10"></rect><text x="450" y="142">E</text></g><path d="M464 138a10 10 0 0 0 10 -10v-10a10 10 0 0 1 10 -10"></path></g><g><path d="M484 108h0"></path><path d="M552 108h0"></path><path d="M484 108a10 10 0 0 0 10 -10v0a10 10 0 0 1 10 -10"></path><g><path d="M504 88h0"></path><path d="M532 88h0"></path><rect x="504" y="77" width="28" height="22" rx="10" ry="10"></rect><text x="518" y="92">+</text></g><path d="M532 88a10 10 0 0 1 10 10v0a10 10 0 0 0 10 10"></path><path d="M484 108h20"></path><g><path d="M504 108h28"></path></g><path d="M532 108h20"></path><path d="M484 108a10 10 0 0 1 10 10v0a10 10 0 0 0 10 10"></path><g><path d="M504 128h0"></path><path d="M532 128h0"></path><rect x="504" y="117" width="28" height="22" rx="10" ry="10"></rect><text x="518" y="132">-</text></g><path d="M532 128a10 10 0 0 0 10 -10v0a10 10 0 0 1 10 -10"></path></g><path d="M552 108h10"></path><g><path d="M562 108h0"></path><path d="M642 108h0"></path><path d="M562 108h10"></path><g><path d="M572 108h0"></path><path d="M632 108h0"></path><rect x="572" y="97" width="60" height="22"></rect><text x="602" y="112">digit</text></g><path d="M632 108h10"></path><path d="M572 108a10 10 0 0 0 -10 10v0a10 10 0 0 0 10 10"></path><g><path d="M572 128h60"></path></g><path d="M632 128a10 10 0 0 0 10 -10v0a10 10 0 0 0 -10 -10"></path></g><path d="M642 108h10"></path></g><path d="M652 108a10 10 0 0 0 10 -10v-28a10 10 0 0 1 10 -10"></path></g><path d="M 672 60 h 20 m -10 -10 v 20 m 10 -20 v 20"></path></g></svg></dd>

		<dt id="dimension-diagram">DIMENSION</dt>
		<dd><svg class="railroad-diagram" width="249" height="62"><g transform="translate(.5 .5)"><path d="M 20 21 v 20 m 10 -20 v 20 m -10 -10 h 20.5"></path><path d="M40 31h10"></path><g><path d="M50 31h0"></path><path d="M118 31h0"></path><rect x="50" y="20" width="68" height="22"></rect><text x="84" y="35">NUMBER</text></g><path d="M118 31h10"></path><path d="M128 31h10"></path><g><path d="M138 31h0"></path><path d="M198 31h0"></path><rect x="138" y="20" width="60" height="22"></rect><text x="168" y="35">IDENT</text></g><path d="M198 31h10"></path><path d="M 208 31 h 20 m -10 -10 v 20 m 10 -20 v 20"></path></g></svg></dd>

		<dt id="percentage-diagram">PERCENTAGE</dt>
		<dd><svg class="railroad-diagram" width="217" height="62"><g transform="translate(.5 .5)"><path d="M 20 21 v 20 m 10 -20 v 20 m -10 -10 h 20.5"></path><path d="M40 31h10"></path><g><path d="M50 31h0"></path><path d="M118 31h0"></path><rect x="50" y="20" width="68" height="22"></rect><text x="84" y="35">NUMBER</text></g><path d="M118 31h10"></path><path d="M128 31h10"></path><g><path d="M138 31h0"></path><path d="M166 31h0"></path><rect x="138" y="20" width="28" height="22" rx="10" ry="10"></rect><text x="152" y="35">%</text></g><path d="M166 31h10"></path><path d="M 176 31 h 20 m -10 -10 v 20 m 10 -20 v 20"></path></g></svg></dd>

		<dt id="unicode-range-diagram">UNICODE-RANGE</dt>
		<dd><svg class="railroad-diagram" width="600" height="222"><g transform="translate(.5 .5)"><path d="M 20 21 v 20 m 10 -20 v 20 m -10 -10 h 20.5"></path><g><path d="M40 31h0"></path><path d="M108 31h0"></path><path d="M40 31h20"></path><g><path d="M60 31h0"></path><path d="M88 31h0"></path><rect x="60" y="20" width="28" height="22" rx="10" ry="10"></rect><text x="74" y="35">U</text></g><path d="M88 31h20"></path><path d="M40 31a10 10 0 0 1 10 10v10a10 10 0 0 0 10 10"></path><g><path d="M60 61h0"></path><path d="M88 61h0"></path><rect x="60" y="50" width="28" height="22" rx="10" ry="10"></rect><text x="74" y="65">u</text></g><path d="M88 61a10 10 0 0 0 10 -10v-10a10 10 0 0 1 10 -10"></path></g><path d="M108 31h10"></path><g><path d="M118 31h0"></path><path d="M146 31h0"></path><rect x="118" y="20" width="28" height="22" rx="10" ry="10"></rect><text x="132" y="35">+</text></g><path d="M146 31h10"></path><g><path d="M156 31h0"></path><path d="M559 31h0"></path><path d="M156 31h20"></path><g><path d="M176 31h115.5"></path><path d="M423.5 31h115.5"></path><path d="M291.5 31h10"></path><g><path d="M301.5 31h0"></path><path d="M413.5 31h0"></path><path d="M301.5 31h10"></path><g><path d="M311.5 31h0"></path><path d="M403.5 31h0"></path><rect x="311.5" y="20" width="92" height="22"></rect><text x="357.5" y="35">hex digit</text></g><path d="M403.5 31h10"></path><path d="M311.5 31a10 10 0 0 0 -10 10v10a10 10 0 0 0 10 10"></path><g><path d="M311.5 61h9.5"></path><path d="M394 61h9.5"></path><text x="357.5" y="66" class="comment">1-6 times</text></g><path d="M403.5 61a10 10 0 0 0 10 -10v-10a10 10 0 0 0 -10 -10"></path></g><path d="M413.5 31h10"></path></g><path d="M539 31h20"></path><path d="M156 31a10 10 0 0 1 10 10v50a10 10 0 0 0 10 10"></path><g><path d="M176 101h0"></path><path d="M539 101h0"></path><g><path d="M176 101h0"></path><path d="M328 101h0"></path><path d="M176 101a10 10 0 0 0 10 -10v0a10 10 0 0 1 10 -10"></path><g><path d="M196 81h112"></path></g><path d="M308 81a10 10 0 0 1 10 10v0a10 10 0 0 0 10 10"></path><path d="M176 101h20"></path><g><path d="M196 101h0"></path><path d="M308 101h0"></path><path d="M196 101h10"></path><g><path d="M206 101h0"></path><path d="M298 101h0"></path><rect x="206" y="90" width="92" height="22"></rect><text x="252" y="105">hex digit</text></g><path d="M298 101h10"></path><path d="M206 101a10 10 0 0 0 -10 10v10a10 10 0 0 0 10 10"></path><g><path d="M206 131h9.5"></path><path d="M288.5 131h9.5"></path><text x="252" y="136" class="comment">1-5 times</text></g><path d="M298 131a10 10 0 0 0 10 -10v-10a10 10 0 0 0 -10 -10"></path></g><path d="M308 101h20"></path></g><path d="M328 101h10"></path><g><path d="M338 101h0"></path><path d="M529 101h0"></path><path d="M338 101h10"></path><g><path d="M348 101h71.5"></path><path d="M447.5 101h71.5"></path><rect x="419.5" y="90" width="28" height="22" rx="10" ry="10"></rect><text x="433.5" y="105">?</text></g><path d="M519 101h10"></path><path d="M348 101a10 10 0 0 0 -10 10v10a10 10 0 0 0 10 10"></path><g><path d="M348 131h0"></path><path d="M519 131h0"></path><text x="433.5" y="136" class="comment">1 to (6 - digits) times</text></g><path d="M519 131a10 10 0 0 0 10 -10v-10a10 10 0 0 0 -10 -10"></path></g><path d="M529 101h10"></path></g><path d="M539 101a10 10 0 0 0 10 -10v-50a10 10 0 0 1 10 -10"></path><path d="M156 31a10 10 0 0 1 10 10v110a10 10 0 0 0 10 10"></path><g><path d="M176 161h25.5"></path><path d="M513.5 161h25.5"></path><path d="M201.5 161h10"></path><g><path d="M211.5 161h0"></path><path d="M323.5 161h0"></path><path d="M211.5 161h10"></path><g><path d="M221.5 161h0"></path><path d="M313.5 161h0"></path><rect x="221.5" y="150" width="92" height="22"></rect><text x="267.5" y="165">hex digit</text></g><path d="M313.5 161h10"></path><path d="M221.5 161a10 10 0 0 0 -10 10v10a10 10 0 0 0 10 10"></path><g><path d="M221.5 191h9.5"></path><path d="M304 191h9.5"></path><text x="267.5" y="196" class="comment">1-6 times</text></g><path d="M313.5 191a10 10 0 0 0 10 -10v-10a10 10 0 0 0 -10 -10"></path></g><path d="M323.5 161h10"></path><path d="M333.5 161h10"></path><g><path d="M343.5 161h0"></path><path d="M371.5 161h0"></path><rect x="343.5" y="150" width="28" height="22" rx="10" ry="10"></rect><text x="357.5" y="165">-</text></g><path d="M371.5 161h10"></path><path d="M381.5 161h10"></path><g><path d="M391.5 161h0"></path><path d="M503.5 161h0"></path><path d="M391.5 161h10"></path><g><path d="M401.5 161h0"></path><path d="M493.5 161h0"></path><rect x="401.5" y="150" width="92" height="22"></rect><text x="447.5" y="165">hex digit</text></g><path d="M493.5 161h10"></path><path d="M401.5 161a10 10 0 0 0 -10 10v10a10 10 0 0 0 10 10"></path><g><path d="M401.5 191h9.5"></path><path d="M484 191h9.5"></path><text x="447.5" y="196" class="comment">1-6 times</text></g><path d="M493.5 191a10 10 0 0 0 10 -10v-10a10 10 0 0 0 -10 -10"></path></g><path d="M503.5 161h10"></path></g><path d="M539 161a10 10 0 0 0 10 -10v-110a10 10 0 0 1 10 -10"></path></g><path d="M 559 31 h 20 m -10 -10 v 20 m 10 -20 v 20"></path></g></svg></dd>

		<dt id="comment-diagram">COMMENT</dt>
		<dd><svg class="railroad-diagram" width="497" height="81"><g transform="translate(.5 .5)"><path d="M 20 31 v 20 m 10 -20 v 20 m -10 -10 h 20.5"></path><path d="M40 41h10"></path><g><path d="M50 41h0"></path><path d="M86 41h0"></path><rect x="50" y="30" width="36" height="22" rx="10" ry="10"></rect><text x="68" y="45">/*</text></g><path d="M86 41h10"></path><g><path d="M96 41h0"></path><path d="M400 41h0"></path><path d="M96 41a10 10 0 0 0 10 -10v0a10 10 0 0 1 10 -10"></path><g><path d="M116 21h264"></path></g><path d="M380 21a10 10 0 0 1 10 10v0a10 10 0 0 0 10 10"></path><path d="M96 41h20"></path><g><path d="M116 41h0"></path><path d="M380 41h0"></path><path d="M116 41h10"></path><g><path d="M126 41h0"></path><path d="M370 41h0"></path><rect x="126" y="30" width="244" height="22"></rect><text x="248" y="45">anything but * followed by /</text></g><path d="M370 41h10"></path><path d="M126 41a10 10 0 0 0 -10 10v0a10 10 0 0 0 10 10"></path><g><path d="M126 61h244"></path></g><path d="M370 61a10 10 0 0 0 10 -10v0a10 10 0 0 0 -10 -10"></path></g><path d="M380 41h20"></path></g><path d="M400 41h10"></path><g><path d="M410 41h0"></path><path d="M446 41h0"></path><rect x="410" y="30" width="36" height="22" rx="10" ry="10"></rect><text x="428" y="45">*/</text></g><path d="M446 41h10"></path><path d="M 456 41 h 20 m -10 -10 v 20 m 10 -20 v 20"></path></g></svg></dd>

		<dt id="cdo-diagram">CDO</dt>
		<dd><svg class="railroad-diagram" width="153" height="62"><g transform="translate(.5 .5)"><path d="M 20 21 v 20 m 10 -20 v 20 m -10 -10 h 20.5"></path><path d="M40 31h10"></path><g><path d="M50 31h0"></path><path d="M102 31h0"></path><rect x="50" y="20" width="52" height="22" rx="10" ry="10"></rect><text x="76" y="35">&lt;!--</text></g><path d="M102 31h10"></path><path d="M 112 31 h 20 m -10 -10 v 20 m 10 -20 v 20"></path></g></svg></dd>

		<dt id="cdc-diagram">CDC</dt>
		<dd><svg class="railroad-diagram" width="145" height="62"><g transform="translate(.5 .5)"><path d="M 20 21 v 20 m 10 -20 v 20 m -10 -10 h 20.5"></path><path d="M40 31h10"></path><g><path d="M50 31h0"></path><path d="M94 31h0"></path><rect x="50" y="20" width="44" height="22" rx="10" ry="10"></rect><text x="72" y="35">--&gt;</text></g><path d="M94 31h10"></path><path d="M 104 31 h 20 m -10 -10 v 20 m 10 -20 v 20"></path></g></svg></dd>

	</dl>

<h4>
Tokenizer Flags</h4>

	<p>
		The tokenizer can be run with any of several flags that alter its behavior.

	<dl>
		<dt>the <dfn>transform function whitespace</dfn> flag
		<dd>
			This flag is set when parsing SVG's <code>transform</code> attribute.
			When this is set, whitespace is allowed between the name of a transform function and its opening parenthesis.
	</dl>

<h4>
Definitions</h4>

	<p>
		This section defines several terms used during the tokenization phase.

	<dl>
		<dt><dfn>digit</dfn>
		<dd>
			A character between U+0030 DIGIT ZERO (0) and U+0039 DIGIT NINE (9).

		<dt><dfn>hex digit</dfn>
		<dd>
			A <i>digit</i>,
			or a character between U+0041 LATIN CAPITAL LETTER A (A) and U+0046 LATIN CAPITAL LETTER F (F), 
			or a character between U+0061 LATIN SMALL LETTER A (a) and U+0066 LATIN SMALL LETTER F (f).

		<dt><dfn>uppercase letter</dfn>
		<dd>
			A character between U+0041 LATIN CAPITAL LETTER A (A) and U+005A LATIN CAPITAL LETTER Z (Z).

		<dt><dfn>lowercase letter</dfn>
		<dd>
			A character between U+0061 LATIN SMALL LETTER A (a) and U+007A LATIN SMALL LETTER Z (z).

		<dt><dfn>letter</dfn>
		<dd>
			An <i>uppercase letter</i>
			or a <i>lowercase letter</i>.

		<dt><dfn>non-ASCII character</dfn>
		<dd>
			A character with a codepoint equal to or greater than U+00A0 NO-BREAK SPACE.

		<dt><dfn>name-start character</dfn>
		<dd>
			A <i>letter</i>,
			a <i>non-ASCII character</i>,
			or U+005F LOW LINE (_).

		<dt><dfn>name character</dfn>
		<dd>
			A <i>name-start character</i>,
			A <i>digit</i>,
			or U+002D HYPHEN-MINUS (-).

		<dt><dfn>non-printable character</dfn>
		<dd>
			A character between U+0000 NULL and U+0008 BACKSPACE
			or a character between U+000E SHIFT OUT and U+001F INFORMATION SEPARATOR ONE
			or a character between U+007F DELETE and U+009F APPLICATION PROGRAM COMMAND.

		<dt><dfn>newline</dfn>
		<dd>
			U+000A LINE FEED or U+000C FORM FEED. 
			<span class='note'>
				Note that U+000D CARRIAGE RETURN is not included in this definition, 
				as it is removed from the stream during preprocessing.
			</span>

		<dt><dfn>whitespace</dfn>
		<dd>A <i>newline</i>, U+0009 CHARACTER TABULATION, or U+0020 SPACE.

		<dt><dfn>maximum allowed codepoint</dfn>
		<dd>The greatest codepoint defined by Unicode.  This is currently U+10FFFF.

	</dl>

<h4>
<dfn>Data state</dfn></h4>

	<p>
		Consume the <i>next input character</i>.

	<dl>
		<dt><i>whitespace</i>
		<dd>
			Consume as much <i>whitespace</i> as possible.
			Emit a whitespace token.
			Remain in this state.

		<dt>U+0022 QUOTATION MARK (")
		<dd>
			Switch to the <i>double-quote-string state</i>.

		<dt>U+0023 NUMBER SIGN (#)
		<dd>
			Switch to the <i>hash state</i>.

		<dt>U+0027 APOSTROPHE (&apos;)
		<dd>
			Switch to the <i>single-quote-string state</i>.

		<dt>U+0028 LEFT PARENTHESIS (()
		<dd>
			Emit a ( token.
			Remain in this state.

		<dt>U+0029 RIGHT PARENTHESIS ())
		<dd>
			Emit a ) token.
			Remain in this state.

		<dt>U+002B PLUS SIGN (+)
		<dd>
			If the <i>next input character</i> is
			a <i>digit</i>,
			or the <i title="next input character">next 2 input characters</i> are
			U+002E FULL STOP (.)
			followed by a <i>digit</i>,
			switch to the <i>number state</i>.
			Reconsume the <i>current input character</i>.

			<p>
				Otherwise,
				emit a delim token
				with its value set to U+002B PLUS SIGN (+).
				Remain in this state.

		<dt>U+002D HYPHEN-MINUS (-)
		<dd>
			If the <i title="next input character">next 2 input characters</i> are
			U+002D HYPHEN-MINUS
			U+003E GREATER-THAN SIGN
			(->),
			consume them,
			emit a CDC token,
			and remain in this state.

			<p>
				Otherwise,
				if the <i>next input character</i> is a <i>digit</i>,
				or the <i title="next input character">next 2 input characters</i> are
				U+002E FULL STOP (.)
				followed by a <i>digit</i>,
				switch to the <i>number state</i>.
				Reconsume the <i>current input character</i>.

			<p>
				Otherwise,
				switch to the <i>ident state</i>.
				Reconsume the <i>current input character</i>.

		<dt>U+002E FULL STOP (.)
		<dd>
			If the <i>next input character</i> is a <i>digit</i>,
			switch to the <i>number state</i>.
			Reconsume the <i>current input character</i>.

			<p>
				Otherwise,
				emit a delim token
				with its value set to U+002E FULL STOP (.).
				Remain in this state.

		<dt>U+002F SOLIDUS (/)
		<dd>
			If the <i>next input character</i> is U+002A ASTERISK (*),
			consume it
			and switch to the <i>comment state</i>.

			<p>
				Otherwise,
				emit a delim token
				with its value set to U+002F SOLIDUS (/).
				Remain in this state.

		<dt>U+003A COLON (:)
		<dd>
			Emit a colon token.
			Remain in this state.

		<dt>U+003B SEMICOLON (;)
		<dd>
			Emit a semicolon token.
			Remain in this state.

		<dt>U+003C LESS-THAN SIGN (&lt;)
		<dd>
			If the <i title="next input character">next 3 input characters</i> are
			U+0021 EXCLAMATION MARK
			U+002D HYPHEN-MINUS
			U+002D HYPHEN-MINUS
			(!--),
			consume them
			and emit a cdo token.
			Remain in this state.

			<p>
				Otherwise,
				emit a delim token
				with its value set to U+003C LESS-THAN SIGN (&lt;).
				Remain in this state.

		<dt>U+0040 COMMERCIAL AT (@)
		<dd>
			Switch to the <i>at-keyword state</i>.

		<dt>U+005B LEFT SQUARE BRACKET ([)
		<dd>
			Emit a [ token.
			Remain in this state.

		<dt>U+005C REVERSE SOLIDUS (\)
		<dd>
			If the <i>next input character</i> is 
			a <i>newline</i>
			or EOF,
			this is a <i>parse error</i>.
			Emit a delim token
			with its value set to U+005C REVERSE SOLIDUS (\).
			Remain in this state.

			<p>
				Otherwise, switch to the <i>ident state</i>.
				Reconsume the <i>current input character</i>.

		<dt>U+005D RIGHT SQUARE BRACKET (])
		<dd>
			Emit a ] token.
			Remain in this state.

		<dt>U+007B LEFT CURLY BRACKET ({)
		<dd>
			Emit a { token.
			Remain in this state.

		<dt>U+007D RIGHT CURLY BRACKET (})
		<dd>
			Emit a } token.
			Remain in this state.

		<dt><i>digit</i>
		<dd>
			Switch to the <i>number state</i>.
			Reconsume the <i>current input character</i>.

		<dt>U+0055 LATIN CAPITAL LETTER U (U)
		<dt>U+0075 LATIN SMALL LETTER U (u)
		<dd>
			If the <i title="next input character">next 2 input character</i> are
			U+002B PLUS SIGN (+)
			followed by a <i>hex digit</i>,
			consume the <i>next input character</i>.
			<span class='note'>Note: don't consume both of them.</span>
			Switch to the <i>unicode-range state</i>.

			<p>Otherwise,
				switch to the <i>ident state</i>.
				Reconsume the <i>current input character</i>.

		<dt><i>name-start character</i>
		<dd>
			Switch to the <i>ident state</i>.
			Reconsume the <i>current input character</i>.

		<dt>EOF
		<dd>
			Emit an end-of-file token.

		<dt>anything else
		<dd>
			Emit a delim token
			with its value set to the <i>current input character</i>.
			Remain in this state.
	</dl>

<h4>
<dfn>Double-quote-string state</dfn></h4>

	<p>
		If a string token has not yet been created since entering this state,
		create a string token
		with its value initially set to the empty string.

	<p>
		Consume the <i>next input character</i>.

	<dl>
		<dt>U+0022 QUOTATION MARK (")
		<dd>
			Emit the string token.
			Return to the <i>data state</i>.

		<dt>EOF
		<dd>
			This is a <i>parse error</i>.
			Emit the string token.
			Switch to the <i>data state</i>.
			Reconsume the <i>current input character</i>.

		<dt><i>newline</i>
		<dd>
			This is a <i>parse error</i>.
			Emit a bad-string token.
			Switch to the <i>data state</i>.
			Reconsume the <i>current input character</i>.

		<dt>U+005C REVERSE SOLIDUS (\)
		<dd>
			If the <i>next input character</i>
			is an EOF,
			this is a <i>parse error</i>.
			Emit a bad-string token,
			then switch to the <i>data state</i>.

			<p>
				Otherwise,
				if the <i>next input character</i> is
				a <i>newline</i>,
				consume it.
				Remain in this state.

			<p>
				Otherwise,
				<i>consume an escaped character</i>.
				Append the returned character to the string token's value.
				Remain in this state.

		<dt>anything else
		<dd>
			Append the <i>current input character</i>
			to the string token's value.
			Remain in this state.
	</dl>

<h4>
<dfn>Single-quote-string state</dfn></h4>

	<p>
		If a string token has not yet been created since entering this state,
		create a string token
		with its value initially set to the empty string.

	<p>
		Consume the <i>next input character</i>.

	<dl>
		<dt>U+0027 APOSTROPHE (&apos;)
		<dd>
			Emit the string token.
			Return to the <i>data state</i>.

		<dt>EOF
		<dd>
			This is a <i>parse error</i>.
			Emit the string token.
			Switch to the <i>data state</i>.
			Reconsume the <i>current input character</i>.

		<dt><i>newline</i>
		<dd>
			This is a <i>parse error</i>.
			Emit a bad-string token.
			Switch to the <i>data state</i>.
			Reconsume the <i>current input character</i>.

		<dt>U+005C REVERSE SOLIDUS (\)
		<dd>
			If the <i>next input character</i>
			is an EOF,
			this is a <i>parse error</i>.
			Emit a bad-string token,
			then switch to the <i>data state</i>.

			<p>
				Otherwise,
				if the <i>next input character</i> is
				a <i>newline</i>,
				consume it.
				Remain in this state.

			<p>
				Otherwise,
				<i>consume an escaped character</i>.
				Append the returned character to the string token's value.
				Remain in this state.

		<dt>anything else
		<dd>
			Append the <i>current input character</i>
			to the string token's value.
			Remain in this state.
	</dl>

<h4>
<dfn>Hash state</dfn></h4>

	<p>
		Consume the <i>next input character</i>.

	<dl>
		<dt><i>name character</i>
		<dd>
			Create a hash token
			with its value set to the <i>current input character</i>.
			Switch to the <i>hash-rest state</i>.

		<dt>U+005C REVERSE SOLIDUS (\)
		<dd>
			If the <i>next input character</i> is
			a <i>newline</i> or EOF,
			emit a delim token
			with its value set to U+0023 NUMBER SIGN (#).
			Switch to the <i>data state</i>.
			Reconsume the <i>current input character</i>.

			<p>
				Otherwise, 
				<i>consume an escaped character</i>.
				Create a hash token
				with its value set to the returned character.
				Switch to the <i>hash-rest state</i>.

		<dt>anything else
		<dd>
			Emit a delim token 
			with its value set to U+0023 NUMBER SIGN (#).
			Switch to the <i>data state</i>.
			Reconsume the <i>current input character</i>.
	</dl>

<h4>
<dfn>Hash-rest state</dfn></h4>

	<p>
		Consume the <i>next input character</i>.

	<dl>
		<dt><i>name character</i>
		<dd>
			Append the <i>current input character</i>
			to the hash token's value.
			Remain in this state.

		<dt>U+005C REVERSE SOLIDUS (\)
		<dd>
			If the <i>next input character</i> is
			a <i>newline</i> or EOF,
			emit the hash token.
			Switch to the <i>data state</i>.
			Reconsume the <i>current input character</i>.

			<p>
				Otherwise, 
				<i>consume an escaped character</i>.
				Append the returned character to the hash token's value.
				Remain in this state.

		<dt>anything else
		<dd>
			Emit the hash token.
			Switch to the <i>data state</i>.
			Reconsume the <i>current input character</i>.
	</dl>

<h4>
<dfn>Comment state</dfn></h4>

	<p>
		Consume the <i>next input character</i>.

	<dl>
		<dt>U+002A ASTERISK (*)
		<dd>
			If the <i>next input character</i> is
			U+002F SOLIDUS (/),
			consume it,
			and switch to the <i>data state</i>.

			<p>
				Otherwise,
				do nothing
				and remain in this state.

		<dt>EOF
		<dd>
			This is a <i>parse error</i>.
			Switch to the <i>data state</i>.
			Reconsume the <i>current input character</i>.

		<dt>anything else
		<dd>
			Do nothing
			and remain in this state.
	</dl>

<h4>
<dfn>At-keyword state</dfn></h4>

	<p>
		Consume the <i>next input character</i>.

	<dl>
		<dt>U+002D HYPHEN-MINUS (-)
		<dd>
			If the <i>next input character</i> is a <i>name-start character</i>,
			Create an at-keyword token
			with its value initially set to U+002D HYPHEN-MINUS.
			Switch to the <i>at-keyword-rest state</i>.

			<p>
				Otherwise,
				if the <i title="next input character">next two characters</i> are
				U+005C REVERSE SOLIDUS (\)
				followed by anything but
				a <i>newline</i>
				or EOF,
				create an at-keyword token
				with its value initially set to U+002D HYPHEN-MINUS.
				Switch to the <i>at-keyword-rest state</i>.

			<p>
				Otherwise,
				emit a delim token
				with its value set to U+0040 COMMERCIAL AT (@).
				Switch to the <i>data state</i>.
				Reconsume the <i>current input character</i>.

		<dt><i>name-start character</i>
		<dd>
			Create an at-keyword token
			with its value set to the <i>current input character</i>.
			Switch to the <i>at-keyword-rest state</i>.

		<dt>U+005C REVERSE SOLIDUS (\)
		<dd>
			If the <i>next input character</i> is
			a <i>newline</i> or EOF,
			emit a delim token
			with its value set to U+0040 COMMERCIAL AT (@).
			Switch to the <i>data state</i>.
			Reconsume the <i>current input character</i>.

			<p>
				Otherwise, 
				<i>consume an escaped character</i>.
				Create an at-keyword token
				with its value set to the returned character.
				Switch to the <i>at-keyword-rest state</i>.

		<dt>anything else
		<dd>
			Emit a delim token
			with its value set to U+0040 COMMERCIAL AT (@).
			Switch to the <i>data state</i>.
			Reconsume the <i>current input character</i>.
	</dl>

<h4>
<dfn>At-keyword-rest state</dfn></h4>

	<p>
		Consume the <i>next input character</i>.

	<dl>
		<dt><i>name character</i>
		<dd>
			Append the <i>current input character</i>
			to the at-keyword token's value.
			Remain in this state.

		<dt>U+005C REVERSE SOLIDUS (\)
		<dd>
			If the <i>next input character</i> is
			a <i>newline</i> or EOF,
			emit the at-keyword token.
			Switch to the <i>data state</i>.
			Reconsume the <i>current input character</i>.

			<p>
				Otherwise, 
				<i>consume an escaped character</i>.
				Append the returned character to the at-keyword token's value.
				Remain in this state.

		<dt>anything else
		<dd>
			Emit the at-keyword token.
			Switch to the <i>data state</i>.
			Reconsume the <i>current input character</i>.
	</dl>

<h4>
<dfn>Ident state</dfn></h4>

	<p>
		Consume the <i>next input character</i>.

	<dl>
		<dt>U+002D HYPHEN-MINUS (-)
		<dd>
			If the <i>next input character</i> is
			a <i>name-start character</i>,
			create an identifer token
			with its value initially set to U+002D HYPHEN-MINUS.
			Switch to the <i>ident-rest state</i>.

			<p>
				Otherwise,
				if the <i title="next input character">next two characters</i> are
				U+005C REVERSE SOLIDUS (\)
				followed by anything but
				a <i>newline</i>
				or EOF,
				create an identifer token
				with its value initially set to U+002D HYPHEN-MINUS.
				Switch to the <i>ident-rest state</i>.

			<p>
				Otherwise,
				emit a delim token 
				with its value set to U+002D HYPHEN-MINUS (-).
				Switch to the <i>data state</i>.

		<dt><i>name-start character</i>
		<dd>
			Create an ident token
			with its value set to the <i>current input character</i>.
			Switch to the <i>ident-rest state</i>.

		<dt>U+005C REVERSE SOLIDUS (\)
		<dd>
			If the <i>next input character</i> is
			a <i>newline</i> or EOF,
			switch to the <i>data state</i>.
			Reconsume the <i>current input character</i>.

			<p>
				Otherwise, 
				<i>consume an escaped character</i>.
				Create an ident token
				with its value set to the returned character.
				Switch to the <i>ident-rest state</i>.

		<!--
			This state should only be entered with a valid character.
			If it hits anything else, this is a spec error.
		-->
	
	</dl>

<h4>
<dfn>Ident-rest state</dfn></h4>

	<p>
		Consume the <i>next input character</i>.

	<dl>
		<dt><i>name character</i>
		<dd>
			Append the <i>current input character</i>
			to the ident token's value.
			Remain in this state.

		<dt>U+005C REVERSE SOLIDUS (\)
		<dd>
			If the <i>next input character</i> is
			a <i>newline</i> or EOF,
			emit the ident token.
			Switch to the <i>data state</i>.
			Reconsume the <i>current input character</i>.

			<p>
				Otherwise, 
				<i>consume an escaped character</i>.
				Append the returned character to the ident token's value.
				Remain in this state.

		<dt>U+0028 LEFT PARENTHESIS (()
		<dd>
			If the identifier token's value is 
			an <i>ASCII case-insensitive</i> match for "url",
			switch to the <i>url state</i>.

			<p>
				Otherwise,
				Emit a function token
				with its value set to the identifier token's value.
				Switch to the <i>data state</i>.

		<dt><i>whitespace</i>
		<dd>
			If the <i>transform function whitespace</i> flag is set,
			reconsume the <i>current input character</i>
			and switch to the <i>transform-function-whitespace state</i>.

			<p>
				Otherwise,
				emit the ident token.
				Switch to the <i>data state</i>.
				Reconsume the <i>current input character</i>.

		<dt>anything else
		<dd>
			Emit the ident token.
			Switch to the <i>data state</i>.
			Reconsume the <i>current input character</i>.
	</dl>

<h4>
<dfn>Transform-function-whitespace state</dfn></h4>

	<p>
		Consume the <i>next input character</i>.

	<dl>
		<dt><i>whitespace</i>
		<dd>
			If the <i>next input character</i> is <i>whitespace</i>,
			remain in this state.

			<p>
				Otherwise,
				if the <i>next input character</i> is U+0028 LEFT PARENTHESES ((),
				emit a function token
				with its value set to the identifer token's value.
				Switch to the <i>data state</i>.

			<p>
				Otherwise,
				emit the identifer token.
				Switch to the <i>data state</i>.
				Reconsume the <i>current input character</i>.
	</dl>


<h4>
<dfn>Number state</dfn></h4>

	<p>
		Create a number token
		with its representation initially set to the empty string.

	<p>
		Consume the <i>next input character</i>.

	<dl>
		<dt>U+002D HYPHEN-MINUS (-)
		<dd>
			If the <i>next input character</i> is
			a <i>digit</i>,
			consume it.
			Append U+002D HYPHEN-MINUS (-) to the number token's representation.
			Append the <i>digit</i> to the number token's representation.
			Switch to the <i>number-rest state</i>.

			<p>
				Otherwise,
				if the <i title="next input character">next 2 input characters</i> are
				U+002E FULL STOP
				followed by a <i>digit</i>,
				consume them.
				Append U+002D HYPHEN-MINUS (-) to the number token's representation.
				Append U+002E FULL STOP (.) to the number token's representation.
				Append the <i>digit</i> to the number token's representation.
				Switch to the <i>number fraction</i> state.

			<p>
				Otherwise,
				switch to the <i>data state</i>.
				Reconsume the <i>current input character</i>.

		<dt>U+002B PLUS SIGN (+)
		<dd>
			If the <i>next input character</i> is
			a <i>digit</i>,
			consume it.
			Append U+002D PLUS SIGN (+) to the number token's representation.
			Append the <i>digit</i> to the number token's representation.
			Switch to the <i>number-rest state</i>.

			<p>
				Otherwise,
				if the <i title="next input character">next 2 input characters</i> are
				U+002E FULL STOP
				followed by a <i>digit</i>,
				consume them.
				Append U+002D PLUS SIGN (+) to the number token's representation.
				Append U+002E FULL STOP (.) to the number token's representation.
				Append the <i>digit</i> to the number token's representation.
				Switch to the <i>number fraction</i> state.

			<p>
				Otherwise,
				switch to the <i>data state</i>.
				Reconsume the <i>current input character</i>.

		<dt><i>digit</i>
		<dd>
			Append the <i>current input character</i>
			to the number token's representation.
			Switch to the <i>number-rest state</i>.

		<dt>U+002E FULL STOP (.)
		<dd>
			If the <i>next input character</i> is
			a <i>digit</i>,
			consume it.
			Append U+002E FULL STOP (.) to the number token's representation.
			Append the <i>digit</i> to the number token's representation.
			Switch to the <i>number-fraction state</i>.

			<p>
				Otherwise,
				switch to the <i>data state</i>.
				Reconsume the <i>current input character</i>.

		<dt>anything else
		<dd>
			Switch to the <i>data state</i>.
			Reconsume the <i>current input character</i>.
	</dl>

<h4>
<dfn>Number-rest state</dfn></h4>

	<p>
		Consume the <i>next input character</i>.

	<dl>
		<dt><i>digit</i>
		<dd>
			Append the <i>current input character</i>
			to the number token's representation.
			Remain in this state.

		<dt>U+002E FULL STOP (.)
		<dd>
			If the <i>next input character</i> is
			a <i>digit</i>,
			consume it.
			Append U+002E FULL STOP (.)
			followed by the <i>digit</i>
			to the number token's representation.
			Switch to the <i>number-fraction state</i>.

			<p>
				Otherwise,
				set the number token's value to the number
				produced by interpreting the number token's representation
				as a base-10 number
				and emit it.
				Switch to the <i>data state</i>.
				Reconsume the <i>current input character</i>.

		<dt>U+0025 PERCENT SIGN (%)
		<dd>
			Emit a percentage token
			with its value set to the number
			produced by interpreting the number token's representation
			as a base-10 number.
			Switch to the <i>data state</i>.

		<dt>U+0045 LATIN CAPITAL LETTER E (E)
		<dt>U+0065 LATIN SMALL LETTER E (e)
		<dd>
			If the <i>next input character</i> is a <i>digit</i>,
			or the <i title="next input character">next 2 input characters</i>
			are U+002B PLUS SIGN (+) or U+002D HYPHEN-MINUS (-) followed by a <i>digit</i>,
			consume them
			and append them to the number token's representation.
			Switch to the <i>sci-notation state</i>.

			<p>
				Otherwise,
				create a dimension token
				with its representation set to the number token's representation,
				its value set to the number
				produced by interpreting the number token's representation
				as a base-10 number,
				and a unit initially set to the <i>current input character</i>.
				Switch to the <i>dimension state</i>.

		<dt>U+002D HYPHEN-MINUS (-)
		<dd>
			If the <i>next input character</i> is
			a <i>name-start character</i>,
			consume it.
			Create a dimension token
			with its representation set to the number token's representation,
			its value set to the number
			produced by interpreting the number token's representation
			as a base-10 number,
			and a unit initially set to
			U+002D HYPHEN-MINUS
			followed by the <i>name-start character</i>.
			Switch to the <i>dimension state</i>.

			<p>
				Otherwise,
				if the <i title="next input character">next 2 input characters</i> are
				U+005C REVERSE SOLIDUS (\) followed by a <i>newline</i>,
				or U+005C REVERSE SOLIDUS (\) followed by EOF,
				set the number token's value to the number
				produced by interpreting the number token's representation
				as a base-10 number
				and emit it.
				Switch to the <i>data state</i>.
				Reconsume the <i>current input character</i>.

			<p>
				Otherwise,
				if the <i>next input character</i> is
				U+005C REVERSE SOLIDUS (\),
				consume it,
				then <i>consume an escaped character</i>.
				Create a dimension token
				with its representation set to the number token's representation,
				its value set to the number
				produced by interpreting the number token's representation
				as a base-10 number,
				and a unit initially set to
				U+002D HYPHEN-MINUS
				followed by the returned character.
				Switch to the <i>dimension state</i>.

			<p>
				Otherwise,
				set the number token's value to the number
				produced by interpreting the number token's representation
				as a base-10 number
				and emit it.
				Switch to the <i>data state</i>.
				Reconsume the <i>current input character</i>.

		<dt><i>name-start character</i>
		<dd>
			Create a dimension token
			with its representation set to the number token's representation,
			its value set to the number
			produced by interpreting the number token's representation
			as a base-10 number,
			and a unit initially set to the <i>current input character</i>.
			Switch to the <i>dimension state</i>.

		<dt>U+005C REVERSE SOLIDUS (\)
		<dd>
			If the <i>next input character</i> is
			a <i>newline</i> or EOF,
			set the number token's value to the number
			produced by interpreting the number token's representation
			as a base-10 number
			and emit it.
			Switch to the <i>data state</i>.
			Reconsume the <i>current input character</i>.

			<p>
				Otherwise,
				<i>consume an escaped character</i>.
				Create a dimension token
				with its representation set to the number token's representation,
				its value set to the number
				produced by interpreting the number token's representation
				as a base-10 number,
				and a unit initially set to the returned character.
				Switch to the <i>dimension state</i>.

		<dt>anything else
		<dd>
			Emit a number token
			with its value set to the number
			produced by interpreting the string token's value
			as a base-10 number.
			Switch to the <i>data state</i>.
			Reconsume the <i>current input character</i>.
	</dl>

<h4>
<dfn>Number-fraction state</dfn></h4>

	<p>
		Set the number token's type flag to "number".

	<p>
		Consume the <i>next input character</i>.

	<dl>
		<dt><i>digit</i>
		<dd>
			Append the <i>current input character</i>
			to the string token's value.
			Remain in this state.

		<dt>U+0025 PERCENT SIGN (%)
		<dd>
			Emit a percentage token
			with its value set to the number
			produced by interpreting the number token's representation
			as a base-10 number.
			Switch to the <i>data state</i>.
			Reconsume the <i>current input character</i>.

		<dt>U+0045 LATIN CAPITAL LETTER E (E)
		<dt>U+0065 LATIN SMALL LETTER E (e)
		<dd>
			If the <i>next input character</i> is a <i>digit</i>,
			or the <i title="next input character">next 2 input characters</i>
			are U+002B PLUS SIGN (+) or U+002D HYPHEN-MINUS (-) followed by a <i>digit</i>,
			consume them
			and append them to the number token's representation.
			Switch to the <i>sci-notation state</i>.

			<p>
				Otherwise,
				create a dimension token
				with its representation set to the number token's representation,
				its value set to the number
				produced by interpreting the number token's representation
				as a base-10 number,
				and a unit initially set to the <i>current input character</i>.
				Switch to the <i>dimension state</i>.

		<dt>U+002D HYPHEN-MINUS (-)
		<dd>
			If the <i>next input character</i> is
			a <i>name-start character</i>,
			consume it.
			Create a dimension token
			with its representation set to the number token's representation,
			its value set to the number
			produced by interpreting the number token's representation
			as a base-10 number,
			and a unit initially set to
			U+002D HYPHEN-MINUS
			followed by the <i>name-start character</i>.
			Switch to the <i>dimension state</i>.

			<p>
				Otherwise,
				if the <i title="next input character">next 2 input characters</i> are
				U+005C REVERSE SOLIDUS (\) followed by a <i>newline</i>,
				or U+005C REVERSE SOLIDUS (\) followed by EOF,
				set the number token's value to the number
				produced by interpreting the number token's representation
				as a base-10 number
				and emit it.
				Switch to the <i>data state</i>.
				Reconsume the <i>current input character</i>.

			<p>
				Otherwise,
				if the <i>next input character</i> is
				U+005C REVERSE SOLIDUS (\),
				consume it,
				then <i>consume an escaped character</i>.
				Create a dimension token
				with its representation set to the number token's representation,
				its value set to the number
				produced by interpreting the number token's representation
				as a base-10 number,
				and a unit initially set to
				U+002D HYPHEN-MINUS
				followed by the returned character.
				Switch to the <i>dimension state</i>.

			<p>
				Otherwise,
				set the number token's value to the number
				produced by interpreting the number token's representation
				as a base-10 number
				and emit it.
				Switch to the <i>data state</i>.
				Reconsume the <i>current input character</i>.

		<dt><i>name-start character</i>
		<dd>
			Create a dimension token
			with its representation set to the number token's representation,
			its value set to the number
			produced by interpreting the number token's representation
			as a base-10 number,
			and a unit initially set to the <i>current input character</i>.
			Switch to the <i>dimension state</i>.

		<dt>U+005C REVERSE SOLIDUS (\)
		<dd>
			If the <i>next input character</i> is
			a <i>newline</i> or EOF,
			set the number token's value to the number
			produced by interpreting the number token's representation
			as a base-10 number
			and emit it.
			Switch to the <i>data state</i>.
			Reconsume the <i>current input character</i>.

			<p>
				Otherwise,
				<i>consume an escaped character</i>.
				Create a dimension token
				with its representation set to the number token's representation,
				its value set to the number
				produced by interpreting the number token's representation
				as a base-10 number,
				and a unit initially set to the returned character.
				Switch to the <i>dimension state</i>.


		<dt>anything else
		<dd>
			Emit a number token
			with its value set to the number
			produced by interpreting the string token's value
			as a base-10 number.
			Switch to the <i>data state</i>.
			Reconsume the <i>current input character</i>.
	</dl>

<h4>
<dfn>Dimension state</dfn></h4>

	<!--
		This state is currently always entered with a dimension token
		having already been created and gotten over the "first valid character" hump,
		so the dimension token is already ready to emit.

		If this ever becomes not true, make the necessary additions here
		or things will break.
	-->

	<p>
		Consume the <i>next input character</i>.

	<dl>
		<dt><i>name character</i>
		<dd>
			Append the <i>current input character</i>
			to the dimension token's unit.
			Remain in this state.

		<dt>U+005C REVERSE SOLIDUS (\)
		<dd>
			If the <i>next input character</i> is
			a <i>newline</i> or EOF,
			emit the dimension token.
			Switch to the <i>data state</i>.
			Reconsume the <i>current input character</i>.

			<p>
				Otherwise,
				<i>consume an escaped character</i>.
				Append the returned character
				to the dimension token's unit.

		<dt>anything else
		<dd>
			Emit the dimension token.
			Switch to the <i>data state</i>.
			Reconsume the <i>current input character</i>.
	</dl>

<h4>
<dfn>Sci-notation state</dfn></h4>

	<p>
		Set the number token's type flag to "number".

	<p>
		Consume the <i>next input character</i>.

	<dl>
		<dt><i>digit</i>
		<dd>
			Append the <i>current input character</i>
			to the number token's representation.
			Remain in this state.

		<dt>anything else
		<dd>
			Let <var>base</var> be the result of interpreting the portion of the number token's representation 
			preceding the U+0045 LATIN CAPITAL LETTER E (E) or U+0065 LATIN SMALL LETTER E (e)
			as a base-10 number.
			<p>
				Let <var>power</var> be the result of interpreting the portion of the number token's representation 
				following the U+0045 LATIN CAPITAL LETTER E (E) or U+0065 LATIN SMALL LETTER E (e)
				as a base-10 number.
			<p>
				Set the number token's value to <code><var>base</var> * 10<sup><var>power</var></sup></code>.
				If the number token's value is not an integer,
				set the number token's type flag to "number".
				Emit the number token.
				Switch to the <i>data state</i>.
				Reconsume the <i>current input character</i>.
	</dl>

<h4>
<dfn>URL state</dfn></h4>

	<p>
		Consume the <i>next input character</i>.

	<dl>
		<dt>EOF
		<dd>
			This is a <i>parse error</i>.
			Emit a bad-url token.
			Switch to the <i>data state</i>.

		<dt>U+0022 QUOTATION MARK (")
		<dd>
			Switch to the <i>url-double-quote state</i>.

		<dt>U+0027 APOSTROPHE (&apos;)
		<dd>
			Switch to the <i>url-single-quote state</i>.

		<dt>U+0029 RIGHT PARENTHESIS ())
		<dd>
			Emit a url token
			with its value set to the empty string.
			Switch to the <i>data state</i>.

		<dt><i>whitespace</i>
		<dd>
			Remain in this state.

		<dt>anything else
		<dd>
			Switch to the <i>url-unquoted state</i>.
			Reconsume the <i>current input character</i>.
	</dl>

<h4>
<dfn>URL-double-quote state</dfn></h4>

	<p>
		If a url token has not yet been created since entering this state,
		create a url token
		with its value initially set to the empty string.

	<p>
		Consume the <i>next input character</i>.

	<dl>
		<dt>EOF
		<dd>
			This is a <i>parse error</i>.
			Emit a bad-url token.
			Switch to the <i>data state</i>.

		<dt>U+0022 QUOTATION MARK (")
		<dd>
			Switch to the <i>url-end state</i>.

		<dt><i>newline</i>
		<dd>
			This is a <i>parse error</i>.
			Switch to the <i>bad-url state</i>.

		<dt>U+005C REVERSE SOLIDUS (\)
		<dd>
			If the <i>next input character</i> is
			EOF,
			this is a <i>parse error</i>.
			Emit a bad-url token.
			Switch to the <i>data state</i>.
			Reconsume the <i>current input character</i>.

			<p>
				Otherwise, if the <i>next input character</i> is
				a <i>newline</i>,
				consume it
				and remain in this state.

			<p>
				Otherwise,
				<i>consume an escaped character</i>.
				Append the returned character to the url token's value.
				Remain in this state.

		<dt>anything else
		<dd>
			Append the <i>current input character</i>
			to the url token's value.
			Remain in this state.
	</dl>

<h4>
<dfn>URL-single-quote state</dfn></h4>

	<p>
		If a url token has not yet been created since entering this state,
		create a url token
		with its value initially set to the empty string.

	<p>
		Consume the <i>next input character</i>.

	<dl>
		<dt>EOF
		<dd>
			This is a <i>parse error</i>.
			Emit a bad-url token.
			Switch to the <i>data state</i>.

		<dt>U+0027 APOSTROPHE (&apos;)
		<dd>
			Switch to the <i>url-end state</i>.

		<dt><i>newline</i>
		<dd>
			This is a <i>parse error</i>.
			Switch to the <i>bad-url state</i>.

		<dt>U+005C REVERSE SOLIDUS (\)
		<dd>
			If the <i>next input character</i> is
			EOF,
			this is a <i>parse error</i>.
			Emit a bad-url token.
			Switch to the <i>data state</i>.
			Reconsume the <i>current input character</i>.

			<p>
				Otherwise, if the <i>next input character</i> is
				a <i>newline</i>,
				consume it
				and remain in this state.

			<p>
				Otherwise,
				<i>consume an escaped character</i>.
				Append the returned character to the url token's value.
				Remain in this state.

		<dt>anything else
		<dd>
			Append the <i>current input character</i>
			to the url token's value.
			Remain in this state.
	</dl>

<h4>
<dfn>URL-end state</dfn></h4>

	<p>
		Consume the <i>next input character</i>.

	<dl>
		<dt>EOF
		<dd>
			This is a <i>parse error</i>.
			Emit a bad-url token.
			Switch to the <i>data state</i>.

		<dt><i>whitespace</i>
		<dd>
			Remain in this state.

		<dt>U+0029 RIGHT PARENTHESIS ())
		<dd>
			Emit the url token.
			Switch to the <i>data state</i>.

		<dt>anything else
		<dd>
			This is a <i>parse error</i>.
			Switch to the <i>bad-url state</i>.
			Reconsume the <i>current input character</i>.
	</dl>

<h4>
<dfn>URL-unquoted state</dfn></h4>

	<p>
		If a url token has not yet been created since entering this state,
		create a url token
		with its value initially set to the empty string.

	<p>
		Consume the <i>next input character</i>.

	<dl>
		<dt>EOF
		<dd>
			This is a <i>parse error</i>.
			Emit a bad-url token.
			Switch to the <i>data state</i>.

		<dt><i>whitespace</i>
		<dd>
			Switch to the <i>url-end state</i>.

		<dt>U+0029 RIGHT PARENTHESIS ())
		<dd>
			Emit the url token.
			Switch to the <i>data state</i>.

		<dt>U+0022 QUOTATION MARK (")
		<dt>U+0027 APOSTROPHE (&apos;)
		<dt>U+0028 LEFT PARENTHESIS (()
		<dt><i>non-printable character</i>
		<dd>
			This is a <i>parse error</i>.
			Switch to the <i>bad-url state</i>.

		<dt>U+005C REVERSE SOLIDUS
		<dd>
			If the <i>next input character</i>
			is a <i>newline</i> or EOF,
			this is a <i>parse error</i>.
			Switch to the <i>bad-url state</i>.

			<p>
				Otherwise, 
				<i>consume an escaped character</i>.
				Append the returned character
				to the url token's value.
				Remain in this state.

		<dt>anything else
		<dd>
			Append the <i>current input character</i>
			to the url token's value.
			Remain in this state.
	</dl>


<h4>
<dfn>Bad-URL state</dfn></h4>

	<p>
		Consume the <i>next input character</i>.

	<dl>
		<dt>EOF
		<dd>
			This is a <i>parse error</i>.
			Emit a bad-url token.
			Switch to the <i>data state</i>.

		<dt>U+0029 RIGHT PARENTHESIS ())
		<dd>
			Emit a bad-url token.
			Switch to the <i>data state</i>.

		<dt>U+005C REVERSE SOLIDUS
		<dd>
			If the <i>next input character</i>
			is a <i>newline</i> or EOF,
			do nothing
			and remain in this state.

			<p>
				Otherwise, 
				<i>consume an escaped character</i>.
				Remain in this state.

		<dt>anything else
		<dd>
			Do nothing.
			Remain in this state.
	</dl>


<h4>
<dfn>Unicode-range state</dfn></h4>

	<p>
		Create a new unicode-range token
		with an empty range.

	<p>
		Consume as many <i>hex digits</i> as possible, but no more than 6.
		If less than 6 <i>hex digits</i> were consumed,
		consume as many U+003F QUESTION MARK (?) characters as possible,
		but no more than enough to make the total of <i>hex digits</i> and U+003F QUESTION MARK (?) characters equal to 6.

		<p>
			If any U+003F QUESTION MARK (?) characters were consumed,
			first interpret the consumed characters as a hexadecimal number,
			with the U+003F QUESTION MARK (?) characters replaced by U+0030 DIGIT ZERO (0) characters.
			This is the <i>start of the range</i>.
			Then interpret the consumed characters as a hexadecimal number again,
			with the U+003F QUESTION MARK (?) character replaced by U+0046 LATIN CAPITAL LETTER F (F) characters.
			This is the <i>end of the range</i>.
			<i>Set the unicode-range token's range</i>, then emit it.
			Switch to the <i>data state</i>.

		<p>
			Otherwise,
			interpret the digits as a hexadecimal number.
			This is the <i>start of the range</i>.

	<p>
		Consume the <i>next input character</i>.

	<dl>
		<dt>U+002D HYPHEN-MINUS (-)
		<dd>
			If the <i>next input character</i> is a <i>hex digit</i>,
			consume as many <i>hex digits</i> as possible, but no more than 6.
			Interpret the digits as a hexadecimal number.
			This is the <i>end of the range</i>.
			<i>Set the unicode-range token's range</i>, then emit it.
			Switch to the <i>data state</i>.

			<p>
				Otherwise,
				<i>set the unicode-range token's range</i>
				and emit it.
				Switch to the <i>data state</i>.
				Reconsume the <i>current input character</i>.

		<dt>anything else
		<dd>
			<i>Set the unicode-range token's range</i>
			and emit it.
			Switch to the <i>data state</i>.
			Reconsume the <i>current input character</i>.
	</dl>

<h4>
<dfn>Consume an escaped character</dfn></h4>

	<p>
		This section describes how to <i>consume an escaped character</i>.
		It assumes that the U+005C REVERSE SOLIDUS (\) has already been consumed
		and that the next input character has already been verified
		to not be a <i>newline</i> or EOF.
		It will return a character.

	<p>
		Consume the <i>next input character</i>.

	<dl>
		<dt><i>hex digit</i>
		<dd>
			Consume as many <i>hex digits</i> as possible, but no more than 5.
			<span class='note'>Note that this means 1-6 hex digits have been consumed in total.</span>
			If the <i>next input character</i> is
			<i>whitespace</i>,
			consume it as well.
			Interpret the <i>hex digits</i> as a hexadecimal number.
			If this number is zero,
			or is greater than the <i>maximum allowed codepoint</i>,
			return U+FFFD REPLACEMENT CHARACTER (�).
			Otherwise, return the character with that codepoint.

		<dt>anything else
		<dd>
			Return the <i>current input character</i>.
	</dl>

<h4>
<dfn>Set the unicode-range token's range</dfn></h4>

	<p>
		This section describes how to set a unicode-range token's range
		so that the range it describes 
		is within the supported range of unicode characters.

	<p>
		It assumes that the <dfn>start of the range</dfn> has been defined,
		the <dfn>end of the range</dfn> might be defined,
		and both are non-negative integers.

	<p>
		If the <i>start of the range</i> is greater than
		the <i>maximum allowed codepoint</i>,
		the unicode-range token's range is empty.

	<p>
		If the <i>end of the range</i> is defined,
		and it is less than the <i>start of the range</i>,
		the unicode-range token's range is empty.

	<p>
		If the <i>end of the range</i> is not defined,
		the unicode-range token's range
		is the single character whose codepoint is the <i>start of the range</i>.

	<p>
		Otherwise,
		if the <i>end of the range</i> is greater than
		the <i>maximum allowed codepoint</i>,
		change it to the <i>maximum allowed codepoint</i>.
		The unicode-range token's range
		is all characters between
		the character whose codepoint is the <i>start of the range</i>
		and the character whose codepoint is the <i>end of the range</i>.


<h3>
Changes from CSS 2.1 Tokenizer</h3>

	<p>
		<em>This section is non-normative.</em>

	<p>
		Here are the changes that I know that I've made to the tokenizer of 2.1.
		If there are changes not present here, 
		please let me know
		as they may be unintentional.

	<p>
		Note that the point of this spec is to match reality;
		changes from CSS2.1&apos;s tokenizer are nearly always because the tokenizer specified something that doesn't match actual browser behavior,
		or left something unspecified.
		If some detail doesn't match browsers,
		please let me know
		as it's almost certainly unintentional.

	<ol>
		<li>
			The DASHMATCH and INCLUDES tokens have been removed.
			They can instead be handled simply by having them parse as DELIM tokens.
			It was weird to privilege just those two types of attribute equality operators,
			when Selectors 3 adds several more.

		<li>
			The BAD-URI token (now bad-url) is "self-contained".
			In other words, once the tokenizer realizes it's in a bad-url rather than a url token,
			it just seeks forward to look for the closing ),
			ignoring everything else.
			This behavior is simpler than treating it like a FUNCTION token
			and paying attention to opened blocks and such.
			Only WebKit exhibits this behavior,
			but it doesn't appear that we've gotten any compat bugs from it.

		<li>
			The number, percentage, and dimension tokens have been changed
			to include the preceding +/- sign as part of their value
			(rather than as a separate DELIM token that needs to be manually handled every time the token is mentioned in other specs).
			The only consequence of this is that comments can no longer be inserted between the sign and the number.

		<li>
			Some flags have been added for SVG-compatible tokenizing, 
			so that a single state machine can be used for both "vanilla" and SVG CSS parsing.

		<li>
			Scientific notation is supported for numbers,
			per WG resolution.

	</ol>


<!--
PPPPPPPPPPPPPPPPP        AAA               RRRRRRRRRRRRRRRRR      SSSSSSSSSSSSSSS EEEEEEEEEEEEEEEEEEEEEERRRRRRRRRRRRRRRRR   
P::::::::::::::::P      A:::A              R::::::::::::::::R   SS:::::::::::::::SE::::::::::::::::::::ER::::::::::::::::R  
P::::::PPPPPP:::::P    A:::::A             R::::::RRRRRR:::::R S:::::SSSSSS::::::SE::::::::::::::::::::ER::::::RRRRRR:::::R 
PP:::::P     P:::::P  A:::::::A            RR:::::R     R:::::RS:::::S     SSSSSSSEE::::::EEEEEEEEE::::ERR:::::R     R:::::R
  P::::P     P:::::P A:::::::::A             R::::R     R:::::RS:::::S              E:::::E       EEEEEE  R::::R     R:::::R
  P::::P     P:::::PA:::::A:::::A            R::::R     R:::::RS:::::S              E:::::E               R::::R     R:::::R
  P::::PPPPPP:::::PA:::::A A:::::A           R::::RRRRRR:::::R  S::::SSSS           E::::::EEEEEEEEEE     R::::RRRRRR:::::R 
  P:::::::::::::PPA:::::A   A:::::A          R:::::::::::::RR    SS::::::SSSSS      E:::::::::::::::E     R:::::::::::::RR  
  P::::PPPPPPPPP A:::::A     A:::::A         R::::RRRRRR:::::R     SSS::::::::SS    E:::::::::::::::E     R::::RRRRRR:::::R 
  P::::P        A:::::AAAAAAAAA:::::A        R::::R     R:::::R       SSSSSS::::S   E::::::EEEEEEEEEE     R::::R     R:::::R
  P::::P       A:::::::::::::::::::::A       R::::R     R:::::R            S:::::S  E:::::E               R::::R     R:::::R
  P::::P      A:::::AAAAAAAAAAAAA:::::A      R::::R     R:::::R            S:::::S  E:::::E       EEEEEE  R::::R     R:::::R
PP::::::PP   A:::::A             A:::::A   RR:::::R     R:::::RSSSSSSS     S:::::SEE::::::EEEEEEEE:::::ERR:::::R     R:::::R
P::::::::P  A:::::A               A:::::A  R::::::R     R:::::RS::::::SSSSSS:::::SE::::::::::::::::::::ER::::::R     R:::::R
P::::::::P A:::::A                 A:::::A R::::::R     R:::::RS:::::::::::::::SS E::::::::::::::::::::ER::::::R     R:::::R
PPPPPPPPPPAAAAAAA                   AAAAAAARRRRRRRR     RRRRRRR SSSSSSSSSSSSSSS   EEEEEEEEEEEEEEEEEEEEEERRRRRRRR     RRRRRRR
-->

<h3>
Tree Construction</h3>

	<p>
		The input to the tree construction stage is a sequence of tokens from the tokenization stage.
		The output is a tree of items
		with a stylesheet at the root
		and all other nodes being at-rules, style rules, or declarations.

	<p>
		The construction of this stylesheet does not take into account unrecognized items,
		like unknown properties or at-rules.
		It simply produces a tree of rules according to the fundamental syntax of CSS.
		Unrecognized or misplaced rules are handled in the CSSOM Construction stage.

	<p>
		The items that can appear in the tree are a mixture of basic tokens
		and new objects:

	<dl>
		<dt>stylesheet
		<dd>
			A stylesheet has a value consisting of a list of at-rules and style rules.

		<dt>at-rule
		<dd>
			An at-rule has a name,
			a prelude consisting of a list of primitives,
			and a value consisting of a list of at-rules, style rules, or declarations.

		<dt>style rule</dt>
		<dd>
			A style rule has 
			a selector consisting of a list of primitives,
			and a value consisting of a list of at-rules or declarations.

		<dt>declaration
		<dd>
			A declaration has a name,
			a value consisting of a list of primitives,
			and an <var>important</var> flag which is initially unset.

		<dt>primitive
		<dd>
			A primitive is one of the preserved tokens,
			a function,
			or a simple block.

		<dt>preserved tokens
		<dd>
			The tokens that can appear in the tree are:
			ident,
			hash,
			string,
			url,
			delim,
			number,
			percentage,
			dimension,
			unicode-range,
			whitespace,
			cdo,
			cdc,
			colon,
			semicolon,
			at-keyword,
			],
			),
			and }.

			<p class='note'>
				This means that the following tokens emitted by the tokenizer stage will <strong>not</strong> appear in the stylesheet object:
				function,
				bad-string,
				bad-url,
				[,
				(,
				{.

		<dt>function
		<dd>
			A function has a name,
			and a list of arguments.
			Each argument is a list of primitives.

		<dt>simple block
		<dd>
			A simple block has an associated token (either a [, (, or { token)
			and a value consisting of a list of primitives.
	</dl>

	<div class='issue'>
		<p>
			TODO:

		<ul>
			<li>
				Make sure that I properly handle the case where the top element in the stack isn't a stylesheet,
				such as when parsing the <code>style</code> attribute
				(there, the top element is a style rule,
				and we start by entering the declaration-block mode).

			<li>
				Handle the an+b production somehow.
				Maybe just define it in property grammar terms?
		</ul>
	</div>

<h4>
Parser Flags</h4>

	<dl>
		<dt>the <dfn>quirks mode</dfn> flag
		<dd>
			This flag is set when the host document is in quirks mode.
			When this is set,
			the parser allows <a href="#consume-a-primitive-with-the-hashless-co">hash colors without the # character</a>
			and <a href="#consume-a-primitive-with-the-unitless-le">pixel lengths without the 'px' unit</a>
			in some circumstances.
	</dl>

<h4>
Definitions</h4>

	<dl>
		<dt><dfn>current input token</dfn>
		<dd>
			The token currently being operated on, from the list of tokens produced by the tokenizer.

		<dt><dfn>next input token</dfn>
		<dd>
			The token following the <i>current input token</i> in the list of tokens produced by the tokenizer.
			If there isn't a token following the <i>current input token</i>,
			the <i>next input token</i> is an EOF token.

		<dt><dfn>reconsume the current input token</dfn>
		<dd>
			Push the current input token back onto the list of tokens produced by the tokenizer,
			so that the next time a mode instructs you to consume the next input token,
			it will instead reconsume the current input token.

		<dt><dfn>stack of open rules</dfn>
		<dd>
			A stack of rules.  
			This stack always contains the stylesheet object at the bottom of the stack, 
			gains additional rules as block are opened,
			and loses them when blocks are closed.

		<dt><dfn>current rule</dfn>
		<dd>
			The topmost rule in the <i>stack of open rules</i>.

		<dt><dfn>current declaration</dfn>
		<dd>
			The declaration currently being built.
			There may or may not be a current declaration at any given time,
			but there is never more than one.

		<dt><dfn>rule-filled</dfn>
		<dd>
			An at-rule that takes a block,
			and within that block accepts at-rules and/or style rules 
			(which encompasses more than just style rules, such as keyframe rules),
			is called <i>rule-filled</i>.
			Examples of <i>rule-filled</i> at-rules are ''@media'' and ''@keyframes''.

		<dt><dfn>declaration-filled</dfn>
		<dd>
			An at-rule that takes a block,
			and within that block accepts at-rules and/or declarations,
			is called <i>declaration-filled</i>.
			Examples of <i>declaration-filled</i> at-rules are ''@font-face'' and ''@page''.

		<dt><dfn>ASCII case-insensitive</dfn>
		<dd>
			When two strings are to be matched ASCII case-insensitively,
			temporarily convert both of them to ASCII lower-case form
			by adding 32 (0x20) to the value of each codepoint between
			U+0041 LATIN CAPITAL LETTER A (A)
			and U+005A LATIN CAPITAL LETTER Z (Z),
			inclusive,
			and then compare them on a codepoint-by-codepoint basis.

		<dt>declaration that <dfn>can be made important</dfn>
		<dd>
			Declarations that are properties can be made important.
			Declarations that are descriptors cannot be made important.

			<p class='note'>
				Generally, properties are declarations inside of style rules,
				and descriptors are declarations inside of at-rules.
	</dl>

<h4>
<dfn>Top-level mode</dfn></h4>

	<p>
		Consume the <i>next input token</i>.

	<dl>
		<dt>cdo token
		<dt>cdc token
		<dt>whitespace token
		<dd>
			Do nothing.
			Remain in this mode.

		<dt>at-keyword token
		<dd>
			Create an at-rule
			with its name set to the value of the <i>current input token</i>
			and push it onto the <i>stack of open rules</i>.
			Switch to the <i>at-rule-prelude mode</i>.

		<dt>{ token
		<dd>
			This is a <i>parse error</i>.
			<i>Consume a primitive</i>
			and ignore the return value.
			Remain in this state.

		<dt>EOF token
		<dd>
			<i>Finish parsing</i>.

		<dt>anything else
		<dd>
			Create a style rule
			and push it onto the <i>stack of open rules</i>.
			Switch to the <i>selector mode</i>.
			<i>Reconsume the current input token</i>.
	</dl>

<h4>
<dfn>At-rule-prelude mode</dfn></h4>

	<p>
		Consume the <i>next input token</i>.

	<dl>
		<dt>semicolon token
		<dd>
			If the <i>current rule</i> is <i>declaration-filled</i> or <i>rule-filled</i>,
			this is a <i>parse error</i>.
			<i>Discard the current rule</i>.
			<i>Switch to the current rule's content mode.</i>

			<p>
				Otherwise,
				<i>pop the current rule</i>.
				<i>Switch to the current rule's content mode.</i>

		<dt>{ token
		<dd>
			If the <i>current rule</i> is <i>rule-filled</i>,
			switch to the <i>rule-block mode</i>.

			<p>
				Otherwise,
				if the <i>current rule</i> is <i>declaration-filled</i>,
				switch to the <i>declaration-block mode</i>.

			<p>
				Otherwise, this is a <i>parse error</i>.
				<i>Discard the current rule</i>.
				<i>Consume a primitive</i>
				and ignore the return value.
				<i>Switch to the current rule's content mode</i>.

		<dt>} token
		<dd>
			If the <i>stack of open rules</i> has three or more items on it,
			<i>pop the current rule</i>.
			<i>Switch to the current rule's content mode</i>.

			<p>
				Otherwise, this is a <i>parse error</i>.
				<i>Discard the current rule</i>.
				Switch to the <i>next-block-or-statement error mode</i>.


		<dt>EOF token
		<dd>
			<i>Finish parsing</i>.

		<dt>anything else
		<dd>
			<i>Consume a primitive</i>
			and append the returned value 
			to the prelude of the <i>current rule</i>.
			Remain in this mode.
	</dl>


<h4>
<dfn>Rule-block mode</dfn></h4>

	<p>Consume the <i>next input token</i>.

	<dl>
		<dt>whitespace token
		<dd>
			Do nothing.
			Remain in this mode.

		<dt>{ token
		<dd>
			This is a <i>parse error</i>.
			<i>Consume a primitive</i>
			and ignore the return value.
			Remain in this state.
			
		<dt>} token
		<dd>
			<i>Pop the current rule</i>.
			<i>Switch to the current rule's content mode</i>.

		<dt>at-keyword token
		<dd>
			Create an at-rule
			with its name set to the value of the <i>current input token</i>
			and push it onto the <i>stack of open rules</i>.
			Switch to the <i>at-rule-prelude mode</i>.

		<dt>EOF token
		<dd>
			<i>Finish parsing</i>.

		<dt>anything else
		<dd>
			Create a style rule
			and push it onto the <i>stack of open rules</i>.
			Switch to the <i>selector mode</i>.
			<i>Reconsume the current input token</i>.

	</dl>


<h4>
<dfn>Selector mode</dfn></h4>

	<p>
		Consume the <i>next input token</i>.

	<dl>
		<dt>{ token
		<dd>
			Switch to the <i>declaration-block mode</i>.

		<dt>} token
		<dd>
			If the <i>stack of open rules</i> has three or more items on it,
			<i>pop the current rule</i>.
			<i>Switch to the current rule's content mode.</i>

			<p>
				Otherwise, this is a <i>parse error</i>.
				<i>Discard the current rule</i>.
				Switch to the <i>next-block error mode</i>.

		<dt>EOF token
		<dd>
			<i>Discard the current rule</i>.
			<i>Finish parsing</i>.

		<dt>anything else
		<dd>
			<i>Consume a primitive</i>
			and append the returned value 
			to the selector of the <i>current rule</i>.
			Remain in this mode.
	</dl>


<h4>
<dfn>Declaration-block mode</dfn></h4>

	<p>
		Consume the <i>next input token</i>.

	<dl>
		<dt>whitespace token
		<dt>semicolon token
		<dd>
			Do nothing.
			Remain in this mode.

		<dt>} token
		<dd>
			<i>Pop the current rule</i>.
			<i>Switch to the current rule's content mode</i>.

		<dt>at-keyword token
		<dd>
			Create an at-rule
			with its name set to the value of the <i>current input token</i>
			and push it onto the <i>stack of open rules</i>.
			Switch to the <i>at-rule-prelude mode</i>.

		<dt>ident token
		<dd>
			Create a declaration
			with its name set to the value of the <i>current input token</i>.
			Set it as the <i>current declaration</i>.
			Switch to the <i>after-declaration-name mode</i>.

		<dt>EOF token
		<dd>
			<i>Finish parsing</i>.

		<dt>anything else
		<dd>
			This is a <i>parse error</i>.
			Unset the <i>current declaration</i>.
			Switch to the <i>next-declaration error mode</i>.
	</dl>


<h4>
<dfn>After-declaration-name mode</dfn></h4>

	<p>
		Consume the <i>next input token</i>.

	<dl>
		<dt>whitespace
		<dd>
			Do nothing.
			Remain in this mode.

		<dt>colon token
		<dd>
			Do nothing.
			Switch to the <i>declaration-value mode</i>.

		<dt>semicolon token
		<dd>
			This is a <i>parse error</i>.
			Unset the <i>current declaration</i>.
			<i>Switch to the current rule's content mode</i>.

		<dt>EOF token
		<dd>
			Unset the <i>current declaration</i>.
			<i>Finish parsing</i>.

		<dt>anything else
		<dd>
			This is a <i>parse error</i>.
			Unset the <i>current declaration</i>.
			Switch to the <i>next-declaration error mode</i>.
	</dl>


<h4>
<dfn>Declaration-value mode</dfn></h4>

	<p>
		Consume the <i>next input token</i>.

	<dl>
		<dt>delim token with a value of "!"
		<dd>
			<i>Switch to the <i>declaration-important mode</i>.

		<dt>semicolon token
		<dd>
			If the <i>current declaration</i> is grammatically valid,
			append it to the value of the <i>current rule</i>.
			Unset the <i>current declaration</i>.
			<i>Switch to the current rule's content mode</i>.

		<dt>} token
		<dd>
			If the <i>current declaration</i> is grammatically valid,
			append it to the value of the <i>current rule</i>.
			Unset the <i>current declaration</i>.
			<i>Pop the current rule</i>.
			<i>Switch to the current rule's content mode</i>.

		<dt>EOF token
		<dd>
			<i>Finish parsing</i>.

		<dt>anything else
		<dd>
			If the <i>quirks mode</i> flag is set,
			and the <i>current declaration's</i> name
			is an <i>ASCII case-insensitive</i> match
			for one of the property names on the <i>hashless color quirk list</i>,
			<i>consume a primitive with the hashless color quirk</i>
			and append the returned value
			to the value of the <i>current declaration</i>.
			Remain in this mode.

			<p>
				Otherwise,
				if the <i>quirks mode</i> flag is set,
				and the <i>current declaration's</i> name
				is an <i>ASCII case-insensitive</i> match
				for one of the property names on the <i>unitless length quirk list</i>,
				<i>consume a primitive with the unitless length quirk</i>
				and append the returned value
				to the value of the <i>current declaration</i>.
				Remain in this mode.

			<p>
				Otherwise,
				<i>consume a primitive</i>
				and append the returned value
				to the value of the <i>current declaration</i>.
				Remain in this mode.
	</dl>


<h4>
<dfn>Declaration-important mode</dfn></h4>

	<p>
		Consume the <i>next input token</i>.

	<dl>
		<dt>whitespace token
		<dd>
			Do nothing.
			Remain in this mode.

		<dt>ident token whose value is an <i>ASCII case-insensitive</i> match for "important"
		<dd>
			If the <i>current declaration</i> is one that <i>can be made important</i>,
			set the important flag of the <i>current declaration</i> to true,
			and switch to the <i>declaration-end mode</i>.

			<p>
				Otherwise, this is a <i>parse error</i>.
				Unset the <i>current declaration</i>.
				Switch to the <i>next-declaration error mode</i>.
				<i>Reconsume the current input token</i>.

		<dt>anything else
		<dd>
			This is a <i>parse error</i>.
			Unset the <i>current declaration</i>.
			Switch to the <i>next-declaration error mode</i>.
			<i>Reconsume the current input token</i>.
	</dl>



<h4>
<dfn>Declaration-end mode</dfn></h4>

	<!--
	This is intended only for times 
	when you've just consumed something that must come at the end of a declaration.
	Currently, that's just !important.
	-->

	<p>
		Consume the <i>next input token</i>.

	<dl>
		<dt>whitespace token
		<dd>
			Do nothing.
			Remain in this mode.

		<dt>semicolon token
		<dd>
			If the <i>current declaration</i> is grammatically valid,
			append it to the value of the <i>current rule</i>.
			Unset the <i>current declaration</i>.
			<i>Switch to the current rule's content mode</i>.

		<dt>} token
		<dd>
			If the <i>current declaration</i> is grammatically valid,
			append it to the value of the <i>current rule</i>.
			Unset the <i>current declaration</i>.
			<i>Pop the current rule.</i>
			<i>Switch to the current rule's content mode</i>.

		<dt>anything else
		<dd>
			This is a <i>parse error</i>.
			Unset the <i>current declaration</i>.
			Switch to the <i>next-declaration error mode</i>.
	</dl>


<h4>
<dfn>Next-block error mode</dfn></h4>
	
	<!-- Make sure you've already discarded the error'd rule before switching here! -->

	<p>
		Consume the <i>next input token</i>.

	<dl>
		<dt>{ token
		<dd>
			<i>Consume a primitive</i>.
			Ignore the return value.
			<i>Switch to the current rule's content mode</i>.

		<dt>EOF token
		<dd>
			<i>Finish parsing</i>.

		<dt>anything else
		<dd>
			<i>Consume a primitive</i>.
			Ignore the return value.
			Remain in this mode.
	</dl>


<h4>
<dfn>Next-declaration error mode</dfn></h4>
	
	<!-- Make sure you've already unset the current declaration before switching here! -->

	<p>
		Consume the <i>next input token</i>.

	<dl>
		<dt>semicolon token
		<dd>
			Do nothing.
			Switch to the <i>declaration-block mode</i>.

		<dt>} token
		<dd>
			Do nothing.
			Switch to the <i>declaration-block mode</i>.
			<i>Reconsume the current input token</i>.

		<dt>EOF token
		<dd>
			<i>Finish parsing</i>.

		<dt>anything else
		<dd>
			<i>Consume a primitive</i>.
			Ignore the return value.
			Remain in this mode.
	</dl>


<h4>
<dfn>Next-block-or-statement error mode</dfn></h4>
	
	<!-- Make sure you've already discarded the error'd rule before switching here! -->

	<p>
		Consume the <i>next input token</i>.

	<dl>
		<dt>semicolon token
		<dd>
			Do nothing.
			<i>Switch to the current rule's content mode</i>.

		<dt>{ token
		<dd>
			<i>Consume a primitive</i>.
			Ignore the return value.
			<i>Switch to the current rule's content mode</i>.

		<dt>EOF token
		<dd>
			<i>Finish parsing</i>.

		<dt>anything else
		<dd>
			<i>Consume a primitive</i>.
			Ignore the return value.
			Remain in this mode.
	</dl>


<h4>
<dfn>Consume a primitive</dfn></h4>

	<p>
		This section describes how to <i>consume a primitive</i>.

	<p>
		If the <i>current input token</i>
		is a {, [, or ( token,
		<i>consume a simple block</i>
		and return it.

	<p>
		Otherwise, if the <i>current input token</i>
		is a function token,
		<i>consume a function</i>
		and return it.

	<p>
		Otherwise, if the <i>current input token</i>
		is an EOF token,
		<i>finish parsing</i>.

	<p>
		Otherwise, return the <i>current input token</i>.

<h4>
<dfn>Consume a primitive with the hashless color quirk</dfn></h4>

	<p>
		This section describes how to <i>consume a primitive with the hashless color quirk</i>.

	<p>
		The <dfn>hashless color quirk list</dfn> contains the following property names:

	<ul>
		<li>'background-color'
		<li>'border-color'
		<li>'border-top-color'
		<li>'border-right-color'
		<li>'border-bottom-color'
		<li>'border-left-color'
		<li>'color'
	</ul>

	<p>
		If the <i>current input token</i> is a number token, 
		let <var>value</var> be the token's representation.
		If the <i>current input token</i> is a dimension token,
		let <var>value</var> be the token's representation followed by the token's unit.
		If the <i>current input token</i> is an ident token,
		let <var>value</var> be the token's value.

	<p>
		If <var>value</var> has a length of 3 or 6 and is composed solely of <i>hex digits</i>,
		create a hash token with its value set to the <var>value</var>
		and return it.

	<p>
		Otherwise,
		<i>consume a primitive</i>
		and return the returned value.

<h4>
<dfn>Consume a primitive with the unitless length quirk</dfn></h4>

	<p>
		This section describes how to <i>consume a primitive with the unitless length quirk</i>.

	<p>
		The <dfn>unitless length quirk list</dfn> contains the following property names:

	<ul>
		<li>'border-top-width'
		<li>'border-right-width'
		<li>'border-bottom-width'
		<li>'border-left-width'
		<li>'border-width'
		<li>'bottom'
		<li>'font-size'
		<li>'height'
		<li>'left'
		<li>'letter-spacing'
		<li>'margin'
		<li>'margin-right'
		<li>'margin-left'
		<li>'margin-top'
		<li>'margin-bottom'
		<li>'padding'
		<li>'padding-top'
		<li>'padding-right'
		<li>'padding-bottom'
		<li>'padding-left'
		<li>'right'
		<li>'top'
		<li>'width'
		<li>'word-spacing'
	</ul>

	<p>
		If the <i>current input token</i> is a number token,
		create a dimension token with its value and representation set to the token's value and representation,
		and its unit set to "px".
		Return the dimension token.

	<p>
		Otherwise,
		<i>consume a primitive</i>
		and return the returned value.



<h4>
<dfn>Consume a simple block</dfn></h4>

	<p>
		This section describes how to <i>consume a simple block</i>.

	<p>
		The <dfn>ending token</dfn> is the mirror variant of the <i>current input token</i>.
		(E.g. if it was called with [, the <i>ending token</i> is ].)

	<p>
		Create a simple block with its associated token set to the <i>current input token</i>.
		This is the <dfn>current block</dfn>.

	<p>
		Repeatedly consume the <i>next input token</i> and process it as follows:

	<dl>
		<dt>comment token
		<dd>
			Do nothing.

		<dt>EOF token
		<dt><i>ending token</i>
		<dd>
			Return the block.

		<dt>anything else
		<dd>
			<i>Consume a primitive</i>
			and append the returned value
			to the value of the <i>current block</i>.
	</dl>


<h4>
<dfn>Consume a function</dfn></h4>

	<p>
		This section describes how to <i>consume a function</i>.

	<p>
		Create a function with a name equal to the value of the <i>current input token</i>.
		Create an argument, 
		called the <dfn>current argument</dfn>,
		which is initially empty.

	<p>
		Repeatedly consume the <i>next input token</i> and process it as follows:

	<dl>
		<dt>comment token
		<dd>
			Do nothing.

		<dt>EOF token
		<dt>) token
		<dd>
			Append the <i>current argument</i> to the function's argument list.
			Return the function.

		<dt>delim token with the value ","
		<dd>
			Append the <i>current argument</i> to the function's argument list.
			Create a new <i>current argument</i> which is initially empty.

		<dt>number token
		<dd>
			If the <i>quirks mode</i> flag is set,
			and the function's name is as <i>ASCII case-insensitive</i> match with "rect",
			<i>consume a primitive with the unitless length quirk</i>
			and append the returned value
			to the value of the <i>current argument</i>.

			<p>
				Otherwise,
				<i>consume a primitive</i>
				and append the returned value
				to the value of the <i>current argument</i>.

		<dt>anything else
		<dd>
			<i>Consume a primitive</i>
			and append the returned value
			to the value of the <i>current argument</i>.
	</dl>


<h4>
<dfn>Switch to the current rule's content mode</dfn></h4>

	<p>
		This section describes how to <i>switch to the current rule's content mode</i>.
		It is invoked whenever a declaration or rule has been successfully completed,
		or when an error has finished recovery.

	<p>
		If the <i>current rule</i> is a style rule or a <i>declaration-filled</i> at-rule,
		switch to the <i>declaration-block mode</i>.

	<p>
		If the <i>current rule</i> is a <i>rule-filled</i> at-rule,
		switch to the <i>rule-block mode</i>.

	<p>
		If the <i>current rule</i> is a stylesheet,
		switch to the <i>top-level mode</i>.


<h4>
<dfn>Pop the current rule</dfn></h4>

	<p>
		This section describes how to <i>pop the current rule</i>.
		It is invoked whenever a rule is "finished" parsing
		and can be made part of its parent rule.

	<p>
		First, validate the <i>current rule</i>.
		If the rule does not match its required grammar,
		or if it's not valid in its current context,
		discard it.

	<p>
		Otherwise, pop the <i>current rule</i> from the <i>stack of open rules</i>
		and append it to the value of the new <i>current rule</i>.


<h4>
<dfn>Discard the current rule</dfn></h4>

	<p>
		This section describes how to <i>discard the current rule</i>.
		It is invoked whenever the parser determines that the rule it's currently parsing isn't valid,
		and thus must not be included in the parsed stylesheet.

	<p>
		Pop the <i>current rule</i> from the <i>stack of open rules</i>.
		Don't do anything with it.


<h4>
<dfn>Finish parsing</dfn></h4>

	<p>
		This section describes how to <i>finish parsing</i>.
		It is invoked whenever an EOF token is encountered.

	<p>
		If there is a <i>current declaration</i>,
		and it is grammatically valid,
		append it to the value of the <i>current rule</i>.

	<p>
		While there's more than one rule on the <i>stack of open rules</i>,
		<i>pop the current rule</i>.

	<p>
		Finally, return the <i>current rule</i> as the result of parsing.


<h3>
Changes from CSS 2.1 Core Grammar</h3>

	<p>
		<em>This section is non-normative.</em>

	<p class='issue'>
		Here are the changes that I know that I've made to the Core Grammar of 2.1.
		If there are changes not present here, 
		please let me know
		as they may be unintentional.

	<p class='issue'>
		Note that the point of this spec is to match reality;
		changes from CSS2.1&apos;s Core Grammar are nearly always because the Core Grammar specified something that doesn't match actual browser behavior,
		or left something unspecified.
		If some detail doesn't match browsers,
		please let me know
		as it's almost certainly unintentional.

	<ol>
		<li>
			The handling of some miscellanous "special" tokens
			(like an unmatched } token)
			showing up in various places in the grammar
			has been specified with some reasonable behavior shown by at least one browser.
			Previously, stylesheets with those tokens in those places just didn't match the stylesheet grammar at all,
			so their handling was totally undefined.

		<li>
			Quirks mode parsing differences are now officially recognized in the parser.
	</ol>


<h2>Serialization</h2>

	<p>
		This specification does not define how to serialize CSS in general,
		leaving that task to the CSSOM and individual feature specifications.
		However, there is one important facet that must be specified here regarding comments,
		to ensure accurate "round-tripping" of data from text to CSS objects and back.

	<p>
		The tokenizer described in this specification does not produce tokens for comments,
		or otherwise preserve them in any way.
		Implementations may preserve the contents of comments and their location in the token stream.
		If they do, this preserved information must have no effect on the parsing step,
		but must be serialized in its position as
		"/*"
		followed by its contents
		followed by "*/".

	<p>
		If the implementation does not preserve comments,
		it must insert the text "/**/" between the serialization of adjacent tokens
		when the two tokens are of the following pairs:

	<ul>
		<li>
			hash or at-rule token followed by a number, ident, dimension, or a function token;

		<li>
			number, ident, and dimension tokens in any combination;

		<li>
			number, ident, or dimension token followed by a function token;

		<li>
			ident token followed by a ( token.
	</ul>

	<p class='note'>
		The preceding pairs of tokens can only be adjacent due to comments in the original text,
		so the above rule reinserts the minimum number of comments into the serialized text to ensure an accurate round-trip.




<!--
    
TTTTTTTTTTTTTTTTTTTTTTTHHHHHHHHH     HHHHHHHHHEEEEEEEEEEEEEEEEEEEEEE
T:::::::::::::::::::::TH:::::::H     H:::::::HE::::::::::::::::::::E
T:::::::::::::::::::::TH:::::::H     H:::::::HE::::::::::::::::::::E
T:::::TT:::::::TT:::::THH::::::H     H::::::HHEE::::::EEEEEEEEE::::E
TTTTTT  T:::::T  TTTTTT  H:::::H     H:::::H    E:::::E       EEEEEE
        T:::::T          H:::::H     H:::::H    E:::::E             
        T:::::T          H::::::HHHHH::::::H    E::::::EEEEEEEEEE   
        T:::::T          H:::::::::::::::::H    E:::::::::::::::E   
        T:::::T          H:::::::::::::::::H    E:::::::::::::::E   
        T:::::T          H::::::HHHHH::::::H    E::::::EEEEEEEEEE   
        T:::::T          H:::::H     H:::::H    E:::::E             
        T:::::T          H:::::H     H:::::H    E:::::E       EEEEEE
      TT:::::::TT      HH::::::H     H::::::HHEE::::::EEEEEEEE:::::E
      T:::::::::T      H:::::::H     H:::::::HE::::::::::::::::::::E
      T:::::::::T      H:::::::H     H:::::::HE::::::::::::::::::::E
      TTTTTTTTTTT      HHHHHHHHH     HHHHHHHHHEEEEEEEEEEEEEEEEEEEEEE
                                                                    
                                                                    
                                                                   
EEEEEEEEEEEEEEEEEEEEEENNNNNNNN        NNNNNNNNDDDDDDDDDDDDD        
E::::::::::::::::::::EN:::::::N       N::::::ND::::::::::::DDD     
E::::::::::::::::::::EN::::::::N      N::::::ND:::::::::::::::DD   
EE::::::EEEEEEEEE::::EN:::::::::N     N::::::NDDD:::::DDDDD:::::D  
  E:::::E       EEEEEEN::::::::::N    N::::::N  D:::::D    D:::::D 
  E:::::E             N:::::::::::N   N::::::N  D:::::D     D:::::D
  E::::::EEEEEEEEEE   N:::::::N::::N  N::::::N  D:::::D     D:::::D
  E:::::::::::::::E   N::::::N N::::N N::::::N  D:::::D     D:::::D
  E:::::::::::::::E   N::::::N  N::::N:::::::N  D:::::D     D:::::D
  E::::::EEEEEEEEEE   N::::::N   N:::::::::::N  D:::::D     D:::::D
  E:::::E             N::::::N    N::::::::::N  D:::::D     D:::::D
  E:::::E       EEEEEEN::::::N     N:::::::::N  D:::::D    D:::::D 
EE::::::EEEEEEEE:::::EN::::::N      N::::::::NDDD:::::DDDDD:::::D  
E::::::::::::::::::::EN::::::N       N:::::::ND:::::::::::::::DD   
E::::::::::::::::::::EN::::::N        N::::::ND::::::::::::DDD     
EEEEEEEEEEEEEEEEEEEEEENNNNNNNN         NNNNNNNDDDDDDDDDDDDD        
-->

<h2 id="conformance">
Conformance</h2>

<h3 id="conventions">
Document conventions</h3>

	<p>Conformance requirements are expressed with a combination of
	descriptive assertions and RFC 2119 terminology. The key words “MUST”,
	“MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”,
	“RECOMMENDED”, “MAY”, and “OPTIONAL” in the normative parts of this
	document are to be interpreted as described in RFC 2119.
	However, for readability, these words do not appear in all uppercase
	letters in this specification.
	
	<p>All of the text of this specification is normative except sections
	explicitly marked as non-normative, examples, and notes. [[!RFC2119]]</p>
	
	<p>Examples in this specification are introduced with the words “for example”
	or are set apart from the normative text with <code>class="example"</code>,
	like this:
	
	<div class="example">
		<p>This is an example of an informative example.</p>
	</div>
	
	<p>Informative notes begin with the word “Note” and are set apart from the
	normative text with <code>class="note"</code>, like this:
	
	<p class="note">Note, this is an informative note.</p>

<h3 id="conformance-classes">
Conformance classes</h3>

	<p>Conformance to CSS Syntax Module Level 3 is defined for three conformance classes:

	<dl>
		<dt><dfn title="style sheet!!as conformance class">style sheet</dfn>
			<dd>A <a href="http://www.w3.org/TR/CSS21/conform.html#style-sheet">CSS
			style sheet</a>.
		<dt><dfn>renderer</dfn>
			<dd>A <a href="http://www.w3.org/TR/CSS21/conform.html#user-agent">UA</a>
			that interprets the semantics of a style sheet and renders
			documents that use them.
		<dt><dfn id="authoring-tool">authoring tool</dfn>
			<dd>A <a href="http://www.w3.org/TR/CSS21/conform.html#user-agent">UA</a>
			that writes a style sheet.
	</dl>
	
	<p>A style sheet is conformant to CSS Syntax Module Level 3
	if it is syntactically valid according to this module.
	
	<p>A renderer is conformant to CSS Syntax Module Level 3
	if it parses a stylesheet according to this module.
	
	<p>An authoring tool is conformant to CSS Syntax Module Level 3
	if it writes style sheets that are syntactically valid according to this module.

<h2 class=no-num id="acknowledgments">
Acknowledgments</h2>

	<p>
		Thanks for feedback and contributions from
		David Baron,
		呂康豪 (Kang-Hao Lu),
		and Simon Sapin.


<h2 class=no-num id="references">
References</h2>

<h3 class="no-num" id="normative-references">
Normative references</h3>
<!--normative-->

<h3 class="no-num" id="other-references">
Other references</h3>
<!--informative-->

<h2 class="no-num" id="index">
Index</h2>
<!--index-->

<h2 class="no-num" id="property-index">
Property index</h2>
<!-- properties -->

</body>
</html>
<!-- Keep this comment at the end of the file
Local variables:
mode: sgml
sgml-declaration:"~/SGML/HTML4.decl"
sgml-default-doctype-name:"html"
sgml-minimize-attributes:t
sgml-nofill-elements:("pre" "style" "br")
sgml-live-element-indicator:t
sgml-omittag:nil
sgml-shorttag:nil
sgml-namecase-general:t
sgml-general-insert-case:lower
sgml-always-quote-attributes:t
sgml-indent-step:nil
sgml-indent-data:t
sgml-parent-document:nil
sgml-exposed-tags:nil
sgml-local-catalogs:nil
sgml-local-ecat-files:nil
End:
-->
 
