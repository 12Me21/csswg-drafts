<!DOCTYPE html public '-//W3C//DTD HTML 4.01//EN'
	'http://www.w3.org/TR/html4/strict.dtd'>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html">
<title>CSS Cascading and Inheritance Level 3</title>

<link href="../default.css" rel="stylesheet" type="text/css">
<link href="http://www.w3.org/StyleSheets/TR/W3C-[STATUS].css" rel=stylesheet type="text/css">

<style>
table { border-collapse: collapse; border: 1px solid black }
th, td { border: 1px solid black; padding: 0.2em; text-align: left }
.issue { color: red }
</style>
</head>

<body>

<div class="head">

<!--logo-->

<h1>CSS Cascading and Inheritance Level 3</h1>

<h2 class="no-num no-toc">[LONGSTATUS] [DATE]</h2>

<dl>
	<dt>This version:
		<dd><a
			href="[VERSION]">[VERSION]</a>
	<dt>Latest version:
		<dd><a 
			href="http://www.w3.org/TR/css3-cascade">http://www.w3.org/TR/css3-cascade</a>
	<dt>Editor's draft:
		<dd><a href="http://dev.w3.org/csswg/[SHORTNAME]/">http://dev.w3.org/csswg/[SHORTNAME]/</var></a>
	<dt>Previous version:
		<dd><a href="http://www.w3.org/TR/2005/WD-css3-cascade-20051215">http://www.w3.org/TR/2005/WD-css3-cascade-20051215</a>
	<dt>Editor:
		<dd>H&aring;kon Wium Lie, Opera Software, howcome@opera.com
</dl>

<!--begin-copyright-->
<p>[Here will be included the file "../copyright.inc"]</p>
<!--end-copyright-->

<hr title="Separator for header">
</div>

<h2 class="no-num no-toc">Abstract</h2>

	<p>
		This CSS3 module describes how to collate style rules 
		and assign values to all properties on all elements. 
		Values either come from style sheets or the property's initial value. 
		By way of cascading and inheritance, 
		values are propagated to all properties on all elements.

<h2 class="no-num no-toc">
Status of this document</h2>
<!--status-->

<h2 class="no-num no-toc">
Table of contents</h2>
<!--toc-->

<hr>


<h2>Introduction</h2>

	<p>
		One of the fundamental design principles of CSS is <em>cascading</em>, 
		which allows several style sheets to influence the presentation of a document. 
		When different declarations try to set a value for the same element/property combination, 
		the conflicts must somehow be resolved.

	<p>
		The opposite problem arises when no declarations try to set a the value for an element/property combination. 
		In this case, a value must be found by way of <em>inheritance</em> 
		or by looking at the property's <em>initial value</em>.

	<p>
		The rules for finding the specified value for all properties on all elements are described in this specification.
		The rules for finding the specified values in the page context and the margin boxes are described in [[CSS3PAGE]].

<h2 id="combine">
	Combining Style Sheets</h2>

<h3 id="at-import">
Importing style sheets</h3>

	<p>
		The <dfn>''@import''</dfn> rule allows users to import style rules from other style sheets.  
		Any ''@import'' rules must follow all ''@charset'' rules 
		and precede all other at-rules and rule sets in a style sheet.  
		The ''@import'' keyword must be followed by the URI of the style sheet to include. 
		A string is also allowed; 
		it will be interpreted as if it had url(&hellip;) around it.

	<div class="example">
		<p>
			The following lines are equivalent in meaning 
			and illustrate both '@import' syntaxes 
			(one with ''url()'' and one with a bare string):

		<pre><!--
		-->@import "mystyle.css";&#xa;<!--
		-->@import url("mystyle.css");</pre>
	</div>

	<p>
		So that user agents can avoid retrieving resources for unsupported media types, 
		authors may specify media-dependent ''@import'' rules. 
		These <dfn title="conditional import|media-dependent import">conditional imports</dfn> specify comma-separated &ldquo;media queries&rdquo; after the URI.

	<div class=example>
		<p>
			The following rules illustrate how ''@import'' rules can be made media-dependent:

		<pre><!--
		-->@import url("fineprint.css") print;&#xa;<!--
		-->@import url("bluish.css") projection, tv;&#xa;<!--
		-->@import url("narrow.css") handheld and (max-width: 400px);</pre>
	</div>

	<p>
		The full syntax of the expressions after the URL 
		is defined by the Media Queries specification [[!MEDIAQ]].

	<p>
		In the absence of any media queries, 
		the import is unconditional. 
		Specifying ''all'' for the medium has the same effect.


<h2 id="cascade-and-inheritance">
Cascading and Inheritance</h2>

	<p>
		The cascading and inheritance process
		takes a set of declarations as input,
		and outputs a specified value for all properties on all elements.


<h3 id='filter-declarations'>
Filtering Declarations</h3>

	<p>
		In order to find the specified values, 
		implementations must first identify all declarations that apply to each element.
		A declaration applies to an element if:

	<ul>
		<li>
			It belongs to a stylesheet that currently applies to this document.

		<li>
			It is not qualified by a conditional rule [[!CSS3-CONDITIONAL]] with a false condition.

		<li>
			It belongs to a ruleset whose selector matches the element. [[!SELECT]]
	</ul>

	<p>
		The remaining declarations form, 
		for each property on each element,
		an unordered list of values.
		The next section,
		the cascade process,
		orders these lists.

	<p class='issue'>
		Find some appropriate term to DFN for these lists.


<h3 id='cascade-algorithm'>
The Cascade Algorithm</h3>

	<p>
		The cascade algorithm takes an unordered list of declarations
		for a given property on an element
		and sorts it by precedence as determined below.

	<p>
		User agents must sort declarations according to the following criteria, 
		in descending order of importance:

	<dl>
		<dt>Origin
		<dd>
			The origin of a declaration is based on where it comes from
			and whether or not it is declared ''!important''.
			The possible origins are, in ascending order:

			<ol>
				<li>Normal user agent declarations
				<li>Normal user declarations
				<li>Normal author declarations
				<li>Normal override declarations [[!DOM-LEVEL-2-STYLE]]
				<li>Animation declarations [[!CSS3-ANIMATIONS]]
				<li>Important author declarations
				<li>Important override declarations [[!DOM-LEVEL-2-STYLE]]
				<li>Important user declarations
				<li>Important user agent declarations
				<li>Transition declarations [[!CSS3-TRANSITIONS]]
			</ol>

		<dt>Specificity
		<dd>
			The <a href="http://www.w3.org/TR/selectors/#specificity">Selectors module</a> [[!SELECT]] and the <a href="http://www.w3.org/TR/css-style-attr/#interpret">Style Attributes module</a> [[CSS-STYLE-ATTR]] describe how to compute the specificity. 
			The declaration with the highest specificity wins.

		<dt>Order of appearance.
		<dd>
			Rules from imported style sheets are treated as if their stylesheets were substituted in place of the ''@import'' rule.
			Stylesheets independently linked by the originating document are treated as if they were concatenated in linking order,
			as determined by the host document language.
			The last declaration wins. 
	</dl>

	<p>
		The output of the cascade
		is a (potentially empty) sorted list of declarations for each property on each element.

<h3 id="inheritance">
Inheritance</h3>

	<p>
		Inheritance is a way of propagating property values from parent elements to their children. 
		Inheritance means that the specified value of a given element/property is copied 
		from the parent element's computed value for the same property.

	<p>
		The root element, 
		which has no parent element, 
		inherits the initial value of the property. 

	<!--
	<p>The page context inherits from the initial value of the property. Margin boxes inherit from the page context.
	-->

	<p>
		Pseudo-elements inherit according to a fictional tag sequence described for each pseudo-element [[!SELECT]].


	<p>
		Some properties are said to be <dfn title="inheritance">inherited</dfn>. 
		This means that, 
		unless a value is specified for the element/property combination, 
		the value will be determined by inheritance.

	<p>
		All properties accept the ''inherit'' value 
		which explicitly specifies that the value will be determined by inheritance. 
		The ''inherit'' value can be used to strengthen inherited values in the cascade, 
		and it can also be used on properties that are not normally inherited. 
		If the ''inherit'' value is set on the root element, 
		the property is assigned its initial value.


<h3 id="initial">
Initial value</h3>

	<p>
		Each property has an <dfn>initial value</dfn> 
		which becomes the specified value when cascading and inheritance does not yield a value. 
		Note, the initial value can be explicitly specified with the ''initial''keyword which all properties accept. [[CSS3VALUE]]

<!--
David's proposal for ''default'' value:
	http://lists.w3.org/Archives/Member/w3c-css-wg/2002OctDec/0191.html
-->

<h3 id="computing-weight">
Computing weight</h3>

	<p>
		In order to sort declarations in the cascading process, 
		the weight of a declaration must be known. 
		In CSS3, the weight of a declaration is based on the origin of the declaration 
		and its marked level of importance.

	<p>
		CSS style sheets may have three different origins: 
		author, user, and user agent (UA).

	<dl>
		<dt>Author 
		<dd>
			The author specifies style sheets for a source document according to the conventions of the document language. 
			For instance, in HTML, style sheets may be included in the document or linked externally.

		<dt>User 
		<dd>
			The user may be able to specify style information for a particular document. 
			For example, the user may specify a file that contains a style sheet 
			or the user agent may provide an interface that generates a user style sheet 
			(or behave as if it did).

		<dt>User agent
		<dd>
			<em>Conforming user agents</em> [add ref] must apply a "default style sheet" 
			(or behave as if they did) 
			prior to all other style sheets for a document. 
			A user agent's default style sheet 
			should present the elements of the document language 
			in ways that satisfy general presentation expectations for the document language 
			(e.g., for visual browsers, the EM element in HTML is presented using an italic font). 
			See "Appendix D. Default style sheet for HTML 4" [[CSS21]] 
			for a recommended default style sheet for HTML 4.0 documents.
	</dl>

	<p>
		Each CSS declaration can have two levels of importance: 
		normal (which is default) 
		and important (which must be marked). 
		The CSS3 syntax module [[!CSS3SYN]] describes how declarations are marked as important.

	<p>
		The weight of style sheets from the various origins, 
		in ascending order, 
		is:

	<ol>
		<li>User agent style sheets
		<li>User normal style sheets
		<li>Author normal style sheets
		<li>Author important style sheets
		<li>User important style sheets
	</ol>

	<p>
		By default, this strategy gives author declarations more weight than those of the user. 
		It is therefore important that the UA give the user the ability to turn off the influence of a certain style sheet, 
		e.g., through a pull-down menu.

	<p>
		Declarations in imported style sheets have lower weight 
		than declarations in the style sheet from where they are imported. 
		Imported style sheets can themselves import and override other style sheets, recursively, 
		and the same precedence declarations apply.

	<p>
		If the user agent chooses to honor presentational hints from other sources than style sheets, 
		these hints must be given the same weight as the user agent's default style sheet. 
		This rule is intended for presentational hints in HTML.

	<p class="issue">
		Fix precedence of non-CSS presentation hints to match [[CSS21]]

<h2 id="value-stages">
Stages of Value Computation</h2>

	<p>
		Once a user agent has parsed a document and constructed a document tree, 
		it must assign, 
		for every element in the tree, 
		a value to every property that applies to the target media type.

	<p>
		The final value of a CSS3 property for a given element is the result of a four-step calculation:

	<ul>
		<li>
			First, cascading and inheritance yields the <i>specified value</i>.

		<li>
			Second, relative values are computed into absolute values as far as possible without formatting the document,
			thereby yielding the <i>computed value</i>.

		<li>
			The computed value is transformed into the <i>used value</i> in the formatting process.

		<li>
			Finally, the computed value is transformed to the <i>actual value</i> 
			based on constraints of local environment.
	</ul>

<h3 id="specified">
Finding the <dfn>specified value</dfn></h3>

	<p>
		The <dfn>specified value</dfn> is the output of the <a href="http://www.w3.org/TR/CSS21/cascade.html">cascading and inheritance process</a>. [[!CSS21]] [[CSS3CASCADE]]

	<p class="note">
		If the output of the cascade is ''inherit'' or ''initial'', 
		the specified value contains the inherited or initial value, respectively. 
		See examples (d) and (e) in the <a href="#stages-examples">table below</a>.

	<p>
		The cascading and inheritance process guarantees that a <i>specified value</i> exists for every property on every element.

<h3 id="computed">
Finding the computed value</h3>

	<p>
		A <i>specified value</i> can be either absolute (i.e., not relative to another value, as in 'red' or '2mm') or relative (i.e., relative to another value, as in 'auto', '2em').

	<p>
		For absolute values, 
		no extra processing is needed to find the computed value. 
		For relative values, on the other hand, 
		computation is necessary to find the computed value: 
		percentages must be multiplied by a reference value 
		(each property defines which value that is), 
		values with relative units 
		(em, ex, vh, vw) 
		must be made absolute by multiplying with the appropriate reference size, 
		certain keywords 
		(e.g., 'smaller', 'bolder') 
		must be replaced according to their definitions, 
		and valid relative URLs must be resolved to become absolute. 
		See examples (f), (g) and (h) in the <a href="#stages-examples">table below</a>.

	<p>
		The <dfn>computed value</dfn> is the result of resolving the <i>specified value</i> 
		insofar as possible without formatting the document, 
		as defined in the "Computed value" line of the property definition tables.

	<p class="note">
		The <i>computed value</i> is the value that is transferred from parent to child during inheritance.

	<p>
		The computed value exists even when the property does not apply 
		(as defined by the 'Applies To' line). 
		However, some properties may define the computed value of a property for an element 
		to depend on whether the property applies to that element.

<h3 id='used'>
Finding the <dfn>used value</dfn></h3>

	<p>
		<i>Computed values</i> are processed as far as possible without formatting the document. 
		Some values, however, can only be determined when the document is being laid out. 
		For example, if the width of an element is set to be a certain percentage of its containing block, 
		the width cannot be determined until the width of the containing block has been determined. 
		The <dfn>used value</dfn> is the result of taking the <i>computed value</i> 
		and resolving any remaining dependencies into an absolute value.

<h3 id="actual">
Finding the actual value</h3>

	<p>
		A <i>used value</i> is in principle ready to be used, 
		but a user agent may not be able to make use of the value in a given environment. 
		For example, a user agent may only be able to render borders with integer pixel widths 
		and may therefore have to approximate the computed width. 
		Also, the font size of an element may need adjustment based on the availability of fonts 
		or the value of the 'font-size-adjust' property. 
		The <dfn>actual value</dfn> is the used value after any such approximations have been made.

	<p class="note">
		By probing the actual values of elements, 
		much can be learned about how the document is laid out. 
		However, not all information is recorded in the actual values. 
		For example, the actual value of the 'page-break-after' property 
		does not reflect whether there is a page break or not after the element. 
		Similarly, the actual value of 'orphans' 
		does not reflect how many orphan lines there is in a certain element. 
		See examples (j) and (k) in the <a href="#stages-examples">table below</a>.

<h3 id="stages-examples">
Examples</h3>

	<table class="data">
		<thead>
			<tr>
				<th>
				<th>Property
				<th>Winning declaration
				<!--  <th>Cascaded value  -->
				<th>Specified value
				<th>Computed value
				<th>Used value
				<th>Actual value
		<tbody>
			<tr>
				<td>(a)
				<th>'text-align'
				<td><code class="declaration">text-align: left</code>
				<!--  <td>''left''-->
				<td>''left''
				<td>''left''
				<td>''left''
				<td>''left''
			<tr>
				<td>(b)
				<th>'border-top-width', 'border-right-width', 'border-bottom-width', 'border-left-width'
				<td><code class="declaration">border-width: inherit</code>
				<!--  <td>''inherit'' -->
				<td class="say">''4.2px''
				<td>''4.2px''
				<td>''4.2px''
				<td>''4px''
			<tr>
				<td>(c)
				<th>'width'
				<td><small>(none)</small>
				<!--  <td><small>(none)</small>-->
				<td>''auto'' <small>(initial&nbsp;value)</small>
				<td>''auto''
				<td>''120px''
				<td>''120px''
			<tr>
				<td>(d)
				<th>'list-style-position'
				<td><code class="declaration">list-style-position: inherit</code>
				<!--  <td>''inherit'' -->
				<td class="say">''inside''
				<td>''inside''
				<td>''inside''
				<td>''inside''
			<tr>
				<td>(e)
				<th>'list-style-position'
				<td><code class="declaration">list-style-position: initial</code>
				<!--  <td>''initial''-->
				<td>''outside'' <small>(initial&nbsp;value)</small>
				<td>''outside''
				<td>''outside''
				<td>''outside''
			<tr>
				<td>(f)
				<th>'font-size'
				<td><code class="declaration">font-size: 1.2em</code>
				<!--  <td>''1.2em''-->
				<td>''1.2em''
				<td class="say">''14.1px''
				<td>''14.1px''
				<td>''14px''
			<tr>
				<td>(g)
				<th>'width'
				<td><code class="declaration">width: 80%</code>
				<!--  <td>''80%''-->
				<td>''80%''
				<td>''80%''
				<td class="say">''354.2px''
				<td>''354px''
			<tr>
				<td>(h)
				<th>'width'
				<td><code class="declaration">width: auto</code>
				<!--  <td>''auto''-->
				<td>''auto''
				<td>''auto''
				<td class="say">''134px''
				<td>''134px''
			<tr>
				<td>(i)
				<th>'height'
				<td><code class="declaration">height: auto</code>
				<!--  <td>''auto''-->
				<td>''auto''
				<td>''auto''
				<td class="say">''176px''
				<td>''176px''
			<tr>
				<td>(j)
				<th>'page-break-after'
				<td><small>(none)</small>
				<!--  <td><small>(none)</small>-->
				<td>''auto'' <small>(initial&nbsp;value)</small>
				<td>''auto''
				<td>''auto''
				<td>''auto''
			<tr>
				<td>(k)
				<th>'orphans'
				<td><code class="declaration">orphans: 3</code>
				<!--  <td>''3''-->
				<td>''3''
				<td>''3''
				<td>''3''
				<td>''3''
	</table>

<h2>Conformance</h2>

<p>[TBD]

<h2 class="no-num" id="acknowledgments">Acknowledgments</h2>

<p>David Baron contributed to this specification.


<h2 class=no-num id='references'>References</h2>

<h3 class="no-num" id="normative-references">Normative references</h3>
<!--normative-->

<h3 class="no-num" id="other-references">Other references</h3>
<!--informative-->

<h2 class="no-num" id="index">Index</h2>
<!--index-->

<h2 class="no-num" id="property-index">Property index</h2>
<!-- properties -->


</body>
</html>
