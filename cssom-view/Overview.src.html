<!doctype html>
<html lang="en-US">
 <head>
  <meta charset=utf-8>
  <title>CSSOM View Module</title>
  <style>
   .idl { border:solid thin; background:#eee; color:#000; padding:0.5em }
   .idl :link, .idl :visited { color:inherit; background:transparent }
   dfn { font-weight:bold; font-style:normal }
   .example { margin-left:1em; padding-left:1em; border-left:double; color:#222; background:#fcfcfc }
   .example table code { color:inherit }
   td, th { padding:.1em }
   .note {  margin-left:2em; color:green; font-style:italic; font-weight:bold }
   p.note::before { content:"Note: " }
   .XXX { padding:.5em; border:solid red }
   p.XXX::before { content:"Issue: " }
   dl.switch { padding-left:2em }
   dl.switch > dt { text-indent:-1.5em }
   dl.switch > dt:before { content:'\21AA'; padding:0 0.5em 0 0; display:inline-block; width:1em; text-align:right; line-height:0.5em }
   code { color:orangered }
   code :link, code :visited { color:inherit }
  </style>
  <link rel="stylesheet" href="https://www.w3.org/StyleSheets/TR/W3C-[STATUS]">
 </head>
 <body class="draft">
<div class="head">
 <!--logo-->

 <h1>CSSOM View Module</h1>

 <h2 class="no-num no-toc" id="w3c-doctype">[LONGSTATUS] [DATE: 3 August 2002]</h2>

 <dl>

  <dt>This Version:</dt>
  <dd class=dontpublish><a href="http://dev.w3.org/csswg/cssom-view/">http://dev.w3.org/csswg/cssom-view/</a></dd>
  <dd class=publish><a href="[VERSION]">[VERSION]</a></dd>

  <dt class=dontpublish>Participate:</dt>
  <dd class=dontpublish><a href="mailto:www-style@w3.org?subject==%5Bcssom%5D%20">www-style@w3.org</a>
  (<a href="http://lists.w3.org/Archives/Public/www-style/">archives</a>)
  <dd class=dontpublish><a href="https://www.w3.org/Bugs/Public/enter_bug.cgi?product=CSS&amp;component=CSSOM%20View">File a bug</a>
  (<a href="https://www.w3.org/Bugs/Public/buglist.cgi?component=CSSOM%20View&amp;product=CSS&amp;resolution=---">open bugs</a>)
  <script async="" src="https://w3c-test.org/resources.whatwg.org/file-bug.js"></script>
  <dd class=dontpublish><a href="irc://irc.w3.org:6665/css">IRC: #css on W3C</a></dd>

  <dt class=publish>Latest Version:</dt>
  <dd class=publish><a href="[LATEST]">[LATEST]</a></dd>

  <dt class=publish>Latest Editor Draft:</dt>
  <dd class=publish><a href="http://dev.w3.org/csswg/cssom-view/">http://dev.w3.org/csswg/cssom-view/</a></dd>

  <dt class=dontpublish>Previous Versions:</dt>
  <dd class=dontpublish><a href="http://www.w3.org/TR/2009/WD-cssom-view-20090804/">http://www.w3.org/TR/2009/WD-cssom-view-20090804/</a></dd>
  <dd class=dontpublish><a href="http://www.w3.org/TR/2008/WD-cssom-view-20080222/">http://www.w3.org/TR/2008/WD-cssom-view-20080222/</a></dd>
  <dd class=dontpublish><a href="http://www.w3.org/TR/2000/REC-DOM-Level-2-Style-20001113/">http://www.w3.org/TR/2000/REC-DOM-Level-2-Style-20001113/</a></dd>

  <dt>Editors:</dt>
  <dd><a>Simon Pieters</a>
  (<a href="http://www.opera.com/">Opera Software ASA</a>)
  &lt;<a href="mailto:simponp@opera.com">simonp@opera.com</a>&gt;</dd>
  <dd><a href="http://www.w3.org/wiki/User:Gadams">Glenn Adams</a>
  (<a href="http://www.cox.com/">Cox Communications, Inc.</a>)
  &lt;<a href="mailto:glenn.adams@cox.com">glenn.adams@cox.com</a>&gt;</dd>

  <dt>Previous Editor:</dt>
  <dd><a href="http://annevankesteren.nl/">Anne van Kesteren</a>
  (<a href="http://www.opera.com/">Opera Software ASA</a>)
  &lt;<a href="mailto:annevk@opera.com">annevk@opera.com</a>&gt;</dd>
 </dl>

 <!--copyright-->

</div>

<hr>

<h2 class="no-num no-toc">Abstract</h2>

<p>The APIs introduced by this specification provide authors with a way to
inspect and manipulate the visual view of a document. This includes
getting the position of element layout boxes, obtaining the width
of the viewport through script, and also scrolling an element.</p>



<h2 id="sotd" class="no-num no-toc">Status of This Document</h2>

<p><em>This section describes the status of this document at the time of
its publication. Other documents may supersede this document. A list of
current W3C publications and the latest revision of this technical report
can be found in the <a href="http://www.w3.org/TR/">W3C technical reports
index at http://www.w3.org/TR/.</a></em>

<p>This is the [DATE: 3 August 2002] [LONGSTATUS] of CSSOM View. Please send
comments to
<a href="mailto:www-style@w3.org?subject=%5Bcssom-view%5D%20">www-style@w3.org</a>
(<a href="http://lists.w3.org/Archives/Public/www-style/">archived</a>)
with <samp>[cssom-view]</samp> at the start of the subject line.

<p>This document was produced by the <a
href="http://www.w3.org/Style/CSS/members">CSS Working Group</a> (part of
the <a href="http://www.w3.org/Style/">Style Activity</a>).

<p>This document was produced by a group operating under the <a
href="http://www.w3.org/Consortium/Patent-Policy-20040205/">5 February
2004 W3C Patent Policy</a>. W3C maintains a <a
href="http://www.w3.org/2004/01/pp-impl/32061/status"
rel=disclosure>public list of any patent disclosures</a> made in
connection with the deliverables of the group; that page also includes
instructions for disclosing a patent. An individual who has actual
knowledge of a patent which the individual believes contains <a
href="http://www.w3.org/Consortium/Patent-Policy-20040205/#def-essential">Essential
Claim(s)</a> must disclose the information in accordance with <a
href="http://www.w3.org/Consortium/Patent-Policy-20040205/#sec-Disclosure">section
6 of the W3C Patent Policy</a>.</p>

<p>Publication as a Working Draft does not imply endorsement by the W3C
Membership. This is a draft document and may be updated, replaced or
obsoleted by other documents at any time. It is inappropriate to cite this
document as other than work in progress.


<h2 id="toc" class="no-num no-toc">Table of Contents</h2>

<!-- toc -->


<h2>Background</h2>

<p>Many of the features defined in this specification have been supported
by browsers for a long period of time. The goal of this specification is
to define these features in such a way that they can be implemented by all
browsers in an interoperable manner. The specification also defines a
couple of new features that will hopefully be useful to authors. (If they
are not you can bug us!)</p>


<h2>Conformance</h2>

<p>All diagrams, examples, and notes in this specification are
non-normative, as are all sections explicitly marked non-normative.
Everything else in this specification is normative.

<p>The key words "MUST", "MUST NOT", "REQUIRED", <!--"SHALL", "SHALL
NOT",--> "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and
"OPTIONAL" in the normative parts of this document are to be
interpreted as described in RFC2119. For readability, these words do
not appear in all uppercase letters in this specification. <span
data-anolis-ref>RFC2119</span>

<p>Requirements phrased in the imperative as part of algorithms
(such as "strip any leading space characters" or "return false and
terminate these steps") are to be interpreted with the meaning of the
key word ("must", "should", "may", etc) used in introducing the
algorithm.

<p>Conformance requirements phrased as algorithms or specific steps
may be implemented in any manner, so long as the end result is
equivalent. (In particular, the algorithms defined in this
specification are intended to be easy to follow, and not intended to
be performant.)

<p id="hardwareLimitations">User agents may impose
implementation-specific limits on otherwise unconstrained inputs,
e.g. to prevent denial of service attacks, to guard against running
out of memory, or to work around platform-specific limitations.

<p>When a method or an attribute is said to call another method or attribute, the user agent must invoke its internal API for that attribute or method so that
e.g. the author can't change the behavior by overriding attributes or methods with custom properties or functions in ECMAScript.

<p>Unless otherwise stated, string comparisons are done in a <span>case-sensitive</span> manner.

<p>A conforming user agent implements all the requirements made by this
specification.</p>


<h3>Web IDL</h3>

<p>The IDL fragments in this specification must be
interpreted as required for conforming IDL fragments, as described in the
Web IDL specification. <span data-anolis-ref>WEBIDL</span>


<h2>Terminology</h2>

<p>Terminology used in this specification is from
DOM,
CSSOM and
HTML.
<span data-anolis-ref>DOM</span>
<span data-anolis-ref>CSSOM</span>
<span data-anolis-ref>HTML</span>

<p class="XXX"><dfn><code>MouseEvent</code></dfn> and <dfn><code>MouseEventInit</code></dfn> are defined in &hellip;

<p><dfn>The HTML <code>body</code> element</dfn> is the first
<code>body</code>
<span data-anolis-spec=html title="HTML elements">HTML element</span> child of the root
<span data-anolis-spec=html title="HTML elements">HTML element</span> <code>html</code>.</p>

<p><dfn>Content edge</dfn>,
<dfn>padding edge</dfn>,
<dfn>border edge</dfn>,
<dfn>margin edge</dfn> and
<dfn>canvas</dfn> are defined by CSS.
<!--<span data-anolis-ref>CSS</span>-->

<p><dfn>Viewport</dfn> and
<dfn>initial containing block</dfn> are
defined by CSS 2.1 unless there is an ancestor <code>foreignObject</code>
element in the <code>http://www.w3.org/2000/svg</code> namespace in which
case that element acts as viewport and initial containing block.
<!--<span data-anolis-ref>CSS</span>-->

<p>The term <dfn>scrolling area</dfn> refers to a box of an element that has the following edges:

<dl>
 <dt>top edge
 <dd><p>The element's top <span>padding edge</span>.
 <dt>right edge
 <dd>
  <dl class=switch>
   <dt>If the element can have overflow to the right
   <dd><p>The right-most edge of the element's right <span>padding edge</span> and the right <span>margin edge</span> of the element's all descendant boxes,
   excluding boxes that have an ancestor of element as their containing block.
   <dt>If the element can have overflow to the left (under right-to-left conditions)
   <dd><p>The element's right <span>padding edge</span>.
  </dl>
 <dt>bottom edge
 <dd><p>The bottom-most edge of the element's bottom <span>padding edge</span> and the bottom <span>margin edge</span> of the element's all descendant boxes,
 excluding boxes that have an ancestor of element as their containing block.
 <dt>left edge
 <dd>
  <dl class=switch>
   <dt>If the element can have overflow to the right
   <dd><p>The element's left <span>padding edge</span>.
   <dt>If the element can have overflow to the left (under right-to-left conditions)
   <dd><p>The left-most edge of the element's left <span>padding edge</span> and the left <span>margin edge</span> of the element's all descendant boxes,
   excluding boxes that have an ancestor of element as their containing block.
  </dl>
</dl>

<p>The term <dfn>document content</dfn> refers to the area on the
<span>canvas</span> that is rendered upon, excluding content on negative
axis.</p>

<p>The term <dfn>CSS layout box</dfn> refers to the same term in CSS. For the purpose
of the requirements in this specification, elements that have a computed value of the
'<code title>display</code>' property that is <code>table-column</code> or
<code>table-column-group</code> must be considered to have an associated <span>CSS
layout box</span> (the column or column group, respectively).</p>

<h3>CSS pixels</h3>

<p>All coordinates and dimensions for the APIs defined in this
specification are in CSS pixels. <!--<span data-anolis-ref>CSS</span>-->

<p class="note">This does not apply to e.g.
<code title=dom-Window-matchMedia>matchMedia()</code> as the units
are explicitly given there.</p>



<h2>Common Infrastructure</h2>

<h3>Scrolling</h3>

<p>When a user agent is to <dfn>perform a scroll</dfn> of a scrolling box <var title>box</var>, to a given position <var title>position</var>, with a set of 
steps <var title>task</var>, an associated element <var title>element</var> and a scroll behavior <var title>behavior</var>, the following steps must be run:

<ol>
 <li><p><span title=concept-smooth-scroll-aborted>Abort</span> any ongoing <span title=concept-smooth-scroll>smooth scroll</span> for <var title>box</var>.
 <li><p>If the user agent honors the '<code>scroll-behavior</code>' property and one of the following are true:
  <ul>
   <li><p><var title>behavior</var> is <code title>auto</code> and <var title>element</var> is not null and its computed value of the '<code>scroll-behavior</code>'
   property is '<code title=scroll-behavior-smooth>smooth</code>'
   <li><p><var title>behavior</var> is <code title>smooth</code>
  </ul>
  <p>...then follow these substeps:
  <ol>
   <li><p>Perform a <span title=concept-smooth-scroll>smooth scroll</span> of <var title>box</var> to <var title>position</var>.
   <li><p><span data-anolis-spec=html>Queue a task</span> to run <var title>task</var>, unless a <span data-anolis-spec=html title=concept-task>task</span> to
   run <var title>task</var> is in the <span data-anolis-spec=html title="queue a task">queue</span>.
   <li><p>Repeat the previous step in a user agent-defined interval while the <span title=concept-smooth-scroll>smooth scroll</span> is ongoing, as well as when
   the <span title=concept-smooth-scroll>smooth scroll</span> is <span title=concept-smooth-scroll-completed>completed</span> (but not if it is
   <span title=concept-smooth-scroll-aborted>aborted</span>).
  </ol>
 <li><p>Otherwise, follow these substeps:
  <ol>
   <li><p>Perform an <span title=concept-instant-scroll>instant scroll</span> of <var title>box</var> to <var title>position</var>.
   <li><p><span data-anolis-spec=html>Queue a task</span> to run <var title>task</var>, unless a <span data-anolis-spec=html title=concept-task>task</span> to
   run <var title>task</var> is in the <span data-anolis-spec=html title="queue a task">queue</span>.
  </ol>
</ol>

<p>When a user agent is to perform a <dfn title=concept-smooth-scroll>smooth scroll</dfn> of a scrolling box <var title>box</var> to <var title>position</var>,
it must update the scroll position of <var title>box</var> in a user agent-defined fashion over a user agent-defined amount of time. When the scroll is
<dfn title="concept-smooth-scroll-completed">completed</dfn>, the scroll position of <var title>box</var> must be <var title>position</var>. The scroll can also
be <dfn title=concept-smooth-scroll-aborted>aborted</dfn>, either by an algorithm or by the user.

<p>When a user agent is to perform an <dfn title=concept-instant-scroll>instant scroll</dfn> of a scrolling box <var title>box</var> to
<var title>position</var>, it must update the scroll position of <var title>box</var> to <var title>position</var>.


<h2>Extensions to the <code title>Window</code> Interface</h2>

<pre class=idl>enum <dfn>ScrollBehavior</dfn> { "auto", "instant", "smooth" };

dictionary <dfn>ScrollOptions</dfn> {
  double x;
  double y;
  <span>ScrollBehavior</span> behavior = "auto";
};

partial interface <span data-anolis-spec=html>Window</span> {
  <span>MediaQueryList</span> <span title=dom-Window-matchMedia>matchMedia</span>(DOMString query);
  readonly attribute <span>Screen</span> <span title=dom-Window-screen>screen</span>;

  // viewport
  readonly attribute double <span title=dom-Window-innerWidth>innerWidth</span>;
  readonly attribute double <span title=dom-Window-innerHeight>innerHeight</span>;

  // viewport scrolling
  readonly attribute double <span title=dom-Window-scrollX>scrollX</span>;
  readonly attribute double <span title=dom-Window-pageXOffset>pageXOffset</span>;
  readonly attribute double <span title=dom-Window-scrollY>scrollY</span>;
  readonly attribute double <span title=dom-Window-pageYOffset>pageYOffset</span>;
  void <span title=dom-Window-scroll>scroll</span>(double x, double y, optional <span>ScrollOptions</span> options);
  void <span title=dom-Window-scrollTo>scrollTo</span>(double x, double y, optional <span>ScrollOptions</span> options);
  void <span title=dom-Window-scrollBy>scrollBy</span>(double x, double y, optional <span>ScrollOptions</span> options);

  // client
  readonly attribute double <span title=dom-Window-screenX>screenX</span>;
  readonly attribute double <span title=dom-Window-screenY>screenY</span>;
  readonly attribute double <span title=dom-Window-outerWidth>outerWidth</span>;
  readonly attribute double <span title=dom-Window-outerHeight>outerHeight</span>;
};</pre>

<p>When the <dfn title=dom-Window-matchMedia><code>matchMedia(<var title>query</var>)</code></dfn> method is invoked these steps must be run:</p>
<ol>
 <li><p>Let <var title>parsed media query list</var> be the result of
 <span title='parse a media query list' data-anolis-spec=cssom>parsing</span>
 <var title>query</var>.</p></li>
 <li><p>Return a <em>new</em> <code>MediaQueryList</code> object,
 associated with the <code data-anolis-spec=html>Window</code> object, with
 <var title>parsed media query list</var> as its associated
 media query list.</p></li>
</ol>

<p>The <dfn title=dom-Window-screen><code>screen</code></dfn> attribute must return the <code>Screen</code> object
associated with the <code data-anolis-spec=html>Window</code> object. It always returns the same
object.</p>
<p class='note'>Accessing <code title=dom-Window-screen>screen</code> through a <code data-anolis-spec=html>WindowProxy</code> object might yield different
results when the <code data-anolis-spec=dom>Document</code> is navigated.</p>

<p>The <dfn title=dom-Window-innerWidth><code>innerWidth</code></dfn> attribute must return the <span>viewport</span> width including the size of a rendered
scroll bar (if any), or zero if there is no <span>viewport</span>.</p>
<div class='example'>
 <p>The following snippet shows how to obtain the width of the viewport:</p>
 <pre><code>var viewportWidth = innerWidth</code></pre>
</div>


<p>The  <dfn title=dom-Window-innerHeight><code>innerHeight</code></dfn> attribute must return the <span>viewport</span> height including the size of a rendered
scroll bar (if any), or zero if there is no <span>viewport</span>.</p>


<p>The <dfn title=dom-Window-scrollX><code>scrollX</code></dfn> attribute attribute must return the x-coordinate, relative to the <span>initial containing
block</span> origin, of the left of the <span>viewport</span>, or zero if there is no <span>viewport</span>.</p>

<p>The <dfn title=dom-Window-pageXOffset><code>pageXOffset</code></dfn> attribute must return the value returned by the <code>scrollX</code> attribute.</p>

<p>The <dfn title=dom-Window-scrollY><code>scrollY</code></dfn> attribute attribute must return the y-coordinate, relative to the <span>initial containing
block</span> origin, of the top of the <span>viewport</span>, or zero if there is no <span>viewport</span>.</p>

<p>The <dfn title=dom-Window-pageYOffset><code>pageYOffset</code></dfn> attribute must return the value returned by the <code>scrollY</code> attribute.</p>

<p>When the <dfn title=dom-Window-scroll><code>scroll(<var title>x</var>, <var title>y</var>, <var title>options</var>)</code></dfn> method is invoked these steps must be run:</p>
<ol>
 <li><p>If there is no <span>viewport</span>, abort these steps.
  <dl class=switch>
   <dt>If <span>document content</span> can have overflow to the right
   <dd><p>Let <var title>x</var> be max(0, min(<var title>x</var>,
   <span>scrolling area</span> width - <span>padding edge</span>
   width)).</p></dd>
   <dt>If <span>document content</span> can have overflow to the left
   (under right-to-left conditions)
   <dd><p>Let <var title>x</var> be min(0, max(<var title>x</var>,
   <span>padding edge</span> width - <span>scrolling area</span>
   width)).</p></dd>
  </dl>
 </li>
 <li><p>Let <var title>y</var> be max(0, min(<var title>y</var>,
 <span>document content</span> height - <span>viewport</span>
 height excluding the size of a rendered scroll bar (if any))).</p></li>
 <li><p>Let <var title>position</var> be the scroll position the <span>viewport</span> would have by aligning the x-coordinate <var title>x</var> of the
 <span>document content</span> with the left of the <span>viewport</span> and aligning the y-coordinate <var title>y</var> of the <span>document content</span>
 with the top of the <span>viewport</span>.
 <li><p>If <var title>position</var> is the same as the <span>viewport</span>'s current scroll position, and the <span>viewport</span> does not have an ongoing
 <span title=concept-smooth-scroll>smooth scroll</span>, abort these steps.
 <li><p>Let <var title>task</var> be these steps:
  <ol>
   <li><p><span data-anolis-spec=dom title=concept-event-fire>Fire an event</span> named <code title='event-scroll'>scroll</code> that bubbles at the
   <code data-anolis-spec=dom>Document</code> object.
  </ol>
 <li><p><span>Perform a scroll</span> of the <span>viewport</span> to <var title>position</var>, with the set of steps <var title>task</var>, and the
 <code data-anolis-spec=dom>Document</code>'s root element as the associated element, if there is one, or <code>null</code> otherwise, and the scroll behavior being the value of the <code title>behavior</code> dictionary member of <var title>options</var>.
</ol>

<p>When the <dfn title=dom-Window-scrollTo><code>scrollTo(<var title>x</var>, <var title>y</var>, <var title>options</var>)</code></dfn> method is invoked, the user agent must act as if
the <code title=dom-Window-scroll>scroll()</code> method was invoked with the same arguments.</p>

<p>When the <dfn title=dom-Window-scrollBy><code>scrollBy(<var title>x</var>, <var title>y</var>, <var title>options</var>)</code></dfn> method is invoked, the user agent must act as if
the <code title=dom-Window-scroll>scroll()</code> method was invoked with
<var title>x</var> plus <code title='dom-Window-scrollX'>scrollX</code>
as first argument and <var title>y</var> plus
<code title='dom-Window-scrollY'>scrollY</code> as second argument.</p>

<p>The <dfn title=dom-Window-screenX><code>screenX</code></dfn> attribute must return the x-coordinate,
relative to the origin of the screen of the output device, of the left of
the client window as number of pixels, or zero if there is no such
thing.</p>

<p>The <dfn title=dom-Window-screenY><code>screenY</code></dfn> attribute must return the y-coordinate,
relative to the origin of the screen of the output device, of the top of
the client window as number of pixels, or zero if there is no such
thing.</p>

<p>The <dfn title=dom-Window-outerWidth><code>outerWidth</code></dfn> attribute must return the width of the
client window. If there is no client window this
attribute must return zero.</p>

<p>The <dfn title=dom-Window-outerHeight><code>outerHeight</code></dfn> attribute must return the height of the
client window. If there is no client window this
attribute must return zero.</p>


<h3>The <code title>MediaQueryList</code> Interface</h3>

<p>A <code>MediaQueryList</code> object has an associated media query list set on creation and an associated
<dfn>list of media query list listeners</dfn>, which is initially empty.</p>
<p>If the associated media query list changes in evaluation then, for each
listener in the <span>list of media query list listeners</span> &mdash; in
appending order, <span data-anolis-spec=html>queue a task</span> that invokes the listener,
passing as argument the <code>MediaQueryList</code> object.</p>
<div class='example'>
<p>A simple piece of code that detects changes in the orientation of the viewport can be written as follows:</p>
<pre><code>function handleOrientationChange(mql) {
    if(mql.matches) // landscape
      &hellip;
    else
      &hellip;
  }
  var mql = matchMedia("(orientation:landscape)")
  mql.addListener(handleOrientationChange)</code></pre>
</div>

<pre class=idl>interface <dfn>MediaQueryList</dfn> {
  readonly attribute DOMString <span title=dom-MediaQueryList-media>media</span>;
  readonly attribute boolean <span title=dom-MediaQueryList-matches>matches</span>;
  void <span title=dom-MediaQueryList-addListener>addListener</span>(<span>MediaQueryListListener</span> listener);
  void <span title=dom-MediaQueryList-removeListener>removeListener</span>(<span>MediaQueryListListener</span> listener);
};

callback <dfn>MediaQueryListListener</dfn> = void (<span>MediaQueryList</span> list);</pre>

<p>The <dfn title=dom-MediaQueryList-media><code>media</code></dfn> attribute must return the
<span title='serialize a media query list' data-anolis-spec=cssom>serialized</span> form of the associated media query list.</p>

<p>The <dfn title=dom-MediaQueryList-matches><code>matches</code></dfn> attribute must return true if the associated media query list
matches the state of the rendered <code data-anolis-spec=dom>Document</code> and false if it does not.</p>

<p>When the <dfn title=dom-MediaQueryList-addListener><code>addListener(<var title>listener</var>)</code></dfn> method is invoked <var title>listener</var> must
be appended to the <span>list of media query list listeners</span>, unless
it is already in the <span>list of media query list listeners</span>.</p>

<p>When the <dfn title=dom-MediaQueryList-removeListener><code>removeListener(<var title>listener</var>)</code></dfn> method is invoked
<var title>listener</var> must be removed from the <span>list of media query list listeners</span>.</p>

<h3>The <code title>Screen</code> Interface</h3>

<p>As its name suggests, the <code>Screen</code> interface represents information about the screen of the output device.</p>

<pre class=idl>interface <dfn>Screen</dfn> {
  readonly attribute double <span title=dom-Screen-availWidth>availWidth</span>;
  readonly attribute double <span title=dom-Screen-availWidth>availHeight</span>;
  readonly attribute double <span title=dom-Screen-availWidth>width</span>;
  readonly attribute double <span title=dom-Screen-availWidth>height</span>;
  readonly attribute unsigned long <span title=dom-Screen-availWidth>colorDepth</span>;
  readonly attribute unsigned long <span title=dom-Screen-availWidth>pixelDepth</span>;
};</pre>

<p>The <dfn title=dom-Screen-availWidth><code>availWidth</code></dfn> attribute must return the available width of the rendering surface of the output
device.</p>

<p>The <dfn title=dom-Screen-availHeight><code>availHeight</code></dfn> attribute must return the available height of the rendering surface of the output
device.</p>

<p>The <dfn title=dom-Screen-width><code>width</code></dfn> attribute must return the width of the output device.</p>

<p>The <dfn title=dom-Screen-height><code>height</code></dfn> attribute must return the height of the output device.</p>

<p>The <dfn title=dom-Screen-colorDepth><code>colorDepth</code></dfn> attribute must return the number of bits allocated to
colors (i.e. excluding the alpha channel) in the output device. If no
bits are allocated to colors in the output device this attribute
must return zero.</p>

<p>The <dfn title=dom-Screen-pixelDepth><code>pixelDepth</code></dfn> attribute must return the value returned by the <code>colorDepth</code> attributed.</p>


<h2>Extensions to the <code title>Document</code> Interface</h2>

<pre class=idl>partial interface <span data-anolis-spec=dom>Document</span> {
  Element? elementFromPoint(double x, double y);
  CaretPosition? caretPositionFromPoint(double x, double y);
};</pre>

<p>The <dfn title=dom-Document-elementFromPoint><code>elementFromPoint(<var title>x</var>, <var title>y</var>)</code></dfn> method must return the element at
coordinates <var title>x</var>,<var title>y</var> in the <span>viewport</span>. The element to be returned is determined
through hit testing. If either argument is negative, <var title>x</var> is greater than the <span>viewport</span> width excluding the size of a rendered scroll
bar (if any), or <var title>y</var> is greater than the <span>viewport</span> height excluding the size of a rendered scroll bar (if any), the method must
return null. If there is no element at the given position the method must return the root element, if any, or null otherwise. If there is no
<span>viewport</span> associated with the document, the method must return null.</p>

<p>The <dfn title=dom-Document-caretPositionFromPoint><code>caretPositionFromPoint(<var title>x</var>, <var title>y</var>)</code></dfn> method must return the
result of running these steps:</p>
<ol>
 <li><p>If there is no <span>viewport</span> associated with the document, return null.
 <li><p>If either argument is negative, <var title>x</var> is greater
 than the <span>viewport</span> width excluding the size of a rendered
 scroll bar (if any), <var title>y</var> is greather than the
 <span>viewport</span> height excluding the size of a rendered scroll bar
 (if any) return null.</p></li>
 <li><p>If at the coordinates <var title>x</var>,<var title>y</var>
 in the <span>viewport</span> no text insertion point indicator would have
 been inserted return null.</p></li>
 <li>
  <p>If at the coordinates <var title>x</var>,<var title>y</var>
  in the <span>viewport</span> a text insertion point indicator would have
  been inserted in a text entry widget which is also a replaced element
  return a <span>caret position</span> with its properties set as
  follows:</p>
  <dl>
   <dt><span>caret node</span></dt>
   <dd><p>The node corresponding to the text entry widget.</p></dd>
   <dt><span>caret offset</span></dt>
   <dd><p>The amount of 16-bit units to the left of where the
   text insertion point indicator would have inserted.</p></dd>
   <dt><span>caret range</span></dt>
   <dd><p>null</p></dd>
  </dl>
 </li>
 <li>
  <p>Otherwise, return a <span>caret position</span> where the
  <span>caret range</span> is a collapsed
  <code data-anolis-spec=dom>Range</code> object for the position
  where the text insertion point indicator would have been inserted and
  the other properties are set as follows:</p>
  <dl>
   <dt><span>caret node</span></dt>
   <dd><p>The <code data-anolis-spec=dom title=dom-Range-startContainer>startContainer</code>
   of the <span>caret range</span>.</p></dd>
   <dt><span>caret offset</span></dt>
   <dd><p>The <code data-anolis-spec=dom title=dom-Range-startOffset>startOffset</code> of
   the <span>caret range</span>.</p>
  </dl>
 </li>
</ol>
<p class='note'>The specifics of hit testing are out of scope of this
specification and therefore the exact details of
<code title=dom-Document-elementFromPoint>elementFromPoint()</code> and
<code title=dom-Document-caretPositionFromPoint>caretPositionFromPoint()</code>
are therefore too. Hit testing will hopefully be defined in a future
revision of CSS or HTML.</p>

<h3>The <code title>CaretPosition</code> Interface</h3>

<p>A <dfn>caret position</dfn> gives the position of a text insertion point indicator. It always has an associated
<dfn>caret node</dfn>, <dfn>caret offset</dfn>, and <dfn>caret range</dfn>. It is represented by a <code>CaretPosition</code> object.</p>
  
<pre class=idl>interface <dfn>CaretPosition</dfn> {
  readonly attribute Node offsetNode;
  readonly attribute unsigned long offset;
  ClientRect? getClientRect();
};</pre>

<p>The <dfn title=dom-CaretPosition-offsetNode><code>offsetNode</code></dfn> attribute must return the <span>caret node</span>.</p>

<p>The <dfn title=dom-CaretPosition-offset><code>offset</code></dfn> attribute must return the <span>caret offset</span>.</p>

<p>The <dfn title=dom-CaretPosition-getClientRect><code>getClientRect()</code></dfn> method must follow these steps, aborting on the first step that
returns a value:</p>
<ol>
 <li>
  <p>If <span>caret range</span> is not null:
  <ol>
   <li><p>Let <var title>list</var> be the result of invoking the
   <code title=dom-Range-getClientRects>getClientRects()</code> method on the
   range.
   <li><p>If <var title>list</var> is empty, return null.
   <li><p>Return the <code>ClientRect</code> object in <var title>list</var> at index 0.
  </ol>
 <li><p>If <span>caret node</span> is a text entry widget that is a replaced element,
 and that is in the document, return a <code>ClientRect</code> object for the caret
 in the widget as represented by the <span>caret offset</span> value.
 <li><p>Return null.
</ol>

<h2>Extensions to the <code title>Element</code> Interface</h2>

<pre class=idl>partial interface <span data-anolis-spec=dom>Element</span> {
  <span>ClientRectList</span> <span title=dom-Element-getClientRects>getClientRects</span>();
  <span>ClientRect</span> <span title=dom-Element-getBoundingClientRect>getBoundingClientRect</span>();
  void <span title=dom-Element-scrollIntoView>scrollIntoView</span>(optional boolean top, optional <span>ScrollOptions</span> options);
  attribute (double or <span>ScrollOptions</span>) <span title=dom-Element-scrollTop>scrollTop</span>;
  attribute (double or <span>ScrollOptions</span>) <span title=dom-Element-scrollLeft>scrollLeft</span>;
  readonly attribute double <span title=dom-Element-scrollWidth>scrollWidth</span>;
  readonly attribute double <span title=dom-Element-scrollHeight>scrollHeight</span>;
  readonly attribute double <span title=dom-Element-clientTop>clientTop</span>;
  readonly attribute double <span title=dom-Element-clientLeft>clientLeft</span>;
  readonly attribute double <span title=dom-Element-clientWidth>clientWidth</span>;
  readonly attribute double <span title=dom-Element-clientHeight>clientHeight</span>;
};</pre>

<p>The <dfn title=dom-Element-getClientRects><code>getClientRects()</code></dfn> method, when invoked, must return the result of the following algorithm:</p>
<ol>
 <li><p>If the element on which it was invoked does not have an associated
 <span>CSS layout box</span> and is not in the <code>http://www.w3.org/2000/svg</code>
 namespace return an empty <code>ClientRectList</code> object and stop
 this algorithm.</p></li>
 <li><p>If the element does not have an associated <span>CSS layout box</span> and is
 in the <code>http://www.w3.org/2000/svg</code> namespace return a
 <code>ClientRectList</code> object containing a single
 <code>ClientRect</code> object that describes the bounding box of the
 element as defined by the SVG specification.
 <span data-anolis-ref>SVG</span></li>
 <li>
  <p>Return a <code>ClientRectList</code> object containing a list of
  <code>ClientRect</code> objects in content order describing the border
  boxes (including those with a height or width of zero) with the
  following constraints:</p>
  <ul>
   <li><p>If the element on which the method was invoked has a computed
   value for <code>display</code> property of <code>table</code> or
   <code>inline-table</code> include both the table box and the caption
   box, if any, but not the anonymous container box.</li>
   <li><p>Replace each
   <a href='http://www.w3.org/TR/CSS21/visuren.html#anonymous-block-level'>anonymous
   block box</a> with its child box(es) and repeat this until no anonymous
   block boxes are left in the final list.</li>
  </ul>
 </li>
</ol>

<p>The <dfn title=dom-Element-getBoundingClientRect><code>getBoundingClientRect()</code></dfn> method, when invoked, must return the result of the following
algorithm:</p>
<ol>
 <li><p>Let <var title>list</var> be the result of invoking
 <code title=dom-Element-getClientRects>getClientRects()</code> on the
 same element this method was invoked on.</p></li>
 <li><p>If the <var title>list</var> is empty return a <code>ClientRect</code>
 object whose <code title=dom-ClientRect-top>top</code>,
 <code title=dom-ClientRect-right>right</code>,
 <code title=dom-ClientRect-bottom>bottom</code> and
 <code title=dom-ClientRect-left>left</code> members are zero.</p></li>
 <li><p>Otherwise, return a <code>ClientRect</code> object describing the
 smallest rectangle that includes the first rectangle in <var title>list</var>
 and all of the remaining rectangles of which the height or width is not
 zero.</p></li>
</ol>
<div class='example'>
 <p>The following snippet gets the dimensions of the first
 <code>div</code> element in a document:</p>
 <pre><code>var example = document.getElementsByTagName(&quot;div&quot;)[0].getBoundingClientRect();&#xA;
var exampleWidth = example.width;&#xA;
var exampleHeight = example.height;</code></pre>
</div>

<p>The <dfn title=dom-Element-scrollIntoView><code>scrollIntoView(<var title>top</var>, <var title>options</var>)</code></dfn> method must run these steps:</p>
<ol>
 <li><p>If the element does not have any associated <span>CSS layout box</span> terminate these steps.</p></li>
 <li><p><span title='scroll an element into view'>Scroll the element into view</span> with the
 <i title>align to top flag</i> set if <var title>top</var> is true or omitted, and the scroll behavior being the value of the <code title>behavior</code>
 dictionary member of <var title>options</var>.</p></li>
</ol>

<p>The <dfn title=dom-Element-scrollTop><code>scrollTop</code></dfn> attribute must return the result of running these steps:</p>
<ol>
 <li><p>If the element does not have any associated <span>CSS layout box</span> or the
 element is the root element and the <code data-anolis-spec=dom>Document</code> is in
 <span data-anolis-spec=dom title=concept-document-quirks>quirks mode</span> return zero and terminate these steps.</p></li>
 <li><p>If the element is the root element return the value of
 <code title='dom-Window-scrollY'>scrollY</code>.</p></li>
 <li><p>If the element is <span>the HTML <code>body</code> element</span>,
 the <code data-anolis-spec=dom>Document</code> is in <span data-anolis-spec=dom title=concept-document-quirks>quirks mode</span>, and the element
 does not have any overflow, return the value of
 <code title=dom-Window-scrollY>scrollY</code>.</p></li>
 <li><p>Return the y-coordinate of the <span>scrolling area</span> at the
 alignment point with the top of the <span>padding edge</span> of the
 element.</p></li>
</ol>
<p>When setting the <code title=dom-Element-scrollTop>scrollTop</code> attribute these steps must be run:</p>
<ol>
 <li><p>If the given value is a <code>ScrollOptions</code> object, and the <code title>y</code> dictionary member is not present, abort these steps.
 <li><p>If the given value is a <code>ScrollOptions</code> object, let <var title>y</var> be the value of the <code title>y</code> dictionary member. Otherwise,
 let <var title>y</var> be the given value.</p></li>
 <li><p>If the element does not have any associated <span>CSS layout box</span>, the
 element is the root element and the <code data-anolis-spec=dom>Document</code> is in
 <span data-anolis-spec=dom title=concept-document-quirks>quirks mode</span>, or the element has no overflow, terminate these
 steps.</p></li>
 <li><p>If the element is the root element invoke
 <code title=dom-Window-scroll>scroll()</code> with zero as first
 argument and <var title>y</var> as second, and, if the given value is a <code>ScrollOptions</code> object, the given value as the third argument.</p></li>
 <li><p>If the element is <span>the HTML <code>body</code> element</span>,
 the <code data-anolis-spec=dom>Document</code> is in <span data-anolis-spec=dom title=concept-document-quirks>quirks mode</span>, and the element
 does not have any vertical overflow, invoke
 <code title=dom-Window-scroll>scroll()</code> with
 <code title=dom-Window-scrollX>scrollX</code> as first
 argument and <var title>y</var> as second, and, if the given value is a <code>ScrollOptions</code> object, the given value as the third argument.</p></li>
 <li><p><span title='scroll an element'>Scroll the element</span> to
 <code title=dom-Element-scrollLeft>scrollLeft</code>,<var title>y</var>, with the scroll behavior being the value of the <code title>behavior</code> dictionary
 member if the given value is a <code>ScrollOptions</code> object, or <code title>auto</code> otherwise.
</ol>

<p>The <dfn title=dom-Element-scrollLeft><code>scrollLeft</code></dfn> attribute must return the result of running these steps:</p>
<ol>
 <li><p>If the element does not have any associated <span>CSS layout box</span> or the
 element is the root element and the <code data-anolis-spec=dom>Document</code> is in
 <span data-anolis-spec=dom title=concept-document-quirks>quirks mode</span> return zero and terminate these steps.</p></li>
 <li><p>If the element is the root element return the value of
 <code title=dom-Window-scrollX>scrollX</code>.</p></li>
 <li><p>If the element is <span>the HTML <code>body</code> element</span>,
 the <code data-anolis-spec=dom>Document</code> is in <span data-anolis-spec=dom title=concept-document-quirks>quirks mode</span>, and the element
 does not have any overflow, return the value of
 <code title=dom-Window-scrollX>scrollX</code>.</p></li>
 <li><p>Return the x-coordinate of the <span>scrolling area</span> at the
 alignment point with the left of the <span>padding edge</span> of the
 element.</p></li>
</ol>
<p>When setting the <code title=dom-Element-scrollLeft>scrollLeft</code> attribute these steps must be run:</p>
<ol>
 <li><p>If the given value is a <code>ScrollOptions</code> object, and the <code title>x</code> dictionary member is not present, abort these steps.
 <li><p>If the given value is a <code>ScrollOptions</code> object, let <var title>x</var> be the value of the <code title>x</code> dictionary member. Otherwise,
 let <var title>x</var> be the given value.</p></li>
 <li><p>If the element does not have any associated <span>CSS layout box</span>, the
 element is the root element and the <code data-anolis-spec=dom>Document</code> is in
 <span data-anolis-spec=dom title=concept-document-quirks>quirks mode</span>, or the element has no overflow, terminate these
 steps.</p></li>
 <li><p>If the element is the root element invoke
 <code title=dom-Window-scroll>scroll()</code> with
 <var title>x</var> as first argument and zero as second, and, if the given value is a <code>ScrollOptions</code> object, the given value as the third
 argument.</p></li>
 <li><p>If the element is <span>the HTML <code>body</code> element</span>,
 the <code data-anolis-spec=dom>Document</code> is in <span data-anolis-spec=dom title=concept-document-quirks>quirks mode</span>, and the element
 does not have any vertical overflow, invoke
 <code title='dom-Window-scroll'>scroll()</code> with
 <var title>x</var> as first argument and
 <code title=dom-Window-scrollY>scrollY</code> as second, and, if the given value is a <code>ScrollOptions</code> object, the given value as the third
 argument.</p></li>
 <li><p><span title='Scroll an element'>Scroll the element</span> to
 <var title>x</var>,<code title=dom-Element-scrollTop>scrollTop</code>, with the scroll behavior being the value of the <code title>behavior</code> dictionary
 member if the given value is a <code>ScrollOptions</code> object, or <code title>auto</code> otherwise.
</ol>

<p>The <dfn title=dom-Element-scrollWidth><code>scrollWidth</code></dfn> attribute must return the result of running these steps:</p>
<ol>
 <li><p>If the element does not have any associated <span>CSS layout box</span> return
 zero and terminate these steps.</p></li>
 <li><p>Let <var title>viewport width</var> be the width of the <span>viewport</span> excluding the width of the scroll bar, if any, or zero if there is no
 <span>viewport</span>.
 <li><p>If the element is the root element and the
 <code data-anolis-spec=dom>Document</code> is not in
 <span data-anolis-spec=dom title=concept-document-quirks>quirks mode</span>
 return max(<span>document content</span> width, <var title>viewport width</var>).</p></li>
 <li><p>If the element is <span>the HTML <code>body</code> element</span>
 and the <code data-anolis-spec=dom>Document</code> is in
 <span data-anolis-spec=dom title=concept-document-quirks>quirks mode</span>
 return max(<span>document content</span> width, <var title>viewport width</var>).</p></li>
 <li><p>Return the width of the element's <span>scrolling area</span>.</p></li>
</ol>

<p>The <dfn title=dom-Element-scrollHeight><code>scrollHeight</code></dfn> attribute must return the result of running these steps:</p>
<ol>
 <li><p>If the element does not have any associated <span>CSS layout box</span> return
 zero and terminate these steps.</p></li>
 <li><p>Let <var title>viewport height</var> be the height of the <span>viewport</span> excluding the height of the scroll bar, if any, or zero if there is no
 <span>viewport</span>.
 <li><p>If the element is the root element and the
 <code data-anolis-spec=dom>Document</code> is not in
 <span data-anolis-spec=dom title=concept-document-quirks>quirks mode</span>
 return max(<span>document content</span> height, <var title>viewport height</var>).</p></li>
 <li><p>If the element is <span>the HTML <code>body</code> element</span>
 and the <code data-anolis-spec=dom>Document</code> is in
 <span data-anolis-spec=dom title=concept-document-quirks>quirks mode</span>
 return max(<span>document content</span> height, <var title>viewport height</var>).</p></li>
 <li><p>Return the height of the element's <span>scrolling area</span>.</p></li>
</ol>

<p>The <dfn title=dom-Element-clientTop><code>clientTop</code></dfn> attribute must run these steps:
<ol>
 <li><p>If the element has no associated <span>CSS layout box</span> or if the <span>CSS layout box</span> is inline, return zero.
 <li><p>Return the computed value of the '<code>border-top-width</code>' property plus the height of any scrollbar rendered between the top <span>padding
 edge</span> and the top <span>border edge</span>.
</ol>
    
<p>The <dfn title=dom-Element-clientLeft><code>clientLeft</code></dfn> attribute must run these steps:
<ol>
 <li><p>If the element has no associated <span>CSS layout box</span> or if the <span>CSS layout box</span> is inline, return zero.
 <li><p>Return the computed value of the '<code>border-left-width</code>' property plus the width of any scrollbar rendered between the left <span>padding
 edge</span> and the left <span>border edge</span>.
</ol>

<p>The <dfn title=dom-Element-clientWidth><code>clientWidth</code></dfn> attribute must run these steps:
<ol>
 <li><p>If the element has no associated <span>CSS layout box</span> or if the <span>CSS layout box</span> is inline, return zero.
 <li><p>If the element is the root element and the element's document's <span data-anolis-spec=html>browsing context</span> is a
 <span data-anolis-spec=html>top-level browsing context</span>, return the <span>viewport</span> width excluding the size of a rendered scroll bar (if
 any).
 <li><p>Return the width of the <span>padding edge</span> excluding the width of any rendered scrollbar between the <span>padding edge</span> and the
 <span>border edge</span>.
</ol>

<p>The <dfn title=dom-Element-clientHeight><code>clientHeight</code></dfn> attribute must run these steps:
<ol>
 <li><p>If the element has no associated <span>CSS layout box</span> or if the <span>CSS layout box</span> is inline, return zero.
 <li><p>If the element is the root element and the element's document's <span data-anolis-spec=html>browsing context</span> is a
 <span data-anolis-spec=html>top-level browsing context</span>, return the <span>viewport</span> height excluding the size of a rendered scroll bar (if any).
 <li><p>Return the height of the <span>padding edge</span> excluding the height of any rendered scrollbar between the <span>padding edge</span> and the
 <span>border edge</span>.
</ol>

<h3>The <code title>getClientRects()</code> and
<code title>getBoundingClientRect()</code> methods</h3>

<p>The <code title=dom-Element-getClientRects>getClientRects()</code> and <code title=dom-Element-getBoundingClientRect>getBoundingClientRect()</code>
methods provide information about the position of the border box edges of
an element relative to the viewport. The objects these methods return
must be static. That is, changes to the underlying
document are not reflected in the objects.</p>

<h3><code title>Element</code> Scrolling Members</h3>

<p>To <dfn>scroll an element into view</dfn>, optionally with an
<i title>align to top flag</i> set, and with a scroll behavior <var title>behavior</var>, means to run these steps for each
ancestor element or <span>viewport</span> that establishes a
scrolling box <var title>box</var>, in order of innermost to outermost scrolling box:</p>

<ol>
 <li><p>If the <code data-anolis-spec=dom>Document</code> associated
 with the element to be
 scrolled into view is not <span data-anolis-spec=html>same origin</span> with the
 <code data-anolis-spec=dom>Document</code> associated with the element or
 <span>viewport</span> associated with <var title>box</var>, terminate these
 steps.</p></li>
 
 <li><p>Let <var title>position</var> be the scroll position <var title>box</var> would have by following these steps:

  <ol>
   <li><p>If the <i title>align to top flag</i> is set align the top of
   the border box of the element to be scrolled into view with the top of
   <var title>box</var>.</p></li>

   <li><p>Otherwise, if the <i title>align to top flag</i> is not set
   align the bottom of the border box of the element to be scrolled into
   view with the bottom of <var title>box</var>.</p></li>

   <li><p>Align the left of the border box of the element to be scrolled
   into view with the left of <var title>box</var>.</p></li>
   <!-- RTL is not special cased in implementations?! -->
  </ol>

 <li><p>If <var title>position</var> is the same as <var title>box</var>'s current scroll position, and <var title>box</var> does not have an ongoing
 <span title=concept-smooth-scroll>smooth scroll</span>, abort these steps.

 <li>
  <dl class=switch>
   <dt>If <var title>box</var> is associated with an element</dt>
   <dd>
    <p>Let <var title>element</var> be the element.
    <p>Let <var title>task</var> be these steps:
    <ol>
     <li><p><span data-anolis-spec=dom title=concept-event-fire>Fire an event</span>
     named <code title="event-scroll">scroll</code> at the element
     associated <var title>box</var>.</p>
    </ol>
   </dd>

   <dt>If <var title>box</var> is associated with a <span>viewport</span></dt>
   <dd>
    <p>Let <var title>element</var> be the <code data-anolis-spec=dom>Document</code>'s root element as the associated element, if there is one, or
    <code>null</code> otherwise.
    <p>Let <var title>task</var> be these steps:
    <ol>
     <li><p><span data-anolis-spec=dom title=concept-event-fire>Fire an event</span>
     named <code title="event-scroll">scroll</code> that bubbles at the
     <code data-anolis-spec=dom>Document</code> object associated with the <span>viewport</span>.</p>
    </ol>
   </dd>
  </dl>
 </li>
 <li><p><span>Perform a scroll</span> of <var title>box</var> to <var title>position</var>, with the set of steps <var title>task</var>,
 <var title>element</var> as the associated element and <var title>behavior</var> as the scroll behavior.

</ol>

<p>To <dfn>scroll an element</dfn> to <var title>x</var>,<var title>y</var> with a scroll behavior <var title>behavior</var> means to:</p>

<ol>
 <li><p>Let <var title>element</var> be the element.
 <li><p>Let <var title>box</var> be <var title>element</var>'s associated scrolling box.
 <li>
  <dl class=switch>
   <dt>If <var title>element</var> can have overflow to the right</dt>

   <dd><p>Let <var title>x</var> be max(0, min(<var title>x</var>,
   <span>scrolling area</span> width -
   <span>padding edge</span> width)).</p></dd>

   <dt>If <var title>element</var> can have overflow to the left (under right-to-left
   conditions)</dt>

   <dd><p>Let <var title>x</var> be min(0, max(<var title>x</var>,
   <span>padding edge</span> width -
   <span>scrolling area</span> width)).</p></dd>
  </dl>
 </li>

 <li><p>Let <var title>y</var> be max(0, min(<var title>y</var>,
 <span>scrolling area</span> height - <span>padding edge</span> height)).</p></li>
  
 <li><p>Let <var title>position</var> be the scroll position <var title>box</var> would have by aligning <span>scrolling area</span> x-coordinate
 <var title>x</var> with the left of <var title>box</var> and aligning <span>scrolling area</span> y-coordinate <var title>y</var> with
 the top of <var title>box</var>.

 <li><p>If <var title>position</var> is the same as <var title>box</var>'s current scroll position, and <var title>box</var> does not have an ongoing
 <span title=concept-smooth-scroll>smooth scroll</span>, abort these steps.

 <li><p>Let <var title>task</var> be these steps:
  <ol>
   <li><p><span data-anolis-spec=dom title=concept-event-fire>Fire an event</span> named
   <code title="event-scroll">scroll</code> at the element.</p></li>
  </ol>

 <li><p><span>Perform a scroll</span> of <var title>box</var> to <var title>position</var>, with the set of steps <var title>task</var>,
 <var title>element</var> as the associated element and <var title>behavior</var> as the scroll behavior.

</ol>


<h2>Extensions to the <code title>HTMLElement</code> Interface</h2>

<pre class=idl>partial interface <span data-anolis-spec=html>HTMLElement</span> {
  readonly attribute <span data-anolis-spec=dom>Element</span> <span title=dom-HTMLElement-offsetParent>offsetParent</span>;
  readonly attribute double <span title=dom-HTMLElement-offsetTop>offsetTop</span>;
  readonly attribute double <span title=dom-HTMLElement-offsetLeft>offsetLeft</span>;
  readonly attribute double <span title=dom-HTMLElement-offsetWidth>offsetWidth</span>;
  readonly attribute double <span title=dom-HTMLElement-offsetHeight>offsetHeight</span>;
};</pre>

<p>The <dfn title=dom-HTMLElement-offsetParent><code>offsetParent</code></dfn> attribute must return the result of running these steps:</p>
<ol>
 <li>
  <p>If any of the following holds true return null and terminate this
  algorithm:</p>
  <ul>
   <li>The element does not have an associated <span>CSS layout box</span>.</li>
   <li>The element is the root element.</li>
   <li>The element is <span>the HTML <code>body</code> element</span>.</li>
   <li>The element's computed value of the '<code>position</code>' property is <code>fixed</code>.</li>
  </ul>
 </li>
 <li>
  <p>Return the nearest ancestor element of the element for which at least
  one of the following is true and terminate this algorithm if such an
  ancestor is found:</p>
  <ul>
   <li>The computed value of the '<code>position</code>' property is not <code>static</code>.</li>
   <li>It is <span>the HTML <code>body</code> element</span>.</li>
   <li>The computed value of the '<code>position</code>' property of
   the element is <code>static</code> and the ancestor is one of the
   following <span data-anolis-spec=html title='HTML elements'>HTML elements</span>:
   <code>td</code>, <code>th</code>, or <code>table</code>.</li>
  </ul>
 </li>
 <li><p>Return null.</p></li>
</ol>

<p>The <dfn title=dom-HTMLElement-offsetTop><code>offsetTop</code></dfn> attribute must return the result of running these steps:</p>
<ol>
 <li><p>If the element is <span>the HTML <code>body</code> element</span>
 or does not have any associated <span>CSS layout box</span> return zero and terminate
 this algorithm.</p></li>
 <li><p>If the <code title=dom-HTMLElement-offsetParent>offsetParent</code> of the element is null return the
 y-coordinate of the top <span>border edge</span> of the first
 <span>CSS layout box</span> associated with the element, relative to the
 <span>initial containing block</span> origin, and terminate this
 algorithm.</p></li>
 <li>
  <p>Return the result of subtracting the y-coordinate of the top
  <span>padding edge</span> of the first <span>CSS layout box</span> associated with
  the <code title=dom-HTMLElement-offsetParent>offsetParent</code> of the element from the y-coordinate of
  the top <span>border edge</span> of the first <span>CSS layout box</span> associated
  with the element, relative to the <span>initial containing block</span>
  origin.</p>
  <p class='note'>An inline element that consists of multiple line boxes
  will only have its first <span>CSS layout box</span> considered.</p>
 </li>
</ol>

<p>The <dfn title=dom-HTMLElement-offsetLeft><code>offsetLeft</code></dfn> attribute must return the result of running these steps:</p>
<ol>
 <li><p>If the element is <span>the HTML <code>body</code>
 element</span> or does not have any associated <span>CSS layout box</span> return zero
 and terminate this algorithm.</p></li>
 <li><p>If the <code title=dom-HTMLElement-offsetParent>offsetParent</code> of the element is null return the
 x-coordinate of the left <span>border edge</span> of the first
 <span>CSS layout box</span> associated with the element, relative to the
 <span>initial containing block</span> origin, and terminate this
 algorithm.</p></li>
 <li>
  <p>Return the result of subtracting the x-coordinate of the left
  <span>padding edge</span> of the first <span>CSS layout box</span> associated with
  the <code title=dom-HTMLElement-offsetParent>offsetParent</code> of the element from the x-coordinate of
  the left <span>border edge</span> of the first <span>CSS layout box</span> associated
  with the element, relative to the <span>initial containing block</span>
  origin.</p>
 </li>
</ol>

<p>The <dfn title=dom-HTMLElement-offsetWidth><code>offsetWidth</code></dfn> attribute must return the result of running these steps:</p>
<ol>
 <li><p>If the element does not have any associated <span>CSS layout box</span> return zero and terminate this algorithm.</p></li>
 <li><p>Return the <span>border edge</span> width of the first <span>CSS layout box</span> associated with the element.</p></li>
</ol>

<p>The <dfn title=dom-HTMLElement-offsetHeight><code>offsetHeight</code></dfn> attribute must return the result of running these steps:</p>
<ol>
 <li><p>If the element does not have any associated <span>CSS layout box</span> return zero and terminate this algorithm.</p></li>
 <li><p>Return the <span>border edge</span> height of the first <span>CSS layout box</span> associated with the element.</p></li>
</ol>

<h2>Extensions to the <code title>Range</code> Interface</h2>

<p>The objects the methods described below return must
be static.</p>

<pre class=idl>partial interface <span data-anolis-spec=dom>Range</span> {
  ClientRectList getClientRects();
  ClientRect getBoundingClientRect();
};</pre>

<p>The <dfn title=dom-Range-getClientRects><code>getClientRects()</code></dfn> method, when invoked, must return an empty
<code>ClientRectList</code> object if the range is not in the document and
otherwise a <code>ClientRectList</code> object containing a list of
<code>ClientRect</code> objects in content order that matches the
following constraints:</p>
<ul>
 <li>For each element selected by the range, whose parent is not selected
 by the range, include the border boxes returned by invoking
 <code title=dom-Element-getClientRects>getClientRects()</code> on the
 element.</li>
 <li>For each <code>Text</code> node selected or partially selected by the
 range (including when the boundary-points are identical), include a
 <code>ClientRect</code> object (for the part that is selected, not the
 whole line box). The bounds of these <code>ClientRect</code> objects are
 computed using font metrics; thus, for horizontal writing, the vertical
 dimension of each box is determined by the font ascent and descent, and
 the horizontal dimension by the text advance width.</li>
</ul>

<p>The <dfn title=dom-Range-getBoundingClientRect><code>getBoundingClientRect()</code></dfn> method, when invoked, must return the result of the following
algorithm:</p>
<ol>
 <li><p>Let <var title>list</var> be the result of invoking
 <code title=dom-Range-getClientRects>getClientRects()</code> on the
 same range this method was invoked on.</p></li>
 <li><p>If <var title>list</var> is empty return a
 <code>ClientRect</code> object whose
 <code title=dom-ClientRect-top>top</code>,
 <code title=dom-ClientRect-right>right</code>,
 <code title=dom-ClientRect-bottom>bottom</code> and
 <code title=dom-ClientRect-left>left</code> members are zero.</p></li>
 <li><p>Otherwise, return a <code>ClientRect</code> object describing the
 smallest rectangle that includes the first rectangle in <var title>list</var>
 and all of the remaining rectangles of which the height or width is not
 zero.</p></li>
</ol>

<h2>Extensions to the <code title>MouseEvent</code> Interface</h2>

<p class="XXX">The object IDL fragment redefines some members. Can we
resolve this somehow?</p>

<!-- x/y do not match IE in the position:relative case but do match other
browsers -->

<pre class=idl>partial interface <span>MouseEvent</span> {
  readonly attribute double <span title=dom-MouseEvent-screenX>screenX</span>;
  readonly attribute double <span title=dom-MouseEvent-screenY>screenY</span>;
  readonly attribute double <span title=dom-MouseEvent-pageX>pageX</span>;
  readonly attribute double <span title=dom-MouseEvent-pageY>pageY</span>;
  readonly attribute double <span title=dom-MouseEvent-clientX>clientX</span>;
  readonly attribute double <span title=dom-MouseEvent-clientY>clientY</span>;
  readonly attribute double <span title=dom-MouseEvent-x>x</span>;
  readonly attribute double <span title=dom-MouseEvent-y>y</span>;
  readonly attribute double <span title=dom-MouseEvent-offsetX>offsetX</span>;
  readonly attribute double <span title=dom-MouseEvent-offsetY>offsetY</span>;
};

partial dictionary <span>MouseEventInit</span> {
  double screenX = 0;
  double screenY = 0;
  double pageX = 0;
  double pageY = 0;
  double clientX = 0;
  double clientY = 0;
  double x = 0;
  double y = 0;
  double offsetX = 0;
  double offsetY = 0;
};</pre>

<p>The <dfn title=dom-MouseEvent-screenX><code>screenX</code></dfn> attribute must return the x-coordinate of
the position where the event occurred relative to the origin of the
screen.</p>

<p>The <dfn title=dom-MouseEvent-screenY><code>screenY</code></dfn> attribute must return the y-coordinate of
the position where the event occurred relative to the origin of the
screen.</p>

<p>The <dfn title=dom-MouseEvent-pageX><code>pageX</code></dfn> attribute must return the horizontal coordinate of
the position where the event occurred relative to
the origin of the <span>initial containing block</span>.</p>

<p>The <dfn title=dom-MouseEvent-pageY><code>pageY</code></dfn> attribute must return the y-coordinate of the
position where the event occurred relative to the origin of the
<span>initial containing block</span>.</p>

<p>The <dfn title=dom-MouseEvent-clientX><code>clientX</code></dfn> attribute must return the x-coordinate of
the position where the event occurred relative to the origin of the
<span>viewport</span>.</p>

<p>The <dfn title=dom-MouseEvent-clientY><code>clientY</code></dfn> attribute must return the y-coordinate of
the position where the event occurred relative to the origin of the
<span>viewport</span>.</p>

<p>The <dfn title=dom-MouseEvent-x><code>x</code></dfn> attribute must return the value of <code title=dom-MouseEvent-clientX>clientX</code>.</p>

<p>The <dfn title=dom-MouseEvent-y><code>y</code></dfn> attribute must return the value of <code title=dom-MouseEvent-clientY>clientY</code>.</p>

<p>The <dfn title=dom-MouseEvent-offsetX><code>offsetX</code></dfn> attribute must return the x-coordinate of
the position where the event occurred relative to the origin of the
<span>padding edge</span> of the target node.</p>

<p>The <dfn title=dom-MouseEvent-offsetY><code>offsetY</code></dfn> attribute must return the y-coordinate of
the position where the event occurred relative to the origin of the
<span>padding edge</span> of the target node.</p>

<h2>Rectangles</h2>


<h3>The <code title>ClientRectList</code> Interface</h3>

<p>The <code>ClientRectList</code> interface consists of an ordered list of <code>ClientRect</code> objects.</p>

<pre class=idl>interface <dfn>ClientRectList</dfn> {
  readonly attribute unsigned long <span title=dom-ClientRectList-length>length</span>;
  getter <span>ClientRect</span> <span title=dom-ClientRectList-item>item</span>(unsigned long index);
};</pre>

<p>The <dfn title=dom-ClientRectList-length><code>length</code></dfn> attribute must return the total number of <code>ClientRect</code> objects associated with
the object.</p>

<p>The <dfn title=dom-ClientRectList-item><code>item(<var title>index</var>)</code></dfn> method, when invoked, must throw an
<code data-anolis-spec=dom>IndexSizeError</code> exception when <var title>index</var> is
greater than the number of <code>ClientRect</code> objects associated with the object. Otherwise, the <code>ClientRect</code> object at
<var title>index</var> must be returned.</p>

<h3>The <code title>ClientRect</code> Interface</h3>

<p>Objects implementing the <code>ClientRect</code> interface represent a rectangular box. The type of box is specified by the method that returns a
<code>ClientRect</code> object.</p>

<pre class=idl>interface <dfn>ClientRect</dfn> {
  readonly attribute double <span title=dom-ClientRect-top>top</span>;
  readonly attribute double <span title=dom-ClientRect-top>right</span>;
  readonly attribute double <span title=dom-ClientRect-top>bottom</span>;
  readonly attribute double <span title=dom-ClientRect-top>left</span>;
  readonly attribute double <span title=dom-ClientRect-top>width</span>;
  readonly attribute double <span title=dom-ClientRect-top>height</span>;
};</pre>

<p>The <dfn title=dom-ClientRect-top><code>top</code></dfn> attribute must return the y-coordinate, relative to the <span>viewport</span> origin, of the top of
the rectangle box.</p>

<p>The <dfn title=dom-ClientRect-right><code>right</code></dfn> attribute must return the x-coordinate, relative to the <span>viewport</span> origin, of the
right of the rectangle box.</p>

<p>The <dfn title=dom-ClientRect-bottom><code>bottom</code></dfn> attribute must return the y-coordinate, relative to the <span>viewport</span> origin, of the
bottom of the rectangle box.</p>

<p>The <dfn title=dom-ClientRect-left><code>left</code></dfn> attribute must return the x-coordinate, relative to the <span>viewport</span> origin, of the left
of the rectangle box.</p>

<p>The <dfn title=dom-ClientRect-width><code>width</code></dfn> attribute must return the width of the rectangle box.</p>
<p class='note'>This is identical to <code title='dom-ClientRect-right'>right</code> minus <code title='dom-ClientRect-left'>left</code>.</p>

<p>The <dfn title=dom-ClientRect-height><code>height</code></dfn> attribute must return the height of the rectangle box.</p>
<p class='note'>This is identical to <code title='dom-ClientRect-bottom'>bottom</code> minus <code title='dom-ClientRect-top'>top</code>.</p>

  
<h2>Events</h2>

<h3>Resizing viewports</h3>

<p>Whenever a <span>viewport</span> has its width or height changed (e.g. as a result of the user resizing the browser window, or zooming in, or an
<code>iframe</code> element's dimensions are changed), the user agent must <span data-anolis-spec=html>queue a task</span> to
<span data-anolis-spec=dom title=concept-event-fire>fire an event</span> event named
<code>resize</code> at the <code data-anolis-spec=html>Window</code> object associated with that
<span>viewport</span>. If such a resize is ongoing over a period of time, the user agent must <span data-anolis-spec=html title="queue a task">queue</span> that
task at a user agent-defined interval while the resize is ongoing.

<h3>Scrolling</h3>

<p>Whenever a <span>viewport</span> gets scrolled in response to user interaction, the user agent must <span data-anolis-spec=html>queue a task</span> to
<span data-anolis-spec=html title=concept-event-fire>fire an event</span> named
<code>scroll</code> that bubbles at the <code data-anolis-spec=dom>Document</code> object associated with that <span>viewport</span>. If such a scroll is
ongoing over a period of time, the user agent must <span data-anolis-spec=html title="queue a task">queue</span> that task at a user agent-defined interval
while the scroll is ongoing.

<p>Whenever an element gets scrolled in response to user interaction, the user agent must <span data-anolis-spec=html>queue a task</span> to
<span data-anolis-spec=dom title=concept-event-fire>fire an event</span> named
<code>scroll</code> at the element. If such a scroll is ongoing over a period of time, the user agent must
<span data-anolis-spec=html title="queue a task">queue</span> that task at a user agent-defined interval while the scroll is ongoing.


<h2>CSS properties</h2>

<p class=XXX>The features in this section should be moved to some other specification.

<h3>Smooth Scrolling: The '<code title>scroll-behavior</code>' Property</h3>

<pre class=propdef>
Name: <dfn>scroll-behavior</dfn>
Value: instant | smooth
Initial: instant
Applies to: scrolling boxes
Inherited: no
Computed value:	specified value 
Media: visual
Animatable: no
Canonical Order: per grammar
</pre>

<p>The '<code>scroll-behavior</code>' property specifies the scrolling behavior for a scrolling box, when scrolling happens due to navigation or CSSOM scrolling
APIs. Scrolls that are performed by the user are not affected by this property. When this property is specified on the root element, it applies to the
<span>viewport</span> instead.

<dl>
 <dt>'<dfn title=scroll-behavior-instant><code>instant</code></dfn>'
 <dd><p>The scrolling box is scrolled in an instant fashion.

 <dt>'<dfn title=scroll-behavior-smooth><code>smooth</code></dfn>'
 <dd><p>The scrolling box is scrolled in a smooth fashion using a user agent-defined timing function over a user agent-defined period of time. User agents
 should follow platform convensions, if any.
</dl>

<p>User agents may ignore this property.

<h2 class=no-num>References</h2>
<div id=anolis-references></div>

<h2 class="no-num">Acknowledgments</h2>

<p>The editors would like to thank

Alexey Feldgendler,
Bj&ouml;rn H&ouml;hrmann,
Dan Bates,
David Vest,
Garrett Smith,
Hallvord R. M. Steen,
Leif Arne Storset,
Luiz Agostini,
Maciej Stachowiak,
Michael Dyck,
Mike Wilson,
Morten Stenshorne,
Peter-Paul Koch,
Rachel Kmetz,
Robert O'Callahan,
Sam Weinig,
<!--Simon Pieters,-->
Scott Johnson,
Sylvain Galineau,
Tarquin Wilton-Jones,
Thomas Moore, and
Xiaomei Ji<!-- should actually use real name here -->

for their contributions to this document.</p>

<p>Special thanks to the Microsoft employees who first implemented many of
the features specified in this draft, which were first widely deployed by
the Windows Internet Explorer browser.</p>
 </body>
</html>
