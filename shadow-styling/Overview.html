<!DOCTYPE html><html lang=en><head>
  <meta content="text/html; charset=utf-8" http-equiv=Content-Type>
  <title>Shadow DOM Styling</title>
  <link href=../default.css rel=stylesheet type=text/css>
  <link href=../csslogo.ico rel="shortcut icon" type=image/x-icon>
  <style>
  body {
    background: url("https://www.w3.org/StyleSheets/TR/logo-ED") top left no-repeat white;
    background-attachment: fixed;
    color: black;
    font-family: sans-serif;
    margin: 0 auto;
    max-width: 50em;
    padding: 2em 1em 2em 70px;
  }
  :link { color: #00C; background: transparent }
  :visited { color: #609; background: transparent }
  a[href]:active { color: #C00; background: transparent }
  a[href]:hover { background: #ffa }

  a[href] img { border-style: none }

  h1, h2, h3, h4, h5, h6 { text-align: left }
  h1, h2, h3 { color: #005A9C; }
  h1 { font: 170% sans-serif }
  h2 { font: 140% sans-serif }
  h3 { font: 120% sans-serif }
  h4 { font: bold 100% sans-serif }
  h5 { font: italic 100% sans-serif }
  h6 { font: small-caps 100% sans-serif }

  .hide { display: none }

  div.head { margin-bottom: 1em }
  div.head h1 { margin-top: 2em; clear: both }
  div.head table { margin-left: 2em; margin-top: 2em }

  p.copyright { font-size: small }
  p.copyright small { font-size: small }

  pre { margin-left: 2em }
  dt { font-weight: bold }

  ul.toc, ol.toc {
    list-style: none;
  }
  </style>
</head>
<body class=h-entry>
<div class=head>
  <p data-fill-with=logo><a class=logo href=http://www.w3.org/>
    <img alt=W3C height=48 src=http://www.w3.org/Icons/w3c_home width=72>
</a>
</p>
  <h1 class="p-name no-ref" id=title>Shadow DOM Styling</h1>
  <h2 class="no-num no-toc no-ref heading settled heading" id=subtitle><span class=content>Editor’s Draft,
    <span class=dt-updated><span class=value-title title=20140305>5 March 2014</span></span></span></h2>
  <div data-fill-with=spec-metadata><dl><dt>This version:<dd><a class=u-url href=http://dev.w3.org/csswg/shadow-styling>http://dev.w3.org/csswg/shadow-styling</a><dt>Editor’s Draft:<dd><a href=http://dev.w3.org/csswg/shadow-styling>http://dev.w3.org/csswg/shadow-styling</a>
    <dt>Feedback:</dt>
        <dd><a href="mailto:www-style@w3.org?subject=%5Bshadow-styling%5D%20feedback">www-style@w3.org</a>
            with subject line
            “<kbd>[shadow-styling] <var>… message topic …</var></kbd>”(<a href=http://lists.w3.org/Archives/Public/www-style/ rel=discussion>archives</a>)<dt>Test Suite:<dd>None Yet<dt>Editors:
<dd class="p-author h-card vcard"><a class="p-name fn u-url url" href=http://xanthir.com/contact/>Tab Atkins Jr.</a> (<span class="p-org org">Google</span>)</dl></div>
  <div data-fill-with=warning></div>
  <p class=copyright data-fill-with=copyright><a href=http://www.w3.org/Consortium/Legal/ipr-notice#Copyright>Copyright</a> © 2014 <a href=http://www.w3.org/><abbr title="World Wide Web Consortium">W3C</abbr></a><sup>®</sup> (<a href=http://www.csail.mit.edu/><abbr title="Massachusetts Institute of Technology">MIT</abbr></a>, <a href=http://www.ercim.eu/><abbr title="European Research Consortium for Informatics and Mathematics">ERCIM</abbr></a>, <a href=http://www.keio.ac.jp/>Keio</a>, <a href=http://ev.buaa.edu.cn/>Beihang</a>), All Rights Reserved. W3C <a href=http://www.w3.org/Consortium/Legal/ipr-notice#Legal_Disclaimer>liability</a>, <a href=http://www.w3.org/Consortium/Legal/ipr-notice#W3C_Trademarks>trademark</a> and <a href=http://www.w3.org/Consortium/Legal/copyright-documents>document use</a> rules apply.
</p>
  <hr title="Separator for header">
</div>

<h2 class="no-num no-toc no-ref heading settled heading" id=abstract><span class=content>Abstract</span></h2>
<p class=p-summary data-fill-with=abstract>This specification defines the additions to CSS to accommodate Shadow DOM styling.
<a href=http://www.w3.org/TR/CSS/>CSS</a> is a language for describing the rendering of structured documents 
(such as HTML and XML) 
on screen, on paper, in speech, etc.</p>

<h2 class="no-num no-toc no-ref heading settled heading" id=status><span class=content>Status of this document</span></h2>
<div data-fill-with=status><p>
	This is a public copy of the editors’ draft. 
	It is provided for discussion only and may change at any moment. 
	Its publication here does not imply endorsement of its contents by W3C. 
	Don’t cite this document other than as work in progress.

<p>
	The (<a href=http://lists.w3.org/Archives/Public/www-style/>archived</a>) public mailing list
	<a href="mailto:www-style@w3.org?Subject=%5Bshadow-styling%5D%20PUT%20SUBJECT%20HERE">www-style@w3.org</a> 
	(see <a href=http://www.w3.org/Mail/Request>instructions</a>) 
	is preferred for discussion of this specification. 
	When sending e-mail, 
	please put the text “shadow-styling” in the subject, 
	preferably like this:
	“[shadow-styling] <em>…summary of comment…</em>”

<p>
	This document was produced by the <a href=http://www.w3.org/Style/CSS/members>CSS Working Group</a> 
	(part of the <a href=http://www.w3.org/Style/>Style Activity</a>).

<p>
	This document was produced by a group operating under 
	the <a href=http://www.w3.org/Consortium/Patent-Policy-20040205/>5 February 2004 W3C Patent Policy</a>. 
	W3C maintains a <a href=http://www.w3.org/2004/01/pp-impl/32061/status rel=disclosure>public list of any patent disclosures</a> 
	made in connection with the deliverables of the group; 
	that page also includes instructions for disclosing a patent. 
	An individual who has actual knowledge of a patent which the individual believes contains <a href=http://www.w3.org/Consortium/Patent-Policy-20040205/#def-essential>Essential Claim(s)</a> 
	must disclose the information in accordance with <a href=http://www.w3.org/Consortium/Patent-Policy-20040205/#sec-Disclosure>section 6 of the W3C Patent Policy</a>.</div>
<div data-fill-with=at-risk></div>

<h2 class="no-num no-toc no-ref heading settled heading" id=contents><span class=content>Table of Contents</span></h2>
<div data-fill-with=table-of-contents><ul class=toc>
	<li><a href=#intro><span class=secno>1</span> Introduction</a>
	<li><a href=#shadow-dom><span class=secno>2</span> Shadow DOM CSS Concepts</a>
		<ul class=toc>
		<li><a href=#shadow-trees><span class=secno>2.1</span> Shadow Trees</a>
		<li><a href=#distribution-lists><span class=secno>2.2</span> Distribution Lists</a>
		<li><a href=#inheritance0><span class=secno>2.3</span> Inheritance and Shadow DOM</a></ul>
	<li><a href=#selectors-data-model><span class=secno>3</span> Extensions to the Selectors Data Model</a>
		<ul class=toc>
		<li><a href=#host-element><span class=secno>3.1</span> Host Elements in a Shadow Tree</a></ul>
	<li><a href=#inheritance><span class=secno>4</span> Shadow DOM Combinators</a>
		<ul class=toc>
		<li><a href=#shadow-combinator><span class=secno>4.1</span> Selecting Into A Shadow Tree: the <span class=css data-link-type=maybe title=/shadow/>/shadow/</span> combinator</a>
		<li><a href=#shadow-child-combinator><span class=secno>4.2</span> Selecting the Top-level Elements in a Shadow Tree: the <span class=css data-link-type=maybe title=/shadow-child/>/shadow-child/</span> combinator</a>
		<li><a href=#shadow-deep-combinator><span class=secno>4.3</span> Selecting Through All Shadows: the <span class=css data-link-type=maybe title=/shadow-deep/>/shadow-deep/</span> combinator</a>
		<li><a href=#content-combinator><span class=secno>4.4</span> Selecting Distributed Elements: the <span class=css data-link-type=maybe title=/content/>/content/</span> combinator</a></ul>
	<li><a href=#selectors><span class=secno>5</span> Shadow DOM Selectors</a>
		<ul class=toc>
		<li><a href=#top-selector><span class=secno>5.1</span> Selecting Root-like Elements: the <span class=css data-link-type=maybe title=:top>:top</span> pseudo-class</a>
		<li><a href=#host-selector><span class=secno>5.2</span> Selecting the Host Element: the <span class=css data-link-type=maybe title=:host>:host</span> and <span class=css data-link-type=maybe title=:host()>:host()</span> pseudo-classes</a>
		<li><a href=#ancestor-selector><span class=secno>5.3</span> Selecting Based on an Ancestor Outside the Shadow Tree: the <span class=css data-link-type=maybe title=:ancestor()>:ancestor()</span> pseudo-class</a></ul>
	<li><a href=#cascading><span class=secno>6</span> Changes to the Cascading Model</a>
	<li><a href=#conformance><span class=secno></span> Conformance</a>
		<ul class=toc>
		<li><a href=#conventions><span class=secno></span> Document conventions</a>
		<li><a href=#conformance-classes><span class=secno></span> Conformance classes</a>
		<li><a href=#partial><span class=secno></span> Partial implementations</a>
		<li><a href=#experimental><span class=secno></span> Experimental implementations</a>
		<li><a href=#testing><span class=secno></span> Non-experimental implementations</a></ul>
	<li><a href=#references><span class=secno></span> References</a>
		<ul class=toc>
		<li><a href=#normative><span class=secno></span> Normative References</a>
		<li><a href=#informative><span class=secno></span> Informative References</a></ul>
	<li><a href=#index><span class=secno></span> Index</a>
	<li><a href=#property-index><span class=secno></span> Property index</a>
	<li><a href=#issues-index><span class=secno></span>Issues Index</a></ul></div>



<h2 class="heading settled heading" data-level=1 id=intro><span class=secno>1 </span><span class=content>
Introduction</span><a class=self-link href=#intro></a></h2>

<p>	...

<h2 class="heading settled heading" data-level=2 id=shadow-dom><span class=secno>2 </span><span class=content>
Shadow DOM CSS Concepts</span><a class=self-link href=#shadow-dom></a></h2>

<p>	The Shadow DOM spec augments the DOM with several new concepts,
	several of which are relevant to CSS.

<h3 class="heading settled heading" data-level=2.1 id=shadow-trees><span class=secno>2.1 </span><span class=content>
Shadow Trees</span><a class=self-link href=#shadow-trees></a></h3>

<p>	A <dfn data-dfn-type=dfn data-export="" id=shadow-tree>shadow tree<a class=self-link href=#shadow-tree></a></dfn> is a document fragment
	that can be attached to any element in the DOM.
	An element can have any number of <a data-link-type=dfn href=#shadow-tree title="shadow trees">shadow trees</a>,
	which are ordered by creation time.
	The most recently-created <a data-link-type=dfn href=#shadow-tree title="shadow tree">shadow tree</a> on an element
	is the <dfn data-dfn-type=dfn data-export="" id=active-shadow-tree>active shadow tree<a class=self-link href=#active-shadow-tree></a></dfn> for that element.

<p>	An element with a <a data-link-type=dfn href=#shadow-tree title="shadow tree">shadow tree</a> is a <dfn data-dfn-type=dfn data-export="" id=shadow-host>shadow host<a class=self-link href=#shadow-host></a></dfn>.
	It is the <dfn data-dfn-type=dfn data-export="" id=host-element0>host element<a class=self-link href=#host-element0></a></dfn> for its shadow trees.

<p>	The descendants of a <a data-link-type=dfn href=#shadow-host title="shadow host">shadow host</a>
	must not generate boxes as normal.
	Instead, the contents of the <a data-link-type=dfn href=#active-shadow-tree title="active shadow tree">active shadow tree</a> generates boxes
	as if it were the contents of the element instead.

<p>	All selectors appearing in a <a data-link-type=dfn href=#shadow-tree title="shadow tree">shadow tree</a>
	are <a data-link-type=dfn href=http://dev.w3.org/csswg/selectors-4/#scope title="scoped selectors">scoped selectors</a>,
	with the <a data-link-type=dfn href=#host-element0 title="host element">host element</a> as their <a data-link-type=dfn href=http://dev.w3.org/csswg/selectors-4/#scoping-root title="scoping root">scoping root</a>.

<h3 class="heading settled heading" data-level=2.2 id=distribution-lists><span class=secno>2.2 </span><span class=content>
Distribution Lists</span><a class=self-link href=#distribution-lists></a></h3>

<p>	While the children of a <a data-link-type=dfn href=#shadow-host title="shadow host">shadow host</a> do not generate boxes normally,
	they can be explicitly pulled into a <a data-link-type=dfn href=#shadow-tree title="shadow tree">shadow tree</a> and forced to render normally.
	This is done by assigning the elements to a <dfn data-dfn-type=dfn data-export="" id=distribution-list>distribution list<a class=self-link href=#distribution-list></a></dfn>.
	An element with a <a data-link-type=dfn href=#distribution-list title="distribution list">distribution list</a> is an <dfn data-dfn-type=dfn data-export="" id=insertion-point>insertion point<a class=self-link href=#insertion-point></a></dfn>.

<p>	This specification does not define how to assign elements to a <a data-link-type=dfn href=#distribution-list title="distribution list">distribution list</a>,
	instead leaving that to the Shadow DOM spec.
	At the time this spec is written, however,
	only <a data-link-type=element title=content>content</a> elements in a <a data-link-type=dfn href=#shadow-tree title="shadow tree">shadow tree</a> can have <a data-link-type=dfn href=#distribution-list title="distribution lists">distribution lists</a>.

<p>	An <a data-link-type=dfn href=#insertion-point title="insertion point">insertion point</a> must not generate any boxes.
	Instead, the elements in its <a data-link-type=dfn href=#distribution-list title="distribution list">distribution list</a> generate boxes as normal,
	as if they all replaced the <a data-link-type=dfn href=#insertion-point title="insertion point">insertion point</a> in-place.
	<span class=note>(Akin to the behavior of <a class=css data-link-type=propdesc href=http://dev.w3.org/csswg/css-display-3/#propdef-display-box title=display-box>display-box: contents</a>.)</span>

<h3 class="heading settled heading" data-level=2.3 id=inheritance0><span class=secno>2.3 </span><span class=content>
Inheritance and Shadow DOM</span><a class=self-link href=#inheritance0></a></h3>

<p>	The <a data-link-type=dfn href=#top-level-element title="top-level elements">top-level elements</a> of a <a data-link-type=dfn href=#shadow-tree title="shadow tree">shadow tree</a>
	inherit from their <a data-link-type=dfn href=#host-element0 title="host element">host element</a>.

<p>	The elements in a <a data-link-type=dfn href=#distribution-list title="distribution list">distribution list</a> inherit normally,
	from their parent.
	Shadow DOM does not change the behavior of inheritance here.

<h2 class="heading settled heading" data-level=3 id=selectors-data-model><span class=secno>3 </span><span class=content>
Extensions to the Selectors Data Model</span><a class=self-link href=#selectors-data-model></a></h2>

<p>	Elements in the <a data-link-type=dfn href=http://dev.w3.org/csswg/selectors-4/#element-tree title="element tree">element tree</a>
	additionally have zero or more <a data-link-type=dfn href=#shadow-tree title="shadow trees">shadow trees</a>
	and zero or one <a data-link-type=dfn href=#distribution-list title="distribution lists">distribution lists</a>.

<p class=note>	Note: The "descendants" of an element
	are based on the children of the element,
	which does not include the <a data-link-type=dfn href=#shadow-tree title="shadow trees">shadow trees</a> or <a data-link-type=dfn href=#distribution-list title="distribution lists">distribution lists</a> of the element.

<p>	When a selector is matched against a <a data-link-type=dfn href=#shadow-tree title="shadow tree">shadow tree</a>,
	the <a data-link-type=dfn href=http://dev.w3.org/csswg/selectors-4/#initial-selector-match-list title="initial selector match list">initial selector match list</a>
	is the <a data-link-type=dfn href=#shadow-host title="shadow host">shadow host</a>,
	followed by all the <a data-link-type=dfn href=#top-level-element title="top-level elements">top-level elements</a> of the <a data-link-type=dfn href=#shadow-tree title="shadow tree">shadow tree</a>
	and their descendants,
	ordered by a pre-order traversal.

<h3 class="heading settled heading" data-level=3.1 id=host-element><span class=secno>3.1 </span><span class=content>
Host Elements in a Shadow Tree</span><a class=self-link href=#host-element></a></h3>

<p>	A <a data-link-type=dfn href=#shadow-host title="shadow host">shadow host</a> is outside of the <a data-link-type=dfn href=#shadow-tree title="shadow trees">shadow trees</a> it hosts,
	but it is sometimes useful to be able to style it from inside the <a data-link-type=dfn href=#shadow-tree title="shadow tree">shadow tree</a> context.

<p>	For the purpose of Selectors,
	a <a data-link-type=dfn href=#host-element0 title="host element">host element</a> also appears in each of its <a data-link-type=dfn href=#shadow-tree title="shadow trees">shadow trees</a>,
	with the contents of the <a data-link-type=dfn href=#shadow-tree title="shadow tree">shadow tree</a> treated as its children.
	If an element has multiple <a data-link-type=dfn href=#shadow-tree title="shadow trees">shadow trees</a>,
	it appears in each <a data-link-type=dfn href=#shadow-tree title="shadow tree’s">shadow tree’s</a> context independently;
	each <a data-link-type=dfn href=#shadow-tree title="shadow tree">shadow tree</a> sees <em>itself</em> as the contents of the <a data-link-type=dfn href=#host-element0 title="host element">host element</a>,
	not the other <a data-link-type=dfn href=#shadow-tree title="shadow trees">shadow trees</a>.

<p>	The <a data-link-type=dfn href=#host-element0 title="host element">host element</a> is not selectable by <strong>any means</strong>
	except for the <a class=css data-link-type=maybe href=#selectordef-host0 title=:host>:host</a> pseudo-class.
	That is, in this context the <a data-link-type=dfn href=#shadow-host title="shadow host">shadow host</a>
	has no tagname, ID, classes, or attributes,
	and the only additional information is has is that the <a class=css data-link-type=maybe href=#selectordef-host0 title=:host>:host</a> pseudo-class matches it.
	In particular, the <a data-link-type=dfn href=#host-element0 title="host element">host element</a> isn’t matched by the <span class=css data-link-type=maybe title=*>*</span> selector either.

	</p><details class=why>
		<summary>Why is the shadow host so weird?</summary>

<p>		The <a data-link-type=dfn href=#shadow-host title="shadow host">shadow host</a> lives outside the <a data-link-type=dfn href=#shadow-tree title="shadow tree">shadow tree</a>,
		and its markup is in control of the page author,
		not the component author.

<p>		It would not be very good if a component used a particular class name
		internally in a <a data-link-type=dfn href=#shadow-tree title="shadow tree">shadow tree</a>,
		and the page author using the component accidentally <em>also</em>
		used the the same class name and put it on the <a data-link-type=dfn href=#host-element0 title="host element">host element</a>.
		Such a situation would result in accidental styling
		that is impossible for the component author to predict,
		and confusing for the page author to debug.

<p>		However, there are still some reasonable use-cases for letting a stylesheet in a <a data-link-type=dfn href=#shadow-tree title="shadow tree">shadow tree</a>
		style its <a data-link-type=dfn href=#host-element0 title="host element">host element</a>.
		So, to allow this situation but prevent accidental styling,
		the <a data-link-type=dfn href=#host-element0 title="host element">host element</a> appears but is completely featureless
		and unselectable except through <a class=css data-link-type=maybe href=#selectordef-host0 title=:host>:host</a>.
	</details>



<h2 class="heading settled heading" data-level=4 id=inheritance><span class=secno>4 </span><span class=content>
Shadow DOM Combinators</span><a class=self-link href=#inheritance></a></h2>

<p>	Shadow DOM defines several new combinators
	to help style the contents of <a data-link-type=dfn href=#shadow-tree title="shadow trees">shadow trees</a> and <a data-link-type=dfn href=#distribution-list title="distribution lists">distribution lists</a>.

	<p class=issue id=issue-46cdc4d6><a class=self-link href=#issue-46cdc4d6></a>
		I’m assuming here that "/foo/" is the syntax we’ll agree on for named combinators.

<h3 class="heading settled heading" data-level=4.1 id=shadow-combinator><span class=secno>4.1 </span><span class=content>
Selecting Into A Shadow Tree: the <a class=css data-link-type=maybe href=#selectordef-shadow title=/shadow/>/shadow/</a> combinator</span><a class=self-link href=#shadow-combinator></a></h3>

<p>	When a <dfn class=css-code data-dfn-type=selector data-export="" id=selectordef-shadow>/shadow/<a class=self-link href=#selectordef-shadow></a></dfn> combinator is encountered in a selector,
	first filter the <a data-link-type=dfn href=http://dev.w3.org/csswg/selectors-4/#selector-match-list title="selector match list">selector match list</a> to only include elements with <a data-link-type=dfn href=#shadow-tree title="shadow trees">shadow trees</a>.
	Then replace every element in the <a data-link-type=dfn href=http://dev.w3.org/csswg/selectors-4/#selector-match-list title="selector match list">selector match list</a>
	with the <a data-link-type=dfn href=#top-level-element title="top-level elements">top-level elements</a> of each <a data-link-type=dfn href=#shadow-tree title="shadow tree">shadow tree</a> of the element,
	and every element reachable by traversing any number of child lists
	from those elements.

	<div class=example>
		For example, say you had a component with a <a data-link-type=dfn href=#shadow-tree title="shadow tree">shadow tree</a> like the following:

		<pre>  &lt;x-foo&gt;
    &lt;"shadow tree"&gt;
      &lt;div&gt;
        &lt;span id="not-top"&gt;...&lt;/span&gt;
      &lt;/div&gt;
      &lt;span id="top"&gt;...&lt;/span&gt;
      &lt;x-bar&gt;
        &lt;"shadow tree"&gt;
          &lt;span id="nested"&gt;...&lt;/span&gt;
        &lt;/&gt;
      &lt;/x-bar&gt;
    &lt;/&gt;
  &lt;/x-foo&gt;
</pre>
<p>		For a stylesheet in the outer document,
		the selector <span class=css data-link-type=maybe title="x-foo /shadow/ span">x-foo /shadow/ span</span>
		selects <span class=css data-link-type=maybe title=#top>#top</span> and <span class=css data-link-type=maybe title=#not-top>#not-top</span>.
		It does not match <span class=css data-link-type=maybe title=#nested>#nested</span>,
		as that element is further nested in the <a data-link-type=dfn href=#shadow-tree title="shadow tree">shadow tree</a> of the <code>&lt;x-bar&gt;</code> component.
	</div>

<h3 class="heading settled heading" data-level=4.2 id=shadow-child-combinator><span class=secno>4.2 </span><span class=content>
Selecting the Top-level Elements in a Shadow Tree: the <a class=css data-link-type=maybe href=#selectordef-shadow-child title=/shadow-child/>/shadow-child/</a> combinator</span><a class=self-link href=#shadow-child-combinator></a></h3>

<p>	When a <dfn class=css-code data-dfn-type=selector data-export="" id=selectordef-shadow-child>/shadow-child/<a class=self-link href=#selectordef-shadow-child></a></dfn> combinator is encountered in a selector,
	first filter the <a data-link-type=dfn href=http://dev.w3.org/csswg/selectors-4/#selector-match-list title="selector match list">selector match list</a> to only include elements with <a data-link-type=dfn href=#shadow-tree title="shadow trees">shadow trees</a>.
	Then replace every element in the <a data-link-type=dfn href=http://dev.w3.org/csswg/selectors-4/#selector-match-list title="selector match list">selector match list</a>
	with the <a data-link-type=dfn href=#top-level-element title="top-level elements">top-level elements</a> of each <a data-link-type=dfn href=#shadow-tree title="shadow tree">shadow tree</a> of the element.

	<div class=example>
		For example, say you had a component with a <a data-link-type=dfn href=#shadow-tree title="shadow tree">shadow tree</a> like the following:

		<pre>  &lt;x-foo&gt;
    &lt;"shadow tree"&gt;
      &lt;div&gt;
        &lt;span id="not-top"&gt;...&lt;/span&gt;
      &lt;/div&gt;
      &lt;span id="top"&gt;...&lt;/span&gt;
    &lt;/&gt;
  &lt;/x-foo&gt;
</pre>
<p>		For a stylesheet in the outer document,
		<span class=css data-link-type=maybe title="x-foo /shadow-child/ span">x-foo /shadow-child/ span</span> matches <span class=css data-link-type=maybe title=#top>#top</span>,
		but not <span class=css data-link-type=maybe title=#not-top>#not-top</span>,
		because it’s not a <a data-link-type=dfn href=#top-level-element title="top-level element">top-level element</a> in the <a data-link-type=dfn href=#shadow-tree title="shadow tree">shadow tree</a>.

<p>		If one wanted to target <span class=css data-link-type=maybe title=#not-top>#not-top</span>,
		one way to do it would be with <span class=css data-link-type=maybe title="x-foo /shadow-child/ div > span">x-foo /shadow-child/ div &gt; span</span>.
	</div>

	<p class=issue id=issue-871fab96><a class=self-link href=#issue-871fab96></a>
		This isn’t ideal.
		Maybe don’t implement this one yet,
		because it’s a clumsy design.

<h3 class="heading settled heading" data-level=4.3 id=shadow-deep-combinator><span class=secno>4.3 </span><span class=content>
Selecting Through All Shadows: the <a class=css data-link-type=maybe href=#selectordef-shadow-deep title=/shadow-deep/>/shadow-deep/</a> combinator</span><a class=self-link href=#shadow-deep-combinator></a></h3>

<p>	When a <dfn class=css-code data-dfn-type=selector data-export="" id=selectordef-shadow-deep>/shadow-deep/<a class=self-link href=#selectordef-shadow-deep></a></dfn> combinator is encountered in a selector,
	replace every element in the <a data-link-type=dfn href=http://dev.w3.org/csswg/selectors-4/#selector-match-list title="selector match list">selector match list</a>
	with every element reachable from the original element
	by traversing any number of child lists or shadow trees.

	<div class=example>
		For example, say you had a component with a <a data-link-type=dfn href=#shadow-tree title="shadow tree">shadow tree</a> like the following:

		<pre>  &lt;x-foo&gt;
    &lt;"shadow tree"&gt;
      &lt;div&gt;
        &lt;span id="not-top"&gt;...&lt;/span&gt;
      &lt;/div&gt;
      &lt;span id="top"&gt;...&lt;/span&gt;
      &lt;x-bar&gt;
        &lt;"shadow tree"&gt;
          &lt;span id="nested"&gt;...&lt;/span&gt;
        &lt;/&gt;
      &lt;/x-bar&gt;
    &lt;/&gt;
  &lt;/x-foo&gt;
</pre>
<p>		For a stylesheet in the outer document,
		the selector <span class=css data-link-type=maybe title="x-foo /shadow-deep/ span">x-foo /shadow-deep/ span</span>
		selects all three of <code>&lt;span&gt;</code> elements:
		<span class=css data-link-type=maybe title=#top>#top</span>, <span class=css data-link-type=maybe title=#not-top>#not-top</span>, <em>and</em> <span class=css data-link-type=maybe title=#nested>#nested</span>.
	</div>

<h3 class="heading settled heading" data-level=4.4 id=content-combinator><span class=secno>4.4 </span><span class=content>
Selecting Distributed Elements: the <a class=css data-link-type=maybe href=#selectordef-content title=/content/>/content/</a> combinator</span><a class=self-link href=#content-combinator></a></h3>

<p>	When a <dfn class=css-code data-dfn-type=selector data-export="" id=selectordef-content>/content/<a class=self-link href=#selectordef-content></a></dfn> combinator is encountered in a selector,
	first filter the <a data-link-type=dfn href=http://dev.w3.org/csswg/selectors-4/#selector-match-list title="selector match list">selector match list</a> to only include elements with <a data-link-type=dfn href=#distribution-list title="distribution lists">distribution lists</a>.
	Then replace every element in the <a data-link-type=dfn href=http://dev.w3.org/csswg/selectors-4/#selector-match-list title="selector match list">selector match list</a>
	with the elements in the <a data-link-type=dfn href=#distribution-list title="distribution list">distribution list</a> of each element.

	<div class=example>
		For example, say you had a component with both children and a shadow tree,
		like the following:

		<pre>  &lt;x-foo&gt;
    &lt;div id="one"&gt;...&lt;/div&gt;
    &lt;div id="two"&gt;...&lt;/div&gt;
    &lt;div id="three"&gt;
      &lt;div id="four"&gt;...&lt;/div&gt;
    &lt;/div&gt;
    &lt;"shadow tree"&gt;
      &lt;div id="five"&gt;...&lt;/div&gt;
      &lt;div id="six"&gt;...&lt;/div&gt;
      &lt;content select=":nth-child(odd)"&gt;&lt;/content&gt;
    &lt;/"shadow tree"&gt;
  &lt;/x-foo&gt;
</pre>
<p>		For a stylesheet within the <a data-link-type=dfn href=#shadow-tree title="shadow tree">shadow tree</a>,
		a selector like <span class=css data-link-type=maybe title="* /content/ div">* /content/ div</span>
		selects <span class=css data-link-type=maybe title=#one>#one</span> and <span class=css data-link-type=maybe title=#three>#three</span>,
		as they’re the elements distributed by the <code>&lt;content&gt;</code> element.
	</div>

<h2 class="heading settled heading" data-level=5 id=selectors><span class=secno>5 </span><span class=content>
Shadow DOM Selectors</span><a class=self-link href=#selectors></a></h2>

<p>	Shadow DOM defines a few new selectors
	to help select elements in useful way related to Shadow DOM.

<h3 class="heading settled heading" data-level=5.1 id=top-selector><span class=secno>5.1 </span><span class=content>
Selecting Root-like Elements: the <a class=css data-link-type=maybe href=#selectordef-top title=:top>:top</a> pseudo-class</span><a class=self-link href=#top-selector></a></h3>

<p>	The <dfn class=css-code data-dfn-type=selector data-export="" id=selectordef-top>:top<a class=self-link href=#selectordef-top></a></dfn> pseudo-class
	matches all elements which are not the children of other elements.
	These are called <dfn data-dfn-type=dfn data-export="" id=top-level-element title="top-level element">top-level elements<a class=self-link href=#top-level-element></a></dfn>.

	<div class=example>
		For example, the root of a document has no element parent.
		(In the DOM, it’s the child of a <code>Document</code> object,
		which is not an element.)

<p>		Similarly, elements that are children of a <code>ShadowRoot</code> object do not have element parents,
		nor do elements that are appended directly to a <code>DocumentFragment</code>.
	</div>

<p class=note>	Note: Note that this definition is based on the data model of the host document,
	not necessarily the data model of Selectors.
	For example, <a data-link-type=dfn href=#top-level-element title="top-level elements">top-level elements</a> in a <a data-link-type=dfn href=#shadow-tree title="shadow tree">shadow tree</a>
	are considered to have the <a data-link-type=dfn href=#host-element0 title="host element">host element</a> as their parent
	<em>for the purposes of Selectors</em>,
	but they still match <a class=css data-link-type=maybe href=#selectordef-top title=:top>:top</a> as they are not actually the child of an element.

<h3 class="heading settled heading" data-level=5.2 id=host-selector><span class=secno>5.2 </span><span class=content>
Selecting the Host Element: the <a class=css data-link-type=maybe href=#selectordef-host0 title=:host>:host</a> and <a class=css data-link-type=maybe href=#selectordef-host title=:host()>:host()</a> pseudo-classes</span><a class=self-link href=#host-selector></a></h3>

<p>	The <dfn class=css-code data-dfn-type=selector data-export="" id=selectordef-host0>:host<a class=self-link href=#selectordef-host0></a></dfn> pseudo-class,
	when evaluated in the context of a <a data-link-type=dfn href=#shadow-tree title="shadow tree">shadow tree</a>,
	matches the <a data-link-type=dfn href=#shadow-tree title="shadow tree’s">shadow tree’s</a> <a data-link-type=dfn href=#host-element0 title="host element">host element</a>.
	In any other context,
	it matches nothing.

<p>	The <dfn class=css-code data-dfn-type=selector data-export="" id=selectordef-host>:host()<a class=self-link href=#selectordef-host></a></dfn> function pseudo-class
	has the syntax:

<pre>:host( <a class="production css-code" data-link-type=type href=http://dev.w3.org/csswg/selectors-4/#ltcompound-selector title="<compound-selector>">&lt;compound-selector&gt;</a> )</pre>
<p>	When evaluated in the context of a <a data-link-type=dfn href=#shadow-tree title="shadow tree">shadow tree</a>,
	it matches the <a data-link-type=dfn href=#shadow-tree title="shadow tree’s">shadow tree’s</a> <a data-link-type=dfn href=#host-element0 title="host element">host element</a>
	if the <a data-link-type=dfn href=#host-element0 title="host element">host element</a>,
	in its normal context,
	matches the selector argument.
	In any other context,
	it matches nothing.

	<div class=example>
		For example, say you had a component with a <a data-link-type=dfn href=#shadow-tree title="shadow tree">shadow tree</a> like the following:

		<pre>  &lt;x-foo class="foo"&gt;
    &lt;"shadow tree"&gt;
      &lt;div class="foo"&gt;...&lt;/div&gt;
    &lt;/&gt;
  &lt;/x-foo&gt;
</pre>
<p>		For a stylesheet within the <a data-link-type=dfn href=#shadow-tree title="shadow tree">shadow tree</a>:

<p>		<ul>
			<li><a class=css data-link-type=maybe href=#selectordef-host0 title=:host>:host</a> matches the <code>&lt;x-foo&gt;</code> element.
			<li><span class=css data-link-type=maybe title=x-foo>x-foo</span> matches nothing.
			<li><span class=css data-link-type=maybe title=.foo>.foo</span> matches only the <code>&lt;div&gt;</code> element.
			<li><span class=css data-link-type=maybe title=.foo:host>.foo:host</span> matches nothing
			<li><span class=css data-link-type=maybe title=:host(.foo)>:host(.foo)</span> matches the <code>&lt;x-foo&gt;</code> element.
		</ul>
	</div>

<h3 class="heading settled heading" data-level=5.3 id=ancestor-selector><span class=secno>5.3 </span><span class=content>
Selecting Based on an Ancestor Outside the Shadow Tree: the <a class=css data-link-type=maybe href=#selectordef-ancestor title=:ancestor()>:ancestor()</a> pseudo-class</span><a class=self-link href=#ancestor-selector></a></h3>

<p>	Ordinary, selectors within a <a data-link-type=dfn href=#shadow-tree title="shadow tree">shadow tree</a>
	can’t see elements outside the <a data-link-type=dfn href=#shadow-tree title="shadow tree">shadow tree</a> at all.
	Sometimes, however, it’s useful to select an ancestor that lies somewhere outside the shadow tree,
	above it in the document.

	<div class=example>
		For example, a group of components can define a handful of color themes
		they they know how to respond to.
		Page authors could opt into a particular theme
		by adding a specific class to the components,
		or higher up in the document.
	</div>

<p>	The <dfn class=css-code data-dfn-type=selector data-export="" id=selectordef-ancestor>:ancestor()<a class=self-link href=#selectordef-ancestor></a></dfn> functional pseudo-class tests whether there is an ancestor,
	outside the <a data-link-type=dfn href=#shadow-tree title="shadow tree">shadow tree</a>,
	which matches a particular selector.
	Its syntax is:

<pre>:ancestor( <a class="production css-code" data-link-type=type href=http://dev.w3.org/csswg/selectors-4/#ltcompound-selector title="<compound-selector>">&lt;compound-selector&gt;</a> )</pre>
<p>	When evaluated in the context of a <a data-link-type=dfn href=#shadow-tree title="shadow tree">shadow tree</a>,
	the <a class=css data-link-type=maybe href=#selectordef-ancestor title=:ancestor()>:ancestor()</a> pseudo-class matches any element,
	if the <a data-link-type=dfn href=#host-element0 title="host element">host element</a> or one of its ancestors matches the provided <a class="production css-code" data-link-type=type href=http://dev.w3.org/csswg/selectors-4/#ltcompound-selector title="<compound-selector>">&lt;compound-selector&gt;</a>.
	For the purpose of this pseudo-class,
	the "ancestor" of an element is its parent,
	if it has one,
	or else its <a data-link-type=dfn href=#host-element0 title="host element">host element</a>,
	if it has one.

<p class=note>	Note: This means that the selector pierces through shadow boundaries on the way up,
	looking for elements that match its argument,
	until it reaches the document root.

<h2 class="heading settled heading" data-level=6 id=cascading><span class=secno>6 </span><span class=content>
Changes to the Cascading Model</span><a class=self-link href=#cascading></a></h2>

<p>	When calculating <a href=http://dev.w3.org/csswg/css-cascade/#cascade-order>cascade order</a>,
	declarations in <a data-link-type=dfn href=#shadow-tree title="shadow trees">shadow trees</a> are ordered by creation time,
	with younger <a data-link-type=dfn href=#shadow-tree title="shadow trees">shadow trees</a> treated as coming after older <a data-link-type=dfn href=#shadow-tree title="shadow trees">shadow trees</a>
	within a given <a data-link-type=dfn href=#host-element0 title="host element">host element</a>.

<p class=note>	Note: Note that styles in a shadow tree are <a data-link-type=dfn href=http://dev.w3.org/csswg/css-cascade-3/#scoped title=scoped>scoped</a> to their <a data-link-type=dfn href=#host-element0 title="host element">host element</a>,
	so no further ordering is necessary to define.

<h2 class="no-ref no-num heading settled heading" id=conformance><span class=content>
Conformance</span><a class=self-link href=#conformance></a></h2>

<h3 class="no-ref heading settled heading" id=conventions><span class=content>
Document conventions</span><a class=self-link href=#conventions></a></h3>

    <p>Conformance requirements are expressed with a combination of
    descriptive assertions and RFC 2119 terminology. The key words "MUST",
    "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT",
    "RECOMMENDED", "MAY", and "OPTIONAL" in the normative parts of this
    document are to be interpreted as described in RFC 2119.
    However, for readability, these words do not appear in all uppercase
    letters in this specification.

    <p>All of the text of this specification is normative except sections
    explicitly marked as non-normative, examples, and notes. <a data-biblio-type=normative data-link-type=biblio href=#rfc2119 title=rfc2119>[RFC2119]</a></p>

    <p>Examples in this specification are introduced with the words "for example"
    or are set apart from the normative text with <code>class="example"</code>,
    like this:

    <div class=example>
        <p>This is an example of an informative example.</p>
    </div>

    <p>Informative notes begin with the word "Note" and are set apart from the
    normative text with <code>class="note"</code>, like this:

    <p class=note>Note, this is an informative note.</p>

<h3 class="no-ref heading settled heading" id=conformance-classes><span class=content>
Conformance classes</span><a class=self-link href=#conformance-classes></a></h3>

    <p>Conformance to this specification
    is defined for three conformance classes:
    <dl>
        <dt>style sheet
            <dd>A <a href=http://www.w3.org/TR/CSS21/conform.html#style-sheet>CSS
            style sheet</a>.
        <dt>renderer
            <dd>A <a href=http://www.w3.org/TR/CSS21/conform.html#user-agent>UA</a>
            that interprets the semantics of a style sheet and renders
            documents that use them.
        <dt>authoring tool
            <dd>A <a href=http://www.w3.org/TR/CSS21/conform.html#user-agent>UA</a>
            that writes a style sheet.
    </dl>

    <p>A style sheet is conformant to this specification
    if all of its statements that use syntax defined in this module are valid
    according to the generic CSS grammar and the individual grammars of each
    feature defined in this module.

    <p>A renderer is conformant to this specification
    if, in addition to interpreting the style sheet as defined by the
    appropriate specifications, it supports all the features defined
    by this specification by parsing them correctly
    and rendering the document accordingly. However, the inability of a
    UA to correctly render a document due to limitations of the device
    does not make the UA non-conformant. (For example, a UA is not
    required to render color on a monochrome monitor.)

    <p>An authoring tool is conformant to this specification
    if it writes style sheets that are syntactically correct according to the
    generic CSS grammar and the individual grammars of each feature in
    this module, and meet all other conformance requirements of style sheets
    as described in this module.

<h3 class="no-ref heading settled heading" id=partial><span class=content>
Partial implementations</span><a class=self-link href=#partial></a></h3>

    <p>So that authors can exploit the forward-compatible parsing rules to
    assign fallback values, CSS renderers <strong>must</strong>
    treat as invalid (and <a href=http://www.w3.org/TR/CSS21/conform.html#ignore>ignore
    as appropriate</a>) any at-rules, properties, property values, keywords,
    and other syntactic constructs for which they have no usable level of
    support. In particular, user agents <strong>must not</strong> selectively
    ignore unsupported component values and honor supported values in a single
    multi-value property declaration: if any value is considered invalid
    (as unsupported values must be), CSS requires that the entire declaration
    be ignored.</p>

<h3 class="no-ref heading settled heading" id=experimental><span class=content>
Experimental implementations</span><a class=self-link href=#experimental></a></h3>

    <p>To avoid clashes with future CSS features, the CSS2.1 specification
    reserves a <a href=http://www.w3.org/TR/CSS21/syndata.html#vendor-keywords>prefixed
    syntax</a> for proprietary and experimental extensions to CSS.

    <p>Prior to a specification reaching the Candidate Recommendation stage
    in the W3C process, all implementations of a CSS feature are considered
    experimental. The CSS Working Group recommends that implementations
    use a vendor-prefixed syntax for such features, including those in
    W3C Working Drafts. This avoids incompatibilities with future changes
    in the draft.
    </p>

<h3 class="no-ref heading settled heading" id=testing><span class=content>
Non-experimental implementations</span><a class=self-link href=#testing></a></h3>

    <p>Once a specification reaches the Candidate Recommendation stage,
    non-experimental implementations are possible, and implementors should
    release an unprefixed implementation of any CR-level feature they
    can demonstrate to be correctly implemented according to spec.

    <p>To establish and maintain the interoperability of CSS across
    implementations, the CSS Working Group requests that non-experimental
    CSS renderers submit an implementation report (and, if necessary, the
    testcases used for that implementation report) to the W3C before
    releasing an unprefixed implementation of any CSS features. Testcases
    submitted to W3C are subject to review and correction by the CSS
    Working Group.

    <p>Further information on submitting testcases and implementation reports
    can be found from on the CSS Working Group’s website at
    <a href=http://www.w3.org/Style/CSS/Test/>http://www.w3.org/Style/CSS/Test/</a>.
    Questions should be directed to the
    <a href=http://lists.w3.org/Archives/Public/public-css-testsuite>public-css-testsuite@w3.org</a>
    mailing list.

<h2 class="no-num no-ref heading settled heading" id=references><span class=content>
References</span><a class=self-link href=#references></a></h2>

<h3 class="no-num no-ref heading settled heading" id=normative><span class=content>
Normative References</span><a class=self-link href=#normative></a></h3>
<div data-fill-with=normative-references><dl><dt id=rfc2119 title=RFC2119><a class=self-link href=#rfc2119></a>[RFC2119]<dd>S. Bradner. <a href=http://www.ietf.org/rfc/rfc2119.txt>Key words for use in RFCs to Indicate Requirement Levels</a>. URL: <a href=http://www.ietf.org/rfc/rfc2119.txt>http://www.ietf.org/rfc/rfc2119.txt</a></dl></div>

<h3 class="no-num no-ref heading settled heading" id=informative><span class=content>
Informative References</span><a class=self-link href=#informative></a></h3>
<div data-fill-with=informative-references><dl></dl></div>

<h2 class="no-num no-ref heading settled heading" id=index><span class=content>
Index</span><a class=self-link href=#index></a></h2>
<div data-fill-with=index><ul class=indexlist>
<li>active shadow tree, <a href=#active-shadow-tree title="section 2.1">2.1</a>
<li>:ancestor(), <a href=#selectordef-ancestor title="section 5.3">5.3</a>
<li>/content/, <a href=#selectordef-content title="section 4.4">4.4</a>
<li>distribution list, <a href=#distribution-list title="section 2.2">2.2</a>
<li>:host(), <a href=#selectordef-host title="section 5.2">5.2</a>
<li>:host, <a href=#selectordef-host0 title="section 5.2">5.2</a>
<li>host element, <a href=#host-element0 title="section 2.1">2.1</a>
<li>insertion point, <a href=#insertion-point title="section 2.2">2.2</a>
<li>/shadow/, <a href=#selectordef-shadow title="section 4.1">4.1</a>
<li>/shadow-child/, <a href=#selectordef-shadow-child title="section 4.2">4.2</a>
<li>/shadow-deep/, <a href=#selectordef-shadow-deep title="section 4.3">4.3</a>
<li>shadow host, <a href=#shadow-host title="section 2.1">2.1</a>
<li>shadow tree, <a href=#shadow-tree title="section 2.1">2.1</a>
<li>:top, <a href=#selectordef-top title="section 5.1">5.1</a>
<li>top-level element, <a href=#top-level-element title="section 5.1">5.1</a>
</ul></div>

<h2 class="no-num no-ref heading settled heading" id=property-index><span class=content>
Property index</span><a class=self-link href=#property-index></a></h2>
<div data-fill-with=property-index><p>No properties defined.</div>


<h2 class="no-num heading settled" id=issues-index><span class=content>Issues Index</span><a class=self-link href=#issues-index></a></h2><div style="counter-reset: issue"><div class=issue>
		I’m assuming here that "/foo/" is the syntax we’ll agree on for named combinators.

<a href=#issue-46cdc4d6> ↵ </a></div><div class=issue>
		This isn’t ideal.
		Maybe don’t implement this one yet,
		because it’s a clumsy design.

<a href=#issue-871fab96> ↵ </a></div></div>