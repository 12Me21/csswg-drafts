<h1>CSS Syntax Module Level 3</h1>

<pre class='metadata'>
Status: ED
ED: http://dev.w3.org/csswg/css-syntax/
TR: http://www.w3.org/TR/css-syntax-3/
Previous Version: http://www.w3.org/TR/2013/WD-css-syntax-3-20130919/
Shortname: css-syntax
Level: 3
Editor: Tab Atkins Jr., Google, http://xanthir.com/contact/
Editor: Simon Sapin, Mozilla, http://exyr.org/about/
Abstract: This module describes, in general terms, the basic structure and syntax of CSS stylesheets. It defines, in detail, the syntax and parsing of CSS - how to turn a stream of bytes into a meaningful stylesheet.
Ignored Terms: <keyframes-name>, <keyframe-rule>, <keyframe-selector>, <translation-value>, <media-query-list>
Link Defaults: css-text-decor-3 (property) text-decoration
</pre>

<link href="railroad-diagrams.css" rel="stylesheet" type="text/css">

<h2 id="intro">
Introduction</h2>

	<em>This section is not normative.</em>

	This module defines the abstract syntax and parsing of CSS stylesheets
	and other things which use CSS syntax
	(such as the HTML <code>style</code> attribute).

	It defines algorithms for converting a stream of Unicode <a>code points</a>
	(in other words, text)
	into a stream of CSS tokens,
	and then further into CSS objects
	such as stylesheets, rules, and declarations.

<h3 id="placement">
Module interactions</h3>

	This module defines the syntax and parsing of CSS stylesheets.
	It supersedes the lexical scanner and grammar defined in CSS 2.1.

<h2 id='syntax-description'>
Description of CSS's Syntax</h2>

	<em>This section is not normative.</em>

	A CSS document is a series of <a>qualified rules</a>,
	which are usually style rules that apply CSS properties to elements,
	and <a>at-rules</a>,
	which define special processing rules or values for the CSS document.

	A qualified rule starts with a prelude
	then has a {}-wrapped block containing a sequence of declarations.
	The meaning of the prelude varies based on the context that the rule appears in -
	for style rules, it's a selector which specifies what elements the declarations will apply to.
	Each declaration has a name,
	followed by a colon and the declaration value.
	Declarations are separated by semicolons.

	<div class='example'>

		A typical rule might look something like this:

		<pre>
			p > a {
				color: blue;
				text-decoration: underline;
			}
		</pre>

		In the above rule, "<code>p > a</code>" is the selector,
		which, if the source document is HTML,
		selects any <code>&lt;a></code> elements that are children of a <code>&lt;p></code> element.

		"<code>color: blue;</code>" is a declaration specifying that,
		for the elements that match the selector,
		their 'color' property should have the value ''blue''.
		Similiarly, their 'text-decoration' property should have the value ''underline''.
	</div>

	At-rules are all different, but they have a basic structure in common.
	They start with an "@" <a>code point</a> followed by their name.
	Some <a>at-rules</a> are simple statements,
	with their name followed by more CSS values to specify their behavior,
	and finally ended by a semicolon.
	Others are blocks;
	they can have CSS values following their name,
	but they end with a {}-wrapped block,
	similar to a <a>qualified rule</a>.
	Even the contents of these blocks are specific to the given <a>at-rule</a>:
	sometimes they contain a sequence of declarations, like a <a>qualified rule</a>;
	other times, they may contain additional blocks, or at-rules, or other structures altogether.

	<div class='example'>

		Here are several examples of <a>at-rules</a> that illustrate the varied syntax they may contain.

		<pre>@import "my-styles.css";</pre>

		The ''@import'' <a>at-rule</a> is a simple statement.
		After its name, it takes a single string or ''url()'' function to indicate the stylesheet that it should import.

		<pre>
			@page :left {
				margin-left: 4cm;
				margin-right: 3cm;
			}
		</pre>

		The ''@page'' <a>at-rule</a> consists of an optional page selector (the '':left'' pseudoclass),
		followed by a block of properties that apply to the page when printed.
		In this way, it's very similar to a normal style rule,
		except that its properties don't apply to any "element",
		but rather the page itself.

		<pre>
			@media print {
				body { font-size: 10pt }
			}
		</pre>

		The ''@media'' <a>at-rule</a> begins with a media type
		and a list of optional media queries.
		Its block contains entire rules,
		which are only applied when the ''@media''s conditions are fulfilled.
	</div>

	Property names and <a>at-rule</a> names are always <b>identifiers</b>,
	which have to start with a letter or a hyphen followed by a letter,
	and then can contain letters, numbers, hyphens, or underscores.
	You can include any <a>code point</a> at all,
	even ones that CSS uses in its syntax,
	by <a>escaping</a> it.

	The syntax of selectors is defined in the <a href="http://www.w3.org/TR/selectors/">Selectors spec</a>.
	Similarly, the syntax of the wide variety of CSS values is defined in the <a href="http://www.w3.org/TR/css3-values/">Values &amp; Units spec</a>.
	The special syntaxes of individual <a>at-rules</a> can be found in the specs that define them.

<h3 id="escaping">
Escaping</h3>

	<em>This section is not normative.</em>

	Any Unicode <a>code point</a> can be included in an identifier or quoted string
	by <dfn>escaping</dfn> it.
	CSS escape sequences start with a backslash (\), and continue with:

	<ul>
		<li>
			Any Unicode <a>code point</a> that is not a <a>hex digits</a> or a <a>newline</a>.
			The escape sequence is replaced by that <a>code point</a>.
		<li>
			Or one to six <a>hex digits</a>, followed by an optional <a>whitespace</a>.
			The escape sequence is replaced by the Unicode <a>code point</a>
			whose value is given by the hexadecimal digits.
			This optional whitespace allow hexadecimal escape sequences
			to be followed by "real" hex digits.

			<p class=example>
				An identifier with the value "&B"
				could be written as ''\26 B'' or ''\000026B''.

			<p class=note>
				A "real" space after the escape sequence must be doubled.
	</ul>

<h3 id="error-handling">
Error Handling</h3>

	<em>This section is not normative.</em>

	When errors occur in CSS,
	the parser attempts to recover gracefully,
	throwing away only the minimum amount of content
	before returning to parsing as normal.
	This is because errors aren't always mistakes -
	new syntax looks like an error to an old parser,
	and it's useful to be able to add new syntax to the language
	without worrying about stylesheets that include it being completely broken in older UAs.

	The precise error-recovery behavior is detailed in the parser itself,
	but it's simple enough that a short description is fairly accurate:

	<ul>
		<li>
			At the "top level" of a stylesheet,
			an <<at-keyword-token>> starts an at-rule.
			Anything else starts a qualified rule,
			and is included in the rule's prelude.
			This may produce an invalid selector,
			but that's not the concern of the CSS parser &mdash;
			at worst, it means the selector will match nothing.

		<li>
			Once an at-rule starts,
			nothing is invalid from the parser's standpoint;
			it's all part of the at-rule's prelude.
			Encountering a <<semicolon-token>> ends the at-rule immediately,
			while encountering an opening curly-brace <<{-token>> starts the at-rule's body.
			The at-rule seeks forward, matching blocks (content surrounded by (), {}, or [])
			until it finds a closing curly-brace <<}-token>> that isn't matched by anything else
			or inside of another block.
			The contents of the at-rule are then interpreted according to the at-rule's own grammar.

		<li>
			Qualified rules work similarly,
			except that semicolons don't end them;
			instead, they are just taken in as part of the rule's prelude.
			When the first {} block is found,
			the contents are always interpreted as a list of declarations.

		<li>
			When interpreting a list of declarations,
			unknown syntax at any point causes the parser to throw away whatever declaration it's currently building,
			and seek forward until it finds a semicolon (or the end of the block).
			It then starts fresh, trying to parse a declaration again.

		<li>
			If the stylesheet ends while any rule, declaration, function, string, etc. are still open,
			everything is automatically closed.
			This doesn't make them invalid,
			though they may be incomplete
			and thus thrown away when they are verified against their grammar.
	</ul>

<h2 id="tokenizing-and-parsing">
Tokenizing and Parsing CSS</h2>

	User agents must use the parsing rules described in this specification
	to generate the CSSOM trees from text/css resources.
	Together, these rules define what is referred to as the CSS parser.

	This specification defines the parsing rules for CSS documents,
	whether they are syntactically correct or not.
	Certain points in the parsing algorithm are said to be a <dfn title="parse error">parse errors</dfn>.
	The error handling for parse errors is well-defined:
	user agents must either act as described below when encountering such problems,
	or must abort processing at the first error that they encounter for which they do not wish to apply the rules described below.

	Conformance checkers must report at least one parse error condition to the user
	if one or more parse error conditions exist in the document
	and must not report parse error conditions
	if none exist in the document.
	Conformance checkers may report more than one parse error condition if more than one parse error condition exists in the document.
	Conformance checkers are not required to recover from parse errors,
	but if they do,
	they must recover in the same way as user agents.

<h3 id="parsing-overview">
Overview of the Parsing Model</h3>

	The input to the CSS parsing process consists of a stream of Unicode <a>code points</a>,
	which is passed through a tokenization stage followed by a tree construction stage.
	The output is a CSSStyleSheet object.

	Note: Implementations that do not support scripting do not have to actually create a CSSOM CSSStyleSheet object,
	but the CSSOM tree in such cases is still used as the model for the rest of the specification.

<h3 id="input-byte-stream">
The input byte stream</h3>

	When parsing a stylesheet,
	the stream of Unicode <a>code points</a> that comprises the input to the tokenization stage
	may be initially seen by the user agent as a stream of bytes
	(typically coming over the network or from the local file system).
	The bytes encode the <a>code points</a> according to a particular character encoding,
	which the user agent must use to decode the bytes into <a>code points</a>.

	To decode the stream of bytes into a stream of <a>code points</a>,
	UAs must follow these steps.

	The algorithms to <dfn><a href="http://encoding.spec.whatwg.org/#concept-encoding-get">get an encoding</a></dfn>
	and <dfn><a href="http://encoding.spec.whatwg.org/#decode">decode</a></dfn>
	are defined in the <a href="http://encoding.spec.whatwg.org/">Encoding Standard</a>.

	First, <dfn>determine the fallback encoding</dfn>:

	<ol>
		<li>
			If HTTP or equivalent protocol defines an encoding (e.g. via the charset parameter of the Content-Type header),
			<a>get an encoding</a> for the specified value.
			If that does not return failure,
			use the return value as the fallback encoding.

		<li>
			Otherwise, check the byte stream. If the first several bytes match the hex sequence

			<pre>40 63 68 61 72 73 65 74 20 22 (not 22)* 22 3B</pre>

			then <a>get an encoding</a> for the sequence of <code>(not 22)*</code> bytes,
			decoded per <code>windows-1252</code>.

			Note: Anything ASCII-compatible will do, so using <code>windows-1252</code> is fine.


			Note: The byte sequence above,
			when decoded as ASCII,
			is the string "<code>@charset "…";</code>",
			where the "…" is the sequence of bytes corresponding to the encoding's name.

			If the return value was <code>utf-16</code> or <code>utf-16be</code>,
			use <code>utf-8</code> as the fallback encoding;
			if it was anything else except failure,
			use the return value as the fallback encoding.

			Note: This mimics HTML <code>&lt;meta></code> behavior.

		<li>
			Otherwise, <a>get an encoding</a> for the value of the <code>charset</code> attribute on the <code>&lt;link></code> element or <code>&lt;?xml-stylesheet?></code> processing instruction that caused the style sheet to be included, if any.
			If that does not return failure,
			use the return value as the fallback encoding.

		<li>
			Otherwise, if the referring style sheet or document has an encoding,
			use that as the fallback encoding.

		<li>
			Otherwise, use <code>utf-8</code> as the fallback encoding.
	</ol>

		Then, <a>decode</a> the byte stream using the fallback encoding.

	Note: the <a>decode</a> algorithm lets the byte order mark (BOM) take precedence,
	hence the usage of the term "fallback" above.

	<p class='issue'>
		Anne says that steps 3/4 should be an input to this algorithm from the specs that define importing stylesheet,
		to make the algorithm as a whole cleaner.
		Perhaps abstract it into the concept of an "environment charset" or something?

	<p class='issue'>
		Should we only take the charset from the referring document if it's same-origin?


<h3 id="input-preprocessing">
Preprocessing the input stream</h3>

	The input stream consists of the <a>code points</a>
	pushed into it as the input byte stream is decoded.

	Before sending the input stream to the tokenizer,
	implementations must make the following <a>code point</a> substitutions:

	<ul>
		<li>
			Replace any U+000D CARRIAGE RETURN (CR) <a>code point</a>,
			U+000C FORM FEED (FF) <a>code point</a>,
			or pairs of U+000D CARRIAGE RETURN (CR) followed by U+000A LINE FEED (LF)
			by a single U+000A LINE FEED (LF) <a>code point</a>.

		<li>
			Replace any U+0000 NULL <a>code point</a> with U+FFFD REPLACEMENT CHARACTER (�).
	</ul>


<h2 id="tokenization">
Tokenization</h2>

	Implementations must act as if they used the following algorithms to tokenize CSS.
	To transform a stream of <a>code points</a> into a stream of tokens,
	repeatedly <a>consume a token</a>
	until an <<EOF-token>> is reached,
	collecting the returned tokens into a stream.
	Each call to the <a>consume a token</a> algorithm
	returns a single token,
	so it can also be used "on-demand" to tokenize a stream of <a>code points</a> <em>during</em> parsing,
	if so desired.

	The output of the tokenization step is a stream of zero or more of the following tokens:
	<dfn>&lt;ident-token></dfn>,
	<dfn>&lt;function-token></dfn>,
	<dfn>&lt;at-keyword-token></dfn>,
	<dfn>&lt;hash-token></dfn>,
	<dfn>&lt;string-token></dfn>,
	<dfn>&lt;bad-string-token></dfn>,
	<dfn>&lt;url-token></dfn>,
	<dfn>&lt;bad-url-token></dfn>,
	<dfn>&lt;delim-token></dfn>,
	<dfn>&lt;number-token></dfn>,
	<dfn>&lt;percentage-token></dfn>,
	<dfn>&lt;dimension-token></dfn>,
	<dfn>&lt;unicode-range-token></dfn>,
	<dfn>&lt;include-match-token></dfn>,
	<dfn>&lt;dash-match-token></dfn>,
	<dfn>&lt;prefix-match-token></dfn>,
	<dfn>&lt;suffix-match-token></dfn>,
	<dfn>&lt;substring-match-token></dfn>,
	<dfn>&lt;column-token></dfn>,
	<dfn>&lt;whitespace-token></dfn>,
	<dfn>&lt;CDO-token></dfn>,
	<dfn>&lt;CDC-token></dfn>,
	<dfn>&lt;colon-token></dfn>,
	<dfn>&lt;semicolon-token></dfn>,
	<dfn>&lt;comma-token></dfn>,
	<dfn id="tokendef-open-square">&lt;[-token></dfn>,
	<dfn id="tokendef-close-square">&lt;]-token></dfn>,
	<dfn id="tokendef-open-paren">&lt;(-token></dfn>,
	<dfn id="tokendef-close-paren">&lt;)-token></dfn>,
	<dfn id="tokendef-open-curly">&lt;{-token></dfn>,
	and <dfn id="tokendef-close-curly">&lt;}-token></dfn>.

	<ul>
		<li>
			<<ident-token>>, <<function-token>>, <<at-keyword-token>>, <<hash-token>>, <<string-token>>, and <<url-token>> have a value composed of zero or more <a>code points</a>.
			Additionally, hash tokens have a type flag set to either "id" or "unrestricted".  The type flag defaults to "unrestricted" if not otherwise set.

		<li>
			<<delim-token>> has a value composed of a single <a>code point</a>.

		<li>
			<<number-token>>, <<percentage-token>>, and <<dimension-token>> have a representation composed of one or more <a>code points</a>, and a numeric value.
			<<number-token>> and <<dimension-token>> additionally have a type flag set to either "integer" or "number".  The type flag defaults to "integer" if not otherwise set.
			<<dimension-token>> additionally have a unit composed of one or more <a>code points</a>.

		<li>
			<<unicode-range-token>> has
			a <dfn id=unicode-range-start title="start of the range">start</dfn>
			and an <dfn id=unicode-range-end title="end of the range">end</dfn>,
			a pair of integers.

	</ul>

	Note: The type flag of hash tokens is used in the Selectors syntax [[SELECT]].
	Only hash tokens with the "id" type are valid <a href="http://www.w3.org/TR/selectors/#id-selectors">ID selectors</a>.

	Note: As a technical note,
	the tokenizer defined here requires only three <a>code points</a> of look-ahead.
	The tokens it produces are designed to allow Selectors to be parsed with one token of look-ahead,
	and additional tokens may be added in the future to maintain this invariant.


<h3 id='token-diagrams'>
Token Railroad Diagrams</h3>

	<em>This section is non-normative.</em>

	This section presents an informative view of the tokenizer,
	in the form of railroad diagrams.
	Railroad diagrams are more compact than an explicit parser,
	but often easier to read than an regular expression.

	These diagrams are <em>informative</em> and <em>incomplete</em>;
	they describe the grammar of "correct" tokens,
	but do not describe error-handling at all.
	They are provided solely to make it easier to get an intuitive grasp of the syntax of each token.

	Diagrams with names such as <em>&lt;foo-token></em> represent tokens.
	The rest are productions referred to by other diagrams.

	<!--
		The "source" of these diagrams is in ./Diagrams.src.html
		The generated SVG is copied here so that JavaScript is not required
		to view the spec.
	-->

	<dl>
		<dt id="comment-diagram">comment</dt>
		<dd><svg class="railroad-diagram" width="497" height="81"><g transform="translate(.5 .5)"><path d="M 20 31 v 20 m 10 -20 v 20 m -10 -10 h 20.5"></path><path d="M40 41h10"></path><g><path d="M50 41h0"></path><path d="M86 41h0"></path><rect x="50" y="30" width="36" height="22" rx="10" ry="10"></rect><text x="68" y="45">/*</text></g><path d="M86 41h10"></path><g><path d="M96 41h0"></path><path d="M400 41h0"></path><path d="M96 41a10 10 0 0 0 10 -10v0a10 10 0 0 1 10 -10"></path><g><path d="M116 21h264"></path></g><path d="M380 21a10 10 0 0 1 10 10v0a10 10 0 0 0 10 10"></path><path d="M96 41h20"></path><g><path d="M116 41h0"></path><path d="M380 41h0"></path><path d="M116 41h10"></path><g><path d="M126 41h0"></path><path d="M370 41h0"></path><rect x="126" y="30" width="244" height="22"></rect><text x="248" y="45">anything but * followed by /</text></g><path d="M370 41h10"></path><path d="M126 41a10 10 0 0 0 -10 10v0a10 10 0 0 0 10 10"></path><g><path d="M126 61h244"></path></g><path d="M370 61a10 10 0 0 0 10 -10v0a10 10 0 0 0 -10 -10"></path></g><path d="M380 41h20"></path></g><path d="M400 41h10"></path><g><path d="M410 41h0"></path><path d="M446 41h0"></path><rect x="410" y="30" width="36" height="22" rx="10" ry="10"></rect><text x="428" y="45">*/</text></g><path d="M446 41h10"></path><path d="M 456 41 h 20 m -10 -10 v 20 m 10 -20 v 20"></path></g></svg></dd>

		<dt id="newline-diagram">newline</dt>
		<dd><svg class="railroad-diagram" width="173" height="152"><g transform="translate(.5 .5)"><path d="M 20 21 v 20 m 10 -20 v 20 m -10 -10 h 20.5"></path><g><path d="M40 31h0"></path><path d="M132 31h0"></path><path d="M40 31h20"></path><g><path d="M60 31h8"></path><path d="M104 31h8"></path><rect x="68" y="20" width="36" height="22" rx="10" ry="10"></rect><text x="86" y="35">\n</text></g><path d="M112 31h20"></path><path d="M40 31a10 10 0 0 1 10 10v10a10 10 0 0 0 10 10"></path><g><path d="M60 61h0"></path><path d="M112 61h0"></path><rect x="60" y="50" width="52" height="22" rx="10" ry="10"></rect><text x="86" y="65">\r\n</text></g><path d="M112 61a10 10 0 0 0 10 -10v-10a10 10 0 0 1 10 -10"></path><path d="M40 31a10 10 0 0 1 10 10v40a10 10 0 0 0 10 10"></path><g><path d="M60 91h8"></path><path d="M104 91h8"></path><rect x="68" y="80" width="36" height="22" rx="10" ry="10"></rect><text x="86" y="95">\r</text></g><path d="M112 91a10 10 0 0 0 10 -10v-40a10 10 0 0 1 10 -10"></path><path d="M40 31a10 10 0 0 1 10 10v70a10 10 0 0 0 10 10"></path><g><path d="M60 121h8"></path><path d="M104 121h8"></path><rect x="68" y="110" width="36" height="22" rx="10" ry="10"></rect><text x="86" y="125">\f</text></g><path d="M112 121a10 10 0 0 0 10 -10v-70a10 10 0 0 1 10 -10"></path></g><path d="M 132 31 h 20 m -10 -10 v 20 m 10 -20 v 20"></path></g></svg></dd>

		<dt id="whitespace-diagram">whitespace</dt>
		<dd><svg class="railroad-diagram" width="197" height="122"><g transform="translate(.5 .5)"><path d="M 20 21 v 20 m 10 -20 v 20 m -10 -10 h 20.5"></path><g><path d="M40 31h0"></path><path d="M156 31h0"></path><path d="M40 31h20"></path><g><path d="M60 31h8"></path><path d="M128 31h8"></path><rect x="68" y="20" width="60" height="22" rx="10" ry="10"></rect><text x="98" y="35">space</text></g><path d="M136 31h20"></path><path d="M40 31a10 10 0 0 1 10 10v10a10 10 0 0 0 10 10"></path><g><path d="M60 61h20"></path><path d="M116 61h20"></path><rect x="80" y="50" width="36" height="22" rx="10" ry="10"></rect><text x="98" y="65">\t</text></g><path d="M136 61a10 10 0 0 0 10 -10v-10a10 10 0 0 1 10 -10"></path><path d="M40 31a10 10 0 0 1 10 10v40a10 10 0 0 0 10 10"></path><g><path d="M60 91h0"></path><path d="M136 91h0"></path><rect x="60" y="80" width="76" height="22"></rect><text x="98" y="95">newline</text></g><path d="M136 91a10 10 0 0 0 10 -10v-40a10 10 0 0 1 10 -10"></path></g><path d="M 156 31 h 20 m -10 -10 v 20 m 10 -20 v 20"></path></g></svg></dd>

		<dt id="hex-digit-diagram">hex digit</dt>
		<dd><svg class="railroad-diagram" width="233" height="62"><g transform="translate(.5 .5)"><path d="M 20 21 v 20 m 10 -20 v 20 m -10 -10 h 20.5"></path><path d="M40 31h10"></path><g><path d="M50 31h0"></path><path d="M182 31h0"></path><rect x="50" y="20" width="132" height="22"></rect><text x="116" y="35">0-9 a-f or A-F</text></g><path d="M182 31h10"></path><path d="M 192 31 h 20 m -10 -10 v 20 m 10 -20 v 20"></path></g></svg></dd>

		<dt id="escape-diagram">escape</dt>
		<dd><svg class="railroad-diagram" width="441" height="122"><g transform="translate(.5 .5)"><path d="M 20 21 v 20 m 10 -20 v 20 m -10 -10 h 20.5"></path><path d="M40 31h10"></path><g><path d="M50 31h0"></path><path d="M78 31h0"></path><rect x="50" y="20" width="28" height="22" rx="10" ry="10"></rect><text x="64" y="35">\</text></g><path d="M78 31h10"></path><g><path d="M88 31h0"></path><path d="M400 31h0"></path><path d="M88 31h20"></path><g><path d="M108 31h30"></path><path d="M350 31h30"></path><rect x="138" y="20" width="212" height="22"></rect><text x="244" y="35">not newline or hex digit</text></g><path d="M380 31h20"></path><path d="M88 31a10 10 0 0 1 10 10v10a10 10 0 0 0 10 10"></path><g><path d="M108 61h0"></path><path d="M380 61h0"></path><path d="M108 61h10"></path><g><path d="M118 61h0"></path><path d="M230 61h0"></path><path d="M118 61h10"></path><g><path d="M128 61h0"></path><path d="M220 61h0"></path><rect x="128" y="50" width="92" height="22"></rect><text x="174" y="65">hex digit</text></g><path d="M220 61h10"></path><path d="M128 61a10 10 0 0 0 -10 10v10a10 10 0 0 0 10 10"></path><g><path d="M128 91h9.5"></path><path d="M210.5 91h9.5"></path><text x="174" y="96" class="comment">1-6 times</text></g><path d="M220 91a10 10 0 0 0 10 -10v-10a10 10 0 0 0 -10 -10"></path></g><path d="M230 61h10"></path><g><path d="M240 61h0"></path><path d="M380 61h0"></path><path d="M240 61h20"></path><g><path d="M260 61h100"></path></g><path d="M360 61h20"></path><path d="M240 61a10 10 0 0 1 10 10v0a10 10 0 0 0 10 10"></path><g><path d="M260 81h0"></path><path d="M360 81h0"></path><rect x="260" y="70" width="100" height="22"></rect><text x="310" y="85">whitespace</text></g><path d="M360 81a10 10 0 0 0 10 -10v0a10 10 0 0 1 10 -10"></path></g></g><path d="M380 61a10 10 0 0 0 10 -10v-10a10 10 0 0 1 10 -10"></path></g><path d="M 400 31 h 20 m -10 -10 v 20 m 10 -20 v 20"></path></g></svg></dd>

		<dt id="whitespace-token-diagram">&lt;whitespace-token&gt;</dt>
		<dd><svg class="railroad-diagram" width="221" height="71"><g transform="translate(.5 .5)"><path d="M 20 21 v 20 m 10 -20 v 20 m -10 -10 h 20.5"></path><path d="M40 31h10"></path><g><path d="M50 31h0"></path><path d="M170 31h0"></path><path d="M50 31h10"></path><g><path d="M60 31h0"></path><path d="M160 31h0"></path><rect x="60" y="20" width="100" height="22"></rect><text x="110" y="35">whitespace</text></g><path d="M160 31h10"></path><path d="M60 31a10 10 0 0 0 -10 10v0a10 10 0 0 0 10 10"></path><g><path d="M60 51h100"></path></g><path d="M160 51a10 10 0 0 0 10 -10v0a10 10 0 0 0 -10 -10"></path></g><path d="M170 31h10"></path><path d="M 180 31 h 20 m -10 -10 v 20 m 10 -20 v 20"></path></g></svg></dd>

		<dt id="ws-diagram">ws*</dt>
		<dd><svg class="railroad-diagram" width="305" height="81"><g transform="translate(.5 .5)"><path d="M 20 31 v 20 m 10 -20 v 20 m -10 -10 h 20.5"></path><g><path d="M40 41h0"></path><path d="M264 41h0"></path><path d="M40 41a10 10 0 0 0 10 -10v0a10 10 0 0 1 10 -10"></path><g><path d="M60 21h184"></path></g><path d="M244 21a10 10 0 0 1 10 10v0a10 10 0 0 0 10 10"></path><path d="M40 41h20"></path><g><path d="M60 41h0"></path><path d="M244 41h0"></path><path d="M60 41h10"></path><g><path d="M70 41h0"></path><path d="M234 41h0"></path><rect x="70" y="30" width="164" height="22"></rect><text x="152" y="45">&lt;whitespace-token&gt;</text></g><path d="M234 41h10"></path><path d="M70 41a10 10 0 0 0 -10 10v0a10 10 0 0 0 10 10"></path><g><path d="M70 61h164"></path></g><path d="M234 61a10 10 0 0 0 10 -10v0a10 10 0 0 0 -10 -10"></path></g><path d="M244 41h20"></path></g><path d="M 264 41 h 20 m -10 -10 v 20 m 10 -20 v 20"></path></g></svg></dd>

		<dt id="ident-token-diagram">&lt;ident-token&gt;</dt>
		<dd><svg class="railroad-diagram" width="729" height="110"><g transform="translate(.5 .5)"><path d="M 20 31 v 20 m 10 -20 v 20 m -10 -10 h 20.5"></path><g><path d="M40 41h0"></path><path d="M108 41h0"></path><path d="M40 41h20"></path><g><path d="M60 41h28"></path></g><path d="M88 41h20"></path><path d="M40 41a10 10 0 0 1 10 10v0a10 10 0 0 0 10 10"></path><g><path d="M60 61h0"></path><path d="M88 61h0"></path><rect x="60" y="50" width="28" height="22" rx="10" ry="10"></rect><text x="74" y="65">-</text></g><path d="M88 61a10 10 0 0 0 10 -10v0a10 10 0 0 1 10 -10"></path></g><g><path d="M108 41h0"></path><path d="M344 41h0"></path><path d="M108 41h20"></path><g><path d="M128 41h0"></path><path d="M324 41h0"></path><rect x="128" y="30" width="196" height="22"></rect><text x="226" y="45">a-z A-Z _ or non-ASCII</text></g><path d="M324 41h20"></path><path d="M108 41a10 10 0 0 1 10 10v10a10 10 0 0 0 10 10"></path><g><path d="M128 71h64"></path><path d="M260 71h64"></path><rect x="192" y="60" width="68" height="22"></rect><text x="226" y="75">escape</text></g><path d="M324 71a10 10 0 0 0 10 -10v-10a10 10 0 0 1 10 -10"></path></g><g><path d="M344 41h0"></path><path d="M688 41h0"></path><path d="M344 41a10 10 0 0 0 10 -10v0a10 10 0 0 1 10 -10"></path><g><path d="M364 21h304"></path></g><path d="M668 21a10 10 0 0 1 10 10v0a10 10 0 0 0 10 10"></path><path d="M344 41h20"></path><g><path d="M364 41h0"></path><path d="M668 41h0"></path><path d="M364 41h10"></path><g><path d="M374 41h0"></path><path d="M658 41h0"></path><path d="M374 41h20"></path><g><path d="M394 41h0"></path><path d="M638 41h0"></path><rect x="394" y="30" width="244" height="22"></rect><text x="516" y="45">a-z A-Z 0-9 _ - or non-ASCII</text></g><path d="M638 41h20"></path><path d="M374 41a10 10 0 0 1 10 10v10a10 10 0 0 0 10 10"></path><g><path d="M394 71h88"></path><path d="M550 71h88"></path><rect x="482" y="60" width="68" height="22"></rect><text x="516" y="75">escape</text></g><path d="M638 71a10 10 0 0 0 10 -10v-10a10 10 0 0 1 10 -10"></path></g><path d="M658 41h10"></path><path d="M374 41a10 10 0 0 0 -10 10v29a10 10 0 0 0 10 10"></path><g><path d="M374 90h284"></path></g><path d="M658 90a10 10 0 0 0 10 -10v-29a10 10 0 0 0 -10 -10"></path></g><path d="M668 41h20"></path></g><path d="M 688 41 h 20 m -10 -10 v 20 m 10 -20 v 20"></path></g></svg></dd>

		<dt id="function-token-diagram">&lt;function-token&gt;</dt>
		<dd><svg class="railroad-diagram" width="273" height="62"><g transform="translate(.5 .5)"><path d="M 20 21 v 20 m 10 -20 v 20 m -10 -10 h 20.5"></path><path d="M40 31h10"></path><g><path d="M50 31h0"></path><path d="M174 31h0"></path><rect x="50" y="20" width="124" height="22"></rect><text x="112" y="35">&lt;ident-token&gt;</text></g><path d="M174 31h10"></path><path d="M184 31h10"></path><g><path d="M194 31h0"></path><path d="M222 31h0"></path><rect x="194" y="20" width="28" height="22" rx="10" ry="10"></rect><text x="208" y="35">(</text></g><path d="M222 31h10"></path><path d="M 232 31 h 20 m -10 -10 v 20 m 10 -20 v 20"></path></g></svg></dd>

		<dt id="at-keyword-token-diagram">&lt;at-keyword-token&gt;</dt>
		<dd><svg class="railroad-diagram" width="273" height="62"><g transform="translate(.5 .5)"><path d="M 20 21 v 20 m 10 -20 v 20 m -10 -10 h 20.5"></path><path d="M40 31h10"></path><g><path d="M50 31h0"></path><path d="M78 31h0"></path><rect x="50" y="20" width="28" height="22" rx="10" ry="10"></rect><text x="64" y="35">@</text></g><path d="M78 31h10"></path><path d="M88 31h10"></path><g><path d="M98 31h0"></path><path d="M222 31h0"></path><rect x="98" y="20" width="124" height="22"></rect><text x="160" y="35">&lt;ident-token&gt;</text></g><path d="M222 31h10"></path><path d="M 232 31 h 20 m -10 -10 v 20 m 10 -20 v 20"></path></g></svg></dd>

		<dt id="hash-token-diagram">&lt;hash-token&gt;</dt>
		<dd><svg class="railroad-diagram" width="453" height="100"><g transform="translate(.5 .5)"><path d="M 20 21 v 20 m 10 -20 v 20 m -10 -10 h 20.5"></path><path d="M40 31h10"></path><g><path d="M50 31h0"></path><path d="M78 31h0"></path><rect x="50" y="20" width="28" height="22" rx="10" ry="10"></rect><text x="64" y="35">#</text></g><path d="M78 31h10"></path><path d="M88 31h10"></path><g><path d="M98 31h0"></path><path d="M402 31h0"></path><path d="M98 31h10"></path><g><path d="M108 31h0"></path><path d="M392 31h0"></path><path d="M108 31h20"></path><g><path d="M128 31h0"></path><path d="M372 31h0"></path><rect x="128" y="20" width="244" height="22"></rect><text x="250" y="35">a-z A-Z 0-9 _ - or non-ASCII</text></g><path d="M372 31h20"></path><path d="M108 31a10 10 0 0 1 10 10v10a10 10 0 0 0 10 10"></path><g><path d="M128 61h88"></path><path d="M284 61h88"></path><rect x="216" y="50" width="68" height="22"></rect><text x="250" y="65">escape</text></g><path d="M372 61a10 10 0 0 0 10 -10v-10a10 10 0 0 1 10 -10"></path></g><path d="M392 31h10"></path><path d="M108 31a10 10 0 0 0 -10 10v29a10 10 0 0 0 10 10"></path><g><path d="M108 80h284"></path></g><path d="M392 80a10 10 0 0 0 10 -10v-29a10 10 0 0 0 -10 -10"></path></g><path d="M402 31h10"></path><path d="M 412 31 h 20 m -10 -10 v 20 m 10 -20 v 20"></path></g></svg></dd>

		<dt id="string-token-diagram">&lt;string-token&gt;</dt>
		<dd><svg class="railroad-diagram" width="481" height="248"><g transform="translate(.5 .5)"><path d="M 20 31 v 20 m 10 -20 v 20 m -10 -10 h 20.5"></path><g><path d="M40 41h0"></path><path d="M440 41h0"></path><path d="M40 41h20"></path><g><path d="M60 41h0"></path><path d="M420 41h0"></path><path d="M60 41h10"></path><g><path d="M70 41h0"></path><path d="M98 41h0"></path><rect x="70" y="30" width="28" height="22" rx="10" ry="10"></rect><text x="84" y="45">"</text></g><path d="M98 41h10"></path><g><path d="M108 41h0"></path><path d="M372 41h0"></path><path d="M108 41a10 10 0 0 0 10 -10v0a10 10 0 0 1 10 -10"></path><g><path d="M128 21h224"></path></g><path d="M352 21a10 10 0 0 1 10 10v0a10 10 0 0 0 10 10"></path><path d="M108 41h20"></path><g><path d="M128 41h0"></path><path d="M352 41h0"></path><path d="M128 41h10"></path><g><path d="M138 41h0"></path><path d="M342 41h0"></path><path d="M138 41h20"></path><g><path d="M158 41h0"></path><path d="M322 41h0"></path><rect x="158" y="30" width="164" height="22"></rect><text x="240" y="45">not " \ or newline</text></g><path d="M322 41h20"></path><path d="M138 41a10 10 0 0 1 10 10v10a10 10 0 0 0 10 10"></path><g><path d="M158 71h48"></path><path d="M274 71h48"></path><rect x="206" y="60" width="68" height="22"></rect><text x="240" y="75">escape</text></g><path d="M322 71a10 10 0 0 0 10 -10v-10a10 10 0 0 1 10 -10"></path><path d="M138 41a10 10 0 0 1 10 10v40a10 10 0 0 0 10 10"></path><g><path d="M158 101h10"></path><path d="M312 101h10"></path><path d="M168 101h10"></path><g><path d="M178 101h0"></path><path d="M206 101h0"></path><rect x="178" y="90" width="28" height="22" rx="10" ry="10"></rect><text x="192" y="105">\</text></g><path d="M206 101h10"></path><path d="M216 101h10"></path><g><path d="M226 101h0"></path><path d="M302 101h0"></path><rect x="226" y="90" width="76" height="22"></rect><text x="264" y="105">newline</text></g><path d="M302 101h10"></path></g><path d="M322 101a10 10 0 0 0 10 -10v-40a10 10 0 0 1 10 -10"></path></g><path d="M342 41h10"></path><path d="M138 41a10 10 0 0 0 -10 10v59a10 10 0 0 0 10 10"></path><g><path d="M138 120h204"></path></g><path d="M342 120a10 10 0 0 0 10 -10v-59a10 10 0 0 0 -10 -10"></path></g><path d="M352 41h20"></path></g><path d="M372 41h10"></path><g><path d="M382 41h0"></path><path d="M410 41h0"></path><rect x="382" y="30" width="28" height="22" rx="10" ry="10"></rect><text x="396" y="45">"</text></g><path d="M410 41h10"></path></g><path d="M420 41h20"></path><path d="M40 41a10 10 0 0 1 10 10v88a10 10 0 0 0 10 10"></path><g><path d="M60 149h0"></path><path d="M420 149h0"></path><path d="M60 149h10"></path><g><path d="M70 149h0"></path><path d="M98 149h0"></path><rect x="70" y="138" width="28" height="22" rx="10" ry="10"></rect><text x="84" y="153">&apos;</text></g><path d="M98 149h10"></path><g><path d="M108 149h0"></path><path d="M372 149h0"></path><path d="M108 149a10 10 0 0 0 10 -10v0a10 10 0 0 1 10 -10"></path><g><path d="M128 129h224"></path></g><path d="M352 129a10 10 0 0 1 10 10v0a10 10 0 0 0 10 10"></path><path d="M108 149h20"></path><g><path d="M128 149h0"></path><path d="M352 149h0"></path><path d="M128 149h10"></path><g><path d="M138 149h0"></path><path d="M342 149h0"></path><path d="M138 149h20"></path><g><path d="M158 149h0"></path><path d="M322 149h0"></path><rect x="158" y="138" width="164" height="22"></rect><text x="240" y="153">not &apos; \ or newline</text></g><path d="M322 149h20"></path><path d="M138 149a10 10 0 0 1 10 10v10a10 10 0 0 0 10 10"></path><g><path d="M158 179h48"></path><path d="M274 179h48"></path><rect x="206" y="168" width="68" height="22"></rect><text x="240" y="183">escape</text></g><path d="M322 179a10 10 0 0 0 10 -10v-10a10 10 0 0 1 10 -10"></path><path d="M138 149a10 10 0 0 1 10 10v40a10 10 0 0 0 10 10"></path><g><path d="M158 209h10"></path><path d="M312 209h10"></path><path d="M168 209h10"></path><g><path d="M178 209h0"></path><path d="M206 209h0"></path><rect x="178" y="198" width="28" height="22" rx="10" ry="10"></rect><text x="192" y="213">\</text></g><path d="M206 209h10"></path><path d="M216 209h10"></path><g><path d="M226 209h0"></path><path d="M302 209h0"></path><rect x="226" y="198" width="76" height="22"></rect><text x="264" y="213">newline</text></g><path d="M302 209h10"></path></g><path d="M322 209a10 10 0 0 0 10 -10v-40a10 10 0 0 1 10 -10"></path></g><path d="M342 149h10"></path><path d="M138 149a10 10 0 0 0 -10 10v59a10 10 0 0 0 10 10"></path><g><path d="M138 228h204"></path></g><path d="M342 228a10 10 0 0 0 10 -10v-59a10 10 0 0 0 -10 -10"></path></g><path d="M352 149h20"></path></g><path d="M372 149h10"></path><g><path d="M382 149h0"></path><path d="M410 149h0"></path><rect x="382" y="138" width="28" height="22" rx="10" ry="10"></rect><text x="396" y="153">&apos;</text></g><path d="M410 149h10"></path></g><path d="M420 149a10 10 0 0 0 10 -10v-88a10 10 0 0 1 10 -10"></path></g><path d="M 440 41 h 20 m -10 -10 v 20 m 10 -20 v 20"></path></g></svg></dd>

		<dt id="url-token-diagram">&lt;url-token&gt;</dt>
		<dd><svg class="railroad-diagram" width="693" height="102"><g transform="translate(.5 .5)"><path d="M 20 31 v 20 m 10 -20 v 20 m -10 -10 h 20.5"></path><path d="M40 41h10"></path><g><path d="M50 41h0"></path><path d="M222 41h0"></path><rect x="50" y="30" width="172" height="22"></rect><text x="136" y="45">&lt;ident-token "url"&gt;</text></g><path d="M222 41h10"></path><path d="M232 41h10"></path><g><path d="M242 41h0"></path><path d="M270 41h0"></path><rect x="242" y="30" width="28" height="22" rx="10" ry="10"></rect><text x="256" y="45">(</text></g><path d="M270 41h10"></path><path d="M280 41h10"></path><g><path d="M290 41h0"></path><path d="M334 41h0"></path><rect x="290" y="30" width="44" height="22"></rect><text x="312" y="45">ws*</text></g><path d="M334 41h10"></path><g><path d="M344 41h0"></path><path d="M604 41h0"></path><path d="M344 41a10 10 0 0 0 10 -10v0a10 10 0 0 1 10 -10"></path><g><path d="M364 21h220"></path></g><path d="M584 21a10 10 0 0 1 10 10v0a10 10 0 0 0 10 10"></path><path d="M344 41h20"></path><g><path d="M364 41h0"></path><path d="M584 41h0"></path><g><path d="M364 41h0"></path><path d="M520 41h0"></path><path d="M364 41h20"></path><g><path d="M384 41h0"></path><path d="M500 41h0"></path><rect x="384" y="30" width="116" height="22"></rect><text x="442" y="45">url-unquoted</text></g><path d="M500 41h20"></path><path d="M364 41a10 10 0 0 1 10 10v10a10 10 0 0 0 10 10"></path><g><path d="M384 71h24"></path><path d="M476 71h24"></path><rect x="408" y="60" width="68" height="22"></rect><text x="442" y="75">STRING</text></g><path d="M500 71a10 10 0 0 0 10 -10v-10a10 10 0 0 1 10 -10"></path></g><path d="M520 41h10"></path><g><path d="M530 41h0"></path><path d="M574 41h0"></path><rect x="530" y="30" width="44" height="22"></rect><text x="552" y="45">ws*</text></g><path d="M574 41h10"></path></g><path d="M584 41h20"></path></g><path d="M604 41h10"></path><g><path d="M614 41h0"></path><path d="M642 41h0"></path><rect x="614" y="30" width="28" height="22" rx="10" ry="10"></rect><text x="628" y="45">)</text></g><path d="M642 41h10"></path><path d="M 652 41 h 20 m -10 -10 v 20 m 10 -20 v 20"></path></g></svg></dd>

		<dt id="url-unquoted-diagram">url-unquoted</dt>
		<dd><svg class="railroad-diagram" width="509" height="100"><g transform="translate(.5 .5)"><path d="M 20 21 v 20 m 10 -20 v 20 m -10 -10 h 20.5"></path><path d="M40 31h10"></path><g><path d="M50 31h0"></path><path d="M458 31h0"></path><path d="M50 31h10"></path><g><path d="M60 31h0"></path><path d="M448 31h0"></path><path d="M60 31h20"></path><g><path d="M80 31h0"></path><path d="M428 31h0"></path><rect x="80" y="20" width="348" height="22"></rect><text x="254" y="35">not " &apos; ( ) \ whitespace or non-printable</text></g><path d="M428 31h20"></path><path d="M60 31a10 10 0 0 1 10 10v10a10 10 0 0 0 10 10"></path><g><path d="M80 61h140"></path><path d="M288 61h140"></path><rect x="220" y="50" width="68" height="22"></rect><text x="254" y="65">escape</text></g><path d="M428 61a10 10 0 0 0 10 -10v-10a10 10 0 0 1 10 -10"></path></g><path d="M448 31h10"></path><path d="M60 31a10 10 0 0 0 -10 10v29a10 10 0 0 0 10 10"></path><g><path d="M60 80h388"></path></g><path d="M448 80a10 10 0 0 0 10 -10v-29a10 10 0 0 0 -10 -10"></path></g><path d="M458 31h10"></path><path d="M 468 31 h 20 m -10 -10 v 20 m 10 -20 v 20"></path></g></svg></dd>

		<dt id="number-token-diagram">&lt;number-token&gt;</dt>
		<dd><svg class="railroad-diagram" width="713" height="179"><g transform="translate(.5 .5)"><path d="M 20 50 v 20 m 10 -20 v 20 m -10 -10 h 20.5"></path><g><path d="M40 60h0"></path><path d="M108 60h0"></path><path d="M40 60a10 10 0 0 0 10 -10v0a10 10 0 0 1 10 -10"></path><g><path d="M60 40h0"></path><path d="M88 40h0"></path><rect x="60" y="29" width="28" height="22" rx="10" ry="10"></rect><text x="74" y="44">+</text></g><path d="M88 40a10 10 0 0 1 10 10v0a10 10 0 0 0 10 10"></path><path d="M40 60h20"></path><g><path d="M60 60h28"></path></g><path d="M88 60h20"></path><path d="M40 60a10 10 0 0 1 10 10v0a10 10 0 0 0 10 10"></path><g><path d="M60 80h0"></path><path d="M88 80h0"></path><rect x="60" y="69" width="28" height="22" rx="10" ry="10"></rect><text x="74" y="84">-</text></g><path d="M88 80a10 10 0 0 0 10 -10v0a10 10 0 0 1 10 -10"></path></g><g><path d="M108 60h0"></path><path d="M396 60h0"></path><path d="M108 60h20"></path><g><path d="M128 60h0"></path><path d="M376 60h0"></path><path d="M128 60h10"></path><g><path d="M138 60h0"></path><path d="M218 60h0"></path><path d="M138 60h10"></path><g><path d="M148 60h0"></path><path d="M208 60h0"></path><rect x="148" y="49" width="60" height="22"></rect><text x="178" y="64">digit</text></g><path d="M208 60h10"></path><path d="M148 60a10 10 0 0 0 -10 10v0a10 10 0 0 0 10 10"></path><g><path d="M148 80h60"></path></g><path d="M208 80a10 10 0 0 0 10 -10v0a10 10 0 0 0 -10 -10"></path></g><path d="M218 60h10"></path><path d="M228 60h10"></path><g><path d="M238 60h0"></path><path d="M266 60h0"></path><rect x="238" y="49" width="28" height="22" rx="10" ry="10"></rect><text x="252" y="64">.</text></g><path d="M266 60h10"></path><path d="M276 60h10"></path><g><path d="M286 60h0"></path><path d="M366 60h0"></path><path d="M286 60h10"></path><g><path d="M296 60h0"></path><path d="M356 60h0"></path><rect x="296" y="49" width="60" height="22"></rect><text x="326" y="64">digit</text></g><path d="M356 60h10"></path><path d="M296 60a10 10 0 0 0 -10 10v0a10 10 0 0 0 10 10"></path><g><path d="M296 80h60"></path></g><path d="M356 80a10 10 0 0 0 10 -10v0a10 10 0 0 0 -10 -10"></path></g><path d="M366 60h10"></path></g><path d="M376 60h20"></path><path d="M108 60a10 10 0 0 1 10 10v19a10 10 0 0 0 10 10"></path><g><path d="M128 99h84"></path><path d="M292 99h84"></path><path d="M212 99h10"></path><g><path d="M222 99h0"></path><path d="M282 99h0"></path><rect x="222" y="88" width="60" height="22"></rect><text x="252" y="103">digit</text></g><path d="M282 99h10"></path><path d="M222 99a10 10 0 0 0 -10 10v0a10 10 0 0 0 10 10"></path><g><path d="M222 119h60"></path></g><path d="M282 119a10 10 0 0 0 10 -10v0a10 10 0 0 0 -10 -10"></path></g><path d="M376 99a10 10 0 0 0 10 -10v-19a10 10 0 0 1 10 -10"></path><path d="M108 60a10 10 0 0 1 10 10v58a10 10 0 0 0 10 10"></path><g><path d="M128 138h50"></path><path d="M326 138h50"></path><path d="M178 138h10"></path><g><path d="M188 138h0"></path><path d="M216 138h0"></path><rect x="188" y="127" width="28" height="22" rx="10" ry="10"></rect><text x="202" y="142">.</text></g><path d="M216 138h10"></path><path d="M226 138h10"></path><g><path d="M236 138h0"></path><path d="M316 138h0"></path><path d="M236 138h10"></path><g><path d="M246 138h0"></path><path d="M306 138h0"></path><rect x="246" y="127" width="60" height="22"></rect><text x="276" y="142">digit</text></g><path d="M306 138h10"></path><path d="M246 138a10 10 0 0 0 -10 10v0a10 10 0 0 0 10 10"></path><g><path d="M246 158h60"></path></g><path d="M306 158a10 10 0 0 0 10 -10v0a10 10 0 0 0 -10 -10"></path></g><path d="M316 138h10"></path></g><path d="M376 138a10 10 0 0 0 10 -10v-58a10 10 0 0 1 10 -10"></path></g><g><path d="M396 60h0"></path><path d="M672 60h0"></path><path d="M396 60h20"></path><g><path d="M416 60h236"></path></g><path d="M652 60h20"></path><path d="M396 60a10 10 0 0 1 10 10v28a10 10 0 0 0 10 10"></path><g><path d="M416 108h0"></path><path d="M652 108h0"></path><g><path d="M416 108h0"></path><path d="M484 108h0"></path><path d="M416 108h20"></path><g><path d="M436 108h0"></path><path d="M464 108h0"></path><rect x="436" y="97" width="28" height="22" rx="10" ry="10"></rect><text x="450" y="112">e</text></g><path d="M464 108h20"></path><path d="M416 108a10 10 0 0 1 10 10v10a10 10 0 0 0 10 10"></path><g><path d="M436 138h0"></path><path d="M464 138h0"></path><rect x="436" y="127" width="28" height="22" rx="10" ry="10"></rect><text x="450" y="142">E</text></g><path d="M464 138a10 10 0 0 0 10 -10v-10a10 10 0 0 1 10 -10"></path></g><g><path d="M484 108h0"></path><path d="M552 108h0"></path><path d="M484 108a10 10 0 0 0 10 -10v0a10 10 0 0 1 10 -10"></path><g><path d="M504 88h0"></path><path d="M532 88h0"></path><rect x="504" y="77" width="28" height="22" rx="10" ry="10"></rect><text x="518" y="92">+</text></g><path d="M532 88a10 10 0 0 1 10 10v0a10 10 0 0 0 10 10"></path><path d="M484 108h20"></path><g><path d="M504 108h28"></path></g><path d="M532 108h20"></path><path d="M484 108a10 10 0 0 1 10 10v0a10 10 0 0 0 10 10"></path><g><path d="M504 128h0"></path><path d="M532 128h0"></path><rect x="504" y="117" width="28" height="22" rx="10" ry="10"></rect><text x="518" y="132">-</text></g><path d="M532 128a10 10 0 0 0 10 -10v0a10 10 0 0 1 10 -10"></path></g><path d="M552 108h10"></path><g><path d="M562 108h0"></path><path d="M642 108h0"></path><path d="M562 108h10"></path><g><path d="M572 108h0"></path><path d="M632 108h0"></path><rect x="572" y="97" width="60" height="22"></rect><text x="602" y="112">digit</text></g><path d="M632 108h10"></path><path d="M572 108a10 10 0 0 0 -10 10v0a10 10 0 0 0 10 10"></path><g><path d="M572 128h60"></path></g><path d="M632 128a10 10 0 0 0 10 -10v0a10 10 0 0 0 -10 -10"></path></g><path d="M642 108h10"></path></g><path d="M652 108a10 10 0 0 0 10 -10v-28a10 10 0 0 1 10 -10"></path></g><path d="M 672 60 h 20 m -10 -10 v 20 m 10 -20 v 20"></path></g></svg></dd>

		<dt id="dimension-token-diagram">&lt;dimension-token&gt;</dt>
		<dd><svg class="railroad-diagram" width="377" height="62"><g transform="translate(.5 .5)"><path d="M 20 21 v 20 m 10 -20 v 20 m -10 -10 h 20.5"></path><path d="M40 31h10"></path><g><path d="M50 31h0"></path><path d="M182 31h0"></path><rect x="50" y="20" width="132" height="22"></rect><text x="116" y="35">&lt;number-token&gt;</text></g><path d="M182 31h10"></path><path d="M192 31h10"></path><g><path d="M202 31h0"></path><path d="M326 31h0"></path><rect x="202" y="20" width="124" height="22"></rect><text x="264" y="35">&lt;ident-token&gt;</text></g><path d="M326 31h10"></path><path d="M 336 31 h 20 m -10 -10 v 20 m 10 -20 v 20"></path></g></svg></dd>

		<dt id="percentage-token-diagram">&lt;percentage-token&gt;</dt>
		<dd><svg class="railroad-diagram" width="281" height="62"><g transform="translate(.5 .5)"><path d="M 20 21 v 20 m 10 -20 v 20 m -10 -10 h 20.5"></path><path d="M40 31h10"></path><g><path d="M50 31h0"></path><path d="M182 31h0"></path><rect x="50" y="20" width="132" height="22"></rect><text x="116" y="35">&lt;number-token&gt;</text></g><path d="M182 31h10"></path><path d="M192 31h10"></path><g><path d="M202 31h0"></path><path d="M230 31h0"></path><rect x="202" y="20" width="28" height="22" rx="10" ry="10"></rect><text x="216" y="35">%</text></g><path d="M230 31h10"></path><path d="M 240 31 h 20 m -10 -10 v 20 m 10 -20 v 20"></path></g></svg></dd>

		<dt id="unicode-range-token-diagram">&lt;unicode-range-token&gt;</dt>
		<dd><svg class="railroad-diagram" width="600" height="222"><g transform="translate(.5 .5)"><path d="M 20 21 v 20 m 10 -20 v 20 m -10 -10 h 20.5"></path><g><path d="M40 31h0"></path><path d="M108 31h0"></path><path d="M40 31h20"></path><g><path d="M60 31h0"></path><path d="M88 31h0"></path><rect x="60" y="20" width="28" height="22" rx="10" ry="10"></rect><text x="74" y="35">U</text></g><path d="M88 31h20"></path><path d="M40 31a10 10 0 0 1 10 10v10a10 10 0 0 0 10 10"></path><g><path d="M60 61h0"></path><path d="M88 61h0"></path><rect x="60" y="50" width="28" height="22" rx="10" ry="10"></rect><text x="74" y="65">u</text></g><path d="M88 61a10 10 0 0 0 10 -10v-10a10 10 0 0 1 10 -10"></path></g><path d="M108 31h10"></path><g><path d="M118 31h0"></path><path d="M146 31h0"></path><rect x="118" y="20" width="28" height="22" rx="10" ry="10"></rect><text x="132" y="35">+</text></g><path d="M146 31h10"></path><g><path d="M156 31h0"></path><path d="M559 31h0"></path><path d="M156 31h20"></path><g><path d="M176 31h115.5"></path><path d="M423.5 31h115.5"></path><path d="M291.5 31h10"></path><g><path d="M301.5 31h0"></path><path d="M413.5 31h0"></path><path d="M301.5 31h10"></path><g><path d="M311.5 31h0"></path><path d="M403.5 31h0"></path><rect x="311.5" y="20" width="92" height="22"></rect><text x="357.5" y="35">hex digit</text></g><path d="M403.5 31h10"></path><path d="M311.5 31a10 10 0 0 0 -10 10v10a10 10 0 0 0 10 10"></path><g><path d="M311.5 61h9.5"></path><path d="M394 61h9.5"></path><text x="357.5" y="66" class="comment">1-6 times</text></g><path d="M403.5 61a10 10 0 0 0 10 -10v-10a10 10 0 0 0 -10 -10"></path></g><path d="M413.5 31h10"></path></g><path d="M539 31h20"></path><path d="M156 31a10 10 0 0 1 10 10v50a10 10 0 0 0 10 10"></path><g><path d="M176 101h0"></path><path d="M539 101h0"></path><g><path d="M176 101h0"></path><path d="M328 101h0"></path><path d="M176 101a10 10 0 0 0 10 -10v0a10 10 0 0 1 10 -10"></path><g><path d="M196 81h112"></path></g><path d="M308 81a10 10 0 0 1 10 10v0a10 10 0 0 0 10 10"></path><path d="M176 101h20"></path><g><path d="M196 101h0"></path><path d="M308 101h0"></path><path d="M196 101h10"></path><g><path d="M206 101h0"></path><path d="M298 101h0"></path><rect x="206" y="90" width="92" height="22"></rect><text x="252" y="105">hex digit</text></g><path d="M298 101h10"></path><path d="M206 101a10 10 0 0 0 -10 10v10a10 10 0 0 0 10 10"></path><g><path d="M206 131h9.5"></path><path d="M288.5 131h9.5"></path><text x="252" y="136" class="comment">1-5 times</text></g><path d="M298 131a10 10 0 0 0 10 -10v-10a10 10 0 0 0 -10 -10"></path></g><path d="M308 101h20"></path></g><path d="M328 101h10"></path><g><path d="M338 101h0"></path><path d="M529 101h0"></path><path d="M338 101h10"></path><g><path d="M348 101h71.5"></path><path d="M447.5 101h71.5"></path><rect x="419.5" y="90" width="28" height="22" rx="10" ry="10"></rect><text x="433.5" y="105">?</text></g><path d="M519 101h10"></path><path d="M348 101a10 10 0 0 0 -10 10v10a10 10 0 0 0 10 10"></path><g><path d="M348 131h0"></path><path d="M519 131h0"></path><text x="433.5" y="136" class="comment">1 to (6 - digits) times</text></g><path d="M519 131a10 10 0 0 0 10 -10v-10a10 10 0 0 0 -10 -10"></path></g><path d="M529 101h10"></path></g><path d="M539 101a10 10 0 0 0 10 -10v-50a10 10 0 0 1 10 -10"></path><path d="M156 31a10 10 0 0 1 10 10v110a10 10 0 0 0 10 10"></path><g><path d="M176 161h25.5"></path><path d="M513.5 161h25.5"></path><path d="M201.5 161h10"></path><g><path d="M211.5 161h0"></path><path d="M323.5 161h0"></path><path d="M211.5 161h10"></path><g><path d="M221.5 161h0"></path><path d="M313.5 161h0"></path><rect x="221.5" y="150" width="92" height="22"></rect><text x="267.5" y="165">hex digit</text></g><path d="M313.5 161h10"></path><path d="M221.5 161a10 10 0 0 0 -10 10v10a10 10 0 0 0 10 10"></path><g><path d="M221.5 191h9.5"></path><path d="M304 191h9.5"></path><text x="267.5" y="196" class="comment">1-6 times</text></g><path d="M313.5 191a10 10 0 0 0 10 -10v-10a10 10 0 0 0 -10 -10"></path></g><path d="M323.5 161h10"></path><path d="M333.5 161h10"></path><g><path d="M343.5 161h0"></path><path d="M371.5 161h0"></path><rect x="343.5" y="150" width="28" height="22" rx="10" ry="10"></rect><text x="357.5" y="165">-</text></g><path d="M371.5 161h10"></path><path d="M381.5 161h10"></path><g><path d="M391.5 161h0"></path><path d="M503.5 161h0"></path><path d="M391.5 161h10"></path><g><path d="M401.5 161h0"></path><path d="M493.5 161h0"></path><rect x="401.5" y="150" width="92" height="22"></rect><text x="447.5" y="165">hex digit</text></g><path d="M493.5 161h10"></path><path d="M401.5 161a10 10 0 0 0 -10 10v10a10 10 0 0 0 10 10"></path><g><path d="M401.5 191h9.5"></path><path d="M484 191h9.5"></path><text x="447.5" y="196" class="comment">1-6 times</text></g><path d="M493.5 191a10 10 0 0 0 10 -10v-10a10 10 0 0 0 -10 -10"></path></g><path d="M503.5 161h10"></path></g><path d="M539 161a10 10 0 0 0 10 -10v-110a10 10 0 0 1 10 -10"></path></g><path d="M 559 31 h 20 m -10 -10 v 20 m 10 -20 v 20"></path></g></svg></dd>

		<dt id="include-match-token-diagram">&lt;include-match-token&gt;</dt>
		<dd><svg class="railroad-diagram" width="137" height="62"><g transform="translate(.5 .5)"><path d="M 20 21 v 20 m 10 -20 v 20 m -10 -10 h 20.5"></path><path d="M40 31h10"></path><g><path d="M50 31h0"></path><path d="M86 31h0"></path><rect x="50" y="20" width="36" height="22" rx="10" ry="10"></rect><text x="68" y="35">~=</text></g><path d="M86 31h10"></path><path d="M 96 31 h 20 m -10 -10 v 20 m 10 -20 v 20"></path></g></svg></dd>

		<dt id="dash-match-token-diagram">&lt;dash-match-token&gt;</dt>
		<dd><svg class="railroad-diagram" width="137" height="62"><g transform="translate(.5 .5)"><path d="M 20 21 v 20 m 10 -20 v 20 m -10 -10 h 20.5"></path><path d="M40 31h10"></path><g><path d="M50 31h0"></path><path d="M86 31h0"></path><rect x="50" y="20" width="36" height="22" rx="10" ry="10"></rect><text x="68" y="35">|=</text></g><path d="M86 31h10"></path><path d="M 96 31 h 20 m -10 -10 v 20 m 10 -20 v 20"></path></g></svg></dd>

		<dt id="prefix-match-token-diagram">&lt;prefix-match-token&gt;</dt>
		<dd><svg class="railroad-diagram" width="137" height="62"><g transform="translate(.5 .5)"><path d="M 20 21 v 20 m 10 -20 v 20 m -10 -10 h 20.5"></path><path d="M40 31h10"></path><g><path d="M50 31h0"></path><path d="M86 31h0"></path><rect x="50" y="20" width="36" height="22" rx="10" ry="10"></rect><text x="68" y="35">^=</text></g><path d="M86 31h10"></path><path d="M 96 31 h 20 m -10 -10 v 20 m 10 -20 v 20"></path></g></svg></dd>

		<dt id="suffix-match-token-diagram">&lt;suffix-match-token&gt;</dt>
		<dd><svg class="railroad-diagram" width="137" height="62"><g transform="translate(.5 .5)"><path d="M 20 21 v 20 m 10 -20 v 20 m -10 -10 h 20.5"></path><path d="M40 31h10"></path><g><path d="M50 31h0"></path><path d="M86 31h0"></path><rect x="50" y="20" width="36" height="22" rx="10" ry="10"></rect><text x="68" y="35">$=</text></g><path d="M86 31h10"></path><path d="M 96 31 h 20 m -10 -10 v 20 m 10 -20 v 20"></path></g></svg></dd>

		<dt id="substring-match-token-diagram">&lt;substring-match-token&gt;</dt>
		<dd><svg class="railroad-diagram" width="137" height="62"><g transform="translate(.5 .5)"><path d="M 20 21 v 20 m 10 -20 v 20 m -10 -10 h 20.5"></path><path d="M40 31h10"></path><g><path d="M50 31h0"></path><path d="M86 31h0"></path><rect x="50" y="20" width="36" height="22" rx="10" ry="10"></rect><text x="68" y="35">*=</text></g><path d="M86 31h10"></path><path d="M 96 31 h 20 m -10 -10 v 20 m 10 -20 v 20"></path></g></svg></dd>

		<dt id="column-token-diagram">&lt;column-token&gt;</dt>
		<dd><svg class="railroad-diagram" width="137" height="62"><g transform="translate(.5 .5)"><path d="M 20 21 v 20 m 10 -20 v 20 m -10 -10 h 20.5"></path><path d="M40 31h10"></path><g><path d="M50 31h0"></path><path d="M86 31h0"></path><rect x="50" y="20" width="36" height="22" rx="10" ry="10"></rect><text x="68" y="35">||</text></g><path d="M86 31h10"></path><path d="M 96 31 h 20 m -10 -10 v 20 m 10 -20 v 20"></path></g></svg></dd>

		<dt id="cdo-token-diagram">&lt;CDO-token&gt;</dt>
		<dd><svg class="railroad-diagram" width="153" height="62"><g transform="translate(.5 .5)"><path d="M 20 21 v 20 m 10 -20 v 20 m -10 -10 h 20.5"></path><path d="M40 31h10"></path><g><path d="M50 31h0"></path><path d="M102 31h0"></path><rect x="50" y="20" width="52" height="22" rx="10" ry="10"></rect><text x="76" y="35">&lt;!--</text></g><path d="M102 31h10"></path><path d="M 112 31 h 20 m -10 -10 v 20 m 10 -20 v 20"></path></g></svg></dd>

		<dt id="cdc-token-diagram">&lt;CDC-token&gt;</dt>
		<dd><svg class="railroad-diagram" width="145" height="62"><g transform="translate(.5 .5)"><path d="M 20 21 v 20 m 10 -20 v 20 m -10 -10 h 20.5"></path><path d="M40 31h10"></path><g><path d="M50 31h0"></path><path d="M94 31h0"></path><rect x="50" y="20" width="44" height="22" rx="10" ry="10"></rect><text x="72" y="35">--&gt;</text></g><path d="M94 31h10"></path><path d="M 104 31 h 20 m -10 -10 v 20 m 10 -20 v 20"></path></g></svg></dd>

	</dl>

<h3 id="tokenizer-definitions">
Definitions</h3>

	This section defines several terms used during the tokenization phase.

	<dl>
		<dt><dfn>code point</dfn>
		<dd>
			A <a href="http://unicode.org/glossary/#code_point">Unicode code point</a>.
			Any value in the Unicode codespace; that is, the range of integers from 0 to (hexadecimal) 10FFFF.

		<dt><dfn>next input code point</dfn>
		<dd>
			The first <a>code point</a> in the input stream that has not yet been consumed.

		<dt><dfn>current input code point</dfn>
		<dd>
			The last <a>code point</a> to have been consumed.

		<dt><dfn>reconsume the current input code point</dfn>
		<dd>
			Push the <a>current input code point</a> back onto the front of the input stream,
			so that the next time you are instructed to consume the <a>next input code point</a>,
			it will instead reconsume the <a>current input code point</a>.

		<dt><dfn>EOF code point</dfn>
		<dd>
			A conceptual <a>code point</a> representing the end of the input stream.
			Whenever the input stream is empty,
			the <a>next input code point</a> is always an EOF code point.

		<dt><dfn>digit</dfn>
		<dd>
			A <a>code point</a> between U+0030 DIGIT ZERO (0) and U+0039 DIGIT NINE (9).

		<dt><dfn>hex digit</dfn>
		<dd>
			A <a>digit</a>,
			or a <a>code point</a> between U+0041 LATIN CAPITAL LETTER A (A) and U+0046 LATIN CAPITAL LETTER F (F),
			or a <a>code point</a> between U+0061 LATIN SMALL LETTER A (a) and U+0066 LATIN SMALL LETTER F (f).

		<dt><dfn>uppercase letter</dfn>
		<dd>
			A <a>code point</a> between U+0041 LATIN CAPITAL LETTER A (A) and U+005A LATIN CAPITAL LETTER Z (Z).

		<dt><dfn>lowercase letter</dfn>
		<dd>
			A <a>code point</a> between U+0061 LATIN SMALL LETTER A (a) and U+007A LATIN SMALL LETTER Z (z).

		<dt><dfn>letter</dfn>
		<dd>
			An <a>uppercase letter</a>
			or a <a>lowercase letter</a>.

		<dt><dfn>non-ASCII code point</dfn>
		<dd>
			A <a>code point</a> with a value equal to or greater than U+0080 &lt;control>.

		<dt><dfn>name-start code point</dfn>
		<dd>
			A <a>letter</a>,
			a <a>non-ASCII code point</a>,
			or U+005F LOW LINE (_).

		<dt><dfn>name code point</dfn>
		<dd>
			A <a>name-start code point</a>,
			A <a>digit</a>,
			or U+002D HYPHEN-MINUS (-).

		<dt><dfn>non-printable code point</dfn>
		<dd>
			A <a>code point</a> between U+0000 NULL and U+0008 BACKSPACE,
			or U+000B LINE TABULATION,
			or a <a>code point</a> between U+000E SHIFT OUT and U+001F INFORMATION SEPARATOR ONE,
			or U+007F DELETE.

		<dt><dfn>newline</dfn>
		<dd>
			U+000A LINE FEED.
			<span class='note'>
				Note that U+000D CARRIAGE RETURN and U+000C FORM FEED are not included in this definition,
				as they are converted to U+000A LINE FEED during <a href="#input-preprocessing">preprocessing</a>.
			</span>

		<dt><dfn>whitespace</dfn>
		<dd>A <a>newline</a>, U+0009 CHARACTER TABULATION, or U+0020 SPACE.

		<dt><dfn>surrogate code point</dfn>
		<dd>
			A <a>code point</a> between U+D800 and U+DFFF inclusive.

		<dt><dfn>maximum allowed code point</dfn>
		<dd>The greatest <a>code point</a> defined by Unicode.  This is currently U+10FFFF.

	</dl>

<h3 id="tokenizer-algorithms">
Tokenizer Algorithms</h3>

	The algorithms defined in this section transform a stream of <a>code points</a> into a stream of tokens.

<h4 id="consume-a-token">
Consume a token</h4>

	This section describes how to <dfn>consume a token</dfn> from a stream of <a>code points</a>.
	It will return a single token of any type.

	Consume the <a>next input code point</a>.

	<dl>
		<dt><a>whitespace</a>
		<dd>
			Consume as much <a>whitespace</a> as possible.
			Return a <<whitespace-token>>.

		<dt>U+0022 QUOTATION MARK (")
		<dd>
			<a>Consume a string token</a> with the ending <a>code point</a> U+0022 QUOTATION MARK (")
			and return it.

		<dt>U+0023 NUMBER SIGN (#)
		<dd>
			If the <a>next input code point</a> is a <a>name code point</a>
			or the <a title="next input code point">next two input code points</a>
			<a>are a valid escape</a>,
			then:

			<ol>
				<li>
					Create a <<hash-token>>.

				<li>
					If the <a title="next input code point">next 3 input code points</a> <a>would start an identifier</a>,
					set the <<hash-token>>’s type flag to "id".

				<li>
					<a>Consume a name</a>,
					and set the <<hash-token>>’s value to the returned string.

				<li>
					Return the <<hash-token>>.
			</ol>

			Otherwise,
			return a <<delim-token>>
			with its value set to the <a>current input code point</a>.

		<dt>U+0024 DOLLAR SIGN ($)
		<dd>
			If the <a>next input code point</a> is
			U+003D EQUALS SIGN (=),
			consume it
			and return a <<suffix-match-token>>.

			Otherwise,
			emit a <<delim-token>>
			with its value set to the <a>current input code point</a>.

		<dt>U+0027 APOSTROPHE (&apos;)
		<dd>
			<a>Consume a string token</a> with the ending <a>code point</a> U+0027 APOSTROPHE (&apos;)
			and return it.

		<dt>U+0028 LEFT PARENTHESIS (()
		<dd>
			Return a <<(-token>>.

		<dt>U+0029 RIGHT PARENTHESIS ())
		<dd>
			Return a <<)-token>>.

		<dt>U+002A ASTERISK (*)
		<dd>
			If the <a>next input code point</a> is
			U+003D EQUALS SIGN (=),
			consume it
			and return a <<substring-match-token>>.

			Otherwise,
			return a <<delim-token>>
			with its value set to the <a>current input code point</a>.

		<dt>U+002B PLUS SIGN (+)
		<dd>
			If the input stream <a>starts with a number</a>,
			<a>reconsume the current input code point</a>,
			<a>consume a numeric token</a>
			and return it.

			Otherwise,
			return a <<delim-token>>
			with its value set to the <a>current input code point</a>.

		<dt>U+002C COMMA (,)
		<dd>
			Return a <<comma-token>>.

		<dt>U+002D HYPHEN-MINUS (-)
		<dd>
			If the input stream <a>starts with a number</a>,
			<a>reconsume the current input code point</a>,
			<a>consume a numeric token</a>,
			and return it.

			Otherwise,
			if the input stream <a>starts with an identifier</a>,
			<a>reconsume the current input code point</a>,
			<a>consume an ident-like token</a>,
			and return it.

			Otherwise,
			if the <a title="next input code point">next 2 input code points</a> are
			U+002D HYPHEN-MINUS
			U+003E GREATER-THAN SIGN
			(->),
			consume them
			and return a <<CDC-token>>.

			Otherwise,
			return a <<delim-token>>
			with its value set to the <a>current input code point</a>.

		<dt>U+002E FULL STOP (.)
		<dd>
			If the input stream <a>starts with a number</a>,
			<a>reconsume the current input code point</a>,
			<a>consume a numeric token</a>,
			and return it.

			Otherwise,
			return a <<delim-token>>
			with its value set to the <a>current input code point</a>.

		<dt>U+002F SOLIDUS (/)
		<dd>
			If the <a>next input code point</a> is U+002A ASTERISK (*),
			consume it
			and all following <a>code points</a> up to and including
			the first U+002A ASTERISK (*) followed by a U+002F SOLIDUS (/),
			or up to an EOF code point.
			Then <a>consume a token</a>
			and return it.

			Otherwise,
			return a <<delim-token>>
			with its value set to the <a>current input code point</a>.

		<dt>U+003A COLON (:)
		<dd>
			Return a <<colon-token>>.

		<dt>U+003B SEMICOLON (;)
		<dd>
			Return a <<semicolon-token>>.

		<dt>U+003C LESS-THAN SIGN (&lt;)
		<dd>
			If the <a title="next input code point">next 3 input code points</a> are
			U+0021 EXCLAMATION MARK
			U+002D HYPHEN-MINUS
			U+002D HYPHEN-MINUS
			(!--),
			consume them
			and return a <<CDO-token>>.

			Otherwise,
			return a <<delim-token>>
			with its value set to the <a>current input code point</a>.

		<dt>U+0040 COMMERCIAL AT (@)
		<dd>
			If the <a title="next input code point">next 3 input code points</a>
			<a>would start an identifier</a>,
			<a>consume a name</a>,
			create an <<at-keyword-token>> with its value set to the returned value,
			and return it.

			Otherwise,
			return a <<delim-token>>
			with its value set to the <a>current input code point</a>.

		<dt>U+005B LEFT SQUARE BRACKET ([)
		<dd>
			Return a <<[-token>>.

		<dt>U+005C REVERSE SOLIDUS (\)
		<dd>
			If the input stream <a>starts with a valid escape</a>,
			<a>reconsume the current input code point</a>,
			<a>consume an ident-like token</a>,
			and return it.

			Otherwise,
			this is a <a>parse error</a>.
			Return a <<delim-token>>
			with its value set to the <a>current input code point</a>.

		<dt>U+005D RIGHT SQUARE BRACKET (])
		<dd>
			Return a <<]-token>>.

		<dt>U+005E CIRCUMFLEX ACCENT (^)
		<dd>
			If the <a>next input code point</a> is
			U+003D EQUALS SIGN (=),
			consume it
			and return a <<prefix-match-token>>.

			Otherwise,
			return a <<delim-token>>
			with its value set to the <a>current input code point</a>.

		<dt>U+007B LEFT CURLY BRACKET ({)
		<dd>
			Return a <<{-token>>.

		<dt>U+007D RIGHT CURLY BRACKET (})
		<dd>
			Return a <<}-token>>.

		<dt><a>digit</a>
		<dd>
			<a>Consume a numeric token</a>,
			and return it.

		<dt>U+0055 LATIN CAPITAL LETTER U (U)
		<dt>U+0075 LATIN SMALL LETTER U (u)
		<dd>
			If the <a title="next input code point">next 2 input code points</a> are
			U+002B PLUS SIGN (+)
			followed by a <a>hex digit</a>
			or U+003F QUESTION MARK (?),
			consume the <a>next input code point</a>.
			<span class='note'>Note: don't consume both of them.</span>
			<a>Consume a unicode-range token</a>
			and return it.

			Otherwise,
			<a>reconsume the current input code point</a>,
			<a>consume an ident-like token</a>,
			and return it.

		<dt><a>name-start code point</a>
		<dd>
			<a>Reconsume the current input code point</a>,
			<a>consume an ident-like token</a>,
			and return it.

		<dt>U+007C VERTICAL LINE (|)
		<dd>
			If the <a>next input code point</a> is
			U+003D EQUALS SIGN (=),
			consume it
			and return a <<dash-match-token>>.

			Otherwise,
			if the <a>next input code point</a> is
			U+0073 VERTICAL LINE (|),
			consume it
			and return a <<column-token>>.

			Otherwise,
			return a <<delim-token>>
			with its value set to the <a>current input code point</a>.

		<dt>U+007E TILDE (~)
		<dd>
			If the <a>next input code point</a> is
			U+003D EQUALS SIGN (=),
			consume it
			and return an <<include-match-token>>.

			Otherwise,
			return a <<delim-token>>
			with its value set to the <a>current input code point</a>.

		<dt>EOF
		<dd>
			Return an <<EOF-token>>.

		<dt>anything else
		<dd>
			Return a <<delim-token>>
			with its value set to the <a>current input code point</a>.
	</dl>




<h4 id="consume-a-numeric-token">
Consume a numeric token</h4>

	This section describes how to <dfn>consume a numeric token</dfn> from a stream of <a>code points</a>.
	It returns either a <<number-token>>, <<percentage-token>>, or <<dimension-token>>.

	<a>Consume a number</a>.

	If the <a title="next input code point">next 3 input code points</a> <a>would start an identifier</a>,
	then:

	<ol>
		<li>Create a <<dimension-token>> with the same representation, value, and type flag as the returned number,
			and a unit set initially to the empty string.

		<li><a>Consume a name</a>.
			Set the <<dimension-token>>’s unit to the returned value.

		<li>Return the <<dimension-token>>.
	</ol>

	Otherwise,
	if the <a>next input code point</a> is U+0025 PERCENTAGE SIGN (%),
	consume it.
	Create a <<percentage-token>> with the same representation and value as the returned number,
	and return it.

	Otherwise,
	create a <<number-token>> with the same representation, value, and type flag as the returned number,
	and return it.


<h4 id="consume-an-ident-like-token">
Consume an ident-like token</h4>

	This section describes how to <dfn>consume an ident-like token</dfn> from a stream of <a>code points</a>.
	It returns an <<ident-token>>, <<function-token>>, <<url-token>>, or <<bad-url-token>>.

	<a>Consume a name</a>.

	If the returned string's value is an <a>ASCII case-insensitive</a> match for "url",
	and the <a>next input code point</a> is U+0028 LEFT PARENTHESIS ((),
	consume it.
	<a>Consume a url token</a>,
	and return it.

	Otherwise,
	if the <a>next input code point</a> is U+0028 LEFT PARENTHESIS ((),
	consume it.
	Create a <<function-token>>
	with its value set to the returned string
	and return it.

	Otherwise,
	create an <<ident-token>>
	with its value set to the returned string
	and return it.


<h4 id="consume-a-string-token">
Consume a string token</h4>

	This section describes how to <dfn>consume a string token</dfn> from a stream of <a>code points</a>.
	It returns either a <<string-token>> or <<bad-string-token>>.

	This algorithm must be called with an <var>ending code point</var>,
	which denotes the <a>code point</a> that ends the string.

	Initially create a <<string-token>> with its value set to the empty string.

	Repeatedly consume the <a>next input code point</a> from the stream:

	<dl>
		<dt><var>ending code point</var>
		<dt>EOF
		<dd>
			Return the <<string-token>>.

		<dt><a>newline</a>
		<dd>
			This is a <a>parse error</a>.
			<a>Reconsume the current input code point</a>,
			create a <<bad-string-token>>, and return it.

		<dt>U+005C REVERSE SOLIDUS (\)
		<dd>
			If the <a>next input code point</a> is EOF,
			do nothing.

			Otherwise,
			if the <a>next input code point</a> is a newline,
			consume it.

			Otherwise,
			if the stream <a>starts with a valid escape</a>,
			<a>consume an escaped code point</a>
			and append the returned <a>code point</a> to the <<string-token>>’s value.

		<dt>anything else
		<dd>
			Append the <a>current input code point</a> to the <<string-token>>’s value.
	</dl>


<h4 id="consume-a-url-token">
Consume a url token</h4>

	This section describes how to <dfn>consume a url token</dfn> from a stream of <a>code points</a>.
	It returns either a <<url-token>> or a <<bad-url-token>>.

	Note: This algorithm assumes that the initial "url(" has already been consumed.

	Execute the following steps in order:

	<ol>
		<li>
			Initially create a <<url-token>> with its value set to the empty string.

		<li>
			Consume as much <a>whitespace</a> as possible.

		<li>
			If the <a>next input code point</a> is EOF,
			return the <<url-token>>.

		<li>
			If the <a>next input code point</a> is a U+0022 QUOTATION MARK (") or U+0027 APOSTROPHE (&apos;),
			then:

			<ol>
				<li>
					<a>Consume a string token</a> with the <a>current input code point</a> as the ending code point.

				<li>
					If a <<bad-string-token>> was returned,
					<a>consume the remnants of a bad url</a>,
					create a <<bad-url-token>>,
					and return it.

				<li>
					Set the <<url-token>>’s value to the returned <<string-token>>’s value.

				<li>
					Consume as much <a>whitespace</a> as possible.

				<li>
					If the <a>next input code point</a> is U+0029 RIGHT PARENTHESIS ()) or EOF,
					consume it and return the <<url-token>>;
					otherwise,
					<a>consume the remnants of a bad url</a>,
					create a <<bad-url-token>>,
					and return it.
			</ol>

		<li>
			Repeatedly consume the <a>next input code point</a> from the stream:

			<dl>
				<dt>U+0029 RIGHT PARENTHESIS ())
				<dt>EOF
				<dd>
					Return the <<url-token>>.

				<dt><a>whitespace</a>
				<dd>
					Consume as much <a>whitespace</a> as possible.
					If the <a>next input code point</a> is U+0029 RIGHT PARENTHESIS ()) or EOF,
					consume it and return the <<url-token>>;
					otherwise,
					<a>consume the remnants of a bad url</a>,
					create a <<bad-url-token>>,
					and return it.

				<dt>U+0022 QUOTATION MARK (")
				<dt>U+0027 APOSTROPHE (&apos;)
				<dt>U+0028 LEFT PARENTHESIS (()
				<dt><a>non-printable code point</a>
				<dd>
					This is a <a>parse error</a>.
					<a>Consume the remnants of a bad url</a>,
					create a <<bad-url-token>>,
					and return it.

				<dt>U+005C REVERSE SOLIDUS
				<dd>
					If the stream <a>starts with a valid escape</a>,
					<a>consume an escaped code point</a>
					and append the returned <a>code point</a> to the <<url-token>>’s value.

					Otherwise,
					this is a <a>parse error</a>.
					<a>Consume the remnants of a bad url</a>,
					create a <<bad-url-token>>,
					and return it.

				<dt>anything else
				<dd>
					Append the <a>current input code point</a>
					to the <<url-token>>’s value.
			</dl>
	</ol>


<h4 id="consume-a-unicode-range-token">
Consume a unicode-range token</h4>

	This section describes how to <dfn>consume a unicode-range token</dfn>.
	It returns a <<unicode-range-token>>.

	Note: This algorithm assumes that the initial "u+" has been consumed,
	and the next <a>code point</a> verified to be a <a>hex digit</a> or a "?".

	Execute the following steps in order:

	<ol>
		<li>
			Consume as many <a>hex digits</a> as possible, but no more than 6.
			If less than 6 <a>hex digits</a> were consumed,
			consume as many U+003F QUESTION MARK (?) <a>code points</a> as possible,
			but no more than enough to make the total of <a>hex digits</a> and U+003F QUESTION MARK (?) <a>code points</a> equal to 6.

			If any U+003F QUESTION MARK (?) <a>code points</a> were consumed,
			then:

			<ol>
				<li>
					Interpret the consumed <a>code points</a> as a hexadecimal number,
					with the U+003F QUESTION MARK (?) <a>code points</a> replaced by U+0030 DIGIT ZERO (0) <a>code points</a>.
					This is the <a>start of the range</a>.

				<li>
					Interpret the consumed <a>code points</a> as a hexadecimal number again,
					with the U+003F QUESTION MARK (?) <a>code point</a> replaced by U+0046 LATIN CAPITAL LETTER F (F) <a>code points</a>.
					This is the <a>end of the range</a>.

				<li>
					Return a new <<unicode-range-token>> with the above start and end.
			</ol>

			Otherwise,
			interpret the digits as a hexadecimal number.
			This is the <a>start of the range</a>.

		<li>
			If the <a title="next input code point">next 2 input code point</a> are
			U+002D HYPHEN-MINUS (-) followed by a <a>hex digit</a>,
			then:

			<ol>
				<li>Consume the <a>next input code point</a>.

				<li>
					Consume as many <a>hex digits</a> as possible, but no more than 6.
					Interpret the digits as a hexadecimal number.
					This is the <a>end of the range</a>.
			</ol>

		<li>
			Otherwise, the <a>end of the range</a> is the <a>start of the range</a>.

		<li>
			Return the <<unicode-range-token>> with the above start and end.
	</ol>


<h4 id="consume-an-escaped-code-point">
Consume an escaped code point</h4>

	This section describes how to <dfn>consume an escaped code point</dfn>.
	It assumes that the U+005C REVERSE SOLIDUS (\) has already been consumed
	and that the next input code point has already been verified
	to not be a <a>newline</a> or EOF.
	It will return a <a>code point</a>.

	Consume the <a>next input code point</a>.

	<dl>
		<dt><a>hex digit</a>
		<dd>
			Consume as many <a>hex digits</a> as possible, but no more than 5.
			<span class='note'>Note that this means 1-6 hex digits have been consumed in total.</span>
			If the <a>next input code point</a> is
			<a>whitespace</a>,
			consume it as well.
			Interpret the <a>hex digits</a> as a hexadecimal number.
			If this number is zero,
			or is for a <a>surrogate code point</a>,
			or is greater than the <a>maximum allowed code point</a>,
			return U+FFFD REPLACEMENT CHARACTER (�).
			Otherwise, return the <a>code point</a> with that value.

		<dt>EOF code point
		<dd>
			Return U+FFFD REPLACEMENT CHARACTER (�).

		<dt>anything else
		<dd>
			Return the <a>current input code point</a>.
	</dl>


<h4 id="starts-with-a-valid-escape">
Check if two code points are a valid escape</h4>

	This section describes how to <dfn title="check if two code points are a valid escape|are a valid escape|starts with a valid escape">check if two code points are a valid escape</dfn>.
	The algorithm described here can be called explicitly with two <a>code points</a>,
	or can be called with the input stream itself.
	In the latter case, the two <a>code points</a> in question are
	the <a>current input code point</a>
	and the <a>next input code point</a>,
	in that order.

	Note: This algorithm will not consume any additional <a>code point</a>.

	If the first <a>code point</a> is not U+005D REVERSE SOLIDUS (\),
	return false.

	Otherwise,
	if the second <a>code point</a> is a <a>newline</a>,
	return false.

	Otherwise, return true.


<h4 id="would-start-an-identifier">
Check if three code points would start an identifier</dfn></h4>

	This section describes how to <dfn title="check if three code points would start an identifier|starts with an identifier|start with an identifier|would start an identifier">check if three code points would start an identifier</dfn>.
	The algorithm described here can be called explicitly with three <a>code points</a>,
	or can be called with the input stream itself.
	In the latter case, the three <a>code points</a> in question are
	the <a>current input code point</a>
	and the <a title="next input code point">next two input code points</a>,
	in that order.

	Note: This algorithm will not consume any additional <a>code point</a>.

	Look at the first <a>code point</a>:

	<dl>
		<dt>U+002D HYPHEN-MINUS
		<dd>
			If the second <a>code point</a> is a <a>name-start code point</a>
			or the second and third <a>code points</a> <a>are a valid escape</a>,
			return true.
			Otherwise, return false.

		<dt><a>name-start code point</a>
		<dd>
			Return true.

		<dt>U+005C REVERSE SOLIDUS (\)
		<dd>
			If the first and second <a>code points</a> <a>are a valid escape</a>,
			return true.
			Otherwise, return false.
	</dl>

<h4 id="starts-with-a-number">
Check if three code points would start a number</h4>

	This section describes how to <dfn title="check if three code points would start a number|starts with a number|start with a number|would start a number">check if three code points would start a number</dfn>.
	The algorithm described here can be called explicitly with three <a>code points</a>,
	or can be called with the input stream itself.
	In the latter case, the three <a>code points</a> in question are
	the <a>current input code point</a>
	and the <a title="next input code point">next two input code points</a>,
	in that order.

	Note: This algorithm will not consume any additional <a>code points</a>.

	Look at the first <a>code point</a>:

	<dl>
		<dt>U+002B PLUS SIGN (+)
		<dt>U+002D HYPHEN-MINUS (-)
		<dd>
			If the second <a>code point</a>
			is a <a>digit</a>,
			return true.

			Otherwise,
			if the second <a>code point</a>
			is a U+002E FULL STOP (.)
			and the third <a>code point</a>
			is a <a>digit</a>,
			return true.

			Otherwise, return false.

		<dt>U+002E FULL STOP (.)
		<dd>
			If the second <a>code point</a>
			is a <a>digit</a>,
			return true.
			Otherwise, return false.

		<dt><a>digit</a>
		<dd>
			Return true.

		<dt>anything else
		<dd>
			Return false.
	</dl>


<h4 id="consume-a-name">
Consume a name</h4>

	This section describes how to <dfn>consume a name</dfn> from a stream of <a>code points</a>.
	It returns a string containing
	the largest name that can be formed from adjacent <a>code points</a> in the stream, starting from the first.

	Note: This algorithm does not do the verification of the first few <a>code points</a>
	that are necessary to ensure the returned <a>code points</a> would constitute an <<ident-token>>.
	If that is the intended use,
	ensure that the stream <a>starts with an identifier</a>
	before calling this algorithm.

	Let <var>result</var> initially be an empty string.

	Repeatedly consume the <a>next input code point</a> from the stream:

	<dl>
		<dt><a>name code point</a>
		<dd>
			Append the <a>code point</a> to <var>result</var>.

		<dt>the stream <a>starts with a valid escape</a>
		<dd>
			<a>consume an escaped code point</a>.
			Append the returned <a>code point</a> to <var>result</var>.

		<dt>anything else
		<dd>
			Return <var>result</var>.
	</dl>


<h4 id="consume-a-number">
Consume a number</h4>

	This section describes how to <dfn>consume a number</dfn> from a stream of <a>code points</a>.
	It returns a 3-tuple of
	a string representation,
	a numeric value,
	and a type flag which is either "integer" or "number".

	Note: This algorithm does not do the verification of the first few <a>code points</a>
	that are necessary to ensure a number can be obtained from the stream.
	Ensure that the stream <a>starts with a number</a>
	before calling this algorithm.

	Execute the following steps in order:

	<ol>
		<li>
			Initially set <var>repr</var> to the empty string
			and <var>type</var> to "integer".

		<li>
			If the <a>next input code point</a> is U+002B PLUS SIGN (+) or U+002D HYPHEN-MINUS (-),
			consume it and append it to <var>repr</var>.

		<li>
			While the <a>next input code point</a> is a <a>digit</a>,
			consume it and append it to <var>repr</var>.

		<li>
			If the <a title="next input code point">next 2 input code points</a> are
			U+002E FULL STOP (.) followed by a <a>digit</a>,
			then:

			<ol>
				<li>Consume them.
				<li>Append them to <var>repr</var>.
				<li>Set <var>type</var> to "number".
				<li>While the <a>next input code point</a> is a <a>digit</a>, consume it and append it to <var>repr</var>.
			</ol>

		<li>
			If the <a title="next input code point">next 2 or 3 input code points</a> are
			U+0045 LATIN CAPITAL LETTER E (E) or U+0065 LATIN SMALL LETTER E (e),
			optionally followed by U+002D HYPHEN-MINUS (-) or U+002B PLUS SIGN (+),
			followed by a <a>digit</a>,
			then:

			<ol>
				<li>Consume them.
				<li>Append them to <var>repr</var>.
				<li>Set <var>type</var> to "number".
				<li>While the <a>next input code point</a> is a <a>digit</a>, consume it and append it to <var>repr</var>.
			</ol>

		<li>
			<a title="convert a string to a number">Convert <var>repr</var> to a number</a>,
			and set the <var>value</var> to the returned value.

		<li>
			Return a 3-tuple of <var>repr</var>, <var>value</var>, and <var>type</var>.
	</ol>


<h4 id="convert-a-string-to-a-number">
Convert a string to a number</h4>

	This section describes how to <dfn>convert a string to a number</dfn>.
	It returns a number.

	Note: This algorithm does not do any verification to ensure that the string contains only a number.
	Ensure that the string contains only a valid CSS number
	before calling this algorithm.

	Divide the string into seven components,
	in order from left to right:

	<ol>
		<li>A <b>sign</b>:
			a single U+002B PLUS SIGN (+) or U+002D HYPHEN-MINUS (-),
			or the empty string.
			Let <var>s</var> be the number -1 if the sign is U+002D HYPHEN-MINUS (-);
			otherwise, let <var>s</var> be the number 1.

		<li>An <b>integer part</b>:
			zero or more <a>digits</a>.
			If there is at least one digit,
			let <var>i</var> be the number formed by interpreting the digits as a base-10 integer;
			otherwise, let <var>i</var> be the number 0.

		<li>A <b>decimal point</b>:
			a single U+002E FULL STOP (.),
			or the empty string.

		<li>A <b>fractional part</b>:
			zero or more <a>digits</a>.
			If there is at least one digit,
			let <var>f</var> be the number formed by interpreting the digits as a base-10 integer
			and <var>d</var> be the number of digits;
			otherwise, let <var>f</var> and <var>d</var> be the number 0.

		<li>An <b>exponent indicator</b>:
			a single U+0045 LATIN CAPITAL LETTER E (E) or U+0065 LATIN SMALL LETTER E (e),
			or the empty string.

		<li>An <b>exponent sign</b>:
			a single U+002B PLUS SIGN (+) or U+002D HYPHEN-MINUS (-),
			or the empty string.
			Let <var>t</var> be the number -1 if the sign is U+002D HYPHEN-MINUS (-);
			otherwise, let <var>t</var> be the number 1.

		<li>An <b>exponent</b>:
			zero or more <a>digits</a>.
			If there is at least one digit,
			let <var>e</var> be the number formed by interpreting the digits as a base-10 integer;
			otherwise, let <var>e</var> be the number 0.
	</ol>

	Return the number <code>s·(i + f·10<sup>-d</sup>)·10<sup>te</sup></code>.


<h4 id="consume-the-remnants-of-a-bad-url">
Consume the remnants of a bad url</h4>

	This section describes how to <dfn>consume the remnants of a bad url</dfn> from a stream of <a>code points</a>,
	"cleaning up" after the tokenizer realizes that it's in the middle of a <<bad-url-token>> rather than a <<url-token>>.
	It returns nothing;
	its sole use is to consume enough of the input stream to reach a recovery point
	where normal tokenizing can resume.

	Repeatedly consume the <a>next input code point</a> from the stream:

	<dl>
		<dt>U+0029 RIGHT PARENTHESIS ())
		<dt>EOF
		<dd>
			Return.

		<dt>the input stream <a>starts with a valid escape</a>
		<dd>
			<a>consume an escaped code point</a>.
			<span class='note'>This allows an escaped right parenthesis ("\)") to be encountered without ending the <<bad-url-token>>.
				This is otherwise identical to the "anything else" clause.</span>

		<dt>anything else
		<dd>
			Do nothing.
	</dl>


<!--
PPPPPPPPPPPPPPPPP        AAA               RRRRRRRRRRRRRRRRR      SSSSSSSSSSSSSSS EEEEEEEEEEEEEEEEEEEEEERRRRRRRRRRRRRRRRR
P::::::::::::::::P      A:::A              R::::::::::::::::R   SS:::::::::::::::SE::::::::::::::::::::ER::::::::::::::::R
P::::::PPPPPP:::::P    A:::::A             R::::::RRRRRR:::::R S:::::SSSSSS::::::SE::::::::::::::::::::ER::::::RRRRRR:::::R
PP:::::P     P:::::P  A:::::::A            RR:::::R     R:::::RS:::::S     SSSSSSSEE::::::EEEEEEEEE::::ERR:::::R     R:::::R
	P::::P     P:::::P A:::::::::A             R::::R     R:::::RS:::::S              E:::::E       EEEEEE  R::::R     R:::::R
	P::::P     P:::::PA:::::A:::::A            R::::R     R:::::RS:::::S              E:::::E               R::::R     R:::::R
	P::::PPPPPP:::::PA:::::A A:::::A           R::::RRRRRR:::::R  S::::SSSS           E::::::EEEEEEEEEE     R::::RRRRRR:::::R
	P:::::::::::::PPA:::::A   A:::::A          R:::::::::::::RR    SS::::::SSSSS      E:::::::::::::::E     R:::::::::::::RR
	P::::PPPPPPPPP A:::::A     A:::::A         R::::RRRRRR:::::R     SSS::::::::SS    E:::::::::::::::E     R::::RRRRRR:::::R
	P::::P        A:::::AAAAAAAAA:::::A        R::::R     R:::::R       SSSSSS::::S   E::::::EEEEEEEEEE     R::::R     R:::::R
	P::::P       A:::::::::::::::::::::A       R::::R     R:::::R            S:::::S  E:::::E               R::::R     R:::::R
	P::::P      A:::::AAAAAAAAAAAAA:::::A      R::::R     R:::::R            S:::::S  E:::::E       EEEEEE  R::::R     R:::::R
PP::::::PP   A:::::A             A:::::A   RR:::::R     R:::::RSSSSSSS     S:::::SEE::::::EEEEEEEE:::::ERR:::::R     R:::::R
P::::::::P  A:::::A               A:::::A  R::::::R     R:::::RS::::::SSSSSS:::::SE::::::::::::::::::::ER::::::R     R:::::R
P::::::::P A:::::A                 A:::::A R::::::R     R:::::RS:::::::::::::::SS E::::::::::::::::::::ER::::::R     R:::::R
PPPPPPPPPPAAAAAAA                   AAAAAAARRRRRRRR     RRRRRRR SSSSSSSSSSSSSSS   EEEEEEEEEEEEEEEEEEEEEERRRRRRRR     RRRRRRR
-->

<h2 id="parsing">
Parsing</h2>

	The input to the parsing stage is a stream or list of tokens from the tokenization stage.
	The output depends on how the parser is invoked,
	as defined by the entry points listed later in this section.
	The parser output can consist of at-rules,
	qualified rules,
	and/or declarations.

	The parser's output is constructed according to the fundamental syntax of CSS,
	without regards for the validity of any specific item.
	Implementations may check the validity of items as they are returned by the various parser algorithms
	and treat the algorithm as returning nothing if the item was invalid according to the implementation's own grammar knowledge,
	or may construct a full tree as specified
	and "clean up" afterwards by removing any invalid items.

	The items that can appear in the tree are:

	<dl>
		<dt><dfn>at-rule</dfn>
		<dd>
			An at-rule has a name,
			a prelude consisting of a list of component values,
			and an optional block consisting of a simple {} block.

			Note: This specification places no limits on what an at-rule's block may contain.
			Individual at-rules must define whether they accept a block,
			and if so,
			how to parse it
			(preferably using one of the parser algorithms or entry points defined in this specification).

		<dt><dfn>qualified rule</dfn>
		<dd>
			A qualified rule has
			a prelude consisting of a list of component values,
			and a block consisting of a simple {} block.

			Note: Most qualified rules will be style rules,
			where the prelude is a selector [[SELECT]]
			and the block a <i title="parse a list of declarations">list of declarations</i>.

		<dt><dfn>declaration</dfn>
		<dd>
			A declaration has a name,
			a value consisting of a list of component values,
			and an <var>important</var> flag which is initially unset.

			<p class='issue'>
				Should we go ahead and generalize the important flag to be a list of bang values?
				Suggested by Zack Weinberg.

			Declarations are further categorized as "properties" or "descriptors",
			with the former typically appearing in <a>qualified rules</a>
			and the latter appearing in <a>at-rules</a>.
			(This categorization does not occur at the Syntax level;
			instead, it is a product of where the declaration appears,
			and is defined by the respective specifications defining the given rule.)

		<dt><dfn>component value</dfn>
		<dd>
			A component value is one of the preserved tokens,
			a function,
			or a simple block.

		<dt><dfn>preserved tokens</dfn>
		<dd>
			Any token produced by the tokenizer
			except for <<function-token>>s,
			<<{-token>>s,
			<<(-token>>s,
			and <<[-token>>s.

			Note: The non-preserved tokens listed above are always consumed into higher-level objects,
			either functions or simple blocks,
			and so never appear in any parser output themselves.

			Note: The tokens <<}-token>>s, <<)-token>>s, <<]-token>>, <<bad-string-token>>, and <<bad-url-token>> are always parse errors,
			but they are preserved in the token stream by this specification to allow other specs,
			such as Media Queries,
			to define more fine-grainted error-handling
			than just dropping an entire declaration or block.

		<dt><dfn>function</dfn>
		<dd>
			A function has a name
			and a value consisting of a list of component values.

		<dt><dfn>simple block</dfn>
		<dd>
			A simple block has an associated token (either a <<[-token>>, <<(-token>>, or <<{-token>>)
			and a value consisting of a list of component values.
	</dl>

<h3 id='parser-diagrams'>
Parser Railroad Diagrams</h3>

	<em>This section is non-normative.</em>

	This section presents an informative view of the parser,
	in the form of railroad diagrams.
	Railroad diagrams are more compact than a state-machine,
	but often easier to read than a regular expression.

	These diagrams are <em>informative</em> and <em>incomplete</em>;
	they describe the grammar of "correct" stylesheets,
	but do not describe error-handling at all.
	They are provided solely to make it easier to get an intuitive grasp of the syntax.

	<!--
		The "source" of these diagrams is in ./Diagrams.src.html
		The generated SVG is copied here so that JavaScript is not required
		to view the spec.
	-->

	<dl>
		<dt id="stylesheet-diagram">Stylesheet</dt>
		<dd><svg class="railroad-diagram" width="345" height="200"><g transform="translate(.5 .5)"><path d="M 20 121 v 20 m 10 -20 v 20 m -10 -10 h 20.5"></path><g><path d="M40 131h0"></path><path d="M304 131h0"></path><path d="M40 131a10 10 0 0 0 10 -10v-89a10 10 0 0 1 10 -10"></path><g><path d="M60 22h224"></path></g><path d="M284 22a10 10 0 0 1 10 10v89a10 10 0 0 0 10 10"></path><path d="M40 131h20"></path><g><path d="M60 131h0"></path><path d="M284 131h0"></path><path d="M60 131h10"></path><g><path d="M70 131h0"></path><path d="M274 131h0"></path><path d="M70 131a10 10 0 0 0 10 -10v-10a10 10 0 0 1 10 -10"></path><g><path d="M90 101h0"></path><path d="M254 101h0"></path><rect x="90" y="90" width="164" height="22"></rect><text x="172" y="105">&lt;whitespace-token&gt;</text></g><path d="M254 101a10 10 0 0 1 10 10v10a10 10 0 0 0 10 10"></path><path d="M70 131a10 10 0 0 0 10 -10v-40a10 10 0 0 1 10 -10"></path><g><path d="M90 71h28"></path><path d="M226 71h28"></path><rect x="118" y="60" width="108" height="22"></rect><text x="172" y="75">&lt;CDC-token&gt;</text></g><path d="M254 71a10 10 0 0 1 10 10v40a10 10 0 0 0 10 10"></path><path d="M70 131a10 10 0 0 0 10 -10v-70a10 10 0 0 1 10 -10"></path><g><path d="M90 41h28"></path><path d="M226 41h28"></path><rect x="118" y="30" width="108" height="22"></rect><text x="172" y="45">&lt;CDO-token&gt;</text></g><path d="M254 41a10 10 0 0 1 10 10v70a10 10 0 0 0 10 10"></path><path d="M70 131h20"></path><g><path d="M90 131h16"></path><path d="M238 131h16"></path><rect x="106" y="120" width="132" height="22"></rect><text x="172" y="135">Qualified rule</text></g><path d="M254 131h20"></path><path d="M70 131a10 10 0 0 1 10 10v10a10 10 0 0 0 10 10"></path><g><path d="M90 161h44"></path><path d="M210 161h44"></path><rect x="134" y="150" width="76" height="22"></rect><text x="172" y="165">At-rule</text></g><path d="M254 161a10 10 0 0 0 10 -10v-10a10 10 0 0 1 10 -10"></path></g><path d="M274 131h10"></path><path d="M70 131a10 10 0 0 0 -10 10v29a10 10 0 0 0 10 10"></path><g><path d="M70 180h204"></path></g><path d="M274 180a10 10 0 0 0 10 -10v-29a10 10 0 0 0 -10 -10"></path></g><path d="M284 131h20"></path></g><path d="M 304 131 h 20 m -10 -10 v 20 m 10 -20 v 20"></path></g></svg></dd>

		<dt id="rule-list-diagram">Rule list</dt>
		<dd><svg class="railroad-diagram" width="345" height="140"><g transform="translate(.5 .5)"><path d="M 20 61 v 20 m 10 -20 v 20 m -10 -10 h 20.5"></path><g><path d="M40 71h0"></path><path d="M304 71h0"></path><path d="M40 71a10 10 0 0 0 10 -10v-29a10 10 0 0 1 10 -10"></path><g><path d="M60 22h224"></path></g><path d="M284 22a10 10 0 0 1 10 10v29a10 10 0 0 0 10 10"></path><path d="M40 71h20"></path><g><path d="M60 71h0"></path><path d="M284 71h0"></path><path d="M60 71h10"></path><g><path d="M70 71h0"></path><path d="M274 71h0"></path><path d="M70 71a10 10 0 0 0 10 -10v-10a10 10 0 0 1 10 -10"></path><g><path d="M90 41h0"></path><path d="M254 41h0"></path><rect x="90" y="30" width="164" height="22"></rect><text x="172" y="45">&lt;whitespace-token&gt;</text></g><path d="M254 41a10 10 0 0 1 10 10v10a10 10 0 0 0 10 10"></path><path d="M70 71h20"></path><g><path d="M90 71h16"></path><path d="M238 71h16"></path><rect x="106" y="60" width="132" height="22"></rect><text x="172" y="75">Qualified rule</text></g><path d="M254 71h20"></path><path d="M70 71a10 10 0 0 1 10 10v10a10 10 0 0 0 10 10"></path><g><path d="M90 101h44"></path><path d="M210 101h44"></path><rect x="134" y="90" width="76" height="22"></rect><text x="172" y="105">At-rule</text></g><path d="M254 101a10 10 0 0 0 10 -10v-10a10 10 0 0 1 10 -10"></path></g><path d="M274 71h10"></path><path d="M70 71a10 10 0 0 0 -10 10v29a10 10 0 0 0 10 10"></path><g><path d="M70 120h204"></path></g><path d="M274 120a10 10 0 0 0 10 -10v-29a10 10 0 0 0 -10 -10"></path></g><path d="M284 71h20"></path></g><path d="M 304 71 h 20 m -10 -10 v 20 m 10 -20 v 20"></path></g></svg></dd>

		<dt id="at-rule-diagram">At-rule</dt>
		<dd><svg class="railroad-diagram" width="589" height="102"><g transform="translate(.5 .5)"><path d="M 20 31 v 20 m 10 -20 v 20 m -10 -10 h 20.5"></path><path d="M40 41h10"></path><g><path d="M50 41h0"></path><path d="M214 41h0"></path><rect x="50" y="30" width="164" height="22"></rect><text x="132" y="45">&lt;at-keyword-token&gt;</text></g><path d="M214 41h10"></path><g><path d="M224 41h0"></path><path d="M424 41h0"></path><path d="M224 41a10 10 0 0 0 10 -10v0a10 10 0 0 1 10 -10"></path><g><path d="M244 21h160"></path></g><path d="M404 21a10 10 0 0 1 10 10v0a10 10 0 0 0 10 10"></path><path d="M224 41h20"></path><g><path d="M244 41h0"></path><path d="M404 41h0"></path><path d="M244 41h10"></path><g><path d="M254 41h0"></path><path d="M394 41h0"></path><rect x="254" y="30" width="140" height="22"></rect><text x="324" y="45">Component value</text></g><path d="M394 41h10"></path><path d="M254 41a10 10 0 0 0 -10 10v0a10 10 0 0 0 10 10"></path><g><path d="M254 61h140"></path></g><path d="M394 61a10 10 0 0 0 10 -10v0a10 10 0 0 0 -10 -10"></path></g><path d="M404 41h20"></path></g><g><path d="M424 41h0"></path><path d="M548 41h0"></path><path d="M424 41h20"></path><g><path d="M444 41h0"></path><path d="M528 41h0"></path><rect x="444" y="30" width="84" height="22"></rect><text x="486" y="45">{} block</text></g><path d="M528 41h20"></path><path d="M424 41a10 10 0 0 1 10 10v10a10 10 0 0 0 10 10"></path><g><path d="M444 71h28"></path><path d="M500 71h28"></path><rect x="472" y="60" width="28" height="22" rx="10" ry="10"></rect><text x="486" y="75">;</text></g><path d="M528 71a10 10 0 0 0 10 -10v-10a10 10 0 0 1 10 -10"></path></g><path d="M 548 41 h 20 m -10 -10 v 20 m 10 -20 v 20"></path></g></svg></dd>

		<dt id="qualified-rule-diagram">Qualified rule</dt>
		<dd><svg class="railroad-diagram" width="385" height="81"><g transform="translate(.5 .5)"><path d="M 20 31 v 20 m 10 -20 v 20 m -10 -10 h 20.5"></path><g><path d="M40 41h0"></path><path d="M240 41h0"></path><path d="M40 41a10 10 0 0 0 10 -10v0a10 10 0 0 1 10 -10"></path><g><path d="M60 21h160"></path></g><path d="M220 21a10 10 0 0 1 10 10v0a10 10 0 0 0 10 10"></path><path d="M40 41h20"></path><g><path d="M60 41h0"></path><path d="M220 41h0"></path><path d="M60 41h10"></path><g><path d="M70 41h0"></path><path d="M210 41h0"></path><rect x="70" y="30" width="140" height="22"></rect><text x="140" y="45">Component value</text></g><path d="M210 41h10"></path><path d="M70 41a10 10 0 0 0 -10 10v0a10 10 0 0 0 10 10"></path><g><path d="M70 61h140"></path></g><path d="M210 61a10 10 0 0 0 10 -10v0a10 10 0 0 0 -10 -10"></path></g><path d="M220 41h20"></path></g><path d="M240 41h10"></path><g><path d="M250 41h0"></path><path d="M334 41h0"></path><rect x="250" y="30" width="84" height="22"></rect><text x="292" y="45">{} block</text></g><path d="M334 41h10"></path><path d="M 344 41 h 20 m -10 -10 v 20 m 10 -20 v 20"></path></g></svg></dd>

		<dt id="declaration-list-diagram">Declaration list</dt>
		<dd><svg class="railroad-diagram" width="589" height="102"><g transform="translate(.5 .5)"><path d="M 20 31 v 20 m 10 -20 v 20 m -10 -10 h 20.5"></path><path d="M40 41h10"></path><g><path d="M50 41h0"></path><path d="M94 41h0"></path><rect x="50" y="30" width="44" height="22"></rect><text x="72" y="45">ws*</text></g><path d="M94 41h10"></path><g><path d="M104 41h0"></path><path d="M548 41h0"></path><path d="M104 41h20"></path><g><path d="M124 41h0"></path><path d="M528 41h0"></path><g><path d="M124 41h0"></path><path d="M272 41h0"></path><path d="M124 41a10 10 0 0 0 10 -10v0a10 10 0 0 1 10 -10"></path><g><path d="M144 21h108"></path></g><path d="M252 21a10 10 0 0 1 10 10v0a10 10 0 0 0 10 10"></path><path d="M124 41h20"></path><g><path d="M144 41h0"></path><path d="M252 41h0"></path><rect x="144" y="30" width="108" height="22"></rect><text x="198" y="45">Declaration</text></g><path d="M252 41h20"></path></g><g><path d="M272 41h0"></path><path d="M528 41h0"></path><path d="M272 41a10 10 0 0 0 10 -10v0a10 10 0 0 1 10 -10"></path><g><path d="M292 21h216"></path></g><path d="M508 21a10 10 0 0 1 10 10v0a10 10 0 0 0 10 10"></path><path d="M272 41h20"></path><g><path d="M292 41h0"></path><path d="M508 41h0"></path><path d="M292 41h10"></path><g><path d="M302 41h0"></path><path d="M330 41h0"></path><rect x="302" y="30" width="28" height="22" rx="10" ry="10"></rect><text x="316" y="45">;</text></g><path d="M330 41h10"></path><path d="M340 41h10"></path><g><path d="M350 41h0"></path><path d="M498 41h0"></path><rect x="350" y="30" width="148" height="22"></rect><text x="424" y="45">Declaration list</text></g><path d="M498 41h10"></path></g><path d="M508 41h20"></path></g></g><path d="M528 41h20"></path><path d="M104 41a10 10 0 0 1 10 10v10a10 10 0 0 0 10 10"></path><g><path d="M124 71h70"></path><path d="M458 71h70"></path><path d="M194 71h10"></path><g><path d="M204 71h0"></path><path d="M280 71h0"></path><rect x="204" y="60" width="76" height="22"></rect><text x="242" y="75">At-rule</text></g><path d="M280 71h10"></path><path d="M290 71h10"></path><g><path d="M300 71h0"></path><path d="M448 71h0"></path><rect x="300" y="60" width="148" height="22"></rect><text x="374" y="75">Declaration list</text></g><path d="M448 71h10"></path></g><path d="M528 71a10 10 0 0 0 10 -10v-10a10 10 0 0 1 10 -10"></path></g><path d="M 548 41 h 20 m -10 -10 v 20 m 10 -20 v 20"></path></g></svg></dd>

		<dt id="declaration-diagram">Declaration</dt>
		<dd><svg class="railroad-diagram" width="677" height="81"><g transform="translate(.5 .5)"><path d="M 20 31 v 20 m 10 -20 v 20 m -10 -10 h 20.5"></path><path d="M40 41h10"></path><g><path d="M50 41h0"></path><path d="M174 41h0"></path><rect x="50" y="30" width="124" height="22"></rect><text x="112" y="45">&lt;ident-token&gt;</text></g><path d="M174 41h10"></path><path d="M184 41h10"></path><g><path d="M194 41h0"></path><path d="M238 41h0"></path><rect x="194" y="30" width="44" height="22"></rect><text x="216" y="45">ws*</text></g><path d="M238 41h10"></path><path d="M248 41h10"></path><g><path d="M258 41h0"></path><path d="M286 41h0"></path><rect x="258" y="30" width="28" height="22" rx="10" ry="10"></rect><text x="272" y="45">:</text></g><path d="M286 41h10"></path><g><path d="M296 41h0"></path><path d="M496 41h0"></path><path d="M296 41a10 10 0 0 0 10 -10v0a10 10 0 0 1 10 -10"></path><g><path d="M316 21h160"></path></g><path d="M476 21a10 10 0 0 1 10 10v0a10 10 0 0 0 10 10"></path><path d="M296 41h20"></path><g><path d="M316 41h0"></path><path d="M476 41h0"></path><path d="M316 41h10"></path><g><path d="M326 41h0"></path><path d="M466 41h0"></path><rect x="326" y="30" width="140" height="22"></rect><text x="396" y="45">Component value</text></g><path d="M466 41h10"></path><path d="M326 41a10 10 0 0 0 -10 10v0a10 10 0 0 0 10 10"></path><g><path d="M326 61h140"></path></g><path d="M466 61a10 10 0 0 0 10 -10v0a10 10 0 0 0 -10 -10"></path></g><path d="M476 41h20"></path></g><g><path d="M496 41h0"></path><path d="M636 41h0"></path><path d="M496 41a10 10 0 0 0 10 -10v0a10 10 0 0 1 10 -10"></path><g><path d="M516 21h100"></path></g><path d="M616 21a10 10 0 0 1 10 10v0a10 10 0 0 0 10 10"></path><path d="M496 41h20"></path><g><path d="M516 41h0"></path><path d="M616 41h0"></path><rect x="516" y="30" width="100" height="22"></rect><text x="566" y="45">!important</text></g><path d="M616 41h20"></path></g><path d="M 636 41 h 20 m -10 -10 v 20 m 10 -20 v 20"></path></g></svg></dd>

		<dt id="important-diagram">!important</dt>
		<dd><svg class="railroad-diagram" width="497" height="62"><g transform="translate(.5 .5)"><path d="M 20 21 v 20 m 10 -20 v 20 m -10 -10 h 20.5"></path><path d="M40 31h10"></path><g><path d="M50 31h0"></path><path d="M78 31h0"></path><rect x="50" y="20" width="28" height="22" rx="10" ry="10"></rect><text x="64" y="35">!</text></g><path d="M78 31h10"></path><path d="M88 31h10"></path><g><path d="M98 31h0"></path><path d="M142 31h0"></path><rect x="98" y="20" width="44" height="22"></rect><text x="120" y="35">ws*</text></g><path d="M142 31h10"></path><path d="M152 31h10"></path><g><path d="M162 31h0"></path><path d="M382 31h0"></path><rect x="162" y="20" width="220" height="22"></rect><text x="272" y="35">&lt;ident-token "important"&gt;</text></g><path d="M382 31h10"></path><path d="M392 31h10"></path><g><path d="M402 31h0"></path><path d="M446 31h0"></path><rect x="402" y="20" width="44" height="22"></rect><text x="424" y="35">ws*</text></g><path d="M446 31h10"></path><path d="M 456 31 h 20 m -10 -10 v 20 m 10 -20 v 20"></path></g></svg></dd>

		<dt id="component-value-diagram">Component value</dt>
		<dd><svg class="railroad-diagram" width="261" height="182"><g transform="translate(.5 .5)"><path d="M 20 21 v 20 m 10 -20 v 20 m -10 -10 h 20.5"></path><g><path d="M40 31h0"></path><path d="M220 31h0"></path><path d="M40 31h20"></path><g><path d="M60 31h0"></path><path d="M200 31h0"></path><rect x="60" y="20" width="140" height="22"></rect><text x="130" y="35">Preserved token</text></g><path d="M200 31h20"></path><path d="M40 31a10 10 0 0 1 10 10v10a10 10 0 0 0 10 10"></path><g><path d="M60 61h28"></path><path d="M172 61h28"></path><rect x="88" y="50" width="84" height="22"></rect><text x="130" y="65">{} block</text></g><path d="M200 61a10 10 0 0 0 10 -10v-10a10 10 0 0 1 10 -10"></path><path d="M40 31a10 10 0 0 1 10 10v40a10 10 0 0 0 10 10"></path><g><path d="M60 91h28"></path><path d="M172 91h28"></path><rect x="88" y="80" width="84" height="22"></rect><text x="130" y="95">() block</text></g><path d="M200 91a10 10 0 0 0 10 -10v-40a10 10 0 0 1 10 -10"></path><path d="M40 31a10 10 0 0 1 10 10v70a10 10 0 0 0 10 10"></path><g><path d="M60 121h28"></path><path d="M172 121h28"></path><rect x="88" y="110" width="84" height="22"></rect><text x="130" y="125">[] block</text></g><path d="M200 121a10 10 0 0 0 10 -10v-70a10 10 0 0 1 10 -10"></path><path d="M40 31a10 10 0 0 1 10 10v100a10 10 0 0 0 10 10"></path><g><path d="M60 151h4"></path><path d="M196 151h4"></path><rect x="64" y="140" width="132" height="22"></rect><text x="130" y="155">Function block</text></g><path d="M200 151a10 10 0 0 0 10 -10v-100a10 10 0 0 1 10 -10"></path></g><path d="M 220 31 h 20 m -10 -10 v 20 m 10 -20 v 20"></path></g></svg></dd>

		<dt id="{}-block-diagram">{} block</dt>
		<dd><svg class="railroad-diagram" width="377" height="81"><g transform="translate(.5 .5)"><path d="M 20 31 v 20 m 10 -20 v 20 m -10 -10 h 20.5"></path><path d="M40 41h10"></path><g><path d="M50 41h0"></path><path d="M78 41h0"></path><rect x="50" y="30" width="28" height="22" rx="10" ry="10"></rect><text x="64" y="45">{</text></g><path d="M78 41h10"></path><g><path d="M88 41h0"></path><path d="M288 41h0"></path><path d="M88 41a10 10 0 0 0 10 -10v0a10 10 0 0 1 10 -10"></path><g><path d="M108 21h160"></path></g><path d="M268 21a10 10 0 0 1 10 10v0a10 10 0 0 0 10 10"></path><path d="M88 41h20"></path><g><path d="M108 41h0"></path><path d="M268 41h0"></path><path d="M108 41h10"></path><g><path d="M118 41h0"></path><path d="M258 41h0"></path><rect x="118" y="30" width="140" height="22"></rect><text x="188" y="45">Component value</text></g><path d="M258 41h10"></path><path d="M118 41a10 10 0 0 0 -10 10v0a10 10 0 0 0 10 10"></path><g><path d="M118 61h140"></path></g><path d="M258 61a10 10 0 0 0 10 -10v0a10 10 0 0 0 -10 -10"></path></g><path d="M268 41h20"></path></g><path d="M288 41h10"></path><g><path d="M298 41h0"></path><path d="M326 41h0"></path><rect x="298" y="30" width="28" height="22" rx="10" ry="10"></rect><text x="312" y="45">}</text></g><path d="M326 41h10"></path><path d="M 336 41 h 20 m -10 -10 v 20 m 10 -20 v 20"></path></g></svg></dd>

		<dt id="()-block-diagram">() block</dt>
		<dd><svg class="railroad-diagram" width="377" height="81"><g transform="translate(.5 .5)"><path d="M 20 31 v 20 m 10 -20 v 20 m -10 -10 h 20.5"></path><path d="M40 41h10"></path><g><path d="M50 41h0"></path><path d="M78 41h0"></path><rect x="50" y="30" width="28" height="22" rx="10" ry="10"></rect><text x="64" y="45">(</text></g><path d="M78 41h10"></path><g><path d="M88 41h0"></path><path d="M288 41h0"></path><path d="M88 41a10 10 0 0 0 10 -10v0a10 10 0 0 1 10 -10"></path><g><path d="M108 21h160"></path></g><path d="M268 21a10 10 0 0 1 10 10v0a10 10 0 0 0 10 10"></path><path d="M88 41h20"></path><g><path d="M108 41h0"></path><path d="M268 41h0"></path><path d="M108 41h10"></path><g><path d="M118 41h0"></path><path d="M258 41h0"></path><rect x="118" y="30" width="140" height="22"></rect><text x="188" y="45">Component value</text></g><path d="M258 41h10"></path><path d="M118 41a10 10 0 0 0 -10 10v0a10 10 0 0 0 10 10"></path><g><path d="M118 61h140"></path></g><path d="M258 61a10 10 0 0 0 10 -10v0a10 10 0 0 0 -10 -10"></path></g><path d="M268 41h20"></path></g><path d="M288 41h10"></path><g><path d="M298 41h0"></path><path d="M326 41h0"></path><rect x="298" y="30" width="28" height="22" rx="10" ry="10"></rect><text x="312" y="45">)</text></g><path d="M326 41h10"></path><path d="M 336 41 h 20 m -10 -10 v 20 m 10 -20 v 20"></path></g></svg></dd>

		<dt id="[]-block-diagram">[] block</dt>
		<dd><svg class="railroad-diagram" width="377" height="81"><g transform="translate(.5 .5)"><path d="M 20 31 v 20 m 10 -20 v 20 m -10 -10 h 20.5"></path><path d="M40 41h10"></path><g><path d="M50 41h0"></path><path d="M78 41h0"></path><rect x="50" y="30" width="28" height="22" rx="10" ry="10"></rect><text x="64" y="45">[</text></g><path d="M78 41h10"></path><g><path d="M88 41h0"></path><path d="M288 41h0"></path><path d="M88 41a10 10 0 0 0 10 -10v0a10 10 0 0 1 10 -10"></path><g><path d="M108 21h160"></path></g><path d="M268 21a10 10 0 0 1 10 10v0a10 10 0 0 0 10 10"></path><path d="M88 41h20"></path><g><path d="M108 41h0"></path><path d="M268 41h0"></path><path d="M108 41h10"></path><g><path d="M118 41h0"></path><path d="M258 41h0"></path><rect x="118" y="30" width="140" height="22"></rect><text x="188" y="45">Component value</text></g><path d="M258 41h10"></path><path d="M118 41a10 10 0 0 0 -10 10v0a10 10 0 0 0 10 10"></path><g><path d="M118 61h140"></path></g><path d="M258 61a10 10 0 0 0 10 -10v0a10 10 0 0 0 -10 -10"></path></g><path d="M268 41h20"></path></g><path d="M288 41h10"></path><g><path d="M298 41h0"></path><path d="M326 41h0"></path><rect x="298" y="30" width="28" height="22" rx="10" ry="10"></rect><text x="312" y="45">]</text></g><path d="M326 41h10"></path><path d="M 336 41 h 20 m -10 -10 v 20 m 10 -20 v 20"></path></g></svg></dd>

		<dt id="function-block-diagram">Function block</dt>
		<dd><svg class="railroad-diagram" width="497" height="81"><g transform="translate(.5 .5)"><path d="M 20 31 v 20 m 10 -20 v 20 m -10 -10 h 20.5"></path><path d="M40 41h10"></path><g><path d="M50 41h0"></path><path d="M198 41h0"></path><rect x="50" y="30" width="148" height="22"></rect><text x="124" y="45">&lt;function-token&gt;</text></g><path d="M198 41h10"></path><g><path d="M208 41h0"></path><path d="M408 41h0"></path><path d="M208 41a10 10 0 0 0 10 -10v0a10 10 0 0 1 10 -10"></path><g><path d="M228 21h160"></path></g><path d="M388 21a10 10 0 0 1 10 10v0a10 10 0 0 0 10 10"></path><path d="M208 41h20"></path><g><path d="M228 41h0"></path><path d="M388 41h0"></path><path d="M228 41h10"></path><g><path d="M238 41h0"></path><path d="M378 41h0"></path><rect x="238" y="30" width="140" height="22"></rect><text x="308" y="45">Component value</text></g><path d="M378 41h10"></path><path d="M238 41a10 10 0 0 0 -10 10v0a10 10 0 0 0 10 10"></path><g><path d="M238 61h140"></path></g><path d="M378 61a10 10 0 0 0 10 -10v0a10 10 0 0 0 -10 -10"></path></g><path d="M388 41h20"></path></g><path d="M408 41h10"></path><g><path d="M418 41h0"></path><path d="M446 41h0"></path><rect x="418" y="30" width="28" height="22" rx="10" ry="10"></rect><text x="432" y="45">)</text></g><path d="M446 41h10"></path><path d="M 456 41 h 20 m -10 -10 v 20 m 10 -20 v 20"></path></g></svg></dd>

	</dl>

<h3 id="parser-definitions">
Definitions</h3>

	<dl>
		<dt><dfn>current input token</dfn>
		<dd>
			The token or <a>component value</a> currently being operated on, from the list of tokens produced by the tokenizer.

		<dt><dfn>next input token</dfn>
		<dd>
			The token or <a>component value</a> following the <a>current input token</a> in the list of tokens produced by the tokenizer.
			If there isn't a token following the <a>current input token</a>,
			the <a>next input token</a> is an <<EOF-token>>.

		<dt><dfn><<EOF-token>></dfn>
		<dd>
			A conceptual token representing the end of the list of tokens.
			Whenever the list of tokens is empty,
			the <a>next input token</a> is always an <<EOF-token>>.

		<dt><dfn>consume the next input token</dfn>
		<dd>
			Let the <a>current input token</a> be the current <a>next input token</a>,
			adjusting the <a>next input token</a> accordingly.

		<dt><dfn>reconsume the current input token</dfn>
		<dd>
			The next time an algorithm instructs you to <a>consume the next input token</a>,
			instead do nothing
			(retain the <a>current input token</a> unchanged).

		<dt><dfn>ASCII case-insensitive</dfn>
		<dd>
			When two strings are to be matched ASCII case-insensitively,
			temporarily convert both of them to ASCII lower-case form
			by adding 32 (0x20) to the value of each <a>code point</a> between
			U+0041 LATIN CAPITAL LETTER A (A)
			and U+005A LATIN CAPITAL LETTER Z (Z),
			inclusive,
			and check if this results in identical sequences of <a>code point</a>.
	</dl>



<h3 id="parser-entry-points">
Parser Entry Points</h3>

	The algorithms defined in this section produce high-level CSS objects
	from lower-level objects.
	They assume that they are invoked on a token stream,
	but they may also be invoked on a string;
	if so,
	first perform <a href="#input-preprocessing">input preprocessing</a>
	to produce a <a>code point</a> stream,
	then perform <a href="#tokenization">tokenization</a>
	to produce a token stream.

	"<a>Parse a stylesheet</a>" can also be invoked on a byte stream,
	in which case <a href="#input-byte-stream">The input byte stream</a>
	defines how to decode it into Unicode.

	Note: This specification does not define how a byte stream is decoded for other entry points.

	Note: Other specs can define additional entry points for their own purposes.

	<div class='issue'>
		The following notes should probably be translated into normative text in the relevant specs,
		hooking this spec's terms:

		<ul>
			<li>
				"<a>Parse a stylesheet</a>" is intended to be the normal parser entry point,
				for parsing stylesheets.

			<li>
				"<a>Parse a list of rules</a>" is intended for the content of at-rules such as ''@media''.
				It differs from "<a>Parse a stylesheet</a>" in the handling of <<CDO-token>> and <<CDC-token>>.

			<li>
				"<a>Parse a rule</a>" is intended for use by the <code>CSSStyleSheet#insertRule</code> method,
				and similar functions which might exist,
				which parse text into a single rule.

			<li>
				"<a>Parse a declaration</a>" is used in ''@supports'' conditions. [[CSS3-CONDITIONAL]]

			<li>
				"<a>Parse a list of declarations</a>" is for the contents of a <code>style</code> attribute,
				which parses text into the contents of a single style rule.

			<li>
				"<a>Parse a component value</a>" is for things that need to consume a single value,
				like the parsing rules for ''attr()''.

			<li>
				"<a>Parse a list of component values</a>" is for the contents of presentational attributes,
				which parse text into a single declaration's value,
				or for parsing a stand-alone selector [[SELECT]] or list of Media Queries [[MEDIAQ]],
				as in <a href="http://www.w3.org/TR/selectors-api/">Selectors API</a>
				or the <code>media</code> HTML attribute.
		</ul>
	</div>

	All of the algorithms defined in this spec may be called with either a list of tokens or of component values.
	Either way produces an identical result.


<h4 id="parse-a-stylesheet">
Parse a stylesheet</h4>

	To <dfn>parse a stylesheet</dfn> from a stream of tokens:

	<ol>
		<li>
			Create a new stylesheet.

		<li>
			<a>Consume a list of rules</a> from the stream of tokens, with the <var>top-level flag</var> set.

		<li>
			Assign the returned value to the stylesheet's value.

		<li>
			Return the stylesheet.
	</ol>

<h4 id="parse-a-list-of-rules">
Parse a list of rules</h4>

	To <dfn>parse a list of rules</dfn> from a stream of tokens:

	<ol>
		<li>
			<a>Consume a list of rules</a> from the stream of tokens, with the <var>top-level flag</var> unset.

		<li>
			Return the returned list.
	</ol>

<h4 id="parse-a-rule">
Parse a rule</h4>

	To <dfn>parse a rule</dfn> from a stream of tokens:

	<ol>
		<li>
			<a>Consume the next input token</a>.

		<li>
			While the <a>current input token</a> is a <<whitespace-token>>,
			<a>consume the next input token</a>.

		<li>
			If the <a>current input token</a> is an <<EOF-token>>,
			return a syntax error.

			Otherwise,
			if the <a>current input token</a> is an <<at-keyword-token>>,
			<a>consume an at-rule</a>
			and let <var>rule</var> be the return value.

			Otherwise,
			<a>consume a qualified rule</a>
			and let <var>rule</var> be the return value.
			If nothing was returned,
			return a syntax error.

		<li>
			While the <a>current input token</a> is a <<whitespace-token>>,
			<a>consume the next input token</a>.

		<li>
			If the <a>current input token</a> is an <<EOF-token>>,
			return <var>rule</var>.
			Otherwise, return a syntax error.
	</ol>

<h4 id="parse-a-declaration">
Parse a declaration</h4>

	Note: Unlike "<a>Parse a list of declarations</a>",
	this parses only a declaration and not an at-rule.

	To <dfn>parse a declaration</dfn>:

	<ol>
		<li>
			<a>Consume the next input token</a>.

		<li>
			While the <a>current input token</a> is a <<whitespace-token>>,
			<a>consume the next input token</a>.

		<li>
			<a>Consume a declaration</a>.
			If anything was returned, return it.
			Otherwise, return a syntax error.
	</ol>

<h4 id="parse-a-list-of-declarations">
Parse a list of declarations</h4>

	Note: Despite the name,
	this actually parses a mixed list of declarations and at-rules,
	as CSS 2.1 does for <a href=http://www.w3.org/TR/CSS21/page.html#page-box>''@page''</a>.
	Unexpected at-rules (which could be all of them, in a given context)
	are invalid and should be ignored by the consumer.

	To <dfn>parse a list of declarations</dfn>:

	<ol>
		<li>
			<a>Consume a list of declarations</a>.

		<li>
			Return the returned list.
	</ol>

<h4 id="parse-a-component-value">
Parse a component value</h4>

	To <dfn>parse a component value</dfn>:

	<ol>
		<li>
			<a>Consume the next input token</a>.

		<li>
			While the <a>current input token</a> is a <<whitespace-token>>,
			<a>consume the next input token</a>.

		<li>
			If the <a>current input token</a> is an <<EOF-token>>,
			return a syntax error.

		<li>
			<a>Reconsume the current input token</a>.
			<a>Consume a component value</a>
			and let <var>value</var> be the return value.
			If nothing is returned,
			return a syntax error.

		<li>
			While the <a>current input token</a> is a <<whitespace-token>>,
			<a>consume the next input token</a>.

		<li>
			If the <a>current input token</a> is an <<EOF-token>>,
			return <var>value</var>.
			Otherwise,
			return a syntax error.
	</ol>

<h4 id="parse-a-list-of-component-values">
Parse a list of component values</h4>

	To <dfn>parse a list of component values</dfn>:

	<ol>
		<li>
			Repeatedly <a>consume a component value</a> until an <<EOF-token>> is returned,
			appending the returned values (except the final <<EOF-token>>) into a list.
			Return the list.
	</ol>

<h3 id="parser-algorithms">
Parser Algorithms</h3>

	The following algorithms comprise the parser.
	They are called by the parser entry points above.

	These algorithms may be called with a list of either tokens or of component values.
	(The difference being that some tokens are replaced by <a>functions</a> and <a>simple blocks</a> in a list of component values.)
	Similar to how the input stream returned EOF code points to represent when it was empty during the tokenization stage,
	the lists in this stage must return an <<EOF-token>> when the next token is requested but they are empty.

	An algorithm may be invoked with a specific list,
	in which case it consumes only that list
	(and when that list is exhausted,
	it begins returning <<EOF-token>>s).
	Otherwise,
	it is implicitly invoked with the same list as the invoking algorithm.


<h4 id="consume-a-list-of-rules">
Consume a list of rules</h4>

	To <dfn>consume a list of rules</dfn>:

	Create an initially empty list of rules.

	Repeatedly consume the <a>next input token</a>:

	<dl>
		<dt><<whitespace-token>>
		<dd>
			Do nothing.

		<dt><<EOF-token>>
		<dd>
			Return the list of rules.

		<dt><<CDO-token>>
		<dt><<CDC-token>>
		<dd>
			If the <dfn><var>top-level flag</var></dfn> is set,
			do nothing.

			Otherwise,
			<a>reconsume the current input token</a>.
			<a>Consume a qualified rule</a>.
			If anything is returned,
			append it to the list of rules.

		<dt><<at-keyword-token>>
		<dd>
			<a>Reconsume the current input token</a>.
			<a>Consume an at-rule</a>.
			If anything is returned,
			append it to the list of rules.

		<dt>anything else
		<dd>
			<a>Reconsume the current input token</a>.
			<a>Consume a qualified rule</a>.
			If anything is returned,
			append it to the list of rules.
	</dl>


<h4 id="consume-an-at-rule">
Consume an at-rule</h4>

	To <dfn>consume an at-rule</dfn>:

	Create a new at-rule
	with its name set to the value of the <a>current input token</a>,
	its prelude initially set to an empty list,
	and its value initially set to nothing.

	Repeatedly consume the <a>next input token</a>:

	<dl>
		<dt><<semicolon-token>>
		<dt><<EOF-token>>
		<dd>
			Return the at-rule.

		<dt><<{-token>>
		<dd>
			<a>Consume a simple block</a>
			and assign it to the at-rule's block.
			Return the at-rule.

		<dt><a>simple block</a> with an associated token of <<{-token>>
		<dd>
			Assign the block to the at-rule's block.
			Return the at-rule.

		<dt>anything else
		<dd>
			<a>Reconsume the current input token</a>.
			<a>Consume a component value</a>.
			Append the returned value to the at-rule's prelude.
	</dl>


<h4 id="consume-a-qualified-rule">
Consume a qualified rule</h4>

	To <dfn>consume a qualified rule</dfn>:

	Create a new qualified rule
	with its prelude initially set to an empty list,
	and its value initially set to nothing.

	Repeatedly consume the <a>next input token</a>:

	<dl>
		<dt><<EOF-token>>
		<dd>
			This is a <a>parse error</a>.
			Return nothing.

		<dt><<{-token>>
		<dd>
			<a>Consume a simple block</a>
			and assign it to the qualified rule's block.
			Return the qualified rule.

		<dt><a>simple block</a> with an associated token of <<{-token>>
		<dd>
			Assign the block to the qualified rule's block.
			Return the qualified rule.

		<dt>anything else
		<dd>
			<a>Reconsume the current input token</a>.
			<a>Consume a component value</a>.
			Append the returned value to the qualified rule's prelude.
	</dl>


<h4 id="consume-a-list-of-declarations">
Consume a list of declarations</h4>

	To <dfn>consume a list of declarations</dfn>:

	Create an initially empty list of declarations.

	Repeatedly consume the <a>next input token</a>:

	<dl>
		<dt><<whitespace-token>>
		<dt><<semicolon-token>>
		<dd>
			Do nothing.

		<dt><<EOF-token>>
		<dd>
			Return the list of declarations.

		<dt><<at-keyword-token>>
		<dd>
			<a>Consume an at-rule</a>.
			Append the returned rule to the list of declarations.

		<dt><<ident-token>>
		<dd>
			Initialize a temporary list initially filled with the <a>current input token</a>.
			<a>Consume the next input token</a>.
			While the <a>current input token</a> is anything other than a <<semicolon-token>> or <<EOF-token>>,
			append it to the temporary list
			and <a>consume the next input token</a>.
			<a>Consume a declaration</a> from the temporary list.
			If anything was returned,
			append it to the list of declarations.

		<dt>anything else</dd>
		<dd>
			This is a <a>parse error</a>.
			Repeatedly <a>consume a component value</a>
			until it is a <<semicolon-token>> or <<EOF-token>>.
	</dl>


<h4 id="consume-a-declaration">
Consume a declaration</h4>

	To <dfn>consume a declaration</dfn>:

	Create a new declaration
	with its name set to the value of the <a>current input token</a>
	and its value initially set to the empty list.

	<ol>
		<li>
			<a>Consume the next input token</a>.

		<li>
			While the <a>current input token</a> is a <<whitespace-token>>,
			<a>consume the next input token</a>.

		<li>
			If the <a>current input token</a> is anything other than a <<colon-token>>,
			this is a <a>parse error</a>.
			Return nothing.

			Otherwise, <a>consume the next input token</a>.

		<li>
			While the <a>current input token</a> is anything other than an <<EOF-token>>,
			append it to the declaration's value
			and <a>consume the next input token</a>.

		<li>
			If the last two non-<<whitespace-token>>s in the declaration's value are
			a <<delim-token>> with the value "!"
			followed by an <<ident-token>> with a value that is an <a>ASCII case-insensitive</a> match for "important",
			remove them from the declaration's value
			and set the declaration's <var>important</var> flag to true.

		<li>
			Return the declaration.
	</ol>


<h4 id="consume-a-component-value">
Consume a component value</h4>

	To <dfn>consume a component value</dfn>:

	<a>Consume the next input token</a>.

	If the <a>current input token</a>
	is a <<{-token>>, <<[-token>>, or <<(-token>>,
	<a>consume a simple block</a>
	and return it.

	Otherwise, if the <a>current input token</a>
	is a <<function-token>>,
	<a>consume a function</a>
	and return it.

	Otherwise, return the <a>current input token</a>.


<h4 id="consume-a-simple-block">
Consume a simple block</h4>

	To <dfn>consume a simple block</dfn>:

	The <dfn>ending token</dfn> is the mirror variant of the <a>current input token</a>.
	(E.g. if it was called with <<[-token>>, the <a>ending token</a> is <<]-token>>.)

	Create a <a>simple block</a> with its associated token set to the <a>current input token</a>
	and with a value with is initially an empty list.

	Repeatedly consume the <a>next input token</a> and process it as follows:

	<dl>
		<dt><<EOF-token>>
		<dt><a>ending token</a>
		<dd>
			Return the block.

		<dt>anything else
		<dd>
			<a>Reconsume the current input token</a>.
			<a>Consume a component value</a>
			and append it to the value of the block.
	</dl>


<h4 id="consume-a-function">
Consume a function</h4>

	To <dfn>consume a function</dfn>:

	Create a function with a name equal to the value of the <a>current input token</a>,
	and with a value which is initially an empty list.

	Repeatedly consume the <a>next input token</a> and process it as follows:

	<dl>
		<dt><<EOF-token>>
		<dt><<)-token>>
		<dd>
			Return the function.

		<dt>anything else
		<dd>
			<a>Reconsume the current input token</a>.
			<a>Consume a component value</a>
			and append the returned value
			to the function's value.
	</dl>



<h2 id="anb">
The <var>An+B</var> microsyntax</h2>

	Several things in CSS,
	such as the '':nth-child()'' pseudoclass,
	need to indicate indexes in a list.
	The <var>An+B</var> microsyntax is useful for this,
	allowing an author to easily indicate single elements
	or all elements at regularly-spaced intervals in a list.

	The <dfn>An+B</dfn> notation defines an integer step (<dfn>A</dfn>) and offset (<dfn>B</dfn>),
	and represents the <var>An+B</var>th elements in a list,
	for every positive integer or zero value of <var>n</var>,
	with the first element in the list having index 1 (not 0).

	For values of <var>A</var> and <var>B</var> greater than 0,
	this effectively divides the list into groups of <var>A</var> elements
	(the last group taking the remainder),
	and selecting the <var>B</var>th element of each group.

	The <var>An+B</var> notation also accepts the ''even'' and ''odd'' keywords,
	which have the same meaning as ''2n'' and ''2n+1'', respectively.

	<div class="example">
		<p>Examples:
		<pre><!--
		-->2n+0   /* represents all of the even elements in the list */&#xa;<!--
		-->even   /* same */&#xa;<!--
		-->4n+1   /* represents the 1st, 5th, 9th, 13th, etc. elements in the list */</pre>
	</div>

	The values of <var>A</var> and <var>B</var> can be negative,
	but only the positive results of <var>An+B</var>,
	for <var>n</var> ≥ 0,
	are used.

	<div class="example">
		<p>Example:
		<pre>-n+6   /* represents the first 6 elements of the list */</pre>
	</div>

	If both <var>A</var> and <var>B</var> are 0,
	the pseudo-class represents no element in the list.

<h3 id='anb-syntax'>
Informal Syntax Description</h3>

	<em>This section is non-normative.</em>

	When <var>A</var> is 0, the <var>An</var> part may be omitted
	(unless the <var>B</var> part is already omitted).
	When <var>An</var> is not included
	and <var>B</var> is non-negative,
	the ''+'' sign before <var>B</var> (when allowed)
	may also be omitted.
	In this case the syntax simplifies to just <var>B</var>.

	<div class="example">
		<p>Examples:
		<pre><!--
		-->0n+5   /* represents the 5th element in the list */&#xa;<!--
		-->5      /* same */</pre>
	</div>

	When <var>A</var> is 1 or -1,
	the <code>1</code> may be omitted from the rule.

	<div class="example">
		<p>Examples:
		<p>The following notations are therefore equivalent:
		<pre><!--
		-->1n+0   /* represents all elements in the list */&#xa;<!--
		-->n+0    /* same */&#xa;<!--
		-->n      /* same */</pre>
	</div>

	If <var>B</var> is 0, then every <var>A</var>th element is picked.
	In such a case,
	the <var>+B</var> (or <var>-B</var>) part may be omitted
	unless the <var>A</var> part is already omitted.

	<div class="example">
		<p>Examples:
		<pre><!--
		-->2n+0   /* represents every even element in the list */&#xa;<!--
		-->2n     /* same */</pre>
	</div>

	Whitespace is permitted on either side of the ''+'' or ''-''
	that separates the <var>An</var> and <var>B</var> parts when both are present.

	<div class="example">
		<p>Valid Examples with white space:
		<pre><!--
		-->3n + 1&#xa;<!--
		-->+3n - 2&#xa;<!--
		-->-n+ 6&#xa;<!--
		-->+6</pre>
		<p>Invalid Examples with white space:
		<pre><!--
		-->3 n&#xa;<!--
		-->+ 2n&#xa;<!--
		-->+ 2</pre>
	</div>


<h3 id="the-anb-type">
The <code>&lt;an+b></code> type</h3>

	The <var>An+B</var> notation was originally defined using a slightly different tokenizer than the rest of CSS,
	resulting in a somewhat odd definition when expressed in terms of CSS tokens.
	This section describes how to recognize the <var>An+B</var> notation in terms of CSS tokens
	(thus defining the <var>&lt;an+b></var> type for CSS grammar purposes),
	and how to interpret the CSS tokens to obtain values for <var>A</var> and <var>B</var>.

	The <var>&lt;an+b></var> type is defined
	(using the <a href="http://www.w3.org/TR/css3-values/#value-defs">Value Definition Syntax in the Values &amp; Units spec</a>)
	as:

	<pre class='prod'>
		<dfn id="anb-production">&lt;an+b></dfn> =
		  odd | even |
		  <var>&lt;integer></var> |

		  <var>&lt;n-dimension></var> |
		  '+'?<sup><a href="#anb-plus">†</a></sup> n |
		  -n |

		  <var>&lt;ndashdigit-dimension></var> |
		  '+'?<sup><a href="#anb-plus">†</a></sup> <var>&lt;ndashdigit-ident></var> |
		  <var>&lt;dashndashdigit-ident></var> |

		  <var>&lt;n-dimension></var> <var>&lt;signed-integer></var> |
		  '+'?<sup><a href="#anb-plus">†</a></sup> n <var>&lt;signed-integer></var> |
		  -n <var>&lt;signed-integer></var> |

		  <var>&lt;ndash-dimension></var> <var>&lt;signless-integer></var> |
		  '+'?<sup><a href="#anb-plus">†</a></sup> n- <var>&lt;signless-integer></var> |
		  -n- <var>&lt;signless-integer></var> |

		  <var>&lt;n-dimension></var> ['+' | '-'] <var>&lt;signless-integer></var>
		  '+'?<sup><a href="#anb-plus">†</a></sup> n ['+' | '-'] <var>&lt;signless-integer></var> |
		  -n ['+' | '-'] <var>&lt;signless-integer></var>
	</pre>

	where:

	<ul>
		<li><dfn><code>&lt;n-dimension></code></dfn> is a <<dimension-token>> with its type flag set to "integer", and a unit that is an <a>ASCII case-insensitive</a> match for "n"
		<li><dfn><code>&lt;ndash-dimension></code></dfn> is a <<dimension-token>> with its type flag set to "integer", and a unit that is an <a>ASCII case-insensitive</a> match for "n-"
		<li><dfn><code>&lt;ndashdigit-dimension></code></dfn> is a <<dimension-token>> with its type flag set to "integer", and a unit that is an <a>ASCII case-insensitive</a> match for "n-*", where "*" is a series of one or more <a>digits</a>
		<li><dfn><code>&lt;ndashdigit-ident></code></dfn> is an <<ident-token>> whose value is an <a>ASCII case-insensitive</a> match for "n-*", where "*" is a series of one or more <a>digits</a>
		<li><dfn><code>&lt;dashndashdigit-ident></code></dfn> is an <<ident-token>> whose value is an <a>ASCII case-insensitive</a> match for "-n-*", where "*" is a series of one or more <a>digits</a>
		<li><dfn><code>&lt;integer></code></dfn> is a <<number-token>> with its type flag set to "integer"
		<li><dfn><code>&lt;signed-integer></code></dfn> is a <<number-token>> with its type flag set to "integer", and whose representation starts with "+" or "-"
		<li><dfn><code>&lt;signless-integer></code></dfn> is a <<number-token>> with its type flag set to "integer", and whose representation start with a <a>digit</a>
	</ul>

	<p id="anb-plus">
		<sup>†</sup>: When a plus sign (+) precedes an ident starting with "n", as in the cases marked above,
		there must be no whitespace between the two tokens,
		or else the tokens do not match the above grammar.

	The clauses of the production are interpreted as follows:

	<dl>
		<dt>''odd''
		<dd>
			<var>A</var> is 2, <var>B</var> is 1.

		<dt>''even''
		<dd>
			<var>A</var> is 2, <var>B</var> is 0.

		<dt><code><var>&lt;integer></var></code>
		<dd>
			<var>A</var> is 0, <var>B</var> is the integer’s value.

		<dt><code><var>&lt;n-dimension></var></code>
		<dt><code>'+'? n</code>
		<dt><code>-n</code>
		<dd>
			<var>A</var> is the dimension's value, 1, or -1, respectively.
			<var>B</var> is 0.

		<dt><code><var>&lt;ndashdigit-dimension></var></code>
		<dt><code>'+'? <var>&lt;ndashdigit-ident></var></code>
		<dd>
			<var>A</var> is the dimension's value or 1, respectively.
			<var>B</var> is the dimension's unit or ident's value, respectively,
			with the first <a>code point</a> removed and the remainder interpreted as a base-10 number.
			<span class=note>B is negative.</span>

		<dt><code><var>&lt;dashndashdigit-ident></var></code>
		<dd>
			<var>A</var> is -1.
			<var>B</var> is the ident's value, with the first two <a>code points</a> removed and the remainder interpreted as a base-10 number.
			<span class=note>B is negative.</span>

		<dt><code><var>&lt;n-dimension></var> <var>&lt;signed-integer></var></code>
		<dt><code>'+'? n <var>&lt;signed-integer></var></code>
		<dt><code>-n <var>&lt;signed-integer></var></code>
		<dd>
			<var>A</var> is the dimension's value, 1, or -1, respectively.
			<var>B</var> is the integer’s value.

		<dt><code><var>&lt;ndash-dimension></var> <var>&lt;signless-integer></var></code>
		<dt><code>'+'? n- <var>&lt;signless-integer></var></code>
		<dt><code>-n- <var>&lt;signless-integer></var></code>
		<dd>
			<var>A</var> is the dimension's value, 1, or -1, respectively.
			<var>B</var> is the negation of the integer’s value.

		<dt><code><var>&lt;n-dimension></var> ['+' | '-'] <var>&lt;signless-integer></var></code>
		<dt><code>'+'? n ['+' | '-'] <var>&lt;signless-integer></var></code>
		<dt><code>-n ['+' | '-'] <var>&lt;signless-integer></var></code>
		<dd>
			<var>A</var> is the dimension's value, 1, or -1, respectively.
			<var>B</var> is the integer’s value.
			If a '-' was provided between the two, <var>B</var> is instead the negation of the integer’s value.
	</dl>



<h2 id='rule-defs'>
Defining Grammars for Rules and Other Values</h2>

	The <a href="http://www.w3.org/TR/css3-values/">Values</a> spec defines how to specify a grammar for properties.
	This section does the same, but for rules.

	Just like in property grammars,
	the notation <code>&lt;foo></code> refers to the "foo" grammar term,
	assumed to be defined elsewhere.
	Substituting the <code>&lt;foo></code> for its definition results in a semantically identical grammar.

	Several types of tokens are written literally, without quotes:

	<ul>
		<li><<ident-token>>s (such as ''auto'', ''disc'', etc), which are simply written as their value.
		<li><<at-keyword-token>>s, which are written as an @ character followed by the token's value, like "@media".
		<li><<function-token>>s, which are written as the function name followed by a ( character, like "translate(".
		<li>The <<colon-token>> (written as <code>:</code>), <<comma-token>> (written as <code>,</code>), <<semicolon-token>> (written as <code>;</code>), <<(-token>>, <<)-token>>, <<{-token>>, and <<}-token>>s.
	</ul>

	Tokens match if their value is an <a>ASCII case-insensitive</a> match
	for the value defined in the grammar.

	<p class=note>
		Although it is possible, with <a>escaping</a>,
		to construct an <<ident-token>> whose value starts with <code>@</code> or ends with <code>(</code>,
		such a tokens is not an <<at-keyword-token>> or a <<function-token>>
		and does not match corresponding grammar definitions.

	<<delim-token>>s are written with their value enclosed in single quotes.
	For example, a <<delim-token>> containing the "+" <a>code point</a> is written as <code>'+'</code>.
	Similarly, the <<[-token>> and <<]-token>>s must be written in single quotes,
	as they're used by the syntax of the grammar itself to group clauses.
	<<whitespace-token>> is never indicated in the grammar;
	<<whitespace-token>>s are allowed before, after, and between any two tokens,
	unless explicitly specified otherwise in prose definitions.
	(For example, if the prelude of a rule is a selector,
	whitespace is significant.)

	When defining a function or a block,
	the ending token must be specified in the grammar,
	but if it's not present in the eventual token stream,
	it still matches.

	<div class='example'>
		For example, the syntax of the ''translateX()'' function is:

		<pre>translateX( <<translation-value>> )</pre>

		However, the stylesheet may end with the function unclosed, like:

		<pre>.foo { transform: translate(50px</pre>

		The CSS parser parses this as a style rule containing one declaration,
		whose value is a function named "translate".
		This matches the above grammar,
		even though the ending token didn't appear in the token stream,
		because by the time the parser is finished,
		the presence of the ending token is no longer possible to determine;
		all you have is the fact that there's a block and a function.
	</div>

<h3 id='declaration-rule-list'>
Defining Block Contents: the <<declaration-list>>, <<rule-list>>, and <<stylesheet>> productions</h3>

	The CSS parser is agnostic as to the contents of blocks,
	such as those that come at the end of some at-rules.
	Defining the generic grammar of the blocks in terms of tokens is non-trivial,
	but there are dedicated and unambiguous algorithms defined for parsing this.

	The <dfn>&lt;declaration-list></dfn> production represents a list of declarations.
	It may only be used in grammars as the sole value in a block,
	and represents that the contents of the block must be parsed using the <a>consume a list of declarations</a> algorithm.

	Similarly, the <dfn>&lt;rule-list></dfn> production represents a list of rules,
	and may only be used in grammars as the sole value in a block.
	It represents that the contents of the block must be parsed using the <a>consume a list of rules</a> algorithm.

	Finally, the <dfn>&lt;stylesheet></dfn> production represents a list of rules.
	It is identical to <<rule-list>>,
	except that blocks using it default to accepting all rules
	that aren't otherwise limited to a particular context.

	<div class='example'>
		For example, the ''@font-face'' rule is defined to have an empty prelude,
		and to contain a list of declarations.
		This is expressed with the following grammar:

		<pre>@font-face { <<declaration-list>> }</pre>

		This is a complete and sufficient definition of the rule's grammar.

		For another example,
		''@keyframes'' rules are more complex,
		interpreting their prelude as a name and containing keyframes rules in their block
		Their grammar is:

		<pre>@keyframes <<keyframes-name>> { <<rule-list>> }</pre>
	</div>

	For rules that use <<declaration-list>>,
	the spec for the rule must define which properties, descriptors, and/or at-rules are valid inside the rule;
	this may be as simple as saying "The @foo rule accepts the properties/descriptors defined in this specification/section.",
	and extension specs may simply say "The @foo rule additionally accepts the following properties/descriptors.".
	Any declarations or at-rules found inside the block that are not defined as valid
	must be removed from the rule's value.

	Within a <<declaration-list>>,
	<code>!important</code> is automatically invalid on any descriptors.
	If the rule accepts properties,
	the spec for the rule must define whether the properties interact with the cascade,
	and with what specificity.
	If they don't interact with the cascade,
	properties containing <code>!important</code> are automatically invalid;
	otherwise using <code>!important</code> is valid and has its usual effect on the cascade origin of the property.

	<div class='example'>
		For example, the grammar for ''@font-face'' in the previous example must,
		in addition to what is written there,
		define that the allowed declarations are the descriptors defined in the Fonts spec.
	</div>

	For rules that use <<rule-list>>,
	the spec for the rule must define what types of rules are valid inside the rule,
	same as <<declaration-list>>,
	and unrecognized rules must similarly be removed from the rule's value.

	<div class='example'>
		For example, the grammar for ''@keyframes'' in the previous example must,
		in addition to what is written there,
		define that the only allowed rules are <<keyframe-rule>>s,
		which are defined as:

		<pre><<keyframe-rule>> = <<keyframe-selector>> { <<declaration-list>> }</pre>

		Keyframe rules, then,
		must further define that they accept as declarations all animatable CSS properties,
		plus the 'animation-timing-function' property,
		but that they do not interact with the cascade.
	</div>

	For rules that use <<stylesheet>>,
	all rules are allowed by default,
	but the spec for the rule may define what types of rules are <em>invalid</em> inside the rule.

	<div class='example'>
		For example, the ''@media'' rule accepts anything that can be placed in a stylesheet,
		except more ''@media'' rules.
		As such, its grammar is:

		<pre>@media <<media-query-list>> { <<stylesheet>> }</pre>

		It additionally defines a restriction that the <<stylesheet>> can not contain ''@media'' rules,
		which causes them to be dropped from the outer rule's value if they appear.
	</div>


<h2 id="css-stylesheets">
CSS stylesheets</h2>

	To <dfn>parse a CSS stylesheet</dfn>,
	first <i>parse a stylesheet</i>.
	Interpret all of the resulting top-level <i>qualified rules</i> as <i>style rules</i>, defined below.

	If any style rule is invalid,
	or any at-rule is not recognized or is invalid according to its grammar or context,
	it's a <i>parse error</i>.
	Discard that rule.

<h3 id="style-rules">
Style rules</h3>

	A <dfn>style rule</dfn> is a <i>qualified rule</i>
	that associates a <a href="http://dev.w3.org/csswg/selectors4/#selector-list">selector list</a> [[!SELECT]]
	with a list of property declarations.
	They are also called
	<a href="http://www.w3.org/TR/CSS21/syndata.html#rule-sets">rule sets</a> in [[!CSS21]].
	CSS Cascading and Inheritance [[!CSS3CASCADE]] defines how the declarations inside of style rules participate in the cascade.

	The prelude of the qualified rule is parsed as a
	<a href="http://dev.w3.org/csswg/selectors4/#selector-list">selector list</a>.
	If this results in an <a href="http://dev.w3.org/csswg/selectors4/#invalid">invalid selector list</a>,
	the entire style rule is invalid.

	The content of the qualified rule’s block is parsed as a
	<i title="parse a list of declarations">list of declarations</i>.
	Unless defined otherwise by another specification or a future level of this specification,
	at-rules in that list are invalid
	and must be ignored.
	Declaration for an unknown CSS property
	or whose value does not match the syntax defined by the property are invalid
	and must be ignored.
	The validity of the style rule’s contents have no effect on the validity of the style rule itself.
	Unless otherwise specified, property names are <i>ASCII case-insensitive</i>.

	Note: The names of Custom Properties [[CSS-VARIABLES]] are case-sensitive.

	<i>Qualified rules</i> at the top-level of a CSS stylesheet are style rules.
	Qualified rules in other contexts may or may not be style rules,
	as defined by the context.

	<p class='example'>
		For example, qualified rules inside ''@media'' rules [[CSS3-CONDITIONAL]] are style rules,
		but qualified rules inside ''@keyframes'' rules are not [[CSS3-ANIMATIONS]].

<h3 id='charset-rule'>
The ''@charset'' Rule</h3>

	The <dfn>@charset</dfn> rule is a very special <i>at-rule</i> associated with determining the character encoding of the stylesheet.
	In general, its grammar is:

	<pre class='prod'><dfn>&lt;at-charset-rule></dfn> = @charset <<string>>;</pre>

	Additionally, an ''@charset'' rule is invalid if it is not at the top-level of a stylesheet,
	or if it is not the very first rule of a stylesheet.

	''@charset'' rules have an <dfn>encoding</dfn>,
	given by the value of the <<string>>.

	The ''@charset'' rule has <strong>no effect on a stylesheet</strong>.

	Note: However, the algorithm to <a>determine the fallback encoding</a>
	looks at the first several bytes of the stylesheet
	to see if they're a match for the ASCII characters <code>@charset "XXX";</code>,
	where XXX is a sequence of bytes other than 22 (ASCII for <code>"</code>).
	While this resembles an ''@charset'' rule,
	it's not actually the same thing.
	For example, the necessary sequence of bytes will spell out something entirely different
	if the stylesheet is in an encoding that's not ASCII-compatible,
	such as UTF-16.



<h2 id="serialization">
Serialization</h2>

	This specification does not define how to serialize CSS in general,
	leaving that task to the CSSOM and individual feature specifications.
	However, there is one important facet that must be specified here regarding comments,
	to ensure accurate "round-tripping" of data from text to CSS objects and back.

	The tokenizer described in this specification does not produce tokens for comments,
	or otherwise preserve them in any way.
	Implementations may preserve the contents of comments and their location in the token stream.
	If they do, this preserved information must have no effect on the parsing step,
	but must be serialized in its position as
	"/*"
	followed by its contents
	followed by "*/".

	Unless the implementation has a preserved comment at that position,
	it must insert the text "/**/" between the serialization of adjacent tokens
	when the two tokens are of the following pairs:

	<ul>
		<li>
			a <<hash-token>> or <<at-keyword-token>> followed by a <<number-token>>, <<percentage-token>>, <<ident-token>>, <<dimension-token>>, <<unicode-range-token>>, <<url-token>>, or a <<function-token>>;

		<li>
			<<number-token>>s, <<ident-token>>s, and <<dimension-token>>s in any combination;

		<li>
			a <<number-token>>, <<ident-token>>, or <<dimension-token>> followed by a <<percentage-token>>, <<unicode-range-token>>, <<url-token>>, or <<function-token>>;

		<li>
			an <<ident-token>> followed by a <<(-token>>;

		<li>
			a <<delim-token>> containing "#" or "@" followed by any token except <<whitespace-token>>;

		<li>
			a <<delim-token>> containing "-", "+", ".", "&lt;", ">", or "!" following or followed by any token except <<whitespace-token>>;

		<li>
			a <<delim-token>> containing "/" following or followed by a <<delim-token>> containing "*".
	</ul>

	Note: The preceding pairs of tokens can only be adjacent due to comments in the original text,
	so the above rule reinserts the minimum number of comments into the serialized text to ensure an accurate round-trip.
	(Roughly.  The <<delim-token>> rules are slightly too powerful, for simplicity.)

	Note: No comment is inserted between consecutive <<whitespace-token>>.
	As a consequence such token sequences will not "round-trip" exactly.
	This shouldn’t be an issue as CSS grammars always interpret
	any amount of whitespace as identical to a single space.

<h3 id='serializing-anb'>
Serializing <var>&lt;an+b></var></h3>

	To serialize an <var>&lt;an+b></var> value,
	let <var>s</var> initially be the empty string:

	<dl>
		<dt><var>A</var> and <var>B</var> are both zero
		<dd>
			Append "0" to <var>s</var>.

		<dt><var>A</var> is zero, <var>B</var> is non-zero
		<dd>
			Serialize <var>B</var> and append it to <var>s</var>.

		<dt><var>A</var> is non-zero, <var>B</var> is zero
		<dd>
			Serialize <var>A</var> and append it to <var>s</var>.
			Append "n" to <var>s</var>.

		<dt><var>A</var> and <var>B</var> are both non-zero
		<dd>
			Serialize <var>A</var> and append it to <var>s</var>.
			Append "n" to <var>s</var>.
			If <var>B</var> is positive,
			append "+" to <var>s</var>
			Serialize <var>B</var> and append it to <var>s</var>.
	</dl>

		Return <var>s</var>.

<h2 id="changes">
Changes from CSS 2.1 and Selectors Level 3</h2>

	<em>This section is non-normative.</em>

	Note: The point of this spec is to match reality;
	changes from CSS2.1 are nearly always because CSS 2.1 specified something that doesn't match actual browser behavior,
	or left something unspecified.
	If some detail doesn't match browsers,
	please let me know
	as it's almost certainly unintentional.

	Changes in decoding from a byte stream:

	<ul>
		<li>
			Only detect ''@charset'' rules in ASCII-compatible byte patterns.

		<li>
			Ignore ''@charset'' rules that specify an ASCII-incompatible encoding,
			as that would cause the rule itself to not decode properly.

		<li>
			Refer to the the <a href="http://encoding.spec.whatwg.org/">Encoding Standard</a>
			rather than the IANA registery for character encodings.

	</ul>

	Tokenization changes:

	<ul>
		<li>
			Any U+0000 NULL <a>code point</a> in the CSS source is replaced with U+FFFD REPLACEMENT CHARACTER.

		<li>
			Any hexadecimal escape sequence such as ''\0'' that evaluates to zero
			produce U+FFFD REPLACEMENT CHARACTER rather than U+0000 NULL.
			<!--
				This covers a security issue:
				https://bugzilla.mozilla.org/show_bug.cgi?id=228856
			-->

		<li>
			The definition of <a>non-ASCII code point</a> was changed
			to be consistent with every definition of ASCII.
			This affects <a>code points</a> U+0080 to U+009F,
			which are now <a>name code points</a> rather than <<delim-token>>s,
			like the rest of <a>non-ASCII code points</a>.

		<li>
			Tokenization does not emit COMMENT or BAD_COMMENT tokens anymore.
			BAD_COMMENT is now considered the same as a normal token (not an error).
			<a href="#serialization">Serialization</a> is responsible
			for inserting comments as necessary between tokens that need to be separated,
			e.g. two consecutive <<ident-token>>s.

		<li>
			The <<unicode-range-token>> is now more restrictive,
			and doesn't include non-sensical patterns that the 2.1 definition allowed.

		<li>
			Apply the <a href="http://www.w3.org/TR/CSS21/syndata.html#unexpected-eof">EOF error handling rule</a> in the tokenizer
			and emit normal <<string-token>> and <<url-token>> rather than BAD_STRING or BAD_URI
			on EOF.

		<li>
			<<prefix-match-token>>, <<suffix-match-token>>, and <<substring-match-token>> have been imported from Selectors 3.

		<li>
			The BAD_URI token (now <<bad-url-token>>) is "self-contained".
			In other words, once the tokenizer realizes it's in a <<bad-url-token>> rather than a <<url-token>>,
			it just seeks forward to look for the closing ),
			ignoring everything else.
			This behavior is simpler than treating it like a <<function-token>>
			and paying attention to opened blocks and such.
			Only WebKit exhibits this behavior,
			but it doesn't appear that we've gotten any compat bugs from it.

		<li>
			The <<comma-token>> has been added.

		<li>
			<<number-token>>, <<number-token>>, and <<dimension-token>> have been changed
			to include the preceding +/- sign as part of their value
			(rather than as a separate <<delim-token>> that needs to be manually handled every time the token is mentioned in other specs).
			The only consequence of this is that comments can no longer be inserted between the sign and the number.

		<li>
			Scientific notation is supported for numbers/percentages/dimensions to match SVG,
			per WG resolution.

		<li>
			<<column-token>> has been added,
			to keep Selectors parsing in single-token lookahead.

		<li>
			Hexadecimal escape for <a>surrogate code points</a> now emit a replacement character rather than the surrogate.
			This allows implementations to safely use UTF-16 internally.

	</ul>

	Parsing changes:

	<ul>
		<li>
			Any list of declaration now also accepts at-rules, like ''@page'',
			per WG resolution.
			This makes a difference in error handling
			even if no such at-rules are defined yet:
			an at-rule, valid or not, ends and lets the next declaration being
			at a {} block without a <<semicolon-token>>.

		<li>
			The handling of some miscellanous "special" tokens
			(like an unmatched <<}-token>>)
			showing up in various places in the grammar
			has been specified with some reasonable behavior shown by at least one browser.
			Previously, stylesheets with those tokens in those places just didn't match the stylesheet grammar at all,
			so their handling was totally undefined.
			Specifically:

			<ul>
				<li>
					[] blocks, () blocks and functions can now contain {} blocks, <<at-keyword-token>>s or <<semicolon-token>>s

				<li>
					Qualified rule preludes can now contain semicolons

				<li>
					Qualified rule and at-rule preludes can now contain <<at-keyword-token>>s
			</ul>

	</ul>

	<var>An+B</var> changes from Selectors Level 3 [[SELECT]]:

	<ul>
		<li>
			The <var>An+B</var> microsyntax has now been formally defined in terms of CSS tokens,
			rather than with a separate tokenizer.
			This has resulted in minor differences:

			<ul>
				<li>
					In some cases, minus signs or digits can be escaped
					(when they appear as part of the unit of a <<dimension-token>> or <<ident-token>>).
			</ul>
	</ul>

<h2 class=no-num id="acknowledgments">
Acknowledgments</h2>

	<p>
		Thanks for feedback and contributions from
		David Baron,
		呂康豪 (Kang-Hao Lu),
		Marc O'Morain,
		and Zack Weinberg.
