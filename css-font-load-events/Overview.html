<!DOCTYPE html><html lang=en><head>
  <meta content="text/html; charset=utf-8" http-equiv=Content-Type>
  <title>CSS Font Load Events Module Level 3</title>
  <link href=../default.css rel=stylesheet type=text/css>
  <link href=../csslogo.ico rel="shortcut icon" type=image/x-icon>
  <link href=https://www.w3.org/StyleSheets/TR/W3C-ED rel=stylesheet type=text/css>
</head>
<body class=h-entry>
<style scoped>
#bolderlighter {
	width: 40%;
}

#bolderlighter th {
	text-align: center;
}

#fontformats td, #eventhandlers td, #fontformats th, #eventhandlers th {
	padding-right: 2em;
	text-align: left;
}

#authors dd {
	margin-bottom: 0;
}

#fontstylematchingalg {
	list-style-type: lower-alpha;
}

#fontmatchingalg ul, #fontmatchingalg ol {
	margin-top: 0.8em;
}

#fontmatchingalg li + li {
	margin-top: 0.8em;
}

div.figure {
	page-break-inside: avoid;
}

div.featex {
	width: 700px;
}

div.featex img {
	margin: auto;
	display: block;
}

ol ol {
	list-style-type: lower-alpha;
}

.idl-code {
	font-weight: bold;
	color: #c50;
	font-family: Menlo, Consolas, "DejaVu Sans Mono", monospace;
	font-size: .9em;
}

.idl-code .idl-code,
pre .idl-code {
	font-size: 1em;
}

pre.idl {
	white-space: pre-wrap;
}
</style>


<div class=head>
  <p data-fill-with=logo><a class=logo href=http://www.w3.org/>
    <img alt=W3C height=48 src=http://www.w3.org/Icons/w3c_home width=72>
</a></p>
  <h1 class="p-name no-ref" id=title>CSS Font Load Events Module Level 3</h1>
  <h2 class="no-num no-toc no-ref heading settled heading" id=subtitle><span class=content>Editor’s Draft,
    <span class=dt-updated><span class=value-title title=20130904>4 September 2013</span></span></span></h2>
  <div data-fill-with=spec-metadata><dl><dt>This version:<dd><a class=u-url href=http://dev.w3.org/csswg/css-font-load-events/>http://dev.w3.org/csswg/css-font-load-events/</a><dt>Latest version:<dd><a href=http://www.w3.org/TR/css-font-load-events-3/>http://www.w3.org/TR/css-font-load-events-3/</a><dt>Editor’s Draft:<dd><a href=http://dev.w3.org/csswg/css-font-load-events/>http://dev.w3.org/csswg/css-font-load-events/</a>
<dt>Feedback:</dt>
    <dd><a href="mailto:www-style@w3.org?subject=%5Bcss-font-load-events%5D%20feedback">www-style@w3.org</a>
        with subject line
        “<kbd>[css-font-load-events] <var>… message topic …</var></kbd>”
        (<a href=http://lists.w3.org/Archives/Public/www-style/ rel=discussion>archives</a>)<dt>Test Suite:<dd>None Yet<dt>Editors:
<dd class="p-author h-card vcard"><a class="p-name fn u-url url" href=http://xanthir.com/contact/>Tab Atkins Jr.</a> (<span class="p-org org">Google</span>)<dd class="p-author h-card vcard"><a class="p-name fn u-email email" href=mailto:jdaggett@mozilla.com>John Daggett</a> (<span class="p-org org">Mozilla</span>)</dl></div>
  <div data-fill-with=warning></div>
  <p class=copyright data-fill-with=copyright><a href=http://www.w3.org/Consortium/Legal/ipr-notice#Copyright>Copyright</a> © 2013 <a href=http://www.w3.org/><abbr title="World Wide Web Consortium">W3C</abbr></a><sup>®</sup> (<a href=http://www.csail.mit.edu/><abbr title="Massachusetts Institute of Technology">MIT</abbr></a>, <a href=http://www.ercim.eu/><abbr title="European Research Consortium for Informatics and Mathematics">ERCIM</abbr></a>, <a href=http://www.keio.ac.jp/>Keio</a>, <a href=http://ev.buaa.edu.cn/>Beihang</a>), All Rights Reserved. W3C <a href=http://www.w3.org/Consortium/Legal/ipr-notice#Legal_Disclaimer>liability</a>, <a href=http://www.w3.org/Consortium/Legal/ipr-notice#W3C_Trademarks>trademark</a> and <a href=http://www.w3.org/Consortium/Legal/copyright-documents>document use</a> rules apply.</p>
  <hr title="Separator for header">
</div>

<h2 class="no-num no-toc no-ref heading settled heading" id=abstract><span class=content>Abstract</span></h2>
<p class=p-summary data-fill-with=abstract>This CSS module describes events and interfaces used for dynamically loading font resources.
<a href=http://www.w3.org/TR/CSS/>CSS</a> is a language for describing the rendering of structured documents 
(such as HTML and XML) 
on screen, on paper, in speech, etc.</p>

<h2 class="no-num no-toc no-ref heading settled heading" id=status><span class=content>Status of this document</span></h2>
<div data-fill-with=status><p>
	This is a public copy of the editors' draft. 
	It is provided for discussion only and may change at any moment. 
	Its publication here does not imply endorsement of its contents by W3C. 
	Don’t cite this document other than as work in progress.

<p>
	The (<a href=http://lists.w3.org/Archives/Public/www-style/>archived</a>) public mailing list
	<a href="mailto:www-style@w3.org?Subject=%5Bcss-font-load-events%5D%20PUT%20SUBJECT%20HERE">www-style@w3.org</a> 
	(see <a href=http://www.w3.org/Mail/Request>instructions</a>) 
	is preferred for discussion of this specification. 
	When sending e-mail, 
	please put the text “css-font-load-events” in the subject, 
	preferably like this:
	“[css-font-load-events] <em>…summary of comment…</em>”

<p>
	This document was produced by the <a href=/Style/CSS/members>CSS Working Group</a> 
	(part of the <a href=/Style/>Style Activity</a>).

<p>
	This document was produced by a group operating under 
	the <a href=/Consortium/Patent-Policy-20040205/>5 February 2004 W3C Patent Policy</a>. 
	W3C maintains a <a href=/2004/01/pp-impl/32061/status rel=disclosure>public list of any patent disclosures</a> 
	made in connection with the deliverables of the group; 
	that page also includes instructions for disclosing a patent. 
	An individual who has actual knowledge of a patent which the individual believes contains <a href=/Consortium/Patent-Policy-20040205/#def-essential>Essential Claim(s)</a> 
	must disclose the information in accordance with <a href=/Consortium/Patent-Policy-20040205/#sec-Disclosure>section 6 of the W3C Patent Policy</a>.</div>
<div data-fill-with=at-risk></div>

<h2 class="no-num no-toc no-ref heading settled heading" id=contents><span class=content>Table of contents</span></h2>
<div data-fill-with=table-of-contents><ul class=toc><li><a href=#introduction><span class=secno>1</span>
Introduction</a><li><a href=#font-load-events><span class=secno>2</span>
Font Load Events</a><ul class=toc><li><a href=#document-FontFaceSet><span class=secno>2.1</span>
Extension to the <code>document</code> interface</a><li><a href=#fontface-interface><span class=secno>2.2</span>
The <code>FontFace</code> Interface</a><ul class=toc><li><a href=#font-face-constructor><span class=secno>2.2.1</span>
The Constructor</a><li><a href=#font-face-load><span class=secno>2.2.2</span>
The <code>load()</code> method</a><li><a href=#font-face-ready><span class=secno>2.2.3</span>
The <code>ready()</code> method</a><li><a href=#font-face-match><span class=secno>2.2.4</span>
The <code>match()</code> method</a><li><a href=#font-face-css-connection><span class=secno>2.2.5</span>
Connection to CSS’s <span class=css data-link-type=maybe>@font-face</span></a></ul><li><a href=#FontFaceSet-interface><span class=secno>2.3</span>
The <code>FontFaceSet</code> Interface</a><ul class=toc><li><a href=#FontFaceSet-events><span class=secno>2.3.1</span>
Events</a><li><a href=#load-method><span class=secno>2.3.2</span>
The <code>load()</code> method</a><li><a href=#check-method><span class=secno>2.3.3</span>
The <code>check()</code> method</a><li><a href=#ready-method><span class=secno>2.3.4</span>
The <code>ready()</code> method</a></ul><li><a href=#font-load-event-examples><span class=secno>2.4</span>
Font load event examples</a></ul><li><a href=#changes><span class=secno></span>Changes</a><ul class=toc><li><a href=#changes-since-20130212><span class=secno></span>
Changes from the <span>February 2013 CSS3 Fonts Working Draft</span></a></ul><li><a href=#acknowledgments><span class=secno></span>
Acknowledgments</a><li><a href=#conformance><span class=secno></span>
Conformance</a><ul class=toc><li><a href=#conventions><span class=secno></span>
Document conventions</a><li><a href=#conformance-classes><span class=secno></span>
Conformance classes</a><li><a href=#partial><span class=secno></span>
Partial implementations</a><li><a href=#experimental><span class=secno></span>
Experimental implementations</a><li><a href=#testing><span class=secno></span>
Non-experimental implementations</a></ul><li><a href=#references><span class=secno></span>
References</a><ul class=toc><li><a href=#normative><span class=secno></span>
Normative References</a><li><a href=#informative><span class=secno></span>
Informative References</a></ul><li><a href=#index><span class=secno></span>
Index</a><li><a href=#property-index><span class=secno></span>
Property index</a><li><a href=#issues-index><span class=secno></span>Issues Index</a></ul></div>



<h2 class="heading settled heading" data-level=1 id=introduction><span class=secno>1 </span><span class=content>
Introduction</span><a class=self-link href=#introduction></a></h2>

	<p class=issue id=issue-c42e0891><a class=self-link href=#issue-c42e0891></a>
		Fill in intro.

<h2 class="heading settled heading" data-level=2 id=font-load-events><span class=secno>2 </span><span class=content>
Font Load Events</span><a class=self-link href=#font-load-events></a></h2>

<p>	Since fonts defined via <a class=css data-link-type=maybe href=http://dev.w3.org/csswg/css-fonts-3/#at-font-face-rule>@font-face</a> rules are loaded on demand,
	pages may need to know precisely when fonts have completed
	downloading before measuring text elements on the page or to
	show some form of interim user interface state.

<h3 class="heading settled heading" data-level=2.1 id=document-FontFaceSet><span class=secno>2.1 </span><span class=content>
Extension to the <code>document</code> interface</span><a class=self-link href=#document-FontFaceSet></a></h3>

<p>	To allow font loading to be tracked explicitly within content
	the following event target is added to the <code>document</code> of the page:

	<pre class=idl>  partial interface Document {
    readonly attribute FontFaceSet <dfn class=idl-code data-dfn-for=Document data-dfn-type=attribute data-export="" id=dom-document-fonts>fonts<a class=self-link href=#dom-document-fonts></a></dfn>;
  };
</pre>
	<p class=issue id=issue-fbb9c14f><a class=self-link href=#issue-fbb9c14f></a>
		Look up what to do to add this to workers as well.
		I think I just need to add it to WorkerGlobalScope or something.

<h3 class="heading settled heading" data-level=2.2 id=fontface-interface><span class=secno>2.2 </span><span class=content>
The <code>FontFace</code> Interface</span><a class=self-link href=#fontface-interface></a></h3>

<p>	The <a class=idl-code data-link-type=interface>FontFace</a> interface represents a single usable font face.
	CSS <a class=css data-link-type=maybe href=http://dev.w3.org/csswg/css-fonts-3/#at-font-face-rule>@font-face</a> rules implicitly define FontFace objects,
	or they can be constructed manually from a url or binary data.

	<pre class=idl>  typedef (ArrayBuffer or ArrayBufferView) BinaryData;

  dictionary FontFaceDescriptors {
    DOMString style = "normal";
    DOMString weight = "normal";
    DOMString stretch = "normal";
    DOMString unicodeRange = "U+0-10FFFF";
    DOMString variant = "normal";
    DOMString featureSettings = "normal";
  };

  enum FontFaceLoadStatus { "unloaded", "loading", "loaded", "error" };

  [Constructor(DOMString family, (DOMString or BinaryData) source,
             FontFaceDescriptors descriptors)]
  interface FontFace {
    attribute DOMString family;
    attribute DOMString style;
    attribute DOMString weight;
    attribute DOMString stretch;
    attribute DOMString unicodeRange;
    attribute DOMString variant;
    attribute DOMString featureSettings;

    readonly attribute FontFaceLoadStatus status;

    // If the font face’s source is url-based and its status isn’t
    // "loading" or "loaded", this kicks off the load.
    void load();

    // Returns a promise that fulfills or rejects when the font face
    // reached "loaded" or "error" status.
    Promise ready();

    // Tells you whether the font matches the given set of descriptors.
    boolean match(FontFaceDescriptors descriptors, optional DOMString characters);
  };
</pre>
	<dl dfn-for=FontFace dfn-type=attribute>
		<dt><dfn data-dfn-type=dfn data-noexport="" id=family>family<a class=self-link href=#family></a></dfn>, of type <a class=idl-code data-link-type=interface>DOMString</a>
		<dt><dfn data-dfn-type=dfn data-noexport="" id=style>style<a class=self-link href=#style></a></dfn>, of type <a class=idl-code data-link-type=interface>DOMString</a>
		<dt><dfn data-dfn-type=dfn data-noexport="" id=weight>weight<a class=self-link href=#weight></a></dfn>, of type <a class=idl-code data-link-type=interface>DOMString</a>
		<dt><dfn data-dfn-type=dfn data-noexport="" id=stretch>stretch<a class=self-link href=#stretch></a></dfn>, of type <a class=idl-code data-link-type=interface>DOMString</a>
		<dt><dfn data-dfn-type=dfn data-noexport="" id=unicoderange>unicodeRange<a class=self-link href=#unicoderange></a></dfn>, of type <a class=idl-code data-link-type=interface>DOMString</a>
		<dd>
			These attributes all represent the corresponding aspects of a font face,
			as defined by the descriptors defined in the CSS <a class=css data-link-type=maybe href=http://dev.w3.org/csswg/css-fonts-3/#at-font-face-rule>@font-face</a> rule.
			They are parsed the same as the corresponding <a class=css data-link-type=maybe href=http://dev.w3.org/csswg/css-fonts-3/#at-font-face-rule>@font-face</a> descriptors.
			They are used by the font matching algorithm,
			but otherwise have no effect.

<p>			For example, a FontFace with a <a class=idl-code data-link-type=attribute>style</a> of <code>"italic"</code>
			<em>represents</em> an italic font face;
			it does not <strong>make</strong> the font face italic.

		<dt><dfn data-dfn-type=dfn data-noexport="" id=variant>variant<a class=self-link href=#variant></a></dfn>, of type <a class=idl-code data-link-type=interface>DOMString</a>
		<dt><dfn data-dfn-type=dfn data-noexport="" id=featuresettings>featureSettings<a class=self-link href=#featuresettings></a></dfn>, of type <a class=idl-code data-link-type=interface>DOMString</a>
		<dd>
			These attributes have the same meaning,
			and are parsed the same as,
			the corresponding descriptors in the CSS <a class=css data-link-type=maybe href=http://dev.w3.org/csswg/css-fonts-3/#at-font-face-rule>@font-face</a> rules.

<p>			They turn on or off specific features in fonts that support them.
			Unlike the previous attributes,
			these attributes actually affect the font face.

		<dt><dfn data-dfn-type=dfn data-noexport="" id=status0>status<a class=self-link href=#status0></a></dfn>, of type <a class=idl-code data-link-type=enum>FontFaceLoadStatus</a>
		<dd>
			This attribute reflects the current status of the font face.
			It must be "unloaded" for a newly-created <a class=idl-code data-link-type=interface>FontFace</a>.

<p>			It can change due to an author explicitly requesting a font face to load,
			such as through the <a class=idl-code data-link-for=FontFace data-link-type=method href=#dom-fontface-load>load()</a> method on <a class=idl-code data-link-type=interface>FontFace</a>,
			or implicitly by the user agent,
			due to it detecting that the font face is needed to draw some text on the screen.
	</dl>

<p>	All <a class=idl-code data-link-type=interface>FontFace</a> objects contain an internal <dfn class=idl-code data-dfn-for=FontFace data-dfn-type=attribute data-export="" id=dom-fontface-fontstatuspromise>[[FontStatusPromise]]<a class=self-link href=#dom-fontface-fontstatuspromise></a></dfn> attribute,
	which tracks the status of the font.
	It starts out pending,
	and fulfills or rejects when the font is successfully loaded and parsed, or hits an error.

<p>	All <a class=idl-code data-link-type=interface>FontFace</a> objects also contain 
	internal <dfn class=idl-code data-dfn-for=FontFace data-dfn-type=attribute data-export="" id=dom-fontface-urls>[[Urls]]<a class=self-link href=#dom-fontface-urls></a></dfn> and <dfn class=idl-code data-dfn-for=FontFace data-dfn-type=attribute data-export="" id=dom-fontface-data>[[Data]]<a class=self-link href=#dom-fontface-data></a></dfn> attributes,
	of which one is not <code>null</code> and the rest are <code>null</code>.

<h4 class="heading settled heading" data-level=2.2.1 id=font-face-constructor><span class=secno>2.2.1 </span><span class=content>
The Constructor</span><a class=self-link href=#font-face-constructor></a></h4>

<p>	A <a class=idl-code data-link-type=interface>FontFace</a> can be constructed either
	from a URL pointing to a font face file,
	or from an ArrayBuffer (or ArrayBufferView) containing the binary representation of a font face.

<p>	When the <dfn data-dfn-type=dfn data-noexport="" id=constructordomstring-family-domstring-or-binarydata-source-fontfacedescriptors-descriptors>Constructor(DOMString family, (DOMString or BinaryData) source, FontFaceDescriptors descriptors)<a class=self-link href=#constructordomstring-family-domstring-or-binarydata-source-fontfacedescriptors-descriptors></a></dfn> method is called,
	execute these steps:

	<ol link-type=idl>
		<li>
			Let <var>font face</var> be a fresh <a>FontFace</a> object.
			Set <var>font face’s</var> <a href=#status0>status</a> argument to <code>"unloaded"</code>.
			Set its internal <a>[[FontStatusPromise]]</a> attribute to a fresh pending <a>Promise</a> object.

		<li>
			Parse the <a href=#family>family</a> argument,
			and the members of the <a>descriptors</a> argument,
			according to the grammars of the corresponding descriptors of the CSS <a class=css data-link-type=maybe href=http://dev.w3.org/csswg/css-fonts-3/#at-font-face-rule>@font-face</a> rule.
			If any of them fail to parse correctly,
			throw a SyntaxError exception and abort these steps.
			Otherwise, set <var>font face’s</var> corresponding attributes to the serialization of the parsed values.

		<li>
			If the <a>source</a> argument was a <a>DOMString</a>,
			parse it according to the grammar of the <a class=property data-link-type=propdesc href=http://dev.w3.org/csswg/css-fonts-3/#descdef-src title=src>src</a> descriptor of the CSS <a class=css data-link-type=maybe href=http://dev.w3.org/csswg/css-fonts-3/#at-font-face-rule>@font-face</a> rule.
			If it fails to parse correctly,
			throw a SyntaxError exception and abort these steps;
			otherwise, set <var>font face’s</var> internal <a>[[Urls]]</a> attribute to the string.

<p class=note>			Note: Note that this means that passing a naked url as the source argument,
			like <code>"http://example.com/myFont.woff"</code>,
			won’t work - it needs to be at least wrapped in a <span class=css data-link-type=maybe>url()</span> function,
			like <code>"url(http://example.com/myFont.woff)"</code>.
			In return for this inconvenience,
			you get to specify multiple fallbacks,
			specify the type of font each fallback is,
			and refer to local fonts easily.

<p>			If the <a>source</a> argument was a <a>BinaryData</a>,
			set <var>font face’s</var> internal <a>[[Data]]</a> attribute to the passed argument.

		<li>
			Return the <a>FontFace</a> object.
			Complete the rest of these steps asynchronously.

		<li>
			If <var>font face’s</var> <a>[[Data]]</a> attribute is not <code>null</code>,
			set <var>font face’s</var> <a href=#status0>status</a> attribute to "loading",
			and attempt to parse the data in it as a font.
			If this is successful,
			<var>font face</var> now represents the parsed font;
			fulfill <var>font face’s</var> <a>[[FontStatusPromise]]</a> with <var>font face</var>,
			and set its <a href=#status0>status</a> attribute to "loaded".
			If it is unsuccessful,
			reject <var>font face’s</var> <a>[[FontStatusPromise]]</a> with a SyntaxError
			and set <var>font face’s</var> <a href=#status0>status</a> attribute to "error".
	</ol>

<h4 class="heading settled heading" data-level=2.2.2 id=font-face-load><span class=secno>2.2.2 </span><span class=content>
The <code>load()</code> method</span><a class=self-link href=#font-face-load></a></h4>

<p>	When the <dfn class=idl-code data-dfn-for=FontFace data-dfn-type=method data-export="" id=dom-fontface-load>load()<a class=self-link href=#dom-fontface-load></a></dfn> method is called,
	execute these steps:

	<ol link-type=idl>
		<li>
			Let <var>font face</var> be the <a>FontFace</a> object on which this method was called.

		<li>
			If <var>font face’s</var> <a>[[Urls]]</a> attribute is <code>null</code>,
			or its <a href=#status0>status</a> attribute is anything other than <code>"unloaded"</code>,
			abort this algorithm immediately.

		<li>
			Otherwise, 
			set <var>font face’s</var> <a href=#status0>status</a> attribute to "loading",
			return immediately,
			and follow these steps asynchronously:

		<li>
			Using the value of <var>font face’s <a>[[Urls]]</a> attribute,
			attempt to load a font as defined in <a data-biblio-type=informative data-link-type=biblio href=#css3fonts title=CSS3FONTS>[CSS3FONTS]</a>,
			as if it was the value of a <a class=css data-link-type=maybe href=http://dev.w3.org/csswg/css-fonts-3/#at-font-face-rule>@font-face</a> rule’s <a class=property data-link-type=propdesc href=http://dev.w3.org/csswg/css-fonts-3/#descdef-src title=src>src</a> descriptor.

		</var><li>
			If the attempt to load fails,
			reject <var>font face’s</var> <a>[[FontStatusPromise]]</a> with a NetworkError
			and set <var>font face’s</var> <a href=#status0>status</a> attribute to "error".

		<li>
			Otherwise,
			<var>font face</var> now represents the loaded font;
			fulfill <var>font face’s</var> <a>[[FontStatusPromise]]</a> with <var>font face</var>
			and set <var>font face’s</var> <a href=#status0>status</a> attribute to "loaded".
	</ol>

<h4 class="heading settled heading" data-level=2.2.3 id=font-face-ready><span class=secno>2.2.3 </span><span class=content>
The <code>ready()</code> method</span><a class=self-link href=#font-face-ready></a></h4>

<p>	When the <dfn class=idl-code data-dfn-for=FontFace data-dfn-type=method data-export="" id=dom-fontface-ready>ready()<a class=self-link href=#dom-fontface-ready></a></dfn> method is called,
	execute these steps:

	<ol link-type=idl>
		<li>
			Let <var>font face</var> be the <a>FontFace</a> object on which this method was called.

		<li>
			Return <var>font face’s</var> <a>[[FontStatusPromise]]</a>.
	</ol>

<h4 class="heading settled heading" data-level=2.2.4 id=font-face-match><span class=secno>2.2.4 </span><span class=content>
The <code>match()</code> method</span><a class=self-link href=#font-face-match></a></h4>

<p>	When the <dfn class=idl-code data-dfn-for=FontFace data-dfn-type=method data-export="" id=dom-fontface-matchfontfacedescriptors-descriptors-optional-domstring-characters title=match()>match(FontFaceDescriptors <dfn class=idl-code data-dfn-for=FontFace/match() data-dfn-type=argument data-export="" id=dom-fontfacematch-descriptors>descriptors<a class=self-link href=#dom-fontfacematch-descriptors></a></dfn>, optional DOMString <dfn class=idl-code data-dfn-for=FontFace/match() data-dfn-type=argument data-export="" id=dom-fontfacematch-characters>characters<a class=self-link href=#dom-fontfacematch-characters></a></dfn>)<a class=self-link href=#dom-fontface-matchfontfacedescriptors-descriptors-optional-domstring-characters></a></dfn> method is called,
	execute these steps:

	<p class=issue id=issue-7d93b920><a class=self-link href=#issue-7d93b920></a>
		Refer to Font’s font matching algorithm somehow.

<h4 class="heading settled heading" data-level=2.2.5 id=font-face-css-connection><span class=secno>2.2.5 </span><span class=content>
Connection to CSS’s <a class=css data-link-type=maybe href=http://dev.w3.org/csswg/css-fonts-3/#at-font-face-rule>@font-face</a></span><a class=self-link href=#font-face-css-connection></a></h4>

<p>	A CSS <a class=css data-link-type=maybe href=http://dev.w3.org/csswg/css-fonts-3/#at-font-face-rule>@font-face</a> rule automatically defines a corresponding <a class=idl-code data-link-type=interface>FontFace</a> object,
	which is automatically placed in the document’s <a class=idl-code data-link-type=attribute href=#dom-document-fonts>fonts</a> attribute.

<p>	The <a class=idl-code data-link-type=interface>FontFace</a> object corresponding to a <a class=css data-link-type=maybe href=http://dev.w3.org/csswg/css-fonts-3/#at-font-face-rule>@font-face</a> rule
	has its <a class=idl-code data-link-type=attribute>family</a>, <a class=idl-code data-link-type=attribute>style</a>, <a class=idl-code data-link-type=attribute>weight</a>, <a class=idl-code data-link-type=attribute>stretch</a>, <a class=idl-code data-link-type=attribute>unicodeRange</a>, <a class=idl-code data-link-type=attribute>variant</a>, and <a class=idl-code data-link-type=attribute>featureSettings</a> attributes set to the same value as the corresponding descriptors in the <a class=css data-link-type=maybe href=http://dev.w3.org/csswg/css-fonts-3/#at-font-face-rule>@font-face</a> rule.
	There is a two-way connection between the two:
	any change made to a <a class=css data-link-type=maybe href=http://dev.w3.org/csswg/css-fonts-3/#at-font-face-rule>@font-face</a> descriptor is immediately reflected in the corresponding <a class=idl-code data-link-type=interface>FontFace</a> attribute,
	and vice versa.

<p>	The internal <a class=idl-code data-link-type=attribute href=#dom-fontface-urls>[[Urls]]</a> attribute of the <a class=idl-code data-link-type=interface>FontFace</a> object is set to the value of the <a class=css data-link-type=maybe href=http://dev.w3.org/csswg/css-fonts-3/#at-font-face-rule>@font-face</a> rule’s <a class=property data-link-type=propdesc href=http://dev.w3.org/csswg/css-fonts-3/#descdef-src title=src>src</a> descriptor,
	and reflects any changes made to the <a class=property data-link-type=propdesc href=http://dev.w3.org/csswg/css-fonts-3/#descdef-src title=src>src</a> descriptor.

<p>	Otherwise, a <a class=idl-code data-link-type=interface>FontFace</a> object created by a CSS <a class=css data-link-type=maybe href=http://dev.w3.org/csswg/css-fonts-3/#at-font-face-rule>@font-face</a> rule is identical to one created manually.

<h3 class="heading settled heading" data-level=2.3 id=FontFaceSet-interface><span class=secno>2.3 </span><span class=content>
The <code>FontFaceSet</code> Interface</span><a class=self-link href=#FontFaceSet-interface></a></h3>

	<pre class=idl>  dictionary <dfn class=idl-code data-dfn-type=dictionary data-export="" id=dictdef-cssfontfaceloadeventinit>CSSFontFaceLoadEventInit<a class=self-link href=#dictdef-cssfontfaceloadeventinit></a></dfn> : <a class=idl-code data-link-type=dictionary>EventInit</a> {
    sequence<cssfontfacerule> <dfn class=idl-code data-dfn-for=CSSFontFaceLoadEventInit data-dfn-type=dictmember data-export="" id=dom-cssfontfaceloadeventinit-fontfaces>fontfaces<a class=self-link href=#dom-cssfontfaceloadeventinit-fontfaces></a></dfn> = null;
  };

  [Constructor(DOMString type, optional <a class=idl-code data-link-type=dictionary href=#dictdef-cssfontfaceloadeventinit>CSSFontFaceLoadEventInit</a> eventInitDict)]
  interface <dfn class=idl-code data-dfn-type=interface data-export="" id=dom-cssfontfaceloadevent>CSSFontFaceLoadEvent<a class=self-link href=#dom-cssfontfaceloadevent></a></dfn> : <a class=idl-code data-link-type=interface>Event</a> {
    readonly attribute sequence<cssfontfacerule> <dfn class=idl-code data-dfn-for=CSSFontFaceLoadEvent data-dfn-type=attribute data-export="" id=dom-cssfontfaceloadevent-fontfaces>fontfaces<a class=self-link href=#dom-cssfontfaceloadevent-fontfaces></a></dfn>;
  }

  enum FontFaceSetLoadStatus { "loading", "loaded" };

  [SetClass(<a class=idl-code data-link-type=interface>FontFace</a>)]
  interface <dfn class=idl-code data-dfn-type=interface data-export="" id=dom-fontfaceset>FontFaceSet<a class=self-link href=#dom-fontfaceset></a></dfn> {

    // -- events for when loading state changes
    attribute <a class=idl-code data-link-type=interface href=http://www.w3.org/html/wg/drafts/html/CR/webappapis.html#eventhandler>EventHandler</a> <dfn class=idl-code data-dfn-for=FontFaceSet data-dfn-type=attribute data-export="" id=dom-fontfaceset-onloading>onloading<a class=self-link href=#dom-fontfaceset-onloading></a></dfn>;
    attribute <a class=idl-code data-link-type=interface href=http://www.w3.org/html/wg/drafts/html/CR/webappapis.html#eventhandler>EventHandler</a> <dfn class=idl-code data-dfn-for=FontFaceSet data-dfn-type=attribute data-export="" id=dom-fontfaceset-onloadingdone>onloadingdone<a class=self-link href=#dom-fontfaceset-onloadingdone></a></dfn>;
    attribute <a class=idl-code data-link-type=interface href=http://www.w3.org/html/wg/drafts/html/CR/webappapis.html#eventhandler>EventHandler</a> <dfn class=idl-code data-dfn-for=FontFaceSet data-dfn-type=attribute data-export="" id=dom-fontfaceset-onloadingerror>onloadingerror<a class=self-link href=#dom-fontfaceset-onloadingerror></a></dfn>;

    // check and start load if appropriate
    // and fulfill promise when all loads complete
    Promise <a class=idl-code data-link-for=FontFaceSet data-link-type=method href=#dom-fontfaceset-loadfont-text title=load()>load</a>(DOMString font, optional DOMString text = " ");

    // return whether all fonts in the fontlist are loaded
    // (does not initiate load if not available)
    boolean <a class=idl-code data-link-for=FontFaceSet data-link-type=method href=#dom-fontfaceset-checkfont-text title=check()>check</a>(DOMString font, optional DOMString text = " ");

    // async notification that font loading and layout operations are done
    Promise <a class=idl-code data-link-for=FontFaceSet data-link-type=method href=#dom-fontfaceset-ready title=ready()>ready</a>();

    // loading state, true while one or more fonts loading, false otherwise
    readonly attribute boolean <dfn class=idl-code data-dfn-for=FontFaceSet data-dfn-type=attribute data-export="" id=dom-fontfaceset-loading0>loading<a class=self-link href=#dom-fontfaceset-loading0></a></dfn>;
  };

  <a class=idl-code data-link-type=interface href=#dom-fontfaceset>FontFaceSet</a> implements <a class=idl-code data-link-type=interface>EventTarget</a>;
</cssfontfacerule></cssfontfacerule></pre>
<p>	The set entries for a <a class=idl-code data-link-type=interface href=#dom-fontfaceset>FontFaceSet</a> in the <a class=idl-code data-link-type=attribute href=#dom-document-fonts>fonts</a> attribute of a document
	are initially populated with the corresponding <a class=idl-code data-link-type=interface>FontFace</a> objects
	from all of the CSS <a class=css data-link-type=maybe href=http://dev.w3.org/csswg/css-fonts-3/#at-font-face-rule>@font-face</a> rules in the document’s stylesheets,
	in document order.
	As stylesheets are added to or removed from the document,
	this initial segment of set entries is changed accordingly,
	always maintaining document order.
	Manually-added <a class=idl-code data-link-type=interface>FontFace</a> objects appear in the set entries
	after the <a class=css data-link-type=maybe href=http://dev.w3.org/csswg/css-fonts-3/#at-font-face-rule>@font-face</a>-generated ones,
	in insertion order.

<p>	Because font families are loaded only when they are used, 
	content sometimes needs to understand when the loading of fonts occurs.  
	Authors can use the events and methods defined here to allow greater control over actions 
	that are dependent upon the availability of specific fonts.

<p>	The term <dfn data-dfn-type=dfn data-noexport="" id=font-load>font load<a class=self-link href=#font-load></a></dfn> is used below to indicate when the
	loading of content for a given <code>@font-face</code> rule completes.
	A <a class=idl-code data-link-type=interface>FontFace</a> object may list multiple alternate resources
	within its <a class=idl-code data-link-type=attribute href=#dom-fontface-urls>[[Urls]]</a> attribute, 
	including references to local fonts,
	but the term font load only refers to the loading of the finally selected resource for a given <a class=idl-code data-link-type=interface>FontFace</a>, 
	not to the loading of each individual resource.

	<p class=issue id=issue-30993915><a class=self-link href=#issue-30993915></a>
		Document the FontFaceSet behavior for Workers.
		(They start out empty, but can construct fonts or be sent them via postMessage.)

<h4 class="heading settled heading" data-level=2.3.1 id=FontFaceSet-events><span class=secno>2.3.1 </span><span class=content>
Events</span><a class=self-link href=#FontFaceSet-events></a></h4>

<p>	Font load events are grouped into two general categories, events
	associated with a group of fonts loading (<dfn class=idl-code data-dfn-for=FontFaceSet data-dfn-type=event data-export="" id=dom-fontfaceset-loading>loading<a class=self-link href=#dom-fontfaceset-loading></a></dfn>,
	<dfn class=idl-code data-dfn-for=FontFaceSet data-dfn-type=event data-export="" id=dom-fontfaceset-loadingdone>loadingdone<a class=self-link href=#dom-fontfaceset-loadingdone></a></dfn>) or finer-grained events associated
	with each individual font loaded (<dfn class=idl-code data-dfn-for=FontFaceSet data-dfn-type=event data-export="" id=dom-fontfaceset-loadstart>loadstart<a class=self-link href=#dom-fontfaceset-loadstart></a></dfn>,
	<dfn class=idl-code data-dfn-for=FontFaceSet data-dfn-type=event data-export="" id=dom-fontfaceset-load>load<a class=self-link href=#dom-fontfaceset-load></a></dfn>, <dfn class=idl-code data-dfn-for=FontFaceSet data-dfn-type=event data-export="" id=dom-fontfaceset-error>error<a class=self-link href=#dom-fontfaceset-error></a></dfn>).

<p>	The following are the event handlers (and their corresponding event handler event types)
	that must be supported by <code>FontFaceSet</code> objects as IDL attributes:

	<table class=data id=eventhandlers>
		<thead>
			<tr>
				<th>Event handler
				<th>Event handler event type
		<tbody>
			<tr>
				<th><a class=idl-code data-link-type=attribute href=#dom-fontfaceset-onloading>onloading</a>
				<td><a class=idl-code data-link-type=event href=#dom-fontfaceset-loading>loading</a>
			<tr>
				<th><a class=idl-code data-link-type=attribute href=#dom-fontfaceset-onloadingdone>onloadingdone</a>
				<td><a class=idl-code data-link-type=event href=#dom-fontfaceset-loadingdone>loadingdone</a>
			<tr>
				<th><a class=idl-code data-link-type=attribute href=#dom-fontfaceset-onloadingerror>onloadingerror</a>
				<td><a class=idl-code data-link-type=event>loadingerror</a>
	</table>

<p>	To <dfn data-dfn-type=dfn data-noexport="" id=fire-a-font-load-event>fire a font load event<a class=self-link href=#fire-a-font-load-event></a></dfn> named <var>e</var> at a <a class=idl-code data-link-type=interface href=#dom-fontfaceset>FontFaceSet</a> target
	means to
	<a href=http://www.w3.org/TR/html5/webappapis.html#event-firing>fire a simple event</a> named <var>e</var>
	using the <a class=idl-code data-link-type=interface href=#dom-cssfontfaceloadevent>CSSFontFaceLoadEvent</a> interface that also meets these conditions:

	<ol>
		<li>
			The <a class=idl-code data-link-type=attribute>fontface</a> attribute is initialized to the given <var>font
			face rule</var>.

		<li>
			The <a class=idl-code data-link-type=attribute>error</a> attribute is initialized to the given <var>error</var>, if one occurred during the font load.
	</ol>

<p>	When the user agent determines that one or more fonts
	defined via <a class=css data-link-type=maybe href=http://dev.w3.org/csswg/css-fonts-3/#at-font-face-rule>@font-face</a> rules in a document <var>doc</var>
	need to be loaded, it must run the following steps:

	<ol>
		<li>
			Let <var>font loader</var> be the value of the <a class=idl-code data-link-type=attribute>FontFaceSet</a> attribute of <var>doc</var>.

		<li>
			Set the <code class=idl-code>loading</code> attribute of <var>font loader</var> to true.

		<li>
			<a href=#fire-a-font-load-event>Fire a font load event</a> named <a class=idl-code data-link-type=event href=#dom-fontfaceset-loading>loading</a> at <var>font loader</var>
			with <a class=idl-code data-link-type=attribute>fontface</a> set to the first <a class=css data-link-type=maybe href=http://dev.w3.org/csswg/css-fonts-3/#at-font-face-rule>@font-face</a> rule.

		<li>
			When the user agent begins loading the first resource for a given <code>@font-face</code> rule, it must <a href=#fire-a-font-load-event>fire a
			font load event</a> named <a class=idl-code data-link-type=event href=#dom-fontfaceset-loadstart>loadstart</a> at <var>font loader</var>
			with <a class=idl-code data-link-type=attribute>fontface</a> set to the given <a class=css data-link-type=maybe href=http://dev.w3.org/csswg/css-fonts-3/#at-font-face-rule>@font-face</a> rule.
	</ol>

<p>	These steps imply that if fonts are loaded concurrently, the
	<a class=idl-code data-link-type=event href=#dom-fontfaceset-loading>loading</a> event will fire just once, while
	the <a class=idl-code data-link-type=event href=#dom-fontfaceset-loadstart>loadstart</a> event will be fired once
	for each <a class=css data-link-type=maybe href=http://dev.w3.org/csswg/css-fonts-3/#at-font-face-rule>@font-face</a> rule whose load is initiated.
	User agents must only set the <a class=idl-code data-link-type=event href=#dom-fontfaceset-error>error</a>
	attribute of a font load event to a non-null value in the cases
	noted in this section.

<p>	The term “font load” covers any of the resources listed in the
	<a class=property data-link-type=propdesc href=http://dev.w3.org/csswg/css-fonts-3/#descdef-src title=src>src</a> descriptor, including local fonts.  When multiple resources are
	listed, the “font load” is the first resource in the list to
	successfully load or the error that occurs on the last resource for
	which a load is attempted.

<p>	When the user agent completes each font load for a document <var>doc</var>,
	it must run the following steps:

	<ol>
		<li>
			Let <var>font loader</var> be the value of the <a class=idl-code data-link-type=attribute>FontFaceSet</a> attribute of <var>doc</var>.

		<li>
			If a font data was successfully loaded and activated,
			<a href=#fire-a-font-load-event>fire a font load event</a> named
			<a class=idl-code data-link-type=event href=#dom-fontfaceset-load>load</a> at <var>font loader</var> with
			<a class=idl-code data-link-type=attribute>fontface</a> set to the <a class=css data-link-type=maybe href=http://dev.w3.org/csswg/css-fonts-3/#at-font-face-rule>@font-face</a>
			rule for which the font data was loaded.

		<li>
			Otherwise, <a href=#fire-a-font-load-event>fire a font load event</a>
			named <a class=idl-code data-link-type=event href=#dom-fontfaceset-error>error</a>
			at <var>font loader</var> with <a class=idl-code data-link-type=attribute>fontface</a>
			set to the <a class=css data-link-type=maybe href=http://dev.w3.org/csswg/css-fonts-3/#at-font-face-rule>@font-face</a> rule for which the error occurred.
			If the font data can’t be loaded <a class=idl-code data-link-type=attribute>error</a>
			is set to one of the standard <a class=idl-code data-link-type=interface>DOMError</a> types (e.g. <a class=idl-code data-link-type=event>NotFoundError</a>,
			<a class=idl-code data-link-type=event>NetworkError</a>).  If the font data was downloaded but invalid,
			then <a class=idl-code data-link-type=attribute>error</a> is set to <code>"InvalidFontDataError"</code>.
			If several resources are listed in the <a class=property data-link-type=propdesc href=http://dev.w3.org/csswg/css-fonts-3/#descdef-src title=src>src</a> descriptor, the
			error that caused the last font resource in the list to fail must be used.
	</ol>

<p>	When the user agent completes the final font load for document
	<var>doc</var>, after all pending layout operations that might affect
	font selection have completed and no font loads are pending, it must
	run the following steps:

	<ol>
		<li>
			Let <var>font loader</var> be the value of the <a class=idl-code data-link-type=attribute>FontFaceSet</a> attribute of <var>doc</var>.

		<li>
			Set the <a class=idl-code data-link-type=attribute href=#dom-fontfaceset-loading0>loading</a> attribute of <var>font loader</var> to false.

		<li>
			<a href=#fire-a-font-load-event>Fire a font load event</a>
			named <a class=idl-code data-link-type=event href=#dom-fontfaceset-loadingdone>loadingdone</a>
			at <var>font loader</var> with <a class=idl-code data-link-type=attribute>fontface</a>
			set to the <a class=css data-link-type=maybe href=http://dev.w3.org/csswg/css-fonts-3/#at-font-face-rule>@font-face</a> rule of the last font loaded.
	</ol>

<p>	For example, if three fonts are loaded at the same time, a
	<a class=idl-code data-link-type=event href=#dom-fontfaceset-loading>loading</a> event followed by three <a class=idl-code data-link-type=event href=#dom-fontfaceset-loadstart>loadstart</a> events and three
	<a class=idl-code data-link-type=event href=#dom-fontfaceset-load>load</a> or <a class=idl-code data-link-type=event href=#dom-fontfaceset-error>error</a> events, followed by a
	<a class=idl-code data-link-type=event href=#dom-fontfaceset-loadingdone>loadingdone</a> event will occur.

	<p class=issue id=issue-1b6714d3><a class=self-link href=#issue-1b6714d3></a>
		Errors will go "unreported" when using the general category of font
		load events (i.e. <a class=idl-code data-link-type=event href=#dom-fontfaceset-loading>loading</a> and <a class=idl-code data-link-type=event href=#dom-fontfaceset-loadingdone>loadingdone</a>).
		This seems fine but need to confirm this.

<h4 class="heading settled heading" data-level=2.3.2 id=load-method><span class=secno>2.3.2 </span><span class=content>
The <code>load()</code> method</span><a class=self-link href=#load-method></a></h4>

<p>	The <a href=#dom-fontface-load>load()</a> method of <a class=idl-code data-link-type=interface href=#dom-fontfaceset>FontFaceSet</a> will determine whether all fonts in the given font list
	have been loaded and are available.
	If any fonts are downloadable fonts and have not already been loaded,
	the user agent will initiate the load of each of these fonts.
	It returns a Promise,
	which is fulfilled when all of the fonts are loaded and ready to be used,
	or rejected if any font failed to load properly.

<p>	When the <dfn class=idl-code data-dfn-for=FontFaceSet data-dfn-type=method data-export="" id=dom-fontfaceset-loadfont-text title=load()>load(<dfn class=idl-code data-dfn-for=FontFaceSet/load() data-dfn-type=argument data-export="" id=dom-fontfacesetload-font>font<a class=self-link href=#dom-fontfacesetload-font></a></dfn>, <dfn class=idl-code data-dfn-for=FontFaceSet/load() data-dfn-type=argument data-export="" id=dom-fontfacesetload-text>text<a class=self-link href=#dom-fontfacesetload-text></a></dfn>)<a class=self-link href=#dom-fontfaceset-loadfont-text></a></dfn> method is called,
	execute these steps:

	<ol>
		<li>
			Let <var>font load promise</var> be a new pending Promise.
			Return <var>font load promise</var>.
			Run the remaining steps in this algorithm asynchronously.

		<li>
			Parse the value of the <a class=idl-code data-link-for=load() data-link-type=argument>font</a> argument, 
			using the CSS value syntax of the <a class=property data-link-type=propdesc href=http://dev.w3.org/csswg/css-fonts-3/#propdef-font title=font>font</a> property.

		<li>
			If a syntax error occurs,
			reject <var>font load promise</var> with a SyntaxError.

		<li>
			Otherwise, let <var>font family list</var> be the set of families and
			<var>font style</var> be the other font style attributes.

		<li>
			For each family in <var>font family list</var>, 
			use the font matching rules to select the font faces that match the <var>font style</var>.
			In the case where these are font faces defined via <a class=css data-link-type=maybe href=http://dev.w3.org/csswg/css-fonts-3/#at-font-face-rule>@font-face</a> rules, 
			the use of <a class=property data-link-type=propdesc href=http://dev.w3.org/csswg/css-fonts-3/#descdef-unicode-range title=unicode-range>unicode-range</a> means that this may be more than just a single font face.

		<li>
			Remove from the set of font faces all faces that have defined <a class=property data-link-type=propdesc href=http://dev.w3.org/csswg/css-fonts-3/#descdef-unicode-range title=unicode-range>unicode-range</a>
			values that don’t intersect the range of character values in the <a class=idl-code data-link-for=load() data-link-type=argument>text</a>
			argument and set this to be the <var>font load list</var>.

		<li>
			If the <var>font load list</var> contains no font faces,
			reject <var>font load promise</var> with a TypeError.

		<li>
			For all of the font faces in the <var>font load list</var>,
			call their <a href=#dom-fontface-load>load()</a> method.

		<li>
			Create a new promise by calling <code>Promise.every()</code>
			and passing it the <a>[[FontStatusPromise]]</a> of each font face in the <var>font load list</var>, in order.

		<li>
			Resolve <var>font load promise</var> with the promise produced in the previous step.
	</ol>

<h4 class="heading settled heading" data-level=2.3.3 id=check-method><span class=secno>2.3.3 </span><span class=content>
The <code>check()</code> method</span><a class=self-link href=#check-method></a></h4>

<p>	The <a href=#dom-fontfaceset-checkfont-text>check()</a> method of <a class=idl-code data-link-type=interface href=#dom-fontfaceset>FontFaceSet</a> will determine whether all fonts in the given font list
	have been loaded and are available.
	If all fonts are available,
	it returns true;
	otherwise, it returns false.

<p>	When the <dfn class=idl-code data-dfn-for=FontFaceSet data-dfn-type=method data-export="" id=dom-fontfaceset-checkfont-text title=check()>check(<dfn class=idl-code data-dfn-for=FontFaceSet/check() data-dfn-type=argument data-export="" id=dom-fontfacesetcheck-font>font<a class=self-link href=#dom-fontfacesetcheck-font></a></dfn>, <dfn class=idl-code data-dfn-for=FontFaceSet/check() data-dfn-type=argument data-export="" id=dom-fontfacesetcheck-text>text<a class=self-link href=#dom-fontfacesetcheck-text></a></dfn>)<a class=self-link href=#dom-fontfaceset-checkfont-text></a></dfn> method is called,
	execute these steps:

	<ol>
		<li>
			Parse the value of the <a class=idl-code data-link-for=check() data-link-type=argument>font</a> parameter,
			using the CSS value syntax of the <a class=property data-link-type=propdesc href=http://dev.w3.org/csswg/css-fonts-3/#propdef-font title=font>font</a> property.

		<li>
			If a syntax error occurs, return <code>false</code>.

		<li>
			Otherwise, let <var>font family list</var> be the set of families and
			<var>font style</var> be the other font style attributes.

		<li>
			For each family in <var>font family list</var>, 
			use the font matching rules to select the font faces that match the <var>font style</var>.  
			In the case where these are font faces defined via <a class=css data-link-type=maybe href=http://dev.w3.org/csswg/css-fonts-3/#at-font-face-rule>@font-face</a> rules, 
			the use of 'unicode-range’means that this may be more than just a single font face.

		<li>
			Remove from the set of font faces all faces that have defined <a class=property data-link-type=propdesc href=http://dev.w3.org/csswg/css-fonts-3/#descdef-unicode-range title=unicode-range>unicode-range</a>
			values that don’t intersect the range of character values in the <a class=idl-code data-link-for=check() data-link-type=argument>text</a>
			parameter and set this to be the <var>font load list</var>.

		<li>
			If the <var>font load list</var> contains no font faces, return <code class=idl-code>false</code>.

		<li>
			If all fonts in the <var>font load list</var> have already successfully been loaded,
			return <code>true</code>.  Otherwise, return <code>false</code>.
	</ol>

<p>	The <a class=idl-code data-link-for=check() data-link-type=argument>font</a> parameter of <a href=#dom-fontfaceset-checkfont-text>check()</a>
	and <a href=#dom-fontface-load>load()</a> both specify the list of fonts to load.  
	These values must be parsed using the same syntax as values for the CSS <a class=property data-link-type=propdesc href=http://dev.w3.org/csswg/css-fonts-3/#propdef-font title=font>font</a> property,
	the same way the <a class=idl-code data-link-type=attribute>font</a> attribute of the <a class=idl-code data-link-type=interface>CanvasRenderingContext2D</a> is interpreted. <a data-biblio-type=normative data-link-type=biblio href=#html5 title=HTML5>[HTML5]</a>
	This yields a list of font families along with font style attributes.

<h4 class="heading settled heading" data-level=2.3.4 id=ready-method><span class=secno>2.3.4 </span><span class=content>
The <code>ready()</code> method</span><a class=self-link href=#ready-method></a></h4>

<p>	Because the number of fonts loaded depends on the how many fonts are used for a given piece of text, 
	in some cases whether fonts need to be loaded or not may not be known.
	The <a href=#dom-fontface-ready>ready()</a> method returns a Promise which is fulfilled when the document is done loading fonts,
	which provides a way for authors to avoid having to keep track of which fonts have or haven’t been loaded 
	before examining content which may be affected by loading fonts.

<p>	When the <dfn class=idl-code data-dfn-for=FontFaceSet data-dfn-type=method data-export="" id=dom-fontfaceset-ready>ready()<a class=self-link href=#dom-fontfaceset-ready></a></dfn> method is called,
	execute these steps:

	<ol>
		<li>
			Let <var>font face set</var> be the value of the <a class=idl-code data-link-type=attribute>FontFaceSet</a> attribute of the document.
			Let <var>font readiness promise</var> be a fresh Promise which is initially pending.

		<li>
			Return <var>font readiness promise</var>.
			Execute the rest of these steps asynchronously.

		<li>
			At the earliest point after there are <a href=#no-pending-font-loads>no pending font loads</a>,
			fulfill <var>font readiness promise</var> with <var>font face set</var>.
	</ol>

<p>	There are <dfn data-dfn-type=dfn data-noexport="" id=no-pending-font-loads>no pending font loads<a class=self-link href=#no-pending-font-loads></a></dfn> whenever all of the following are true:

<p>	<ul>
		<li>
			The document has finished loading.

		<li>
			There are no pending stylesheet requests.

		<li>
			There are no <a class=idl-code data-link-type=interface>FontFace</a> objects in <var>font face set</var>
			with a <a class=idl-code data-link-for=FontFace data-link-type=attribute>status</a> of "loading".

		<li>
			There are no pending layout operations which might cause the user agent to request a font.
	</ul>

<p>	If any of the above conditions are false,
	there are <dfn data-dfn-type=dfn data-noexport="" id=possibly-pending-font-loads>possibly pending font loads<a class=self-link href=#possibly-pending-font-loads></a></dfn>.

<p class=note>	Note: Authors should note that a given <a>font readiness promise</a> is only fulfilled once,
	but further fonts may be loaded after it fulfills.
	This is similar to listening for a <a class=idl-code data-link-type=event href=#dom-fontfaceset-loadingdone>loadingdone</a> event to fire,
	but the callbacks passed to the <a class=idl-code data-link-type=method href=#dom-fontface-ready>ready()</a> promise will <strong>always</strong> get called,
	even when no font loads occur because the fonts in question are already loaded.  
	It’s a simple, easy way to synchronize code to font loads 
	without the need to keep track of what fonts are needed and precisely when they load.

<p class=note>	Note: Note that the user agent may need to iterate over multiple font loads before the <a>font readiness promise</a> is fulfilled.
	This can occur with font fallback situations, 
	where one font in the fontlist is loaded 
	but doesn’t contain a particular glyph 
	and other fonts in the fontlist need to be loaded.  
	The <a>font readiness promise</a> is only fulfilled after layout operations complete 
	and no additional font loads are necessary.

<h3 class="heading settled heading" data-level=2.4 id=font-load-event-examples><span class=secno>2.4 </span><span class=content>
Font load event examples</span><a class=self-link href=#font-load-event-examples></a></h3>

	<div class=example>
		To show content only after all font loads complete:

		<pre>  document.FontFaceSet.ready().then(function() {
    var content = document.getElementById("content");
    content.style.visibility = "visible";
  });
</pre>	</div>

	<div class=example>
		Drawing text in a canvas with a downloadable font, explicitly
		initiating the font download and drawing upon completion:

		<pre>  function drawStuff() {
    var ctx = document.getElementById("c").getContext("2d");

    ctx.fillStyle = "red";
    ctx.font = "50px MyDownloadableFont";
    ctx.fillText("Hello!", 100, 100);
  }

  document.FontFaceSet.load("50px MyDownloadableFont")
                       .then(drawStuff, handleError);
</pre>	</div>

	<div class=example>
		A rich text editing application may need to measure text elements
		after editing operations have taken place.  Since style changes may
		or may not require additional fonts to be downloaded, or the fonts
		may already have been downloaded, the measurement procedures need to
		occur after those font loads complete:

		<pre>  function measureTextElements() {
    // contents can now be measured using the metrics of
    // the downloadable font(s)
  }

  function doEditing() {
    // content/layout operations that may cause additional font loads
    document.FontFaceSet.ready().then(measureTextElements);
  }
</pre>	</div>

	<div class=example>
		Unlike the per-font load events, the
		<a class=idl-code data-link-type=event href=#dom-fontfaceset-loadingdone>loadingdone</a> event only fires after all
		font related loads have completed <strong>and</strong> text has been
		laid out without causing additional font loads:

		<pre>  @font-face {
    font-family: latin-serif;
    src: url(latinserif.woff) format("woff"); /* contains no kanji/kana */
  }

  @font-face {
    font-family: jpn-mincho;
    src: url(mincho.woff) format("woff");
  }

  body { font-family: latin-serif, jpn-mincho; }

  &lt;p&gt;納豆はいかがでしょうか
</pre>
<p>		In this situation, the user agent first downloads “latinserif.woff”
		and then tries to use this to draw the Japanese text.  But because no
		Japanese glyphs are present in that font, fallback occurs and the font
		“mincho.woff” is downloaded.  Only after the second font is downloaded
		and the Japanese text laid out does the <a class=idl-code data-link-type=event href=#dom-fontfaceset-loadingdone>loadingdone</a>
		event fire.
	</div>


<h2 class="no-num heading settled heading" id=changes><span class=content>Changes</span><a class=self-link href=#changes></a></h2>

<h3 class="no-num heading settled heading" id=changes-since-20130212><span class=content>
Changes from the <a href=http://www.w3.org/TR/2013/WD-css3-fonts-20130212/>February 2013 CSS3 Fonts Working Draft</a></span><a class=self-link href=#changes-since-20130212></a></h3>

<p>	Major changes include:

<p>	<ul>
		<li>Add details of font load errors.

		<li>Switched to a promise-based design for load() and ready().

		<li>Renamed notifyWhenFontsReady() to ready().
	</ul>

<h2 class="no-num heading settled heading" id=acknowledgments><span class=content>
Acknowledgments</span><a class=self-link href=#acknowledgments></a></h2>

<p>	Several members of the Google Fonts team provided helpful feedback on font load events,
	as did Boris Zbarsky, Jonas Sicking and ms2ger.
<h2 class="no-ref no-num heading settled heading" id=conformance><span class=content>
Conformance</span><a class=self-link href=#conformance></a></h2>

<h3 class="no-ref heading settled heading" id=conventions><span class=content>
Document conventions</span><a class=self-link href=#conventions></a></h3>

    <p>Conformance requirements are expressed with a combination of
    descriptive assertions and RFC 2119 terminology. The key words "MUST",
    "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT",
    "RECOMMENDED", "MAY", and "OPTIONAL" in the normative parts of this
    document are to be interpreted as described in RFC 2119.
    However, for readability, these words do not appear in all uppercase
    letters in this specification.

    <p>All of the text of this specification is normative except sections
    explicitly marked as non-normative, examples, and notes. <a data-biblio-type=normative data-link-type=biblio href=#rfc2119 title=RFC2119>[RFC2119]</a></p>

    <p>Examples in this specification are introduced with the words "for example"
    or are set apart from the normative text with <code>class="example"</code>,
    like this:

    <div class=example>
        <p>This is an example of an informative example.</p>
    </div>

    <p>Informative notes begin with the word "Note" and are set apart from the
    normative text with <code>class="note"</code>, like this:

    <p class=note>Note, this is an informative note.</p>

<h3 class="no-ref heading settled heading" id=conformance-classes><span class=content>
Conformance classes</span><a class=self-link href=#conformance-classes></a></h3>

    <p>Conformance to this specification
    is defined for three conformance classes:
    <dl>
        <dt>style sheet
            <dd>A <a href=http://www.w3.org/TR/CSS21/conform.html#style-sheet>CSS
            style sheet</a>.
        <dt>renderer
            <dd>A <a href=http://www.w3.org/TR/CSS21/conform.html#user-agent>UA</a>
            that interprets the semantics of a style sheet and renders
            documents that use them.
        <dt>authoring tool
            <dd>A <a href=http://www.w3.org/TR/CSS21/conform.html#user-agent>UA</a>
            that writes a style sheet.
    </dl>

    <p>A style sheet is conformant to this specification
    if all of its statements that use syntax defined in this module are valid
    according to the generic CSS grammar and the individual grammars of each
    feature defined in this module.

    <p>A renderer is conformant to this specification
    if, in addition to interpreting the style sheet as defined by the
    appropriate specifications, it supports all the features defined
    by this specification by parsing them correctly
    and rendering the document accordingly. However, the inability of a
    UA to correctly render a document due to limitations of the device
    does not make the UA non-conformant. (For example, a UA is not
    required to render color on a monochrome monitor.)

    <p>An authoring tool is conformant to this specification
    if it writes style sheets that are syntactically correct according to the
    generic CSS grammar and the individual grammars of each feature in
    this module, and meet all other conformance requirements of style sheets
    as described in this module.

<h3 class="no-ref heading settled heading" id=partial><span class=content>
Partial implementations</span><a class=self-link href=#partial></a></h3>

    <p>So that authors can exploit the forward-compatible parsing rules to
    assign fallback values, CSS renderers <strong>must</strong>
    treat as invalid (and <a href=http://www.w3.org/TR/CSS21/conform.html#ignore>ignore
    as appropriate</a>) any at-rules, properties, property values, keywords,
    and other syntactic constructs for which they have no usable level of
    support. In particular, user agents <strong>must not</strong> selectively
    ignore unsupported component values and honor supported values in a single
    multi-value property declaration: if any value is considered invalid
    (as unsupported values must be), CSS requires that the entire declaration
    be ignored.</p>

<h3 class="no-ref heading settled heading" id=experimental><span class=content>
Experimental implementations</span><a class=self-link href=#experimental></a></h3>

    <p>To avoid clashes with future CSS features, the CSS2.1 specification
    reserves a <a href=http://www.w3.org/TR/CSS21/syndata.html#vendor-keywords>prefixed
    syntax</a> for proprietary and experimental extensions to CSS.

    <p>Prior to a specification reaching the Candidate Recommendation stage
    in the W3C process, all implementations of a CSS feature are considered
    experimental. The CSS Working Group recommends that implementations
    use a vendor-prefixed syntax for such features, including those in
    W3C Working Drafts. This avoids incompatibilities with future changes
    in the draft.
    </p>

<h3 class="no-ref heading settled heading" id=testing><span class=content>
Non-experimental implementations</span><a class=self-link href=#testing></a></h3>

    <p>Once a specification reaches the Candidate Recommendation stage,
    non-experimental implementations are possible, and implementors should
    release an unprefixed implementation of any CR-level feature they
    can demonstrate to be correctly implemented according to spec.

    <p>To establish and maintain the interoperability of CSS across
    implementations, the CSS Working Group requests that non-experimental
    CSS renderers submit an implementation report (and, if necessary, the
    testcases used for that implementation report) to the W3C before
    releasing an unprefixed implementation of any CSS features. Testcases
    submitted to W3C are subject to review and correction by the CSS
    Working Group.

    <p>Further information on submitting testcases and implementation reports
    can be found from on the CSS Working Group’s website at
    <a href=http://www.w3.org/Style/CSS/Test/>http://www.w3.org/Style/CSS/Test/</a>.
    Questions should be directed to the
    <a href=http://lists.w3.org/Archives/Public/public-css-testsuite>public-css-testsuite@w3.org</a>
    mailing list.

<h2 class="no-num no-ref heading settled heading" id=references><span class=content>
References</span><a class=self-link href=#references></a></h2>

<h3 class="no-num no-ref heading settled heading" id=normative><span class=content>
Normative References</span><a class=self-link href=#normative></a></h3>
<div data-fill-with=normative-references><dl><dt id=html5 title=HTML5><a class=self-link href=#html5></a>[HTML5]<dd>Robin Berjon; et al. <a href=http://www.w3.org/TR/2013/CR-html5-20130806/>HTML5</a>. 6 August 2013. W3C Candidate Recommendation. (Work in progress.) URL: <a href=http://www.w3.org/TR/2013/CR-html5-20130806/>http://www.w3.org/TR/2013/CR-html5-20130806/</a><dt id=rfc2119 title=RFC2119><a class=self-link href=#rfc2119></a>[RFC2119]<dd>S. Bradner. <a href=http://www.ietf.org/rfc/rfc2119.txt>Key words for use in RFCs to Indicate Requirement Levels</a>. URL: <a href=http://www.ietf.org/rfc/rfc2119.txt>http://www.ietf.org/rfc/rfc2119.txt</a></dl></div>

<h3 class="no-num no-ref heading settled heading" id=informative><span class=content>
Informative References</span><a class=self-link href=#informative></a></h3>
<div data-fill-with=informative-references><dl></dl></div>

<h2 class="no-num no-ref heading settled heading" id=index><span class=content>
Index</span><a class=self-link href=#index></a></h2>
<div data-fill-with=index><ul class=indexlist>
<li>characters, <a href=#dom-fontfacematch-characters title="section 2.2.4">2.2.4</a>
<li>check(), <a href=#dom-fontfaceset-checkfont-text title="section 2.3.3">2.3.3</a>
<li>Constructor(DOMString family, (DOMString or BinaryData) source, FontFaceDescriptors descriptors), <a href=#constructordomstring-family-domstring-or-binarydata-source-fontfacedescriptors-descriptors title="section 2.2.1">2.2.1</a>
<li>CSSFontFaceLoadEvent, <a href=#dom-cssfontfaceloadevent title="section 2.3">2.3</a>
<li>CSSFontFaceLoadEventInit, <a href=#dictdef-cssfontfaceloadeventinit title="section 2.3">2.3</a>
<li>[[Data]], <a href=#dom-fontface-data title="section 2.2">2.2</a>
<li>descriptors, <a href=#dom-fontfacematch-descriptors title="section 2.2.4">2.2.4</a>
<li>error, <a href=#dom-fontfaceset-error title="section 2.3.1">2.3.1</a>
<li>family, <a href=#family title="section 2.2">2.2</a>
<li>featureSettings, <a href=#featuresettings title="section 2.2">2.2</a>
<li>fire a font load event, <a href=#fire-a-font-load-event title="section 2.3.1">2.3.1</a>
<li>font, <a href=#dom-fontfacesetload-font title="section 2.3.2">2.3.2</a>
<li>font, <a href=#dom-fontfacesetcheck-font title="section 2.3.3">2.3.3</a>
<li>fontfaces, <a href=#dom-cssfontfaceloadeventinit-fontfaces title="section 2.3">2.3</a>
<li>fontfaces, <a href=#dom-cssfontfaceloadevent-fontfaces title="section 2.3">2.3</a>
<li>FontFaceSet, <a href=#dom-fontfaceset title="section 2.3">2.3</a>
<li>font load, <a href=#font-load title="section 2.3">2.3</a>
<li>fonts, <a href=#dom-document-fonts title="section 2.1">2.1</a>
<li>[[FontStatusPromise]], <a href=#dom-fontface-fontstatuspromise title="section 2.2">2.2</a>
<li>load(), <a href=#dom-fontface-load title="section 2.2.2">2.2.2</a>
<li>load, <a href=#dom-fontfaceset-load title="section 2.3.1">2.3.1</a>
<li>load(), <a href=#dom-fontfaceset-loadfont-text title="section 2.3.2">2.3.2</a>
<li>loading, <a href=#dom-fontfaceset-loading0 title="section 2.3">2.3</a>
<li>loading, <a href=#dom-fontfaceset-loading title="section 2.3.1">2.3.1</a>
<li>loadingdone, <a href=#dom-fontfaceset-loadingdone title="section 2.3.1">2.3.1</a>
<li>loadstart, <a href=#dom-fontfaceset-loadstart title="section 2.3.1">2.3.1</a>
<li>match(), <a href=#dom-fontface-matchfontfacedescriptors-descriptors-optional-domstring-characters title="section 2.2.4">2.2.4</a>
<li>no pending font loads, <a href=#no-pending-font-loads title="section 2.3.4">2.3.4</a>
<li>onloading, <a href=#dom-fontfaceset-onloading title="section 2.3">2.3</a>
<li>onloadingdone, <a href=#dom-fontfaceset-onloadingdone title="section 2.3">2.3</a>
<li>onloadingerror, <a href=#dom-fontfaceset-onloadingerror title="section 2.3">2.3</a>
<li>possibly pending font loads, <a href=#possibly-pending-font-loads title="section 2.3.4">2.3.4</a>
<li>ready(), <a href=#dom-fontface-ready title="section 2.2.3">2.2.3</a>
<li>ready(), <a href=#dom-fontfaceset-ready title="section 2.3.4">2.3.4</a>
<li>status, <a href=#status0 title="section 2.2">2.2</a>
<li>stretch, <a href=#stretch title="section 2.2">2.2</a>
<li>style, <a href=#style title="section 2.2">2.2</a>
<li>text, <a href=#dom-fontfacesetload-text title="section 2.3.2">2.3.2</a>
<li>text, <a href=#dom-fontfacesetcheck-text title="section 2.3.3">2.3.3</a>
<li>unicodeRange, <a href=#unicoderange title="section 2.2">2.2</a>
<li>[[Urls]], <a href=#dom-fontface-urls title="section 2.2">2.2</a>
<li>variant, <a href=#variant title="section 2.2">2.2</a>
<li>weight, <a href=#weight title="section 2.2">2.2</a>
</ul></div>

<h2 class="no-num no-ref heading settled heading" id=property-index><span class=content>
Property index</span><a class=self-link href=#property-index></a></h2>
<div data-fill-with=property-index><p>No properties defined.</div>


<h2 class="no-num heading settled" id=issues-index><span class=content>Issues Index</span><a class=self-link href=#issues-index></a></h2><div style="counter-reset: issue"><p class=issue>
		Fill in intro.

<a href=#issue-c42e0891> ↵ </a><p class=issue>
		Look up what to do to add this to workers as well.
		I think I just need to add it to WorkerGlobalScope or something.

<a href=#issue-fbb9c14f> ↵ </a><p class=issue>
		Refer to Font’s font matching algorithm somehow.

<a href=#issue-7d93b920> ↵ </a><p class=issue>
		Document the FontFaceSet behavior for Workers.
		(They start out empty, but can construct fonts or be sent them via postMessage.)

<a href=#issue-30993915> ↵ </a><p class=issue>
		Errors will go "unreported" when using the general category of font
		load events (i.e. <a class=idl-code data-link-type=event href=#dom-fontfaceset-loading>loading</a> and <a class=idl-code data-link-type=event href=#dom-fontfaceset-loadingdone>loadingdone</a>).
		This seems fine but need to confirm this.

<a href=#issue-1b6714d3> ↵ </a></div>